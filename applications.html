<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –†–ê–ü–û–†–¢–ò –¢–ê –ö–û–î–ò</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --primary-bright: #4ade80;
            --bg: #020406;
            --card-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(34, 197, 94, 0.25);
            --text-gray: #94a3b8;
            --neon-glow: 0 0 25px rgba(34, 197, 94, 0.4);
            --error: #ef4444;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            color: white; font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 50% 50%, rgba(34, 197, 94, 0.05) 0%, #020406 100%);
            min-height: 100vh;
        }

        .admin-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .header { text-align: center; margin-bottom: 60px; }
        .header h1 { font-size: 42px; font-weight: 900; letter-spacing: -1px; margin: 0; }
        .header p { color: var(--primary); font-weight: 700; text-transform: uppercase; font-size: 14px; margin-top: 10px; }

        .section-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 50px; }
        
        @media (max-width: 900px) { .section-grid { grid-template-columns: 1fr; } }

        .glass-panel {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 30px; padding: 30px; backdrop-filter: blur(10px);
        }

        .panel-title { font-size: 20px; font-weight: 800; margin-bottom: 25px; display: flex; align-items: center; gap: 10px; }
        
        .code-box {
            background: rgba(0,0,0,0.4); border: 2px dashed var(--glass-border);
            border-radius: 15px; padding: 20px; text-align: center; margin-bottom: 20px;
        }
        .current-code { font-size: 32px; font-weight: 900; color: var(--primary-bright); letter-spacing: 5px; text-shadow: var(--neon-glow); }
        .code-timer { font-size: 12px; color: var(--text-gray); margin-top: 10px; }

        .btn {
            width: 100%; padding: 16px; border-radius: 14px; border: none;
            font-weight: 800; cursor: pointer; text-transform: uppercase; font-size: 14px; transition: 0.3s;
        }
        .btn-primary { background: var(--primary); color: black; margin-bottom: 10px; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--neon-glow); }
        
        .app-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px; padding: 25px; margin-bottom: 20px;
        }
        .app-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .app-info h3 { margin: 0; font-size: 18px; }
        .app-info p { margin: 5px 0; font-size: 13px; color: var(--text-gray); }

        .status-badge { padding: 5px 12px; border-radius: 8px; font-size: 11px; font-weight: 800; text-transform: uppercase; }
        .status-new { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .status-approved { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
        .status-rejected { background: rgba(239, 68, 68, 0.2); color: #f87171; }

        .motivation-box { background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; font-size: 14px; line-height: 1.6; margin: 15px 0; color: #cbd5e1; }

        .action-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-action { padding: 10px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; font-size: 12px; }
        .btn-approve { background: #22c55e; color: black; }
        .btn-reject { background: #ef4444; color: white; }
        .btn-delete { background: none; border: 1px solid rgba(255,255,255,0.1); color: var(--text-gray); font-size: 11px; margin-top: 10px; cursor: pointer; border-radius: 5px; padding: 4px 8px; }

        /* –í–ê–®–ê –°–ï–ö–¶–Ü–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ò (–ü–û–í–ù–Ü–°–¢–Æ –ó –û–†–ò–ì–Ü–ù–ê–õ–£) */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: var(--card-bg); border: 1px solid var(--glass-border); padding: 20px; border-radius: 20px; text-align: center; }
        .stat-value { font-size: 24px; font-weight: 900; color: var(--primary-bright); }
        .stat-label { font-size: 12px; color: var(--text-gray); text-transform: uppercase; margin-top: 5px; }
    </style>
</head>
<body oncontextmenu="return false;">

    <div class="admin-container">
        <div class="header">
            <p>–ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª–æ–º</p>
            <h1>COMMAND CENTER</h1>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div id="totalUsers" class="stat-value">...</div>
                <div class="stat-label">–í—Å—å–æ–≥–æ –±—ñ–π—Ü—ñ–≤</div>
            </div>
            <div class="stat-card">
                <div id="totalApps" class="stat-value">...</div>
                <div class="stat-label">–ù–æ–≤–∏—Ö —Ä–∞–ø–æ—Ä—Ç—ñ–≤</div>
            </div>
        </div>

        <div class="section-grid">
            <div class="glass-panel">
                <div class="panel-title">üîë –°–µ–∫—Ä–µ—Ç–Ω—ñ –∫–æ–¥–∏</div>
                
                <div class="code-box">
                    <p style="font-size: 11px; color: var(--text-gray); margin-bottom: 10px;">–î–ò–ù–ê–ú–Ü–ß–ù–ò–ô –ö–û–î (2 –•–í)</p>
                    <div id="shortCode" class="current-code">------</div>
                    <div id="shortTimer" class="code-timer">–î—ñ—î –¥–æ: --:--</div>
                </div>

                <div class="code-box">
                    <p style="font-size: 11px; color: var(--text-gray); margin-bottom: 10px;">–ü–û–°–¢–Ü–ô–ù–ò–ô –ö–û–î (48 –ì–û–î)</p>
                    <div id="longCode" class="current-code">------</div>
                    <div id="longTimer" class="code-timer">–î—ñ—î –¥–æ: --:--</div>
                </div>

                <button class="btn btn-primary" onclick="window.generateShortCode()">–û–Ω–æ–≤–∏—Ç–∏ 2-—Ö–≤ –∫–æ–¥</button>
                <button class="btn btn-primary" style="background: #3b82f6; color: white;" onclick="window.generateLongCode()">–û–Ω–æ–≤–∏—Ç–∏ 48-–≥–æ–¥ –∫–æ–¥</button>
                <button class="btn btn-primary" style="background: var(--error); color: white;" onclick="window.clearUsedCodes()">–û—á–∏—Å—Ç–∏—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –∫–æ–¥–∏</button>
            </div>

            <div class="glass-panel">
                <div class="panel-title">üìù –†–∞–ø–æ—Ä—Ç–∏ –Ω–∞ –≤—Å—Ç—É–ø</div>
                <div id="appsList">
                    <p style="text-align:center; color:var(--text-gray);">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–∞–ø–æ—Ä—Ç—ñ–≤...</p>
                </div>
            </div>
        </div>

        <div class="glass-panel" style="margin-top: 30px;">
            <div class="panel-title">üìú –û—Å—Ç–∞–Ω–Ω—ñ –¥—ñ—ó –≤ —Å–∏—Å—Ç–µ–º—ñ</div>
            <div id="systemLogs" style="font-size: 12px; color: var(--text-gray); max-height: 300px; overflow-y: auto; line-height: 1.8;">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, doc, updateDoc, deleteDoc, addDoc, serverTimestamp, getDocs, where, Timestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // –¢–í–Ü–ô –û–†–ò–ì–Ü–ù–ê–õ–¨–ù–ò–ô –ö–û–ù–§–Ü–ì
        const firebaseConfig = {
            apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
            authDomain: "dsv-gta.firebaseapp.com",
            projectId: "dsv-gta",
            storageBucket: "dsv-gta.firebasestorage.app",
            messagingSenderId: "661591588818",
            appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- –õ–û–ì–Ü–ö–ê –î–í–û–• –¢–ò–ü–Ü–í –ö–û–î–Ü–í (–¢–Ü–õ–¨–ö–ò –¢–ï, –©–û –¢–†–ï–ë–ê –ë–£–õ–û –î–û–î–ê–¢–ò) ---
        const generateID = () => Math.random().toString(36).substring(2, 8).toUpperCase();

        window.generateShortCode = async () => {
            const newCode = generateID();
            const expires = new Date(Date.now() + 2 * 60 * 1000);
            const q = query(collection(db, "codes"), where("type", "==", "short"), where("status", "==", "active"));
            const snap = await getDocs(q);
            for(const d of snap.docs) { await updateDoc(doc(db, "codes", d.id), { status: "expired" }); }
            await addDoc(collection(db, "codes"), {
                code: newCode, type: "short", status: "active",
                expiresAt: Timestamp.fromDate(expires), createdAt: serverTimestamp()
            });
        };

        window.generateLongCode = async () => {
            const newCode = generateID();
            const expires = new Date(Date.now() + 48 * 60 * 60 * 1000);
            const q = query(collection(db, "codes"), where("type", "==", "long"), where("status", "==", "active"));
            const snap = await getDocs(q);
            for(const d of snap.docs) { await updateDoc(doc(db, "codes", d.id), { status: "expired" }); }
            await addDoc(collection(db, "codes"), {
                code: newCode, type: "long", status: "active",
                expiresAt: Timestamp.fromDate(expires), createdAt: serverTimestamp()
            });
        };

        window.clearUsedCodes = async () => {
            if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ñ –∫–æ–¥–∏?")) return;
            const q = query(collection(db, "codes"), where("status", "!=", "active"));
            const snap = await getDocs(q);
            for(const d of snap.docs) { await deleteDoc(doc(db, "codes", d.id)); }
        };

        // –¢–í–Ü–ô –°–õ–£–•–ê–ß –ö–û–î–Ü–í
        onSnapshot(query(collection(db, "codes"), where("status", "==", "active")), (snap) => {
            document.getElementById('shortCode').innerText = "------";
            document.getElementById('longCode').innerText = "------";
            snap.forEach(d => {
                const data = d.data();
                const date = data.expiresAt.toDate();
                const timeStr = date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                if(data.type === 'short') {
                    document.getElementById('shortCode').innerText = data.code;
                    document.getElementById('shortTimer').innerText = `–î—ñ—î –¥–æ: ${timeStr}`;
                } else {
                    document.getElementById('longCode').innerText = data.code;
                    document.getElementById('longTimer').innerText = `–î—ñ—î –¥–æ: ${date.toLocaleDateString()} ${timeStr}`;
                }
            });
        });

        // --- –¢–í–Ü–ô –°–õ–£–•–ê–ß –†–ê–ü–û–†–¢–Ü–í (–î–û–î–ê–ù–û –ü–†–ê–¶–Æ–Æ–ß–Ü –ö–ù–û–ü–ö–ò) ---
        onSnapshot(query(collection(db, "applications"), orderBy("date", "desc")), (snap) => {
            const listUI = document.getElementById('appsList');
            document.getElementById('totalApps').innerText = snap.size;
            let html = "";
            snap.forEach(d => {
                const data = d.data();
                const id = d.id;
                const status = data.status || 'new';
                const statusClass = `status-${status}`;
                const statusText = status === 'approved' ? '–ü—Ä–∏–π–Ω—è—Ç–æ' : status === 'rejected' ? '–í—ñ–¥—Ö–∏–ª–µ–Ω–æ' : '–ù–æ–≤–∏–π';

                html += `
                    <div class="app-card">
                        <div class="app-header">
                            <div class="app-info">
                                <h3>${data.name}</h3>
                                <p>${data.rank} | Discord: ${data.discord}</p>
                                <span class="status-badge ${statusClass}">${statusText}</span>
                            </div>
                            <button class="btn-delete" onclick="window.deleteApp('${id}')">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        </div>
                        <div class="motivation-box">${data.motivation}</div>
                        ${(status === 'new' || status === 'pending') ? `
                            <div class="action-group">
                                <button class="btn-action btn-approve" onclick="window.updateStatus('${id}', 'approved')">–ü—Ä–∏–π–Ω—è—Ç–∏</button>
                                <button class="btn-action btn-reject" onclick="window.updateStatus('${id}', 'rejected')">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            listUI.innerHTML = html || '<p style="text-align:center;">–†–∞–ø–æ—Ä—Ç—ñ–≤ –Ω–µ–º–∞—î</p>';
        });

        window.updateStatus = async (id, newStatus) => {
            await updateDoc(doc(db, "applications", id), { status: newStatus });
            // –¢–í–Ü–ô –ó–ê–ü–ò–° –í –õ–û–ì–ò
            await addDoc(collection(db, "logs"), {
                action: `–°—Ç–∞—Ç—É—Å —Ä–∞–ø–æ—Ä—Ç—É ${id} –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ ${newStatus}`,
                user: "–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä",
                timestamp: serverTimestamp()
            });
        };

        window.deleteApp = async (id) => {
            if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ä–∞–ø–æ—Ä—Ç?")) await deleteDoc(doc(db, "applications", id));
        };

        // --- –¢–í–û–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–ê –õ–û–ì–ò (–ù–ï –ß–Ü–ü–ê–í) ---
        onSnapshot(collection(db, "users"), (snap) => {
            document.getElementById('totalUsers').innerText = snap.size;
        });

        onSnapshot(query(collection(db, "logs"), orderBy("timestamp", "desc")), (snap) => {
            const logUI = document.getElementById('systemLogs');
            let logHtml = "";
            snap.forEach(d => {
                const log = d.data();
                const time = log.timestamp?.toDate().toLocaleString() || "–ó–∞—Ä–∞–∑";
                logHtml += `<div><span style="color:var(--primary)">[${time}]</span> ${log.action} ‚Äî <span style="color:white">${log.user}</span></div>`;
            });
            logUI.innerHTML = logHtml;
        });
    </script>

    <script>
        document.onkeydown = function(e) {
            if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) || (e.ctrlKey && e.keyCode == 85)) {
                return false;
            }
        };

        setInterval(function() {
            (function(a) {
                return (function(a) {
                    return (Function('Function(arguments[0])(arguments[1])')(a, a));
                })(function(a) {
                    if (a === 'stateObject') { return false; }
                    debugger;
                });
            })('stateObject');
        }, 500);

        document.addEventListener('contextmenu', event => event.preventDefault());
    </script>
</body>
</html>
