<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –û–°–û–ë–ò–°–¢–ò–ô –ö–ê–ë–Ü–ù–ï–¢</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #22c55e; --bg: #030507; --card-bg: #0a0c10; --text-gray: #94a3b8; --danger: #ef4444; --warning: #f59e0b; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; min-height: 100vh; }
        
        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ—è */
        nav { display: flex; justify-content: space-between; align-items: center; padding: 15px 8%; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); position: fixed; width: 100%; box-sizing: border-box; z-index: 100; border-bottom: 1px solid rgba(34,197,94,0.1); }
        .logo-box { background: var(--primary); color: black; padding: 4px 10px; border-radius: 6px; font-weight: 800; text-decoration: none; }
        
        /* –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .section { padding: 120px 5% 60px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; box-sizing: border-box; }
        
        /* –ö–∞—Ä—Ç–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é */
        .card { background: var(--card-bg); padding: 35px; border-radius: 24px; border: 1px solid rgba(255,255,255,0.06); width: 100%; max-width: 600px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); position: relative; z-index: 10; }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 20px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05); text-align: left; }
        .stat-val { display: block; font-size: 28px; font-weight: 800; color: var(--primary); margin-bottom: 5px; }
        .stat-label { font-size: 11px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1px; }
        
        /* –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å */
        .admin-item { background: rgba(255,255,255,0.02); padding: 15px; border-radius: 12px; margin-bottom: 12px; border-left: 4px solid var(--primary); display: flex; justify-content: space-between; align-items: center; gap: 10px; }
        .admin-info { flex-grow: 1; }
        .admin-btns { display: flex; flex-wrap: wrap; gap: 6px; justify-content: flex-end; }
        
        .btn-sm { padding: 8px 12px; font-size: 11px; border-radius: 8px; border: none; cursor: pointer; font-weight: 700; color: white; transition: 0.2s; }
        .btn-sm:active { transform: scale(0.95); }
        .btn-logout { width: 100%; background: rgba(255,255,255,0.05); color: var(--text-gray); padding: 12px; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; cursor: pointer; font-weight: 600; margin-top: 10px; }

        #userProfile, #loading { display: none; }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo-box">–î–®–í</a>
    <div style="font-size: 12px; font-weight: 700; color: var(--primary); letter-spacing: 1px;">–°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–Ü–ù–ù–Ø</div>
</nav>

<section class="section">
    <div id="loading" style="display: block;">
        <p style="color: var(--primary); font-weight: 600; animation: pulse 1.5s infinite;">‚ö° –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∑ —Å–µ—Ä–≤–µ—Ä–∞...</p>
    </div>

    <div class="card" id="userProfile">
        <h2 id="uName" style="margin:0; font-size: 28px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h2>
        <p id="uRank" style="color:var(--primary); font-weight:700; margin-top:8px; font-size: 16px;">–ü–æ—Å–∞–¥–∞ —É—Ç–æ—á–Ω—é—î—Ç—å—Å—è</p>
        
        <div class="stat-grid">
            <div class="stat-box">
                <span class="stat-val" id="uID">0</span>
                <span class="stat-label">ID –ì–†–ê–í–¶–Ø</span>
            </div>
            <div class="stat-box">
                <span class="stat-val" id="uStatus" style="color: #3b82f6;">–ê–∫—Ç–∏–≤–Ω–∏–π</span>
                <span class="stat-label">–°–¢–ê–¢–£–°</span>
            </div>
            <div class="stat-box">
                <span class="stat-val" id="uWarns" style="color: var(--warning);">0</span>
                <span class="stat-label">–ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø</span>
            </div>
            <div class="stat-box">
                <span class="stat-val" id="uRep" style="color: var(--danger);">0</span>
                <span class="stat-label">–î–û–ì–ê–ù–ò</span>
            </div>
        </div>

        <button onclick="window.logout()" class="btn-logout">–ó–ê–í–ï–†–®–ò–¢–ò –°–ï–°–Ü–Æ</button>

        <div id="adminArea" style="display:none; margin-top:40px; border-top:1px solid rgba(255,255,255,0.1); padding-top:25px;">
            <h3 style="color:var(--primary); font-size:14px; margin-bottom: 20px; display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 18px;">üíé</span> –ü–ê–ù–ï–õ–¨ –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –î–®–í
            </h3>
            <div id="allUsersList"></div>
        </div>
    </div>
</section>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.firebasestorage.app",
        messagingSenderId: "661591588818",
        appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // –°–ª—É—Ö–∞—á —Å—Ç–∞–Ω—É –≤—Ö–æ–¥—É
    onAuthStateChanged(auth, (user) => {
        if (user) { 
            loadData(user.uid); 
        } else { 
            window.location.href = "index.html"; 
        }
    });

    async function loadData(uid) {
        try {
            const s = await getDoc(doc(db, "name", uid)); 
            document.getElementById('loading').style.display = 'none';
            
            if (s.exists()) {
                const d = s.data();
                document.getElementById('userProfile').style.display = 'block';
                
                // –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–∞
                document.getElementById('uName').innerText = d.name || "–ë–æ—î—Ü—å –î–®–í";
                document.getElementById('uRank').innerText = d.rank || "–†—è–¥–æ–≤–∏–π";
                document.getElementById('uID').innerText = d.gameID || "---";
                
                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                const r = d.reprimands || 0;
                const w = d.warns || 0;
                document.getElementById('uRep').innerText = r;
                document.getElementById('uWarns').innerText = w;

                // –õ–æ–≥—ñ–∫–∞ —Å—Ç–∞—Ç—É—Å—É (–ó–≤—ñ–ª—å–Ω–µ–Ω–Ω—è –ø—Ä–∏ 3 –¥–æ–≥–∞–Ω–∞—Ö)
                const st = document.getElementById('uStatus');
                if (r >= 3) {
                    st.innerText = "–ó–í–Ü–õ–¨–ù–ï–ù–ò–ô";
                    st.style.color = "var(--danger)";
                } else {
                    st.innerText = "–ê–∫—Ç–∏–≤–Ω–∏–π";
                    st.style.color = "#3b82f6";
                }

                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∞–¥–º—ñ–Ω–∞
                if (d.role === 'admin') { 
                    document.getElementById('adminArea').style.display = 'block'; 
                    renderList(); 
                }
            } else {
                alert("–ü–æ–º–∏–ª–∫–∞: –î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω—ñ –≤ –∫–æ–ª–µ–∫—Ü—ñ—ó 'name'");
                document.getElementById('loading').innerHTML = "<p style='color:red'>–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –¥–∞–Ω–∏—Ö</p>";
            }
        } catch (e) {
            console.error(e);
            alert("–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å.");
        }
    }

    async function renderList() {
        const snap = await getDocs(collection(db, "name"));
        const cont = document.getElementById('allUsersList');
        cont.innerHTML = "";
        
        snap.forEach(uDoc => {
            const u = uDoc.data();
            const id = uDoc.id;
            const r = u.reprimands || 0;
            const w = u.warns || 0;

            cont.innerHTML += `
                <div class="admin-item">
                    <div class="admin-info">
                        <b style="font-size:14px;">${u.name || '–ê–Ω–æ–Ω—ñ–º'}</b><br>
                        <small style="color:var(--text-gray)">${u.rank || '–†—è–¥–æ–≤–∏–π'} [ID: ${u.gameID || '?'}]</small>
                    </div>
                    <div class="admin-btns">
                        <button class="btn-sm" style="background:var(--danger);" onclick="processStat('${id}','reprimands',${r+1})">+ –î</button>
                        <button class="btn-sm" style="background:#475569;" onclick="processStat('${id}','reprimands',${Math.max(0,r-1)})">- –î</button>
                        <button class="btn-sm" style="background:var(--warning);" onclick="processStat('${id}','warns',${w+1})">+ –ü</button>
                        <button class="btn-sm" style="background:#475569;" onclick="processStat('${id}','warns',${Math.max(0,w-1)})">- –ü</button>
                        <button class="btn-sm" style="background:#3b82f6;" onclick="changeRank('${id}')">–†–ê–ù–ì</button>
                    </div>
                </div>`;
        });
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –∫–Ω–æ–ø–æ–∫
    window.processStat = async (id, field, val) => {
        try {
            await updateDoc(doc(db, "name", id), { [field]: val });
            renderList();
            if(id === auth.currentUser.uid) loadData(id);
        } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–∑–∏"); }
    };

    window.changeRank = async (id) => {
        const nr = prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –ø–æ—Å–∞–¥—É/—Ä–∞–Ω–≥:");
        if (nr) { 
            await updateDoc(doc(db, "name", id), { rank: nr }); 
            renderList(); 
        }
    };

    window.logout = () => { 
        signOut(auth).then(() => window.location.href = "index.html"); 
    };
</script>

<style>
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
</style>
</body>
</html>
