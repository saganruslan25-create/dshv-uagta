<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –ö–ê–ë–Ü–ù–ï–¢ –ë–Ü–ô–¶–Ø</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --primary-bright: #4ade80;
            --bg: #020406;
            --card-bg: rgba(255, 255, 255, 0.04);
            --glass-border: rgba(34, 197, 94, 0.25);
            --text-gray: #94a3b8;
            --neon-glow: 0 0 25px rgba(34, 197, 94, 0.4);
        }

        body {
            margin: 0; padding: 0; background-color: var(--bg); color: white; font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at 20% 20%, rgba(34, 197, 94, 0.15) 0%, transparent 40%), var(--bg);
            min-height: 100vh; overflow-x: hidden;
        }

        /* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 8%; height: 80px; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 1000;
        }

        .logo-box { 
            background: var(--primary); color: black; padding: 6px 15px; border-radius: 8px; 
            font-weight: 900; text-decoration: none; box-shadow: var(--neon-glow); 
        }

        /* –ì–û–õ–û–í–ù–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† */
        .dashboard-container { 
            display: grid; grid-template-columns: 280px 1fr 2fr; gap: 30px; 
            padding: 40px 8%; max-width: 1600px; margin: 0 auto; 
        }

        /* –ë–û–ö–û–í–ê –ü–ê–ù–ï–õ–¨ */
        .sidebar { display: flex; flex-direction: column; gap: 15px; }
        .nav-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 28px; padding: 25px; }
        
        .menu-link {
            display: flex; align-items: center; padding: 16px; border-radius: 16px; 
            color: white; text-decoration: none; font-size: 14px; font-weight: 600;
            background: rgba(255,255,255,0.03); margin-bottom: 10px; border: 1px solid transparent; 
            transition: 0.3s; cursor: pointer;
        }
        .menu-link:hover { background: rgba(34, 197, 94, 0.15); border-color: var(--primary); transform: translateX(10px); }
        .menu-link.active { background: var(--primary); color: black; }

        /* –ö–ê–†–¢–ö–ê –ü–†–û–§–Ü–õ–Æ */
        .profile-card { 
            background: var(--card-bg); border: 2px solid var(--primary); border-radius: 40px; 
            padding: 50px 30px; text-align: center; height: fit-content; box-shadow: var(--neon-glow); 
        }
        .avatar-wrap { 
            width: 120px; height: 120px; border-radius: 50%; border: 4px solid var(--primary); 
            margin: 0 auto 25px; display: flex; align-items: center; justify-content: center; 
            background: rgba(0,0,0,0.5); overflow: hidden;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-wrapper { display: flex; flex-direction: column; gap: 25px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
        .stat-card { 
            background: var(--card-bg); border: 1px solid var(--glass-border); 
            padding: 30px 20px; border-radius: 30px; text-align: center; transition: 0.3s;
        }
        .stat-label { color: var(--text-gray); font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
        .stat-value { font-size: 22px; font-weight: 900; display: block; margin-top: 10px; }

        /* –ü–ê–ù–ï–õ–¨ –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê */
        .admin-panel { 
            grid-column: 1 / -1; background: rgba(255,255,255,0.02); 
            border: 1px solid var(--glass-border); border-radius: 35px; padding: 35px; margin-top: 20px;
        }
        .user-row { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 18px 25px; background: rgba(0,0,0,0.3); border-radius: 20px; 
            margin-bottom: 12px; border: 1px solid rgba(255,255,255,0.05);
        }
        .admin-btn { 
            background: var(--primary); color: black; border: none; padding: 10px 20px; 
            border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.3s;
        }
        .admin-btn:hover { background: var(--primary-bright); transform: scale(1.05); }

        /* –ö–ù–û–ü–ö–ò –ö–ï–†–£–í–ê–ù–ù–Ø */
        .ctrl-btns { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .ctrl-btn { 
            width: 35px; height: 35px; border-radius: 10px; border: 1px solid var(--primary); 
            background: rgba(34, 197, 94, 0.1); color: white; cursor: pointer; font-weight: 900; transition: 0.2s;
        }
        .ctrl-btn:hover { background: var(--primary); color: black; }

        .btn-exit { 
            background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); 
            color: #ff7b7b; width: 100%; padding: 16px; border-radius: 18px; 
            font-weight: 800; cursor: pointer; margin-top: 10px; transition: 0.3s;
        }
        .btn-exit:hover { background: #ef4444; color: white; }

        @media (max-width: 1200px) { .dashboard-container { grid-template-columns: 280px 1fr; } .profile-card { grid-column: 1 / 2; } }
        @media (max-width: 900px) { .dashboard-container { grid-template-columns: 1fr; } .sidebar, .profile-card { grid-column: auto; } }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo-box">–î–®–í</a>
    <div style="font-size: 10px; font-weight: 900; color: var(--primary-bright); letter-spacing: 2px;">–û–°–û–ë–ò–°–¢–ò–ô –ö–ê–ë–Ü–ù–ï–¢ –ë–Ü–ô–¶–Ø</div>
</nav>

<div class="dashboard-container">
    <div class="sidebar">
        <div class="nav-card">
            <a href="index.html" class="menu-link">üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</a>
            <a href="#" class="menu-link">üìÖ –©–æ—Ç–∏–∂–Ω–µ–≤—ñ –∑–≤—ñ—Ç–∏</a>
            <a href="#" class="menu-link">üßπ –°—É–±–æ—Ç–Ω–∏–∫</a>
            <a href="applications.html" id="adminAppBtn" class="menu-link" style="display:none; border: 1px solid var(--primary);">üìà –ü–µ—Ä–µ–≥–ª—è–¥ —Ä–∞–ø–æ—Ä—Ç—ñ–≤</a>
            <button onclick="logout()" class="btn-exit">üö™ –í–∏–π—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–∏</button>
        </div>
    </div>

    <div class="profile-card">
        <div class="avatar-wrap">
            <img src="https://cdn-icons-png.flaticon.com/512/1077/1077114.png" width="70" style="filter: invert(1);">
        </div>
        <h2 id="userName" style="margin: 0; font-size: 24px; font-weight: 900;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</h2>
        <p id="userRankDisplay" style="color: var(--text-gray); font-weight: 600; margin: 10px 0 20px;">---</p>
        <div id="userID" style="color:var(--primary-bright); font-weight:800; background:rgba(34,197,94,0.1); padding:8px 20px; border-radius:20px; display: inline-block;">ID: 0000</div>
    </div>

    <div class="stats-wrapper">
        <div class="stats-grid">
            <div class="stat-card" style="border-top: 4px solid var(--primary);">
                <span class="stat-label">–ó–≤–∞–Ω–Ω—è</span>
                <span id="statRank" class="stat-value" style="color:var(--primary-bright)">---</span>
            </div>
            <div class="stat-card">
                <span class="stat-label">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è</span>
                <span id="statWarns" class="stat-value">0</span>
                <div class="admin-controls" style="display:none;">
                    <div class="ctrl-btns">
                        <button class="ctrl-btn" onclick="updateStat('warns', 1)">+</button>
                        <button class="ctrl-btn" onclick="updateStat('warns', -1)">-</button>
                    </div>
                </div>
            </div>
            <div class="stat-card">
                <span class="stat-label">–î–æ–≥–∞–Ω–∏</span>
                <span id="statReprimands" class="stat-value">0</span>
                <div class="admin-controls" style="display:none;">
                    <div class="ctrl-btns">
                        <button class="ctrl-btn" onclick="updateStat('reprimands', 1)">+</button>
                        <button class="ctrl-btn" onclick="updateStat('reprimands', -1)">-</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="adminSection" class="admin-panel" style="display:none;">
            <h3 style="margin: 0 0 25px 0; color: var(--primary); font-size: 20px; font-weight: 900; text-transform: uppercase;">üìã –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –æ—Å–æ–±–æ–≤–∏–º —Å–∫–ª–∞–¥–æ–º</h3>
            <div id="usersList">
                </div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.firebasestorage.app",
        messagingSenderId: "661591588818",
        appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let selectedUID = ""; 

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            selectedUID = user.uid;
            await loadUserData(user.uid, true);
        } else {
            window.location.href = "index.html";
        }
    });

    async function loadUserData(uid, isInitialLoad = false) {
        const userDoc = await getDoc(doc(db, "users", uid));
        if (userDoc.exists()) {
            const data = userDoc.data();
            
            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
            document.getElementById('userName').innerText = data.name;
            document.getElementById('userRankDisplay').innerText = data.rank;
            document.getElementById('statRank').innerText = data.rank;
            document.getElementById('userID').innerText = "ID: " + (data.gameID || "–ù–µ –≤–∫–∞–∑–∞–Ω–æ");
            document.getElementById('statWarns').innerText = data.warns || 0;
            document.getElementById('statReprimands').innerText = data.reprimands || 0;

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∞–¥–º—ñ–Ω–∞ (—Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–≤–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é)
            if (isInitialLoad) {
                const myDoc = await getDoc(doc(db, "users", auth.currentUser.uid));
                if (myDoc.data().role === 'admin') {
                    document.getElementById('adminSection').style.display = 'block';
                    document.getElementById('adminAppBtn').style.display = 'flex';
                    document.querySelectorAll('.admin-controls').forEach(c => c.style.display = 'block');
                    loadAllUsers();
                }
            }
        }
    }

    async function loadAllUsers() {
        const querySnapshot = await getDocs(collection(db, "users"));
        const listContainer = document.getElementById('usersList');
        listContainer.innerHTML = "";
        
        querySnapshot.forEach((uDoc) => {
            const uData = uDoc.data();
            const row = document.createElement('div');
            row.className = 'user-row';
            row.innerHTML = `
                <div>
                    <div style="font-weight:800;">${uData.name}</div>
                    <div style="font-size:12px; color:var(--primary);">${uData.rank}</div>
                </div>
                <button class="admin-btn" onclick="window.selectUser('${uDoc.id}')">–ö–µ—Ä—É–≤–∞—Ç–∏</button>
            `;
            listContainer.appendChild(row);
        });
    }

    window.selectUser = (uid) => {
        selectedUID = uid;
        loadUserData(uid);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    window.updateStat = async (field, change) => {
        const userRef = doc(db, "users", selectedUID);
        const userDoc = await getDoc(userRef);
        if (userDoc.exists()) {
            const currentVal = userDoc.data()[field] || 0;
            const newVal = Math.max(0, currentVal + change);
            await updateDoc(userRef, { [field]: newVal });
            loadUserData(selectedUID);
        }
    };

    window.logout = () => {
        signOut(auth).then(() => {
            window.location.href = "index.html";
        });
    };
</script>

</body>
</html>
