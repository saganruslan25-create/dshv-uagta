<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ДШВ | ОСОБИСТИЙ КАБІНЕТ</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --bg: #030507;
            --card-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-gray: #94a3b8;
        }

        body {
            margin: 0; background: var(--bg); color: white;
            font-family: 'Inter', sans-serif; min-height: 100vh;
            background-image: radial-gradient(circle at 50% -20%, rgba(34, 197, 94, 0.15), transparent 50%);
        }

        /* Навігація як у index */
        nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 8%; background: rgba(0,0,0,0.8); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 100;
        }
        .logo-box { background: var(--primary); color: black; padding: 4px 10px; border-radius: 6px; font-weight: 800; text-decoration: none; }

        /* ОСНОВНИЙ КОНТЕЙНЕР (СІТКА ЗА МАКЕТОМ) */
        .dashboard {
            display: grid;
            grid-template-columns: 250px 1fr 2fr; /* Меню | Профіль | Статистика */
            gap: 25px; padding: 40px 5%; max-width: 1600px; margin: 0 auto;
        }

        @media (max-width: 1100px) { .dashboard { grid-template-columns: 1fr; } }

        /* ЛІВЕ МЕНЮ */
        .sidebar { display: flex; flex-direction: column; gap: 12px; }
        .side-btn {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            color: white; padding: 15px; border-radius: 14px; text-align: left;
            cursor: pointer; transition: 0.3s; font-size: 13px; font-weight: 600;
        }
        .side-btn:hover { border-color: var(--primary); background: rgba(34, 197, 94, 0.05); }
        .side-btn.admin { border-left: 4px solid var(--primary); }

        /* ЦЕНТРАЛЬНА КАРТКА ПРОФІЛЮ */
        .profile-card {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 30px; padding: 40px 20px; text-align: center;
            backdrop-filter: blur(10px); height: fit-content;
        }
        .avatar-circle {
            width: 140px; height: 140px; background: rgba(255,255,255,0.05);
            border: 2px dashed var(--primary); border-radius: 50%;
            margin: 0 auto 25px; display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }
        .avatar-circle img { width: 80%; opacity: 0.5; }
        .profile-name { font-size: 22px; font-weight: 800; margin-bottom: 5px; }
        .profile-id { color: var(--text-gray); font-size: 14px; letter-spacing: 1px; }

        /* ПРАВА СІТКА СТАТИСТИКИ */
        .stats-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;
        }
        .stat-item {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            padding: 30px 20px; border-radius: 24px; text-align: center;
            transition: 0.3s; display: flex; flex-direction: column; justify-content: center;
        }
        .stat-item:hover { transform: translateY(-5px); border-color: rgba(34,197,94,0.3); }
        .stat-label { color: var(--text-gray); font-size: 12px; font-weight: 700; text-transform: uppercase; margin-bottom: 10px; }
        .stat-value { font-size: 20px; font-weight: 800; color: white; }
        .stat-value.green { color: var(--primary); }

        /* Кнопки адміна внизу списком */
        .admin-panel {
            grid-column: 1 / -1; background: rgba(0,0,0,0.3); 
            border-radius: 24px; padding: 30px; margin-top: 20px; border: 1px solid rgba(34,197,94,0.1);
        }
        .user-row {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid var(--glass-border);
        }
    </style>
</head>
<body>

<nav>
    <a href="index.html" class="logo-box">ДШВ</a>
    <div style="font-size: 12px; font-weight: 700; color: var(--primary);">СИСТЕМА УПРАВЛІННЯ</div>
</nav>

<div class="dashboard">
    <div class="sidebar">
        <button class="side-btn">Головна сторінка (soon)</button>
        <button class="side-btn">Статут ДШВ (soon)</button>
        <button class="side-btn">Рапорти на підвищення (soon)</button>
        <div id="adminMenu" style="display: none; margin-top: 20px;">
            <p style="font-size: 10px; color: var(--primary); margin-left: 10px; font-weight: 800;">ADMIN PANEL</p>
            <button class="side-btn admin">Керування бійцями</button>
            <button class="side-btn admin">Перегляд логів</button>
        </div>
        <button class="side-btn" onclick="window.logout()" style="margin-top: auto; opacity: 0.6;">Завершити сесію</button>
    </div>

    <div class="profile-card">
        <div class="avatar-circle">
            <img src="https://cdn-icons-png.flaticon.com/512/1946/1946429.png" alt="user">
        </div>
        <div class="profile-name" id="uName">Завантаження...</div>
        <div class="profile-id">ID ГРАВЦЯ: <span id="uID">---</span></div>
    </div>

    <div class="stats-grid">
        <div class="stat-item">
            <span class="stat-label">Посада</span>
            <span class="stat-value" id="uRank" style="color: var(--primary);">---</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Попередження</span>
            <span class="stat-value" id="uWarns" style="color: #f59e0b;">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Догани</span>
            <span class="stat-value" id="uRep" style="color: #ef4444;">0</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Паспорт</span>
            <a href="#" id="uPass" target="_blank" class="stat-value" style="color: #3b82f6; text-decoration: none; font-size: 14px;">ВІДКРИТИ ↗</a>
        </div>
        <div class="stat-item">
            <span class="stat-label">Діскорд</span>
            <span class="stat-value" id="uDiscord" style="font-size: 14px;">---</span>
        </div>
        <div class="stat-item">
            <span class="stat-label">Статус</span>
            <span class="stat-value green">АКТИВНИЙ</span>
        </div>
        
        <div id="adminSection" class="admin-panel" style="display: none;">
            <h3 style="margin-top:0; font-size: 14px; color: var(--primary);">СПИСОК ОСОБОВОГО СКЛАДУ</h3>
            <div id="usersList"></div>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.firebasestorage.app",
        messagingSenderId: "661591588818",
        appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, (user) => {
        if (user) { loadUserData(user.uid); } 
        else { window.location.href = "index.html"; }
    });

    async function loadUserData(uid) {
        // Виправлення: перевіряємо колекцію "users", як ми створювали в index.html
        const userDoc = await getDoc(doc(db, "users", uid));
        
        if (userDoc.exists()) {
            const d = userDoc.data();
            document.getElementById('uName').innerText = d.name;
            document.getElementById('uRank').innerText = d.rank;
            document.getElementById('uID').innerText = d.gameID;
            document.getElementById('uWarns').innerText = d.warns || 0;
            document.getElementById('uRep').innerText = d.reprimands || 0;
            document.getElementById('uDiscord').innerText = d.discord || "Не вказано";
            document.getElementById('uPass').href = d.passport || "#";

            if (d.role === 'admin') {
                document.getElementById('adminMenu').style.display = 'block';
                document.getElementById('adminSection').style.display = 'block';
                renderAdminList();
            }
        } else {
            alert("Помилка: Дані користувача не знайдені в колекції 'users'");
        }
    }

    async function renderAdminList() {
        const snap = await getDocs(collection(db, "users"));
        const list = document.getElementById('usersList');
        list.innerHTML = "";
        snap.forEach(uDoc => {
            const u = uDoc.data();
            list.innerHTML += `
                <div class="user-row">
                    <span>${u.name} [ID: ${u.gameID}]</span>
                    <div>
                        <button onclick="upd('${uDoc.id}', 'reprimands', ${(u.reprimands||0)+1})" style="background:#ef4444; border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer; margin-right:5px;">+ Догана</button>
                        <button onclick="upd('${uDoc.id}', 'warns', ${(u.warns||0)+1})" style="background:#f59e0b; border:none; color:white; padding:5px 10px; border-radius:5px; cursor:pointer;">+ Пред</button>
                    </div>
                </div>`;
        });
    }

    window.upd = async (id, field, val) => {
        await updateDoc(doc(db, "users", id), { [field]: val });
        location.reload();
    };

    window.logout = () => signOut(auth).then(() => window.location.href = "index.html");
</script>
</body>
</html>
