<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –î–®–í</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #121212;
            --accent-green: #2ecc71;
            --text-main: #ffffff;
            --text-dim: #b3b3b3;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* –®–∞–ø–∫–∞ —Å–∞–π—Ç—É */
        header {
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            background: var(--accent-green);
            color: black;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .btn-exit {
            color: var(--danger);
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }

        /* –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .main-container {
            display: grid;
            grid-template-columns: 250px 1fr 1fr;
            gap: 25px;
            padding: 0 40px 40px 40px;
        }

        /* –ë—ñ—á–Ω–µ –º–µ–Ω—é */
        .sidebar {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .nav-item {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.03);
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
        }

        /* –ö–∞—Ä—Ç–∫–∞ –ø—Ä–æ—Ñ—ñ–ª—é */
        .profile-card {
            background: var(--card-bg);
            border: 1px solid var(--accent-green);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .avatar-circle {
            width: 150px;
            height: 150px;
            border: 3px solid var(--accent-green);
            border-radius: 50%;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #2a2a2a;
        }

        .avatar-circle img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .id-badge {
            background: var(--accent-green);
            color: black;
            padding: 5px 40px;
            border-radius: 10px;
            font-weight: bold;
            margin-top: 15px;
        }

        /* –ë–ª–æ–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .stat-box {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .stat-label { color: var(--accent-green); font-size: 12px; margin-bottom: 10px; text-transform: uppercase; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat-value.red { color: var(--danger); }

        .full-width { grid-column: 1 / span 2; }

        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #111;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        /* –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑–≤—ñ—Ç—É */
        .report-item {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-green);
            /* –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤ —è–∫ —É —Å—É–±–æ—Ç–Ω–∏–∫—É */
            white-space: pre-wrap; 
            word-wrap: break-word;
            line-height: 1.6;
        }

        /* –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –°—Ç–∏–ª—å –¥–ª—è –ø–æ—Å–∏–ª–∞–Ω—å —É –∑–≤—ñ—Ç—ñ */
        .report-item a {
            color: #3498db;
            text-decoration: underline;
            cursor: pointer;
        }

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 25px;
            cursor: pointer;
        }

        /* –†–µ—î—Å—Ç—Ä –æ—Å–æ–±–æ–≤–æ–≥–æ —Å–∫–ª–∞–¥—É */
        .registry-section {
            padding: 40px;
            background: rgba(255,255,255,0.02);
            margin: 20px 40px;
            border-radius: 20px;
        }

        .registry-user {
            background: #151515;
            padding: 15px 25px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-group { display: flex; gap: 10px; }
        .btn-action {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-reports { background: var(--accent-green); color: black; }
        .btn-delete { background: var(--danger); color: white; }

    </style>
</head>
<body>

<header>
    <div class="logo">–î–®–í</div>
    <div class="user-info">
        <span id="headerUserName">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
        <a class="btn-exit" onclick="logout()">–í–ò–ô–¢–ò</a>
    </div>
</header>

<div class="main-container">
    <div class="sidebar">
        <div class="nav-item">üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</div>
        <div class="nav-item">üìÖ –©–æ—Ç–∏–∂–Ω–µ–≤—ñ –∑–≤—ñ—Ç–∏</div>
        <div class="nav-item">üßπ –°—É–±–æ—Ç–Ω–∏–∫</div>
        <div class="nav-item" onclick="scrollToRegistry()">üìù –ü–µ—Ä–µ–≥–ª—è–¥ —Ä–∞–ø–æ—Ä—Ç—ñ–≤</div>
        <div class="nav-item" style="margin-top: auto; color: var(--danger);" onclick="logout()">üö™ –í–∏–π—Ç–∏ –∑ –∫–∞–±—ñ–Ω–µ—Ç—É</div>
    </div>

    <div class="profile-card">
        <div class="avatar-circle">
            <img src="https://via.placeholder.com/150" alt="–ê–≤–∞—Ç–∞—Ä">
        </div>
        <h2 id="profileName">–†—É—Å–ª–∞–Ω –ö—É—â–∏—Ä–≥</h2>
        <div class="id-badge" id="profileId">ID: 17218</div>
        <p style="color: var(--danger); font-size: 12px; margin-top: 20px; cursor: pointer;">–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –ø—Ä–æ—Ñ—ñ–ª—å</p>
    </div>

    <div class="stats-grid">
        <div class="stat-box full-width">
            <div class="stat-label">–ü–æ—Ç–æ—á–Ω–∞ –ø–æ—Å–∞–¥–∞ / –ó–≤–∞–Ω–Ω—è</div>
            <div class="stat-value" id="profileRank">–Ü–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –î–®–í/ –¢–µ—Ö.–ê–¥–º—ñ–Ω</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è</div>
            <div class="stat-value">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–î–æ–≥–∞–Ω–∏</div>
            <div class="stat-value red">0</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">–î–æ–∫—É–º–µ–Ω—Ç–∏</div>
            <div class="stat-value">–ù–ï–ú–ê–Ñ</div>
        </div>
        <div class="stat-box">
            <div class="stat-label">Discord –ê–∫–∫–∞—É–Ω—Ç</div>
            <div class="stat-value">---</div>
        </div>
        <div class="stat-box full-width">
            <div class="stat-label">–°—Ç–∞—Ç—É—Å —Å–ª—É–∂–±–∏</div>
            <div class="stat-value" style="color: var(--accent-green);">–ê–ö–¢–ò–í–ù–ê</div>
        </div>
    </div>
</div>

<div class="registry-section" id="registry">
    <h3>üìã –†–ï–Ñ–°–¢–† –û–°–û–ë–û–í–û–ì–û –°–ö–õ–ê–î–£</h3>
    <div id="usersList">
        </div>
</div>

<div class="modal-overlay" id="reportsModal">
    <div class="modal-content">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">–ó–≤—ñ—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h2>
        <div id="reportsContent">
            </div>
    </div>
</div>

<script>
    // –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø FIREBASE (–ó–∞–º—ñ–Ω—ñ—Ç—å –Ω–∞ –≤–∞—à—ñ –¥–∞–Ω—ñ)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ –≤ –∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–∏–π HTML
    function linkify(text) {
        const urlPattern = /(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
        return text.replace(urlPattern, function(url) {
            return '<a href="' + url + '" target="_blank">' + url + '</a>';
        });
    }

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
    async function loadUsers() {
        const usersList = document.getElementById('usersList');
        usersList.innerHTML = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';

        try {
            const snapshot = await db.collection('users').get();
            usersList.innerHTML = '';
            
            snapshot.forEach(doc => {
                const user = doc.data();
                const userDiv = document.createElement('div');
                userDiv.className = 'registry-user';
                userDiv.innerHTML = `
                    <div>
                        <strong>${user.name}</strong><br>
                        <span style="font-size: 12px; color: #888;">ID: ${user.id || '---'} | ${user.rank}</span>
                    </div>
                    <div class="btn-group">
                        <button class="btn-action btn-reports" onclick="showReports('${user.name}', '${doc.id}')">–ó–í–Ü–¢–ò</button>
                        <button class="btn-action" style="background: #333; color: white;">–ö–ï–†–£–í–ê–¢–ò</button>
                        <button class="btn-action btn-delete">–í–ò–î–ê–õ–ò–¢–ò</button>
                    </div>
                `;
                usersList.appendChild(userDiv);
            });
        } catch (e) {
            usersList.innerHTML = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è.';
        }
    }

    // –ü–æ–∫–∞–∑ –∑–≤—ñ—Ç—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    async function showReports(userName, userId) {
        const modal = document.getElementById('reportsModal');
        const content = document.getElementById('reportsContent');
        document.getElementById('modalTitle').innerText = `–ó–í–Ü–¢–ò: ${userName}`;
        
        content.innerHTML = '–ü–æ—à—É–∫ –∑–≤—ñ—Ç—ñ–≤...';
        modal.style.display = 'flex';

        try {
            // –û—Ç—Ä–∏–º—É—î–º–æ –∑–≤—ñ—Ç–∏ (–∫–æ–ª–µ–∫—Ü—ñ—è subotniks)
            const q = await db.collection('subotniks').where('name', '==', userName).get();
            
            if (q.empty) {
                content.innerHTML = '<p>–ó–≤—ñ—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>';
                return;
            }

            content.innerHTML = '';
            q.forEach(doc => {
                const data = doc.data();
                const div = document.createElement('div');
                div.className = 'report-item';
                
                // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ linkify –¥–ª—è –ø–æ—Å–∏–ª–∞–Ω—å —Ç–∞ white-space: pre-wrap –≤–∂–µ –≤ CSS
                const formattedContent = linkify(data.content || "–ë–µ–∑ —Ç–µ–∫—Å—Ç—É");
                
                div.innerHTML = `
                    <div style="color: var(--accent-green); font-weight: bold; margin-bottom: 10px;">
                        –î–∞—Ç–∞: ${data.date || '–ù–µ –≤–∫–∞–∑–∞–Ω–∞'}
                    </div>
                    <div>${formattedContent}</div>
                `;
                content.appendChild(div);
            });
        } catch (e) {
            content.innerHTML = '–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö.';
            console.error(e);
        }
    }

    function closeModal() {
        document.getElementById('reportsModal').style.display = 'none';
    }

    function scrollToRegistry() {
        document.getElementById('registry').scrollIntoView({ behavior: 'smooth' });
    }

    function logout() {
        alert('–í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏...');
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
    window.onload = loadUsers;

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–µ—é
    window.onclick = function(event) {
        if (event.target == document.getElementById('reportsModal')) {
            closeModal();
        }
    }
</script>

</body>
</html>
