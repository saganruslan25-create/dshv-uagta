<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–®–í | COMMAND CENTER</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           –û–°–ù–û–í–ù–Ü –ó–ú–Ü–ù–ù–Ü –¢–ê –ö–û–õ–¨–û–†–ò
           ========================================= */
        :root {
            --primary: #22c55e;
            --primary-bright: #4ade80;
            --primary-glow: rgba(34, 197, 94, 0.15);
            --bg: #030507;
            --card-bg: #0a0c10;
            --glass-border: rgba(34, 197, 94, 0.2);
            --danger: #ef4444;
            --danger-bright: #ff5f5f;
            --warning: #fbbf24;
            --text-gray: #94a3b8;
        }

        /* –°–ö–†–û–õ–ë–ê–† */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #05070a;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #2d3436;
            border-radius: 10px;
            border: 2px solid #05070a;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(34, 197, 94, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(34, 197, 94, 0.05) 0%, transparent 30%);
            color: white; 
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none; 
            -webkit-user-select: none;
        }

        input, textarea {
            user-select: text !important;
            -webkit-user-select: text !important;
        }

        /* =========================================
           –ï–ö–†–ê–ù–ò –ë–õ–û–ö–£–í–ê–ù–ù–Ø –¢–ê –°–¢–ê–¢–£–°–Ü–í
           ========================================= */
        #verifyWaitingScreen, #banScreen, #lockScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(3, 5, 7, 0.98);
            z-index: 9999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        #verifyWaitingScreen h1 { color: var(--warning); font-size: 32px; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 1px; }
        #banScreen h1 { color: var(--danger); font-size: 40px; text-transform: uppercase; letter-spacing: 5px; }
        #lockScreen h1 { color: var(--danger); font-size: 32px; margin-bottom: 20px; text-transform: uppercase; }

        /* =========================================
           –®–ê–ü–ö–ê (HEADER)
           ========================================= */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 5%;
            background: rgba(3, 5, 7, 0.9);
            backdrop-filter: blur(15px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--glass-border);
        }

        .logo-box { 
            background: var(--primary);
            color: black;
            padding: 6px 14px; 
            border-radius: 8px;
            font-weight: 900;
            text-decoration: none;
            font-size: 15px;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.3);
            text-transform: uppercase;
        }
        .logo-box:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.6);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* –ù–û–í–ê –ö–ù–û–ü–ö–ê –í–ò–ô–¢–ò - –ß–ï–†–í–û–ù–ò–ô –°–¢–ò–õ–¨ –ê–†–•–Ü–í–£ */
        .btn-logout-custom {
            background: var(--danger);
            color: black;
            padding: 8px 20px;
            border-radius: 10px;
            font-weight: 900;
            cursor: pointer;
            border: none;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.25);
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-logout-custom:hover {
            background: var(--danger-bright);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.5);
        }

        /* =========================================
           –°–ò–°–¢–ï–ú–ê –°–ü–û–í–Ü–©–ï–ù–¨ (NOTIFICATIONS)
           ========================================= */
        .notif-wrapper {
            position: relative;
            cursor: pointer;
            padding: 5px;
            margin-right: 10px;
        }

        .bell-icon {
            font-size: 24px;
            color: var(--warning);
            transition: 0.3s;
        }
        .bell-icon:hover {
            transform: rotate(15deg) scale(1.1);
            filter: drop-shadow(0 0 8px rgba(251, 191, 36, 0.5));
        }

        .bell-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--danger);
            color: white;
            font-size: 10px;
            font-weight: 900;
            padding: 2px 6px;
            border-radius: 50%;
            border: 2px solid var(--bg);
            display: none;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.2); box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        #notifDropdown {
            position: absolute;
            top: 70px;
            right: 5%;
            width: 350px;
            background: #0c121d;
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            display: none;
            flex-direction: column;
            z-index: 2000;
            box-shadow: 0 20px 60px rgba(0,0,0,0.9);
            overflow: hidden;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .notif-header {
            padding: 15px 20px;
            background: rgba(255,255,255,0.03);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .notif-header h4 {
            color: var(--primary-bright);
            font-size: 13px;
            font-weight: 800;
            letter-spacing: 0.5px;
        }

        .notif-list-container {
            max-height: 350px;
            overflow-y: auto;
        }

        .notif-item-link {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            text-decoration: none;
            color: white;
            transition: 0.2s;
            position: relative;
        }

        .notif-item-link:hover {
            background: rgba(34, 197, 94, 0.05);
            padding-left: 25px;
        }
        
        .notif-item-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary);
            opacity: 0;
            transition: 0.2s;
        }
        .notif-item-link:hover::before {
            opacity: 1;
        }

        /* =========================================
           –û–°–ù–û–í–ù–ò–ô –õ–ï–Ø–£–¢ (GRID)
           ========================================= */
        .main-wrapper {
            display: flex;
            justify-content: center;
            padding: 30px 5%;
        }

        .main-container {
            display: grid;
            grid-template-columns: 280px 420px 1fr;
            gap: 25px;
            width: 100%;
            max-width: 1600px;
        }

        /* –ë–õ–û–ö–ò –Ü–ù–¢–ï–†–§–ï–ô–°–£ */
        .side-menu, .profile-card, .info-box {
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* –ë–û–ö–û–í–ï –ú–ï–ù–Æ */
        .side-menu {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            height: fit-content;
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: rgba(255,255,255,0.02);
            border-radius: 14px;
            color: white;
            text-decoration: none;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid transparent;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.05);
            transform: translateX(5px);
            border-color: rgba(255,255,255,0.1);
        }

        .fire-dot {
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--danger);
            display: none;
        }

        /* –ü–†–û–§–Ü–õ–¨ (–ù–û–í–ò–ô –î–ò–ó–ê–ô–ù) */
        .profile-card {
            padding: 40px 25px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 1px solid rgba(34, 197, 94, 0.3);
            position: relative;
        }

        .avatar-circle {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 4px solid var(--primary);
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: #111;
            box-shadow: 0 0 30px rgba(34, 197, 94, 0.1);
        }

        .user-name {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-rank-display {
            color: var(--primary-bright);
            font-weight: 900;
            font-size: 26px;
            margin: 5px 0;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }

        .rank-separator {
            color: rgba(255,255,255,0.2);
            letter-spacing: 4px;
            margin: 10px 0;
            font-weight: 300;
        }

        .user-pos-display {
            color: var(--primary-bright);
            font-weight: 700;
            font-size: 15px;
            text-transform: uppercase;
        }

        .id-badge {
            background: var(--primary);
            color: black;
            padding: 8px 30px;
            border-radius: 8px;
            font-weight: 900;
            font-size: 14px;
            margin-top: 25px;
            display: inline-block;
            box-shadow: 0 5px 15px rgba(34, 197, 94, 0.3);
        }

        /* –Ü–ù–§–û –ü–ê–ù–ï–õ–¨ */
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .info-box {
            padding: 25px;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        
        .info-box:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .info-box span {
            font-size: 11px;
            font-weight: 800;
            color: var(--primary-bright);
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 1px;
            display: block;
        }

        .info-box h2 {
            font-size: 28px;
            font-weight: 800;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* –ö–ù–û–ü–ö–ò –ö–ï–†–£–í–ê–ù–ù–Ø (–ê–î–ú–Ü–ù) */
        .admin-controls {
            display: none; /* JS –≤–º–∏–∫–∞—î —Ü–µ –¥–ª—è –∞–¥–º—ñ–Ω—ñ–≤ */
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }

        .btn-mini {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-mini:hover {
            background: var(--primary);
            color: black;
            border-color: var(--primary);
        }

        .btn-add-info {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: black;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: none; /* JS –≤–º–∏–∫–∞—î */
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 16px;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.4);
        }
        .btn-add-info:hover {
            transform: scale(1.1) rotate(90deg);
        }

        /* =========================================
           –†–ï–Ñ–°–¢–† –û–°–û–ë–û–í–û–ì–û –°–ö–õ–ê–î–£
           ========================================= */
        .staff-section-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 10px 5% 50px;
        }

        .staff-section {
            width: 100%;
            max-width: 1600px;
            background: var(--card-bg);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 35px;
            margin-top: 20px;
        }

        .staff-header {
            color: var(--primary-bright);
            margin-bottom: 30px;
            text-transform: uppercase;
            font-size: 18px;
            font-weight: 800;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
        }

        .staff-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255,255,255,0.02);
            padding: 20px 30px;
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid var(--glass-border);
            transition: 0.3s;
        }
        .staff-item:hover {
            background: rgba(255,255,255,0.04);
            border-color: var(--primary);
            transform: scale(1.005);
        }

        .order-arrows {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-right: 20px;
        }
        .btn-arrow {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--primary);
            border-radius: 6px;
            width: 28px;
            height: 28px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-arrow:hover {
            background: var(--primary);
            color: black;
        }

        /* –ö–ù–û–ü–ö–ò –î–Ü–ô –í –†–ï–Ñ–°–¢–†–Ü */
        .staff-actions {
            display: flex;
            gap: 12px;
        }

        .btn-action-g {
            background: var(--primary);
            color: black;
            padding: 10px 22px;
            border-radius: 10px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
        }
        .btn-manage {
            background: #1e293b;
            color: white;
            padding: 10px 22px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            font-weight: 700;
        }
        .btn-verify {
            background: var(--warning);
            color: black;
            padding: 10px 22px;
            border-radius: 10px;
            font-weight: 800;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            animation: pulse 2s infinite;
        }
        .btn-action-r {
            background: transparent;
            border: 1px solid var(--danger);
            color: var(--danger);
            padding: 10px 22px;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
        }
        
        .btn-action-g:hover, .btn-manage:hover, .btn-verify:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .btn-action-r:hover {
            background: var(--danger);
            color: black;
        }

        /* =========================================
           –ú–û–î–ê–õ–¨–ù–ï –í–Ü–ö–ù–û (–ê–†–•–Ü–í)
           ========================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal-content {
            background: #0c121d;
            border: 1px solid var(--glass-border);
            width: 95%;
            max-width: 900px;
            height: 85vh;
            border-radius: 25px;
            padding: 40px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 50px rgba(34, 197, 94, 0.1);
        }

        .close-modal {
            position: absolute;
            top: 25px;
            right: 30px;
            font-size: 40px;
            cursor: pointer;
            color: #555;
            transition: 0.3s;
            line-height: 20px;
        }
        .close-modal:hover { color: var(--danger); transform: rotate(90deg); }

        .report-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .report-header {
            padding: 15px 20px;
            background: rgba(255,255,255,0.02);
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .report-body {
            padding: 20px;
            font-size: 14px;
            line-height: 1.6;
            color: #d1d5db;
            white-space: pre-wrap;
        }

        /* =========================================
           –ú–û–ë–Ü–õ–¨–ù–ê –ê–î–ê–ü–¢–ê–¶–Ü–Ø (FIX)
           ========================================= */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr; /* –û–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ */
                gap: 20px;
            }

            .side-menu { order: 2; }
            .profile-card { order: 1; }
            .info-panel { order: 3; }

            header {
                padding: 15px 4%;
            }

            .header-right span {
                display: none; /* –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —ñ–º'—è –∑–≤–µ—Ä—Ö—É –Ω–∞ –º–æ–±—ñ–ª—å–Ω–æ–º—É */
            }

            .avatar-circle {
                width: 100px;
                height: 100px;
                font-size: 40px;
            }

            .staff-item {
                flex-direction: column;
                gap: 20px;
                text-align: center;
                padding: 20px;
            }
            
            .staff-item > div:first-child {
                flex-direction: column;
                gap: 10px;
            }

            .order-arrows {
                flex-direction: row;
                margin-right: 0;
                margin-bottom: 10px;
            }

            .staff-actions {
                flex-wrap: wrap;
                justify-content: center;
            }

            .btn-action-g, .btn-manage, .btn-verify, .btn-action-r {
                padding: 12px 20px;
                width: 100%; /* –ö–Ω–æ–ø–∫–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
            }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <div id="verifyWaitingScreen">
        <h1>–í–ï–†–ò–§–Ü–ö–ê–¶–Ü–Ø...</h1>
        <p style="color: var(--text-gray); font-size: 16px;">–û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É –≤—ñ–¥ –∫–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–∞.</p>
        <button class="btn-logout-custom" style="margin-top: 30px;" onclick="window.logout()">–í–ò–ô–¢–ò –ó –ê–ö–ê–£–ù–¢–£</button>
    </div>

    <div id="banScreen">
        <h1>ACCESS REVOKED</h1>
        <p style="color: var(--danger);">–í–∞—à IP –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ —Å–∏—Å—Ç–µ–º–æ—é –±–µ–∑–ø–µ–∫–∏.</p>
    </div>

    <div id="lockScreen">
        <h1>–°–ò–°–¢–ï–ú–ê –¢–ò–ú–ß–ê–°–û–í–û –ó–ê–ë–õ–û–ö–û–í–ê–ù–ê</h1>
        <p style="color: var(--text-gray); margin-bottom: 20px;">–í–µ–¥—É—Ç—å—Å—è —Ç–µ—Ö–Ω—ñ—á–Ω—ñ —Ä–æ–±–æ—Ç–∏ –∞–±–æ –≤–≤–µ–¥–µ–Ω–æ —Ä–µ–∂–∏–º —Ç–∏—à—ñ.</p>
        <button class="btn-logout-custom" onclick="window.logout()">–í–ò–ô–¢–ò</button>
    </div>

    <header>
        <a href="index.html" class="logo-box">–î–®–í</a>
        <div class="header-right">
            <div class="notif-wrapper" onclick="toggleNotifs(event)">
                <span class="bell-icon">üîî</span>
                <div id="bellBadge" class="bell-badge">0</div>
            </div>
            
            <div id="notifDropdown">
                <div class="notif-header">
                    <h4>–°–ü–û–í–Ü–©–ï–ù–ù–Ø</h4>
                    <button onclick="clearAllNotifications()" style="background:none; border:none; color:var(--text-gray); font-size:10px; cursor:pointer; font-weight: 700;">–ü–†–û–ß–ò–¢–ê–¢–ò –í–°–ï</button>
                </div>
                <div id="notifList" class="notif-list-container">
                    </div>
            </div>

            <span id="topName" style="color:var(--primary-bright); font-weight:800; font-size: 14px;">...</span>
            
            <button class="btn-logout-custom" onclick="window.logout()">–í–ò–ô–¢–ò</button>
        </div>
    </header>

    <div class="main-wrapper">
        <div class="main-container">
            
            <div class="side-menu">
                <button id="backToMe" onclick="resetView()" style="display:none; width:100%; background:var(--warning); color:black; padding:14px; border-radius:12px; font-weight:900; border:none; cursor:pointer; margin-bottom:15px; font-size: 13px;">‚¨Ö –ü–û–í–ï–†–ù–£–¢–ò–°–Ø –î–û –°–ï–ë–ï</button>
                
                <a href="index.html" class="menu-item">
                    <span>üè† –ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞</span>
                </a>
                <a href="reports.html" class="menu-item">
                    <span>üìÖ –©–æ—Ç–∏–∂–Ω–µ–≤—ñ –∑–≤—ñ—Ç–∏</span>
                    <div id="dot-reports" class="fire-dot"></div>
                </a>
                <a href="subotnik.html" class="menu-item">
                    <span>üßπ –°—É–±–æ—Ç–Ω–∏–∫</span>
                    <div id="dot-subotniks" class="fire-dot"></div>
                </a>
                <a href="applications.html" class="menu-item" id="adminAppBtn" style="display:none;">
                    <span>üìù –ü–µ—Ä–µ–≥–ª—è–¥ —Ä–∞–ø–æ—Ä—Ç—ñ–≤</span>
                    <div id="dot-apps" class="fire-dot"></div>
                </a>
                <a href="chats.html" class="menu-item">
                    <span>üí¨ –ß–∞—Ç–∏ / –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</span>
                    <div id="dot-chats" class="fire-dot"></div>
                </a>
                
                <div id="lockBtn" style="display:none;" class="btn-action-r" style="text-align: center; justify-content: center;" onclick="toggleSystemAccess()">
                    üîí –ö–ï–†–£–í–ê–ù–ù–Ø –î–û–°–¢–£–ü–û–ú
                </div>
            </div>

            <div class="profile-card">
                <div class="avatar-circle">üë§</div>
                <div id="userName" class="user-name">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
                
                <h2 id="userRank" class="user-rank-display">...</h2>
                <h6 class="rank-separator">------------------------</h6>
                <h6 id="userPos" class="user-pos-display">...</h6>
                
                <div id="userID" class="id-badge">ID: ...</div>
            </div>

            <div class="info-panel">
                <div class="info-box">
                    <h2 id="greeting">–í—ñ—Ç–∞—î–º–æ!</h2>
                </div>
                
                <div class="stats-grid">
                    <div class="info-box">
                        <span>–ü–û–ü–ï–†–ï–î–ñ–ï–ù–ù–Ø</span>
                        <h2 id="userRep">0</h2>
                        <div class="admin-controls">
                            <button class="btn-mini" onclick="changeStat('reprimands', -1)">-</button>
                            <button class="btn-mini" onclick="changeStat('reprimands', 1)">+</button>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <span>–î–û–ì–ê–ù–ò</span>
                        <h2 id="userWarns">0</h2>
                        <div class="admin-controls">
                            <button class="btn-mini" onclick="changeStat('warns', -1)">-</button>
                            <button class="btn-mini" onclick="changeStat('warns', 1)">+</button>
                        </div>
                    </div>
                    
                    <div class="info-box">
                        <span>–ü–ê–°–ü–û–†–¢</span>
                        <h2 id="userPassport" style="font-size: 15px; word-break: break-all;">---</h2>
                        <button id="btnAddPass" class="btn-add-info" onclick="updateField('passport')">+</button>
                    </div>
                    
                    <div class="info-box">
                        <span>DISCORD</span>
                        <h2 id="userDiscord" style="font-size: 15px; word-break: break-all;">---</h2>
                        <button id="btnAddDisc" class="btn-add-info" onclick="updateField('discord')">+</button>
                    </div>
                </div>
                
                <div class="info-box">
                    <span>–°–¢–ê–¢–£–° –°–õ–£–ñ–ë–ò</span>
                    <h2 style="color: var(--primary);">–ê–ö–¢–ò–í–ù–ê</h2>
                </div>
            </div>
        </div>
    </div>

    <div class="staff-section-container" id="adminSection" style="display:none;">
        <div class="staff-section">
            <h3 class="staff-header">üìã –†–ï–Ñ–°–¢–† –û–°–û–ë–û–í–û–ì–û –°–ö–õ–ê–î–£</h3>
            <div id="staffList">
                </div>
        </div>
    </div>

    <div id="reportsModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle" style="color: var(--primary-bright); margin-bottom: 25px; text-transform: uppercase;">–ê–†–•–Ü–í –ó–í–Ü–¢–Ü–í</h2>
            <div id="modalReportsList" style="overflow-y:auto; flex-grow: 1;">
                </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, collection, onSnapshot, query, where, deleteDoc, getDocs, setDoc, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø
        const firebaseConfig = {
            apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
            authDomain: "dsv-gta.firebaseapp.com",
            projectId: "dsv-gta",
            storageBucket: "dsv-gta.firebasestorage.app",
            messagingSenderId: "661591588818",
            appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü
        let currentUID = null;
        let myData = null;
        let editingUID = null;
        // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø—Ä–æ—á–∏—Ç–∞–Ω—ñ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –∑ LocalStorage —â–æ–± –≤–æ–Ω–∏ –Ω–µ –∑'—è–≤–ª—è–ª–∏—Å—è –ø—ñ—Å–ª—è —Ä–µ—Ñ—Ä–µ—à—É
        let readNotifications = JSON.parse(localStorage.getItem('readNotifs')) || [];

        const greetings = [
            "–†–∞–¥—ñ –±–∞—á–∏—Ç–∏ –í–∞—Å!", 
            "–í—ñ—Ç–∞—î–º–æ –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º!", 
            "–ü—Ä–∏—î–º–Ω–æ –∑–Ω–æ–≤—É –í–∞—Å –±–∞—á–∏—Ç–∏!", 
            "–ó –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º —É —Å—Ç—Ä—ñ–π!",
            "–ë–∞–∂–∞—î–º–æ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—ó —Å–ª—É–∂–±–∏!",
            "–î–®–í –≤—ñ—Ç–∞—î –í–∞—Å!"
        ];

        // –§–£–ù–ö–¶–Ü–Ø –í–ò–•–û–î–£
        window.logout = () => {
            signOut(auth).then(() => {
                window.location.href = "index.html";
            });
        };

        // –ü–ï–†–ï–í–Ü–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–Ü–á –¢–ê IP
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "index.html";
                return;
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ IP (–°—Ç–∞—Ä–∞ —Å–∏—Å—Ç–µ–º–∞)
            try {
                const res = await fetch('https://api.ipify.org?format=json');
                const ipData = await res.json();
                const banSnap = await getDoc(doc(db, "bannedIPs", ipData.ip));
                if (banSnap.exists()) {
                    document.getElementById('banScreen').style.display = 'flex';
                    return;
                }
            } catch (e) {
                console.log("IP Check skipped");
            }

            currentUID = user.uid;
            editingUID = user.uid;

            // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            const userDoc = await getDoc(doc(db, "users", user.uid));
            
            if (!userDoc.exists()) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è, —è–∫—â–æ –Ω–µ–º–∞—î –≤ –±–∞–∑—ñ
                await setDoc(doc(db, "users", user.uid), {
                    name: user.displayName || "–ù–æ–≤–∏–π –±–æ—î—Ü—å",
                    verified: false,
                    role: 'user',
                    rank: '–†–µ–∫—Ä—É—Ç | –°–ª—É–∂–±–æ–≤–µ—Ü—å',
                    reprimands: 0,
                    warns: 0,
                    staffIndex: Date.now()
                });
                document.getElementById('verifyWaitingScreen').style.display = 'flex';
                return;
            }

            myData = userDoc.data();

            // –ï–∫—Ä–∞–Ω –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–µ—Ä–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
            if (!myData.verified && myData.role !== 'admin') {
                document.getElementById('verifyWaitingScreen').style.display = 'flex';
                return;
            }

            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
            document.getElementById("greeting").textContent = greetings[Math.floor(Math.random() * greetings.length)];
            updateUI(myData);
            listenToSystemStatus(myData.role);
            
            // –Ø–∫—â–æ –ê–¥–º—ñ–Ω
            if (myData.role === 'admin') {
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('adminAppBtn').style.display = 'flex';
                document.getElementById('lockBtn').style.display = 'block';
                // –ü–æ–∫–∞–∑—É—î–º–æ –∫–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è
                document.querySelectorAll('.admin-controls').forEach(el => el.style.display = 'flex');
                loadStaffList();
            }

            // –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º
            initNotifications();
            listenForMentions();
        });

        // –û–ù–û–í–õ–ï–ù–ù–Ø –Ü–ù–¢–ï–†–§–ï–ô–°–£ (–ü—Ä–æ—Ñ—ñ–ª—å)
        function updateUI(data) {
            document.getElementById('userName').innerText = data.name || "---";
            document.getElementById('topName').innerText = data.name || "---";
            document.getElementById('userID').innerText = "ID: " + (data.gameID || "---");
            
            // –õ–æ–≥—ñ–∫–∞ —Ä–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –ó–≤–∞–Ω–Ω—è | –ü–æ—Å–∞–¥–∞
            const fullRank = data.rank || "–†–µ–∫—Ä—É—Ç | –°–ª—É–∂–±–æ–≤–µ—Ü—å";
            const parts = fullRank.split('|');
            const rankName = parts[0] ? parts[0].trim() : "–†–µ–∫—Ä—É—Ç";
            const posName = parts[1] ? parts[1].trim() : "–°–ª—É–∂–±–æ–≤–µ—Ü—å";

            document.getElementById('userRank').innerText = rankName;
            document.getElementById('userPos').innerText = posName;
            
            document.getElementById('userRep').innerText = data.reprimands || 0;
            document.getElementById('userWarns').innerText = data.warns || 0;
            document.getElementById('userPassport').innerText = data.passport || "---";
            document.getElementById('userDiscord').innerText = data.discord || "---";

            // –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–ª—é—Å–∏–∫–∏ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ü–µ –º—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å
            const isMe = editingUID === currentUID;
            document.getElementById('btnAddPass').style.display = isMe ? 'flex' : 'none';
            document.getElementById('btnAddDisc').style.display = isMe ? 'flex' : 'none';
        }

        // –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø –°–ü–ò–°–ö–£ –û–°–û–ë–û–í–û–ì–û –°–ö–õ–ê–î–£
        async function loadStaffList() {
            onSnapshot(query(collection(db, "users"), orderBy("staffIndex", "asc")), (snap) => {
                const list = document.getElementById('staffList');
                list.innerHTML = ""; // –û—á–∏—Å—Ç–∫–∞
                
                snap.forEach((s) => {
                    const u = s.data();
                    const item = document.createElement('div');
                    item.className = 'staff-item';
                    
                    // –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–Ω–≥—É –¥–ª—è —Ä–µ—î—Å—Ç—Ä—É
                    const rankParts = (u.rank || "–†–µ–∫—Ä—É—Ç | –°–ª—É–∂–±–æ–≤–µ—Ü—å").split('|');
                    const rName = rankParts[0]?.trim() || "---";
                    const pName = rankParts[1]?.trim() || "---";

                    // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è HTML –µ–ª–µ–º–µ–Ω—Ç–∞
                    item.innerHTML = `
                        <div style="display:flex; align-items:center;">
                            <div class="order-arrows">
                                <button class="btn-arrow" onclick="window.moveUser('${s.id}', -1)">‚ñ≤</button>
                                <button class="btn-arrow" onclick="window.moveUser('${s.id}', 1)">‚ñº</button>
                            </div>
                            <div style="text-align:left;">
                                <b style="font-size:16px; color: white;">${u.name}</b> 
                                <br>
                                <small style="color:var(--text-gray); font-size: 13px;">
                                    ID: ${u.gameID || '---'} <span style="color: var(--primary);">|</span> ${rName}, ${pName}
                                </small>
                            </div>
                        </div>
                        <div class="staff-actions">
                            ${!u.verified ? `<button class="btn-verify" onclick="window.verifyUser('${s.id}')">–í–ï–†–ò–§–Ü–ö–£–í–ê–¢–ò</button>` : ""}
                            <button class="btn-action-g" onclick="window.viewReports('${s.id}', '${u.name}')">–ê–†–•–Ü–í</button>
                            <button class="btn-manage" onclick="window.enterManageMode('${s.id}')">–ö–ï–†–£–í–ê–¢–ò</button>
                            <button class="btn-action-r" onclick="window.deleteUser('${s.id}')">X</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            });
        }

        // =========================================
        // –õ–û–ì–Ü–ö–ê –°–ü–û–í–Ü–©–ï–ù–¨ (–í–ò–ü–†–ê–í–õ–ï–ù–û)
        // =========================================
        
        function addNotification(text, link, docId) {
            // 1. –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —î —Ü–µ–π ID –≤ LocalStorage
            if (readNotifications.includes(docId)) return;

            const list = document.getElementById('notifList');
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —â–æ–± –Ω–µ –¥—É–±–ª—é–≤–∞—Ç–∏ –≤ DOM
            if (document.getElementById('notif-' + docId)) return;

            const item = document.createElement('a');
            item.id = 'notif-' + docId;
            item.className = 'notif-item-link';
            item.innerHTML = `
                <span style="font-size:13px; font-weight:700; color: white;">üì¢ ${text}</span>
                <span style="font-size:11px; color:var(--text-gray); margin-top: 4px;">–©–æ–π–Ω–æ</span>
            `;
            
            // –ö–ª—ñ–∫: –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏ —è–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–µ + –ø–µ—Ä–µ—Ö—ñ–¥
            item.onclick = (e) => {
                e.preventDefault(); // –ó—É–ø–∏–Ω–∏—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–µ—Ä–µ—Ö—ñ–¥, —â–æ–± –≤–∏–∫–æ–Ω–∞—Ç–∏ –ª–æ–≥—ñ–∫—É
                markAsRead(docId);
                window.location.href = link;
            };

            list.prepend(item);
            updateBadgeCount();
        }

        function markAsRead(id) {
            if (!readNotifications.includes(id)) {
                readNotifications.push(id);
                localStorage.setItem('readNotifs', JSON.stringify(readNotifications));
            }
            const el = document.getElementById('notif-' + id);
            if (el) el.remove();
            updateBadgeCount();
        }

        function updateBadgeCount() {
            const count = document.getElementById('notifList').children.length;
            const badge = document.getElementById('bellBadge');
            
            if (count > 0) {
                badge.innerText = count;
                badge.style.display = 'block';
            } else {
                badge.style.display = 'none';
            }
        }

        window.clearAllNotifications = () => {
            const items = document.getElementById('notifList').querySelectorAll('.notif-item-link');
            items.forEach(item => {
                const id = item.id.replace('notif-', '');
                markAsRead(id);
            });
        };

        window.toggleNotifs = (e) => {
            e.stopPropagation();
            const drop = document.getElementById('notifDropdown');
            if (drop.style.display === 'flex') {
                drop.style.display = 'none';
            } else {
                drop.style.display = 'flex';
                drop.style.animation = 'slideDown 0.3s ease';
            }
        };

        // –°–ª—ñ–¥–∫—É—î–º–æ –∑–∞ –Ω–æ–≤–∏–º–∏ –∑–∞–ø–∏—Å–∞–º–∏ (Reports, Subotniks, Apps)
        function initNotifications() {
            const collections = ['reports', 'subotniks', 'applications'];
            
            collections.forEach(colName => {
                onSnapshot(collection(db, colName), (snap) => {
                    // –ß–µ—Ä–≤–æ–Ω–∞ –∫—Ä–∞–ø–∫–∞ –≤ –º–µ–Ω—é
                    const dotId = colName === 'reports' ? 'dot-reports' : 
                                  colName === 'subotniks' ? 'dot-subotniks' : 'dot-apps';
                    
                    // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –∫—Ä–∞–ø–∫–∏ (—è–∫—â–æ –Ω–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –±—ñ–ª—å—à–µ –Ω—ñ–∂ –±—É–ª–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ —Ä–∞–Ω—ñ—à–µ)
                    const savedCount = localStorage.getItem('count_' + colName) || 0;
                    if (snap.size > savedCount) {
                        const dot = document.getElementById(dotId);
                        if(dot) dot.style.display = 'block';
                    }

                    // –õ–æ–≥—ñ–∫–∞ –¥–ª—è –¥–∑–≤—ñ–Ω–æ—á–∫–∞ (—Ç—ñ–ª—å–∫–∏ –Ω–æ–≤—ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ)
                    snap.docChanges().forEach(change => {
                        if (change.type === "added") {
                            // –î–æ–¥–∞—î–º–æ –≤ —Å–ø–∏—Å–æ–∫ (—Ñ—É–Ω–∫—Ü—ñ—è addNotification —Å–∞–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å —á–∏ –º–∏ —Ü–µ –≤–∂–µ –±–∞—á–∏–ª–∏)
                            addNotification(`–ù–æ–≤–∏–π –∑–∞–ø–∏—Å —É: ${colName}`, `${colName}.html`, change.doc.id);
                        }
                    });
                });
            });
        }

        // –°–ª—ñ–¥–∫—É—î–º–æ –∑–∞ –∑–≥–∞–¥–∫–∞–º–∏ –≤ —á–∞—Ç–∞—Ö (@Name)
        function listenForMentions() {
            // –ë–µ—Ä–µ–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ª–∏—à–µ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—é –≥–æ–¥–∏–Ω—É, —â–æ–± –Ω–µ —Å–ø–∞–º–∏—Ç–∏ —Å—Ç–∞—Ä–∏–º–∏
            const oneHourAgo = new Date(Date.now() - 3600 * 1000); 

            onSnapshot(collection(db, "channels"), (snap) => {
                snap.forEach(channel => {
                    const q = query(
                        collection(db, "channels", channel.id, "messages"), 
                        orderBy("createdAt", "desc"),
                        where("createdAt", ">", oneHourAgo)
                    );

                    onSnapshot(q, (mSnap) => {
                        mSnap.docChanges().forEach(change => {
                            if (change.type === "added") {
                                const msg = change.doc.data();
                                // –Ø–∫—â–æ —Ç–µ–∫—Å—Ç –º—ñ—Å—Ç–∏—Ç—å –º–æ—î —ñ–º'—è —ñ —Ü–µ –Ω–µ —è –Ω–∞–ø–∏—Å–∞–≤
                                if (msg.text && msg.text.includes(`@${myData.name}`) && msg.uid !== currentUID) {
                                    addNotification(`–í–∞—Å –∑–≥–∞–¥–∞–≤ ${msg.author}`, 'chats.html', change.doc.id);
                                }
                            }
                        });
                    });
                });
            });
        }

        // =========================================
        // –ê–î–ú–Ü–ù –§–£–ù–ö–¶–Ü–û–ù–ê–õ (–°–¢–ê–†–ò–ô –°–¢–ê–ë–Ü–õ–¨–ù–ò–ô)
        // =========================================

        window.changeStat = async (field, val) => {
            const docRef = doc(db, "users", editingUID);
            const snap = await getDoc(docRef);
            let currentVal = snap.data()[field] || 0;
            let newVal = currentVal + val;
            if (newVal < 0) newVal = 0;

            await updateDoc(docRef, { [field]: newVal });
            
            // –û–Ω–æ–≤–∏—Ç–∏ UI
            const upd = await getDoc(docRef);
            updateUI(upd.data());
        };

        window.updateField = async (f) => {
            let promptText = f === 'passport' ? "–í–≤–µ–¥—ñ—Ç—å –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–∞—Å–ø–æ—Ä—Ç:" : "–í–≤–µ–¥—ñ—Ç—å Discord ID:";
            const val = prompt(promptText);
            if (val) {
                await updateDoc(doc(db, "users", currentUID), { [f]: val });
                // –û–Ω–æ–≤–ª—é—î–º–æ UI –ª–æ–∫–∞–ª—å–Ω–æ
                updateUI({...myData, [f]: val});
                // –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–∑—É
                const u = await getDoc(doc(db, "users", currentUID));
                myData = u.data();
                updateUI(myData);
            }
        };

        // –†–µ–∂–∏–º –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–Ω—à–∏–º –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º
        window.enterManageMode = async (id) => {
            editingUID = id;
            const s = await getDoc(doc(db, "users", id));
            updateUI(s.data());
            
            // –ó–º—ñ–Ω–∞ —Ä–∞–Ω–≥—É —á–µ—Ä–µ–∑ prompt (–°—Ç–∞—Ä–∏–π –º–µ—Ç–æ–¥)
            const currentRank = s.data().rank || "–†–µ–∫—Ä—É—Ç | –°–ª—É–∂–±–æ–≤–µ—Ü—å";
            const newRank = prompt("–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤–µ –∑–≤–∞–Ω–Ω—è —Ç–∞ –ø–æ—Å–∞–¥—É (—Ñ–æ—Ä–º–∞—Ç: –ó–≤–∞–Ω–Ω—è | –ü–æ—Å–∞–¥–∞):", currentRank);
            
            if (newRank && newRank !== currentRank) {
                await updateDoc(doc(db, "users", id), { rank: newRank });
                // –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ UI
                const updated = await getDoc(doc(db, "users", id));
                updateUI(updated.data());
            }

            document.getElementById('backToMe').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.resetView = () => {
            editingUID = currentUID;
            updateUI(myData);
            document.getElementById('backToMe').style.display = 'none';
        };

        window.verifyUser = async (id) => {
            if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –Ω–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø —Ü—å–æ–º—É –±—ñ–π—Ü—é?")) {
                await updateDoc(doc(db, "users", id), { verified: true });
            }
        };

        window.deleteUser = async (id) => {
            // –û—Ç—Ä–∏–º—É—î–º–æ —Å–µ–∫—Ä–µ—Ç–Ω–∏–π –∫–æ–¥ –∑ –±–∞–∑–∏ –¥–ª—è –±–µ–∑–ø–µ–∫–∏
            const settingsDoc = await getDoc(doc(db, "settings", "secrets"));
            const secret = settingsDoc.data()?.adminCode || "0000";

            const input = prompt("–í–í–ï–î–Ü–¢–¨ –ü–ê–†–û–õ–¨ –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê –î–õ–Ø –í–ò–î–ê–õ–ï–ù–ù–Ø:");
            if (input === secret) {
                await deleteDoc(doc(db, "users", id));
                alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–¥–∞–ª–µ–Ω–æ.");
            } else {
                alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!");
            }
        };

        // –ü–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –≤–≥–æ—Ä—É/–≤–Ω–∏–∑ –≤ —Å–ø–∏—Å–∫—É
        window.moveUser = async (id, direction) => {
            const snap = await getDocs(query(collection(db, "users"), orderBy("staffIndex", "asc")));
            let users = [];
            snap.forEach(d => users.push({ id: d.id, ...d.data() }));

            const index = users.findIndex(u => u.id === id);
            const newIndex = index + direction;

            if (newIndex >= 0 && newIndex < users.length) {
                const otherUser = users[newIndex];
                
                // –ú—ñ–Ω—è—î–º–æ –º—ñ—Å—Ü—è–º–∏ staffIndex
                const batch = writeBatch(db);
                batch.update(doc(db, "users", id), { staffIndex: newIndex }); // –ê–±–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–º—ñ–Ω—è—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è index
                // –¢—É—Ç –ø—Ä–æ—Å—Ç—ñ—à–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç - –ø—Ä–æ—Å—Ç–æ –ø–æ–º—ñ–Ω—è—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏ –º—ñ—Å—Ü—è–º–∏ –≤ –±–∞–∑—ñ, –∞–ª–µ –∫—Ä–∞—â–µ –≤–∑—è—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è staffIndex –æ–¥–∏–Ω –æ–¥–Ω–æ–≥–æ
                
                const idx1 = users[index].staffIndex;
                const idx2 = users[newIndex].staffIndex;

                batch.update(doc(db, "users", id), { staffIndex: idx2 });
                batch.update(doc(db, "users", otherUser.id), { staffIndex: idx1 });

                await batch.commit();
            }
        };

        // =========================================
        // –õ–û–ì–Ü–ö–ê –ê–†–•–Ü–í–£ (VIEW REPORTS)
        // =========================================
        window.viewReports = async (uid, name) => {
            const modal = document.getElementById('reportsModal');
            const listUI = document.getElementById('modalReportsList');
            
            document.getElementById('modalTitle').innerText = "–ê–†–•–Ü–í: " + name;
            modal.style.display = 'flex';
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –ø–æ—è–≤–∏
            setTimeout(() => { modal.style.opacity = '1'; }, 10);
            
            listUI.innerHTML = "<p style='text-align:center; color:gray;'>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∞—Ä—Ö—ñ–≤—É...</p>";
            
            let allReports = [];

            // –®—É–∫–∞—î–º–æ –≤ reports
            const reportsSnap = await getDocs(collection(db, "reports"));
            reportsSnap.forEach(doc => {
                const data = doc.data();
                // –ù–µ—Ç–æ—á–Ω–∏–π –ø–æ—à—É–∫ –ø–æ —ñ–º–µ–Ω—ñ –∞–±–æ ID (—è–∫—â–æ –≤–æ–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç—ñ)
                if (JSON.stringify(data).toLowerCase().includes(name.toLowerCase())) {
                    allReports.push({ ...data, type: "–¢–ò–ñ–ù–ï–í–ò–ô –ó–í–Ü–¢" });
                }
            });

            // –®—É–∫–∞—î–º–æ –≤ subotniks
            const subotnikSnap = await getDocs(collection(db, "subotniks"));
            subotnikSnap.forEach(doc => {
                const data = doc.data();
                if (JSON.stringify(data).toLowerCase().includes(name.toLowerCase())) {
                    allReports.push({ ...data, type: "–°–£–ë–û–¢–ù–ò–ö" });
                }
            });

            listUI.innerHTML = "";

            if (allReports.length === 0) {
                listUI.innerHTML = "<p style='text-align:center; padding:20px; color:var(--text-gray);'>–ê—Ä—Ö—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π –∞–±–æ –∑–≤—ñ—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>";
            } else {
                allReports.forEach(rep => {
                    const card = document.createElement('div');
                    card.className = 'report-card';
                    card.innerHTML = `
                        <div class="report-header">
                            <b style="color:var(--primary-bright);">${rep.date || rep.period || '–ë–µ–∑ –¥–∞—Ç–∏'}</b>
                            <small style="color:var(--text-gray); font-weight:700;">[${rep.type}]</small>
                        </div>
                        <div class="report-body">${rep.content || rep.message || '–¢–µ–∫—Å—Ç –∑–≤—ñ—Ç—É –≤—ñ–¥—Å—É—Ç–Ω—ñ–π...'}</div>
                    `;
                    listUI.appendChild(card);
                });
            }
        };

        window.closeModal = () => {
            const modal = document.getElementById('reportsModal');
            modal.style.opacity = '0';
            setTimeout(() => { modal.style.display = 'none'; }, 300);
        };

        // –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ (Lockdown)
        function listenToSystemStatus(role) {
            onSnapshot(doc(db, "settings", "systemStatus"), (snap) => {
                const isLocked = snap.data()?.isLocked;
                if (isLocked && role !== 'admin') {
                    document.getElementById('lockScreen').style.display = 'flex';
                } else {
                    document.getElementById('lockScreen').style.display = 'none';
                }
            });
        }

        window.toggleSystemAccess = async () => {
            const s = await getDoc(doc(db, "settings", "secrets"));
            const code = prompt("–í–í–ï–î–Ü–¢–¨ –ö–û–î –î–û–°–¢–£–ü–£:");
            
            if (code === s.data()?.adminCode) {
                const ref = doc(db, "settings", "systemStatus");
                const snap = await getDoc(ref);
                await updateDoc(ref, { isLocked: !snap.data().isLocked });
                alert("–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ –∑–º—ñ–Ω–µ–Ω–æ!");
            } else {
                alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥!");
            }
        };

        // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–µ–Ω—é –ø—Ä–∏ –∫–ª—ñ–∫—É –ø–æ–∑–∞ –Ω–∏–º
        window.onclick = (event) => {
            const drop = document.getElementById('notifDropdown');
            const bell = document.querySelector('.notif-wrapper');
            if (!bell.contains(event.target) && !drop.contains(event.target)) {
                drop.style.display = 'none';
            }
            
            // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª–∫–∏ –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ñ–æ–Ω
            const modal = document.getElementById('reportsModal');
            if (event.target === modal) {
                window.closeModal();
            }
        };
    </script>
</body>
</html>
