<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
--primary: #00ff44;
--primary-bright: #e0ffe8;
--primary-glow: rgba(0,255,68,0.7);
--primary-dim: rgba(0,255,68,0.15);
--bg: #030507;
--card-bg: rgba(10,12,16,0.85);
--glass-border: rgba(0,255,68,0.3);
--danger: #ef4444;
--danger-glow: rgba(239,68,68,0.6);
--warning: #fbbf24;
--warning-glow: rgba(251,191,36,0.5);
--info: #3b82f6;
--info-glow: rgba(59,130,246,0.5);
--text-gray: #94a3b8;
--text-light: #cbd5e1;
--success: #10b981;
--card-hover: rgba(0,255,68,0.08);
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
background: var(--bg);
color: white;
font-family: 'Inter', sans-serif;
min-height: 100vh;
overflow-x: hidden;
user-select: none;
-webkit-user-select: none;
}
body::before {
content: '';
position: fixed;
top: 0; left: 0;
width: 100%; height: 100%;
background:
radial-gradient(ellipse at 15% 50%, rgba(0,255,68,0.18), transparent 55%),
radial-gradient(ellipse at 85% 20%, rgba(0,255,68,0.15), transparent 55%),
radial-gradient(ellipse at 50% 80%, rgba(0,255,68,0.12), transparent 55%);
pointer-events: none;
z-index: 0;
animation: bgPulse 10s ease-in-out infinite;
}
@keyframes bgPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.75; } }
input, textarea { user-select: text !important; -webkit-user-select: text !important; }
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: #0a0d12; }
::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; box-shadow: 0 0 8px var(--primary); }
@keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideDown { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
@keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
@keyframes glow { 0%, 100% { box-shadow: 0 0 5px var(--primary-glow); } 50% { box-shadow: 0 0 25px var(--primary-glow), 0 0 50px rgba(0,255,68,0.2); } }
@keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-8px); } 40%, 80% { transform: translateX(8px); } }

header { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: rgba(3,5,7,0.9); border-bottom: 1px solid var(--glass-border); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(20px); }
.logo-box { background: var(--primary); color: black; padding: 8px 16px; border-radius: 10px; font-weight: 900; text-decoration: none; font-size: 14px; text-transform: uppercase; box-shadow: 0 0 20px var(--primary-glow); transition: 0.3s; letter-spacing: 1px; }
.logo-box:hover { box-shadow: 0 0 30px var(--primary-glow); transform: translateY(-2px); }
.header-right { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
.user-name-header { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 13px; color: var(--primary-bright); letter-spacing: 0.3px; }
.role-badge { padding: 6px 14px; border-radius: 8px; font-size: 11px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; border: 1px solid; }
.role-admin { background: rgba(0,255,68,0.15); color: var(--primary); border-color: var(--primary); box-shadow: 0 0 15px rgba(0,255,68,0.3); }
.role-instructor { background: rgba(251,191,36,0.15); color: var(--warning); border-color: var(--warning); box-shadow: 0 0 15px rgba(251,191,36,0.3); }
.role-fighter { background: rgba(59,130,246,0.15); color: var(--info); border-color: var(--info); box-shadow: 0 0 15px rgba(59,130,246,0.3); }
.nav-tabs { display: flex; gap: 6px; flex-wrap: wrap; }
.nav-btn { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: var(--text-light); padding: 10px 18px; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 12px; position: relative; overflow: hidden; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; }
.nav-btn:hover { border-color: var(--primary); color: var(--primary-bright); background: rgba(0,255,68,0.08); transform: translateY(-2px); }
.nav-btn.active { background: var(--primary); color: black; border-color: var(--primary); box-shadow: 0 0 20px var(--primary-glow); font-weight: 900; }
.main-wrap { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
.view { display: none; animation: fadeIn 0.5s ease; }
.view.active { display: block; }
.stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px; }
.stat-card { background: var(--card-bg); border: 1px solid rgba(0,255,68,0.15); border-radius: 16px; padding: 22px; text-align: center; backdrop-filter: blur(10px); transition: all 0.3s ease; }
.stat-card:hover { border-color: var(--primary); transform: translateY(-3px); box-shadow: 0 8px 30px rgba(0,255,68,0.15); }
.stat-num { font-size: 32px; font-weight: 900; color: var(--primary); text-shadow: 0 0 15px var(--primary-glow); margin-bottom: 4px; }
.stat-label { font-size: 10px; font-weight: 700; color: var(--text-gray); text-transform: uppercase; letter-spacing: 1.5px; }
.section-title { font-size: 18px; font-weight: 900; color: var(--primary-bright); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 1px; }
<style>
/* Test Cards */
.tests-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-bottom: 40px; }
.test-card { background: var(--card-bg); border: 1px solid rgba(0,255,68,0.15); border-radius: 20px; padding: 28px; width: 320px; backdrop-filter: blur(10px); transition: all 0.4s ease; cursor: pointer; position: relative; }
.test-card:hover { border-color: var(--primary); transform: translateY(-5px); box-shadow: 0 10px 40px rgba(0,255,68,0.2); }
.test-card .emoji { font-size: 48px; margin-bottom: 15px; display: block; }
.test-card h3 { font-size: 17px; font-weight: 800; margin-bottom: 8px; color: white; }
.test-card p { font-size: 12px; color: var(--text-gray); margin-bottom: 15px; line-height: 1.5; }
.test-meta { display: flex; gap: 8px; flex-wrap: wrap; }
.meta-tag { font-size: 10px; padding: 5px 10px; border-radius: 8px; font-weight: 700; background: rgba(0,255,68,0.1); color: var(--primary); border: 1px solid rgba(0,255,68,0.2); }

/* Context menu */
.context-menu { position: fixed; background: rgba(10, 15, 25, 0.98); border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px; min-width: 220px; z-index: 2000; display: none; backdrop-filter: blur(20px); box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8); animation: slideDown 0.2s ease; }
.context-menu.active { display: block; }
.context-menu-item { padding: 12px 16px; cursor: pointer; border-radius: 8px; font-size: 13px; font-weight: 600; display: flex; align-items: center; gap: 10px; transition: all 0.2s ease; color: var(--text-light); }
.context-menu-item:hover { background: rgba(0, 255, 68, 0.1); color: var(--primary-bright); transform: translateX(3px); }
.context-menu-item.danger:hover { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
.context-menu-item.warning:hover { background: rgba(251, 191, 36, 0.1); color: var(--warning); }
.context-menu-divider { height: 1px; background: rgba(255, 255, 255, 0.1); margin: 6px 0; }
.public-link-copied { position: fixed; bottom: 30px; right: 30px; background: var(--primary); color: black; padding: 15px 25px; border-radius: 12px; font-weight: 800; font-size: 13px; z-index: 3000; box-shadow: 0 10px 40px var(--primary-glow); animation: slideUp 0.3s ease; display: none; }
.public-link-copied.show { display: block; }

/* Agreement */
.agreement-box { background: rgba(251,191,36,0.05); border: 1px solid rgba(251,191,36,0.3); border-radius: 16px; padding: 20px; margin-bottom: 25px; }
.agreement-check { display: flex; align-items: flex-start; gap: 12px; cursor: pointer; user-select: none; }
.agreement-check input[type="checkbox"] { width: 22px; height: 22px; cursor: pointer; accent-color: var(--primary); flex-shrink: 0; margin-top: 2px; }
.agreement-text { font-size: 13px; color: var(--text-light); line-height: 1.6; user-select: text; }
.agreement-text strong { color: var(--warning); font-weight: 800; }

/* Intro card */
.intro-card { max-width: 600px; margin: 40px auto; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 24px; padding: 40px; text-align: center; backdrop-filter: blur(10px); }
.intro-card .emoji { font-size: 64px; margin-bottom: 20px; display: block; }
.intro-card h2 { font-size: 24px; font-weight: 900; margin-bottom: 10px; }
.intro-card p { color: var(--text-gray); font-size: 13px; margin-bottom: 8px; }

/* Quiz */
.quiz-container { max-width: 700px; margin: 20px auto; }
.quiz-progress-bar { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; margin-bottom: 25px; overflow: hidden; }
.quiz-progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #00ff88); border-radius: 10px; transition: width 0.5s ease; box-shadow: 0 0 10px var(--primary-glow); }
.quiz-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
.quiz-timer { font-size: 28px; font-weight: 900; color: var(--warning); text-shadow: 0 0 15px var(--warning-glow); }
.quiz-timer.danger { color: var(--danger); text-shadow: 0 0 15px var(--danger-glow); animation: pulse 0.5s infinite; }
.quiz-question { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 30px; margin-bottom: 20px; backdrop-filter: blur(10px); }
.quiz-question h3 { font-size: 18px; font-weight: 800; margin-bottom: 5px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
.quiz-answers { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
.answer-btn { background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 16px 20px; color: white; font-size: 14px; font-weight: 600; cursor: pointer; text-align: left; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; }
.answer-btn:hover { border-color: var(--primary); background: rgba(0,255,68,0.05); transform: translateX(5px); }
.answer-btn.selected { border-color: var(--primary); background: rgba(0,255,68,0.1); box-shadow: 0 0 20px rgba(0,255,68,0.15); }
.answer-letter { width: 32px; height: 32px; border-radius: 10px; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 13px; color: var(--text-gray); flex-shrink: 0; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
.answer-btn.selected .answer-letter { background: var(--primary); color: black; border-color: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }

/* Buttons */
.btn { padding: 14px 28px; border: none; border-radius: 14px; font-weight: 800; font-size: 13px; cursor: pointer; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s ease; }
.btn:active { transform: scale(0.96); }
.btn-primary { background: var(--primary); color: black; box-shadow: 0 4px 15px rgba(0,255,68,0.3); }
.btn-primary:hover { background: var(--primary-bright); box-shadow: 0 6px 25px rgba(0,255,68,0.5); transform: translateY(-2px); }
.btn-primary:disabled { opacity: 0.5; cursor: not-allowed; background: rgba(0,255,68,0.2); }
.btn-secondary { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.15); color: white; }
.btn-secondary:hover { border-color: var(--primary); color: var(--primary-bright); background: rgba(0,255,68,0.08); transform: translateY(-2px); }
.btn-danger { background: rgba(239,68,68,0.1); border: 1px solid var(--danger); color: var(--danger); }
.btn-danger:hover { background: var(--danger); color: white; transform: translateY(-2px); box-shadow: 0 6px 20px var(--danger-glow); }
.btn-warning { background: rgba(251,191,36,0.1); border: 1px solid var(--warning); color: var(--warning); }
.btn-warning:hover { background: var(--warning); color: black; transform: translateY(-2px); box-shadow: 0 6px 20px var(--warning-glow); }
.btn-info { background: rgba(59,130,246,0.1); border: 1px solid var(--info); color: var(--info); }
.btn-info:hover { background: var(--info); color: white; transform: translateY(-2px); box-shadow: 0 6px 20px var(--info-glow); }
.btn-group { display: flex; gap: 10px; justify-content: center; margin-top: 25px; flex-wrap: wrap; }

/* Forms */
.form-card { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 30px; backdrop-filter: blur(10px); margin-bottom: 20px; }
.form-row { margin-bottom: 18px; }
.form-label { display: block; font-size: 11px; color: var(--primary); margin-bottom: 8px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
.form-input { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 14px; border-radius: 12px; font-size: 14px; outline: none; font-family: inherit; transition: 0.3s; }
.form-input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0,255,68,0.15); }
.form-row-inline { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.form-hint { font-size: 11px; color: var(--text-gray); margin-top: 8px; font-weight: 600; }
<style>
/* Results */
.result-detail { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; padding: 18px; margin-bottom: 10px; text-align: left; display: flex; align-items: flex-start; gap: 12px; }
.result-detail .mark { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; font-weight: 900; }
.mark.ok { background: rgba(0,255,68,0.15); color: var(--primary); }
.mark.no { background: rgba(239,68,68,0.15); color: var(--danger); }
.mark.pend { background: rgba(251,191,36,0.15); color: var(--warning); }
.result-circle { width: 160px; height: 160px; border-radius: 50%; margin: 0 auto 25px; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 4px solid; }
.result-circle.pass { border-color: var(--primary); box-shadow: 0 0 40px var(--primary-glow); animation: glow 2s infinite; }
.result-circle.fail { border-color: var(--danger); box-shadow: 0 0 40px var(--danger-glow); }
.result-score { font-size: 36px; font-weight: 900; }
.result-max { font-size: 12px; color: var(--text-gray); font-weight: 700; }
.result-status { font-size: 28px; font-weight: 900; margin-bottom: 10px; }
.result-status.pass { color: var(--primary); text-shadow: 0 0 20px var(--primary-glow); }
.result-status.fail { color: var(--danger); text-shadow: 0 0 20px var(--danger-glow); }

/* Tables */
.results-table { width: 100%; border-collapse: collapse; margin-top: 15px; overflow-x: auto; display: block; }
.results-table table { width: 100%; min-width: 600px; }
.results-table th { text-align: left; padding: 12px 15px; font-size: 10px; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid var(--glass-border); font-weight: 800; }
.results-table td { padding: 12px 15px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); }
.results-table tr:hover td { background: rgba(0,255,68,0.03); }
.status-badge { padding: 4px 12px; border-radius: 8px; font-size: 10px; font-weight: 800; text-transform: uppercase; white-space: nowrap; }
.st-pass { background: rgba(16,185,129,0.15); color: var(--success); border: 1px solid rgba(16,185,129,0.3); }
.st-fail { background: rgba(239,68,68,0.15); color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }
.st-pending { background: rgba(251,191,36,0.15); color: var(--warning); border: 1px solid rgba(251,191,36,0.3); }
.st-approved { background: rgba(0,255,68,0.15); color: var(--primary); border: 1px solid rgba(0,255,68,0.3); }
.st-rejected { background: rgba(239,68,68,0.15); color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }

/* Photo gallery */
.test-photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; margin-top: 15px; }
.test-photo-item { position: relative; border-radius: 12px; overflow: hidden; cursor: zoom-in; border: 1px solid rgba(255,255,255,0.1); transition: 0.3s; }
.test-photo-item:hover { transform: scale(1.05); border-color: var(--primary); box-shadow: 0 0 20px rgba(0,255,68,0.3); }
.test-photo-item img { width: 100%; height: 120px; object-fit: cover; }
.photo-delete-mini { position: absolute; top: 5px; right: 5px; background: rgba(239,68,68,0.9); color: white; border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center; font-weight: 900; }
.upload-photo-btn { background: rgba(0,255,68,0.1); border: 2px dashed var(--primary); color: var(--primary); padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: 700; font-size: 13px; transition: 0.3s; margin-top: 15px; width: 100%; }
.upload-photo-btn:hover { background: rgba(0,255,68,0.2); transform: translateY(-2px); }

/* Question photos */
.question-photo-section { margin-top: 12px; margin-bottom: 12px; }
.question-photo-preview { position: relative; display: inline-block; border-radius: 12px; overflow: hidden; border: 1px solid rgba(0,255,68,0.2); }
.question-photo-preview img { width: 200px; height: 150px; object-fit: cover; display: block; cursor: zoom-in; }
.question-photo-delete { position: absolute; top: 8px; right: 8px; background: rgba(239,68,68,0.95); color: white; border: none; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; font-weight: 900; }
.add-question-photo-btn { background: rgba(0,255,68,0.08); border: 1px dashed rgba(0,255,68,0.3); color: var(--primary); padding: 8px 16px; border-radius: 10px; cursor: pointer; font-size: 12px; font-weight: 700; transition: 0.3s; }
.add-question-photo-btn:hover { background: rgba(0,255,68,0.15); border-color: var(--primary); }
.quiz-question-photo { margin-top: 15px; margin-bottom: 15px; text-align: center; }
.quiz-question-photo img { max-width: 100%; max-height: 300px; border-radius: 12px; border: 1px solid rgba(0,255,68,0.2); cursor: zoom-in; transition: 0.3s; }
.quiz-question-photo img:hover { transform: scale(1.02); border-color: var(--primary); box-shadow: 0 0 20px rgba(0,255,68,0.3); }

/* Lightbox */
.lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 3000; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
.lightbox.active { display: flex; }
.lightbox-img { max-width: 90%; max-height: 85vh; border-radius: 8px; box-shadow: 0 0 50px rgba(0,255,68,0.3); }
.lightbox-close { position: absolute; top: 30px; right: 30px; font-size: 40px; color: white; cursor: pointer; opacity: 0.7; transition: 0.3s; z-index: 3001; }
.lightbox-close:hover { opacity: 1; color: var(--danger); transform: rotate(90deg); }

/* Question blocks */
.q-block { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 20px; margin-bottom: 15px; transition: 0.3s; }
.q-block:hover { border-color: rgba(0,255,68,0.2); }
.q-block.error { border-color: var(--danger) !important; animation: shake 0.5s; box-shadow: 0 0 20px var(--danger-glow); }
.q-block-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.q-num { font-size: 12px; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
.q-del { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 18px; opacity: 0.5; transition: 0.3s; }
.q-del:hover { opacity: 1; transform: scale(1.2); }

/* Options */
.opt-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.opt-radio { width: 22px; height: 22px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); cursor: pointer; transition: 0.3s; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
.opt-radio:hover { border-color: var(--primary); }
.opt-radio.checked { border-color: var(--primary); background: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
.opt-radio.checked::after { content: '‚úì'; color: black; font-size: 12px; font-weight: 900; }
.opt-input { flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08); color: white; padding: 10px 14px; border-radius: 10px; font-size: 13px; outline: none; font-family: inherit; transition: 0.3s; }
.opt-input:focus { border-color: var(--primary); }
.opt-del { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 14px; opacity: 0.4; transition: 0.3s; }
.opt-del:hover { opacity: 1; }
.add-opt-btn { background: none; border: 1px dashed rgba(255,255,255,0.1); color: var(--text-gray); padding: 8px; border-radius: 10px; cursor: pointer; font-size: 12px; width: 100%; transition: 0.3s; font-weight: 600; }
.add-opt-btn:hover { border-color: var(--primary); color: var(--primary); }
<style>
/* Toggle switches */
.free-toggle-create, .table-toggle-create { display: flex; align-items: center; gap: 8px; margin-top: 10px; cursor: pointer; font-size: 12px; color: var(--text-gray); font-weight: 600; transition: 0.3s; }
.free-toggle-create:hover, .table-toggle-create:hover { color: var(--primary); }
.toggle-switch { width: 36px; height: 20px; border-radius: 12px; background: rgba(255,255,255,0.1); position: relative; transition: 0.3s; flex-shrink: 0; }
.toggle-switch.on { background: var(--primary); }
.toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px; border-radius: 50%; background: white; transition: 0.3s; }
.toggle-switch.on::after { left: 18px; }

/* Table builder */
.table-builder { margin-top: 15px; padding: 15px; background: rgba(0,255,68,0.03); border: 1px solid rgba(0,255,68,0.15); border-radius: 12px; }
.table-builder-head { display: flex; gap: 10px; margin-bottom: 10px; flex-wrap: wrap; }
.table-col-input { flex: 1; min-width: 100px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; outline: none; font-family: inherit; }
.table-col-input:focus { border-color: var(--primary); }
.table-builder-rows { margin-top: 10px; }
.table-row-builder { display: flex; gap: 10px; margin-bottom: 8px; align-items: center; }
.table-cell-input { flex: 1; min-width: 100px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.08); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; outline: none; font-family: inherit; }
.table-cell-input:focus { border-color: var(--primary); }

/* Answer tables */
.answer-table-wrapper { overflow-x: auto; margin-bottom: 15px; }
.answer-table { width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.3); border-radius: 12px; overflow: hidden; }
.answer-table th { background: rgba(0,255,68,0.1); color: var(--primary); padding: 12px; text-align: left; font-size: 12px; font-weight: 800; text-transform: uppercase; border-bottom: 2px solid rgba(0,255,68,0.2); }
.answer-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px; }
.answer-table tr:hover td { background: rgba(0,255,68,0.03); }
.table-radio { width: 24px; height: 24px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.2); cursor: pointer; transition: 0.3s; display: inline-flex; align-items: center; justify-content: center; vertical-align: middle; }
.table-radio:hover { border-color: var(--primary); }
.table-radio.checked { border-color: var(--primary); background: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
.table-radio.checked::after { content: '‚úì'; color: black; font-size: 12px; font-weight: 900; }

/* Free answer */
.free-answer-area { margin-top: 15px; }
.free-answer-toggle { display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 12px 16px; border-radius: 12px; border: 1px dashed rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); transition: 0.3s; font-size: 13px; color: var(--text-gray); font-weight: 600; }
.free-answer-toggle:hover { border-color: var(--primary); color: var(--primary-bright); background: rgba(0,255,68,0.05); }
.free-answer-toggle.active { border-color: var(--primary); color: var(--primary); background: rgba(0,255,68,0.08); }
.free-input { width: 100%; margin-top: 10px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 14px; border-radius: 12px; font-size: 14px; outline: none; font-family: inherit; resize: vertical; min-height: 80px; transition: 0.3s; }
.free-input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0,255,68,0.2); }

/* Reviewer chips */
.reviewer-chip { display: inline-flex; align-items: center; gap: 6px; background: rgba(0,255,68,0.1); border: 1px solid rgba(0,255,68,0.2); color: var(--primary-bright); padding: 6px 12px; border-radius: 10px; font-size: 12px; font-weight: 700; margin: 3px; }
.reviewer-chip button { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 14px; margin-left: 4px; }

/* People dropdown */
.people-dropdown { position: relative; }
.people-list { position: absolute; top: 100%; left: 0; right: 0; background: rgba(10,15,25,0.98); border: 1px solid var(--glass-border); border-radius: 12px; max-height: 200px; overflow-y: auto; z-index: 100; display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
.people-list.show { display: block; animation: slideDown 0.2s ease; }
.people-item { padding: 10px 15px; cursor: pointer; font-size: 13px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
.people-item:hover { background: rgba(0,255,68,0.08); }

/* Review cards */
.review-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.06); border-radius: 18px; padding: 25px; margin-bottom: 15px; }
.review-q { margin-bottom: 15px; padding: 15px; background: rgba(255,255,255,0.02); border-radius: 12px; border-left: 3px solid; }
.review-q.auto-ok { border-color: var(--primary); }
.review-q.auto-fail { border-color: var(--danger); }
.review-q.pending { border-color: var(--warning); }
.review-q .q-title { font-size: 13px; font-weight: 700; margin-bottom: 6px; word-wrap: break-word; }
.review-q .q-answer { font-size: 12px; color: var(--text-light); word-wrap: break-word; }
.review-q .q-correct { font-size: 11px; color: var(--primary); margin-top: 4px; }
.review-q .q-points { font-size: 11px; font-weight: 800; margin-top: 4px; }

/* Points control */
.points-control { display: flex; align-items: center; gap: 8px; margin-top: 8px; }
.points-btn { width: 28px; height: 28px; border-radius: 8px; border: 1px solid; background: none; cursor: pointer; font-size: 16px; font-weight: 900; transition: 0.3s; display: flex; align-items: center; justify-content: center; }
.points-btn.plus { border-color: var(--primary); color: var(--primary); }
.points-btn.plus:hover { background: var(--primary); color: black; box-shadow: 0 0 15px var(--primary-glow); }
.points-btn.minus { border-color: var(--danger); color: var(--danger); }
.points-btn.minus:hover { background: var(--danger); color: white; box-shadow: 0 0 15px var(--danger-glow); }
.points-display { font-size: 14px; font-weight: 800; color: var(--primary); min-width: 60px; text-align: center; padding: 4px 12px; background: rgba(0,255,68,0.1); border-radius: 8px; border: 1px solid rgba(0,255,68,0.2); }

/* Settings & manage */
.setting-block { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.05); border-radius: 16px; padding: 22px; margin-bottom: 15px; }
.setting-block h4 { font-size: 13px; font-weight: 800; color: var(--primary-bright); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.admin-list-panel { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.06); border-radius: 16px; padding: 22px; margin-bottom: 15px; }
.manage-card { background: var(--card-bg); border: 1px solid rgba(255,255,255,0.05); border-radius: 14px; padding: 18px 20px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; flex-wrap: wrap; gap: 15px; }
.manage-card:hover { border-color: var(--glass-border); background: rgba(0,255,68,0.03); }

/* History */
.history-table-wrapper { overflow-x: auto; margin-top: 20px; }
.history-table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; min-width: 800px; }
.history-table th { background: rgba(0,255,68,0.1); color: var(--primary); padding: 14px 12px; text-align: left; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid var(--glass-border); }
.history-table td { padding: 14px 12px; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); }
.history-table tr:hover td { background: rgba(0,255,68,0.05); }
.history-filters { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
.filter-input { flex: 1; min-width: 150px; background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px 14px; border-radius: 10px; font-size: 13px; outline: none; font-family: inherit; }
.filter-input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(0,255,68,0.15); }
.filter-select { background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 10px 14px; border-radius: 10px; font-size: 13px; outline: none; font-family: inherit; cursor: pointer; }
.filter-select:focus { border-color: var(--primary); }

/* Public form */
.public-form-card { max-width: 500px; margin: 40px auto; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 24px; padding: 40px; backdrop-filter: blur(10px); }
.public-form-card h2 { font-size: 22px; font-weight: 900; margin-bottom: 8px; color: var(--primary-bright); text-align: center; }
.public-form-card .subtitle { font-size: 13px; color: var(--text-gray); text-align: center; margin-bottom: 30px; }

/* Mobile */
@media(max-width: 768px) {
.stats-row { grid-template-columns: 1fr 1fr; }
.test-card { width: 100%; max-width: 400px; }
.form-row-inline { grid-template-columns: 1fr; }
.btn-group { flex-direction: column; }
.btn { width: 100%; }
.history-table { font-size: 11px; }
.history-table th, .history-table td { padding: 10px 8px; }
}
@media(max-width: 480px) {
.stats-row { grid-template-columns: 1fr; }
header { flex-direction: column; gap: 10px; }
}
</style>
</head>
<body>

<header id="mainHeader">
<a href="#" class="logo-box" onclick="if(!isPublicMode){showView('home')}">‚öî –î–®–í</a>
<div class="header-right">
<div class="nav-tabs" id="navTabs"></div>
<span class="user-name-header" id="headerName">...</span>
<span class="role-badge" id="headerRole">...</span>
</div>
</header>

<div class="main-wrap">

<!-- –ü—É–±–ª—ñ—á–Ω–∞ —Ñ–æ—Ä–º–∞ -->
<div class="view" id="viewPublicForm">
<div class="public-form-card">
<span style="font-size:48px;display:block;text-align:center;margin-bottom:15px">‚öî</span>
<h2>–î–®–í ‚Äî –Ü—Å–ø–∏—Ç</h2>
<div class="subtitle" id="publicTestName">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
<div class="form-row">
<label class="form-label">–Ü–º'—è</label>
<input class="form-input" id="publicFirstName" placeholder="–í–∞—à–µ —ñ–º'—è...">
</div>
<div class="form-row">
<label class="form-label">–ü—Ä—ñ–∑–≤–∏—â–µ</label>
<input class="form-input" id="publicLastName" placeholder="–í–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ...">
</div>
<div class="form-row">
<label class="form-label">–ü—ñ–¥—Ä–æ–∑–¥—ñ–ª</label>
<input class="form-input" id="publicUnit" placeholder="–í–∞—à –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª...">
</div>
<div id="publicAgreementArea"></div>
<div class="btn-group">
<button class="btn btn-primary" id="publicStartBtn" onclick="startPublicQuiz()" disabled>üöÄ –†–æ–∑–ø–æ—á–∞—Ç–∏ —ñ—Å–ø–∏—Ç</button>
</div>
</div>
</div>

<!-- –ì–æ–ª–æ–≤–Ω–∞ -->
<div class="view active" id="viewHome">
<div class="stats-row" id="statsRow"></div>
<div class="section-title">üìã –î–æ—Å—Ç—É–ø–Ω—ñ —ñ—Å–ø–∏—Ç–∏</div>
<div class="tests-grid" id="testsGrid"></div>
<div class="section-title">üìä –ú–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</div>
<div id="myResults"></div>
</div>

<!-- –í—Å—Ç—É–ø –¥–æ —ñ—Å–ø–∏—Ç—É -->
<div class="view" id="viewIntro">
<div class="intro-card" id="introCard"></div>
</div>

<!-- –ü—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è —ñ—Å–ø–∏—Ç—É -->
<div class="view" id="viewQuiz">
<div class="quiz-container" id="quizContainer"></div>
</div>

<!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
<div class="view" id="viewResult">
<div class="quiz-container" id="resultScreen"></div>
</div>

<!-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ—Å–ø–∏—Ç—É -->
<div class="view" id="viewCreate">
<div class="section-title" id="createTitle">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç</div>
<div id="createForm"></div>
</div>

<!-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ -->
<div class="view" id="viewReview">
<div class="section-title">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</div>
<div id="reviewList"></div>
</div>

<!-- –ö–µ—Ä—É–≤–∞–Ω–Ω—è -->
<div class="view" id="viewManage">
<div class="section-title">‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è —ñ—Å–ø–∏—Ç–∞–º–∏</div>
<div id="manageList"></div>
</div>

<!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
<div class="view" id="viewSettings">
<div class="section-title">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
<div id="settingsContent"></div>
</div>

<!-- –°–ø–∏—Å–∫–∏ -->
<div class="view" id="viewHistory">
<div class="section-title">üìä –°–ø–∏—Å–∫–∏ —Ç–∞ —ñ—Å—Ç–æ—Ä—ñ—è</div>
<div id="historyContent"></div>
</div>

<!-- –ê–¥–º—ñ–Ω–∏ -->
<div class="view" id="viewAdminList">
<div class="section-title">üëë –ê–¥–º—ñ–Ω –ø—Ä–∞–≤–∞ –≤ —ñ—Å–ø–∏—Ç–∞—Ö</div>
<div id="adminListContent"></div>
</div>

</div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" onclick="closeLightbox()">
<span class="lightbox-close" onclick="closeLightbox()">&times;</span>
<img id="lightboxImg" class="lightbox-img" src="">
</div>

<!-- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é -->
<div id="contextMenu" class="context-menu">
<div class="context-menu-item" onclick="contextEdit()"><span>‚úèÔ∏è</span><span>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</span></div>
<div class="context-menu-item warning" onclick="contextClear()"><span>üßπ</span><span>–û—á–∏—Å—Ç–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</span></div>
<div class="context-menu-item" onclick="contextCopyLink()"><span>üîó</span><span>–ü—É–±–ª—ñ—á–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è</span></div>
<div class="context-menu-divider"></div>
<div class="context-menu-item danger" onclick="contextDelete()"><span>üóë</span><span>–í–∏–¥–∞–ª–∏—Ç–∏ —ñ—Å–ø–∏—Ç</span></div>
</div>

<!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
<div id="linkCopiedNotif" class="public-link-copied">üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, getDoc, getDocs, collection, updateDoc, addDoc, deleteDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const app = initializeApp({
apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
authDomain: "dsv-gta.firebaseapp.com",
projectId: "dsv-gta",
storageBucket: "dsv-gta.firebasestorage.app",
messagingSenderId: "661591588818",
appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
});
const auth = getAuth(app);
const db = getFirestore(app);

// === –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ===
let ME = {name: '–ù–µ–≤—ñ–¥–æ–º–∏–π', role: 'fighter', uid: ''};
let allUsers = [];
let tests = [];
let results = JSON.parse(localStorage.getItem('isput_results') || '[]');
let reviewers = JSON.parse(localStorage.getItem('isput_reviewers') || '[]');
let adminList = JSON.parse(localStorage.getItem('isput_admins') || '[]');
let webhookUrl = localStorage.getItem('isput_webhook') || '';
let currentTest = null;
let currentQ = 0;
let answers = {};
let timer = null;
let timeLeft = 30;
let editingTestId = null;
let agreementAccepted = false;
let currentTestPhotos = [];
let contextMenuTestId = null;
let isPublicMode = false;
let publicUserInfo = null;

const save = () => {
localStorage.setItem('isput_results', JSON.stringify(results));
localStorage.setItem('isput_reviewers', JSON.stringify(reviewers));
localStorage.setItem('isput_admins', JSON.stringify(adminList));
localStorage.setItem('isput_webhook', webhookUrl);
};

const letters = '–ê–ë–í–ì“ê–î–ï–ñ–ó–ò';
const isAdmin = () => ME.role === 'admin' || adminList.includes(ME.name);
const isReviewer = () => isAdmin() || reviewers.includes(ME.name);
const genId = () => Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
const now = () => {
const d = new Date();
return d.toLocaleDateString('uk') + ' ' + d.toLocaleTimeString('uk', {hour: '2-digit', minute: '2-digit'});
};

// === –ü–ï–†–ï–í–Ü–†–ö–ê –ü–£–ë–õ–Ü–ß–ù–û–ì–û –†–ï–ñ–ò–ú–£ ===
const urlParams = new URLSearchParams(window.location.search);
const publicTestId = urlParams.get('public');

if (publicTestId) {
isPublicMode = true;
document.getElementById('mainHeader').style.display = 'none';
document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
document.getElementById('viewPublicForm').classList.add('active');
loadPublicTest(publicTestId);
}

async function loadPublicTest(testId) {
try {
const snap = await getDoc(doc(db, 'tests', testId));
if (snap.exists()) {
currentTest = {id: snap.id, ...snap.data()};
document.getElementById('publicTestName').textContent = currentTest.name;

if (currentTest.agreementText && currentTest.agreementText.trim()) {
document.getElementById('publicAgreementArea').innerHTML = `
<div class="agreement-box">
<label class="agreement-check">
<input type="checkbox" id="publicAgreementCheck" onchange="togglePublicAgreement()">
<div class="agreement-text"><strong>üìú –£–≥–æ–¥–∞:</strong><br>${currentTest.agreementText}</div>
</label>
</div>`;
} else {
agreementAccepted = true;
document.getElementById('publicStartBtn').disabled = false;
}
} else {
document.getElementById('publicTestName').textContent = '‚ùå –Ü—Å–ø–∏—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ';
}
} catch(e) {
document.getElementById('publicTestName').textContent = '‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è';
}
}

window.togglePublicAgreement = () => {
const cb = document.getElementById('publicAgreementCheck');
agreementAccepted = cb.checked;
document.getElementById('publicStartBtn').disabled = !agreementAccepted;
};

window.startPublicQuiz = () => {
const fn = document.getElementById('publicFirstName').value.trim();
const ln = document.getElementById('publicLastName').value.trim();
const unit = document.getElementById('publicUnit').value.trim();
if (!fn || !ln || !unit) { alert('‚ö†Ô∏è –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!'); return; }
if (!agreementAccepted) { alert('‚ö†Ô∏è –ü—Ä–∏–π–º—ñ—Ç—å —É–≥–æ–¥—É!'); return; }
publicUserInfo = {firstName: fn, lastName: ln, unit: unit, name: fn + ' ' + ln};
ME.name = publicUserInfo.name;
ME.uid = 'public_' + genId();
currentQ = 0;
answers = {};
document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
document.getElementById('viewQuiz').classList.add('active');
renderQuestion();
};

// === AUTH (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –ù–ï –ø—É–±–ª—ñ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É) ===
if (!isPublicMode) {
onAuthStateChanged(auth, async u => {
if (!u) { window.location.href = 'index.html'; return; }
ME.uid = u.uid;
try {
const snap = await getDoc(doc(db, 'users', u.uid));
if (snap.exists()) {
const d = snap.data();
ME.name = d.name || '–ù–µ–≤—ñ–¥–æ–º–∏–π';
ME.role = d.role || 'fighter';
}
const all = await getDocs(collection(db, 'users'));
allUsers = [];
all.forEach(s => {
const d = s.data();
allUsers.push({uid: s.id, name: d.name || '---', role: d.role || 'fighter'});
});
loadTestsFromFirebase();
} catch (e) { console.log('Firebase err:', e); }

document.getElementById('headerName').textContent = ME.name;
const rb = document.getElementById('headerRole');
if (ME.role === 'admin') { rb.textContent = '–ê–î–ú–Ü–ù'; rb.className = 'role-badge role-admin'; }
else if (ME.role === 'instructor') { rb.textContent = '–Ü–ù–°–¢–†–£–ö–¢–û–†'; rb.className = 'role-badge role-instructor'; }
else { rb.textContent = '–ë–Ü–Ñ–¶–¨'; rb.className = 'role-badge role-fighter'; }
buildNav();
showView('home');
});
}

function loadTestsFromFirebase() {
const q2 = query(collection(db, 'tests'), orderBy('createdAt', 'desc'));
onSnapshot(q2, snapshot => {
tests = [];
snapshot.forEach(docSnap => { tests.push({id: docSnap.id, ...docSnap.data()}); });
const activeView = document.querySelector('.view.active');
if (activeView) {
if (activeView.id === 'viewHome') renderHome();
if (activeView.id === 'viewManage') renderManage();
if (activeView.id === 'viewHistory') renderHistory();
}
});
}

function buildNav() {
const tabs = document.getElementById('navTabs');
let html = '<button class="nav-btn active" onclick="showView(\'home\')">üè† –ì–æ–ª–æ–≤–Ω–∞</button>';
if (isAdmin()) {
html += '<button class="nav-btn" onclick="editingTestId=null;showView(\'create\')">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏</button>';
html += '<button class="nav-btn" onclick="showView(\'manage\')">‚öôÔ∏è –ö–µ—Ä—É–≤–∞—Ç–∏</button>';
html += '<button class="nav-btn" onclick="showView(\'history\')">üìä –°–ø–∏—Å–∫–∏</button>';
html += '<button class="nav-btn" onclick="showView(\'settings\')">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>';
html += '<button class="nav-btn" onclick="showView(\'adminList\')">üëë –ê–¥–º—ñ–Ω–∏</button>';
}
if (isReviewer()) {
html += '<button class="nav-btn" onclick="showView(\'review\')">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞</button>';
}
tabs.innerHTML = html;
}

window.showView = v => {
document.querySelectorAll('.view').forEach(el => el.classList.remove('active'));
const viewId = 'view' + v.charAt(0).toUpperCase() + v.slice(1);
const el = document.getElementById(viewId);
if (el) el.classList.add('active');
document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
const btns = document.querySelectorAll('.nav-btn');
const map = {home:0, create:1, manage:2, history:3, settings:4, adminList:5, review: isAdmin()?6:1};
if (btns[map[v]]) btns[map[v]].classList.add('active');
if (v === 'home') renderHome();
if (v === 'create' && !editingTestId) renderCreateForm();
if (v === 'review') renderReview();
if (v === 'manage') renderManage();
if (v === 'settings') renderSettings();
if (v === 'adminList') renderAdminList();
if (v === 'history') renderHistory();
};

// –ë–ª–æ–∫—É–≤–∞–Ω–Ω—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞
document.onkeydown = e => {
if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && [73,74,67].includes(e.keyCode)) || (e.ctrlKey && e.keyCode === 85)) return false;
};
</script>
<script type="module">
// –¶–ï –ü–†–û–î–û–í–ñ–ï–ù–ù–Ø –ü–û–ü–ï–†–ï–î–ù–¨–û–ì–û SCRIPT –ë–õ–û–ö–£!
// –ù–ï —Å—Ç–≤–æ—Ä—é–π –Ω–æ–≤–∏–π <script>, –∞ –¥–æ–¥–∞–π —Ü–µ–π –∫–æ–¥ –í–°–ï–†–ï–î–ò–ù–£ —Ç–æ–≥–æ –∂ –±–ª–æ–∫—É –ø–µ—Ä–µ–¥ </script>

// === –ö–û–ù–¢–ï–ö–°–¢–ù–ï –ú–ï–ù–Æ ===
window.showContextMenu = (event, testId) => {
if (!isAdmin()) return;
event.preventDefault();
event.stopPropagation();
contextMenuTestId = testId;
const menu = document.getElementById('contextMenu');
menu.style.left = event.pageX + 'px';
menu.style.top = event.pageY + 'px';
menu.classList.add('active');
};
window.contextEdit = () => { hideContextMenu(); if (contextMenuTestId) editTest(contextMenuTestId); };
window.contextClear = async () => { hideContextMenu(); if (contextMenuTestId) await clearTestResults(contextMenuTestId); };
window.contextDelete = async () => { hideContextMenu(); if (contextMenuTestId) await deleteTest(contextMenuTestId); };
window.contextCopyLink = () => {
hideContextMenu();
if (contextMenuTestId) {
const url = window.location.origin + window.location.pathname + '?public=' + contextMenuTestId;
navigator.clipboard.writeText(url).then(() => {
const notif = document.getElementById('linkCopiedNotif');
notif.classList.add('show');
setTimeout(() => notif.classList.remove('show'), 3000);
});
}
};
function hideContextMenu() { document.getElementById('contextMenu').classList.remove('active'); }

document.addEventListener('click', e => {
if (!e.target.closest('.context-menu')) hideContextMenu();
if (!e.target.closest('.people-dropdown')) document.querySelectorAll('.people-list').forEach(d => d.classList.remove('show'));
});
document.addEventListener('contextmenu', e => {
if (e.target.closest('.test-card') && isAdmin()) e.preventDefault();
});

// === LIGHTBOX ===
window.openLightbox = url => {
document.getElementById('lightboxImg').src = url;
document.getElementById('lightbox').classList.add('active');
document.body.style.overflow = 'hidden';
};
window.closeLightbox = () => {
document.getElementById('lightbox').classList.remove('active');
document.body.style.overflow = 'auto';
};

// === RENDER QUESTION (–ü–†–û–•–û–î–ñ–ï–ù–ù–Ø –¢–ï–°–¢–£) ===
function renderQuestion() {
if (!currentTest || currentQ >= currentTest.questions.length) {
finishQuiz();
return;
}

const q = currentTest.questions[currentQ];
const total = currentTest.questions.length;
const progress = ((currentQ) / total) * 100;

timeLeft = q.timeLimit || 30;
if (timer) clearInterval(timer);

let photoHtml = '';
if (q.photo) {
photoHtml = `<div class="quiz-question-photo">
<img src="${q.photo}" alt="–§–æ—Ç–æ –ø–∏—Ç–∞–Ω–Ω—è" onclick="openLightbox('${q.photo}')">
</div>`;
}

let answersHtml = '';

if (q.answerType === 'table' && q.tableData) {
const cols = q.tableData.columns || [];
const rows = q.tableData.rows || [];
answersHtml = `<div class="answer-table-wrapper">
<table class="answer-table">
<thead><tr><th></th>${cols.map(c => `<th>${c}</th>`).join('')}</tr></thead>
<tbody>
${rows.map((row, ri) => `<tr>
<td><div class="table-radio${answers[currentQ]?.tableRow === ri ? ' checked' : ''}" onclick="selectTableAnswer(${ri})"></div></td>
${row.map(cell => `<td>${cell}</td>`).join('')}
</tr>`).join('')}
</tbody>
</table>
</div>`;
} else {
const opts = q.options || [];
if (opts.length > 0) {
answersHtml = `<div class="quiz-answers">
${opts.map((o, oi) => `<div class="answer-btn${answers[currentQ]?.optionIndex === oi ? ' selected' : ''}" onclick="selectAnswer(${oi})">
<span class="answer-letter">${letters[oi] || (oi+1)}</span>
<span>${o.text}</span>
</div>`).join('')}
</div>`;
}
}

let freeHtml = '';
if (q.allowFree) {
const isFreeMode = answers[currentQ]?.isFree || false;
const freeText = answers[currentQ]?.freeText || '';
freeHtml = `<div class="free-answer-area">
<div class="free-answer-toggle ${isFreeMode ? 'active' : ''}" onclick="toggleFreeAnswer()">
‚úçÔ∏è –í—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º (–≤—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å)
</div>
${isFreeMode ? `<textarea class="free-input" id="freeAnswerInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å –≤–∞—à—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." oninput="saveFreeText()">${freeText}</textarea>` : ''}
</div>`;
}

document.getElementById('quizContainer').innerHTML = `
<div class="quiz-progress-bar">
<div class="quiz-progress-fill" style="width:${progress}%"></div>
</div>
<div class="quiz-header">
<div>
<span style="font-size:12px;color:var(--text-gray);font-weight:700">–ü–ò–¢–ê–ù–ù–Ø ${currentQ + 1} / ${total}</span>
</div>
<div class="quiz-timer" id="quizTimer">${timeLeft}</div>
</div>
<div class="quiz-question">
<h3>${q.text}</h3>
${photoHtml}
</div>
${answersHtml}
${freeHtml}
<div class="btn-group">
${currentQ > 0 ? '<button class="btn btn-secondary" onclick="prevQuestion()">‚Üê –ù–∞–∑–∞–¥</button>' : ''}
<button class="btn btn-primary" onclick="nextQuestion()">${currentQ === total - 1 ? 'üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç–∏' : '–î–∞–ª—ñ ‚Üí'}</button>
</div>
`;

startTimer();
}

// === –¢–ê–ô–ú–ï–† ===
function startTimer() {
const timerEl = document.getElementById('quizTimer');
if (!timerEl) return;

timer = setInterval(() => {
timeLeft--;
if (timerEl) {
timerEl.textContent = timeLeft;
if (timeLeft <= 10) timerEl.classList.add('danger');
else timerEl.classList.remove('danger');
}
if (timeLeft <= 0) {
clearInterval(timer);
nextQuestion();
}
}, 1000);
}

// === –í–ò–ë–Ü–† –í–Ü–î–ü–û–í–Ü–î–Ü ===
window.selectAnswer = (oi) => {
if (!answers[currentQ]) answers[currentQ] = {};
answers[currentQ].optionIndex = oi;
answers[currentQ].isFree = false;
renderQuestion();
};

window.selectTableAnswer = (ri) => {
if (!answers[currentQ]) answers[currentQ] = {};
answers[currentQ].tableRow = ri;
answers[currentQ].isFree = false;
// –û–Ω–æ–≤–ª—é—î–º–æ —Ä–∞–¥—ñ–æ –±–µ–∑ –ø–æ–≤–Ω–æ–≥–æ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—É
document.querySelectorAll('.table-radio').forEach((el, i) => {
el.classList.toggle('checked', i === ri);
});
};

window.toggleFreeAnswer = () => {
if (!answers[currentQ]) answers[currentQ] = {};
answers[currentQ].isFree = !answers[currentQ].isFree;
if (answers[currentQ].isFree) {
answers[currentQ].optionIndex = undefined;
answers[currentQ].tableRow = undefined;
}
renderQuestion();
};

window.saveFreeText = () => {
const inp = document.getElementById('freeAnswerInput');
if (inp && answers[currentQ]) {
answers[currentQ].freeText = inp.value;
}
};

// === –ù–ê–í–Ü–ì–ê–¶–Ü–Ø –ú–Ü–ñ –ü–ò–¢–ê–ù–ù–Ø–ú–ò ===
window.nextQuestion = () => {
if (timer) clearInterval(timer);
currentQ++;
if (currentQ >= currentTest.questions.length) {
finishQuiz();
} else {
renderQuestion();
}
};

window.prevQuestion = () => {
if (timer) clearInterval(timer);
if (currentQ > 0) {
currentQ--;
renderQuestion();
}
};

// === –ó–ê–í–ï–†–®–ï–ù–ù–Ø –¢–ï–°–¢–£ ===
function finishQuiz() {
if (timer) clearInterval(timer);

const t = currentTest;
const pps = t.maxScore / t.questions.length;
let score = 0;
let correctCount = 0;
let details = [];
let hasPending = false;

t.questions.forEach((q, qi) => {
const ans = answers[qi] || {};
let userAnswer = '';
let correctAnswer = '';
let status = 'wrong';
let points = 0;

if (ans.isFree && ans.freeText) {
userAnswer = ans.freeText;
correctAnswer = q.options?.find(o => o.correct)?.text || '–í—ñ–ª—å–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è';
status = 'pending';
points = 0;
hasPending = true;
} else if (q.answerType === 'table' && q.tableData) {
const selectedRow = ans.tableRow;
correctAnswer = '–†—è–¥–æ–∫ ' + (q.tableData.correctRowIndex + 1);
if (selectedRow !== undefined) {
userAnswer = '–†—è–¥–æ–∫ ' + (selectedRow + 1);
if (selectedRow === q.tableData.correctRowIndex) {
status = 'correct';
points = pps;
correctCount++;
}
} else {
userAnswer = '–ù–µ –≤—ñ–¥–ø–æ–≤—ñ–≤';
}
} else {
const correctOpt = q.options?.find(o => o.correct);
correctAnswer = correctOpt ? correctOpt.text : '‚Äî';
if (ans.optionIndex !== undefined && q.options[ans.optionIndex]) {
userAnswer = q.options[ans.optionIndex].text;
if (q.options[ans.optionIndex].correct) {
status = 'correct';
points = pps;
correctCount++;
}
} else {
userAnswer = '–ù–µ –≤—ñ–¥–ø–æ–≤—ñ–≤';
}
}

score += points;

details.push({
qText: q.text,
userAnswer,
correctAnswer,
status,
points: Math.round(points * 100) / 100
});
});

score = Math.round(score * 100) / 100;
const passed = score >= t.passScore;

const result = {
id: genId(),
testId: t.id,
testName: t.name,
userId: ME.uid,
userName: ME.name,
userRole: isPublicMode ? (publicUserInfo?.unit || '–ü—É–±–ª—ñ—á–Ω–∏–π') : ME.role,
score,
maxScore: t.maxScore,
passScore: t.passScore,
status: hasPending ? 'pending' : 'auto',
reviewedByHuman: false,
reviewer: null,
date: now(),
details,
isPublic: isPublicMode,
publicInfo: publicUserInfo || null
};

results.push(result);
save();

// Discord —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è
sendDiscordNotification('QUIZ_COMPLETED', {
testName: t.name,
userName: ME.name,
userRole: result.userRole,
score,
maxScore: t.maxScore,
passScore: t.passScore,
correctAnswers: correctCount,
totalQuestions: t.questions.length,
status: hasPending ? 'pending' : 'auto',
passed,
date: now()
});

showResult(result);
}

// === –ü–û–ö–ê–ó –†–ï–ó–£–õ–¨–¢–ê–¢–£ ===
function showResult(r) {
const passed = r.score >= r.passScore;
const hasPending = r.details.some(d => d.status === 'pending');

let statusText, statusClass;
if (hasPending) {
statusText = '‚è≥ –ù–ê –ü–ï–†–ï–í–Ü–†–¶–Ü';
statusClass = '';
} else if (passed) {
statusText = '‚úÖ –°–ö–õ–ê–î–ï–ù–û';
statusClass = 'pass';
} else {
statusText = '‚ùå –ù–ï –°–ö–õ–ê–î–ï–ù–û';
statusClass = 'fail';
}

const percentage = r.maxScore > 0 ? Math.round((r.score / r.maxScore) * 100) : 0;

let detailsHtml = r.details.map((d, i) => {
let markClass = d.status === 'correct' ? 'ok' : d.status === 'pending' ? 'pend' : 'no';
let markIcon = d.status === 'correct' ? '‚úì' : d.status === 'pending' ? '?' : '‚úï';
return `<div class="result-detail">
<div class="mark ${markClass}">${markIcon}</div>
<div>
<div style="font-weight:700;font-size:13px;margin-bottom:4px">${i+1}. ${d.qText}</div>
<div style="font-size:12px;color:var(--text-light)">–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.userAnswer}</b></div>
${d.status !== 'pending' ? `<div style="font-size:11px;color:var(--primary);margin-top:3px">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.correctAnswer}</div>` : ''}
<div style="font-size:11px;font-weight:800;margin-top:3px;color:${d.status === 'correct' ? 'var(--primary)' : d.status === 'pending' ? 'var(--warning)' : 'var(--danger)'}">
${d.status === 'correct' ? '+' + d.points.toFixed(1) + ' –±.' : d.status === 'pending' ? '–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏' : '0 –±.'}
</div>
</div>
</div>`;
}).join('');

document.getElementById('resultScreen').innerHTML = `
<div style="text-align:center;margin-bottom:30px">
<div class="result-circle ${passed && !hasPending ? 'pass' : hasPending ? '' : 'fail'}" style="${hasPending ? 'border-color:var(--warning);box-shadow:0 0 40px var(--warning-glow)' : ''}">
<div class="result-score" style="color:${hasPending ? 'var(--warning)' : passed ? 'var(--primary)' : 'var(--danger)'}">${r.score}</div>
<div class="result-max">–∑ ${r.maxScore}</div>
</div>
<div class="result-status ${statusClass}" style="${hasPending ? 'color:var(--warning);text-shadow:0 0 20px var(--warning-glow)' : ''}">${statusText}</div>
<div style="font-size:14px;color:var(--text-gray);margin-bottom:5px">${r.testName}</div>
<div style="font-size:13px;color:var(--text-gray)">${percentage}% –ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö ‚Ä¢ –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π: ${r.passScore} –±.</div>
${hasPending ? '<div style="margin-top:15px;padding:12px;background:rgba(251,191,36,0.1);border:1px solid rgba(251,191,36,0.3);border-radius:12px;font-size:12px;color:var(--warning)">‚ö†Ô∏è –î–µ—è–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—é–¥–∏–Ω–æ—é. –§—ñ–Ω–∞–ª—å–Ω–∏–π –±–∞–ª –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏—Å—è.</div>' : ''}
</div>

<div class="section-title">üìã –î–µ—Ç–∞–ª—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</div>
${detailsHtml}

<div class="btn-group">
${isPublicMode ? '<button class="btn btn-primary" onclick="window.location.reload()">üîÑ –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</button>' : '<button class="btn btn-primary" onclick="showView(\'home\')">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>'}
</div>
`;

document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
document.getElementById('viewResult').classList.add('active');
}
</script>
  <script type="module">
// –¶–ï –ü–†–û–î–û–í–ñ–ï–ù–ù–Ø! –î–æ–¥–∞–π –≤ –¢–û–ô –ñ–ï script –±–ª–æ–∫!

// === DISCORD NOTIFICATIONS ===
async function sendDiscordNotification(type, data) {
if (!webhookUrl) return;
let embed = {};
const timestamp = new Date().toISOString();
switch(type) {
case 'NEW_TEST':
embed = { title: 'üìù –ù–æ–≤–∏–π —ñ—Å–ø–∏—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!', color: 0x00ff44, fields: [
{name: 'üìã –ù–∞–∑–≤–∞', value: data.testName, inline: false},
{name: 'üë§ –°—Ç–≤–æ—Ä–∏–≤', value: data.createdBy, inline: true},
{name: '‚ùì –ü–∏—Ç–∞–Ω—å', value: data.questionCount.toString(), inline: true},
{name: 'üéØ –ú–∞–∫—Å. –±–∞–ª', value: data.maxScore.toString(), inline: true},
{name: '‚úÖ –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π', value: data.passScore.toString(), inline: true},
{name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'TEST_UPDATED':
embed = { title: '‚úèÔ∏è –Ü—Å–ø–∏—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ!', color: 0xfbbf24, fields: [
{name: 'üìã –ù–∞–∑–≤–∞', value: data.testName, inline: false},
{name: 'üë§ –†–µ–¥–∞–≥—É–≤–∞–≤', value: data.editedBy, inline: true},
{name: '‚ùì –ü–∏—Ç–∞–Ω—å', value: data.questionCount.toString(), inline: true},
{name: 'üéØ –ë–∞–ª–∏', value: `${data.passScore}/${data.maxScore}`, inline: true},
{name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'TEST_DELETED':
embed = { title: 'üóë –Ü—Å–ø–∏—Ç –≤–∏–¥–∞–ª–µ–Ω–æ!', color: 0xef4444, fields: [
{name: 'üìã –ù–∞–∑–≤–∞', value: data.testName, inline: true},
{name: 'üë§ –í–∏–¥–∞–ª–∏–≤', value: data.deletedBy, inline: true},
{name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'QUIZ_COMPLETED':
const se = data.status === 'pending' ? '‚è≥' : data.passed ? '‚úÖ' : '‚ùå';
const st = data.status === 'pending' ? '–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ' : data.passed ? '–°–ö–õ–ê–î–ï–ù–û' : '–ù–ï –°–ö–õ–ê–î–ï–ù–û';
const sc = data.status === 'pending' ? 0xfbbf24 : data.passed ? 0x10b981 : 0xef4444;
embed = { title: `${se} –Ü—Å–ø–∏—Ç: ${data.testName}`, color: sc,
description: `**${data.userName}** –∑–∞–≤–µ—Ä—à–∏–≤ —ñ—Å–ø–∏—Ç`, fields: [
{name: 'üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á', value: data.userName, inline: true},
{name: 'üéñ –†–æ–ª—å', value: data.userRole, inline: true},
{name: 'üìä –†–µ–∑—É–ª—å—Ç–∞—Ç', value: `**${data.score}** / ${data.maxScore}`, inline: true},
{name: 'üéØ –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π', value: data.passScore.toString(), inline: true},
{name: 'üìà %', value: `${Math.round((data.score/data.maxScore)*100)}%`, inline: true},
{name: '‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∏—Ö', value: `${data.correctAnswers}/${data.totalQuestions}`, inline: true},
{name: 'üîç –°—Ç–∞—Ç—É—Å', value: st, inline: true},
{name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'RESULT_APPROVED':
embed = { title: '‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ö–≤–∞–ª–µ–Ω–æ!', color: 0x00ff44, fields: [
{name: 'üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á', value: data.userName, inline: true},
{name: 'üìã –Ü—Å–ø–∏—Ç', value: data.testName, inline: true},
{name: 'üìä –ë–∞–ª', value: `**${data.finalScore}**/${data.maxScore}`, inline: true},
{name: 'üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤', value: data.reviewer, inline: true},
{name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'RESULT_REJECTED':
embed = { title: '‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ!', color: 0xef4444, fields: [
{name: 'üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á', value: data.userName, inline: true},
{name: 'üìã –Ü—Å–ø–∏—Ç', value: data.testName, inline: true},
{name: 'üìä –ë–∞–ª', value: `${data.score}/${data.maxScore}`, inline: true},
{name: 'üîç –ü–µ—Ä–µ–≤—ñ—Ä–∏–≤', value: data.reviewer, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'RESULTS_CLEARED':
embed = { title: 'üßπ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ—á–∏—â–µ–Ω–æ!', color: 0xfbbf24, fields: [
{name: 'üìã –Ü—Å–ø–∏—Ç', value: data.testName, inline: true},
{name: 'üë§ –û—á–∏—Å—Ç–∏–≤', value: data.clearedBy, inline: true},
{name: 'üóë –í–∏–¥–∞–ª–µ–Ω–æ', value: data.count.toString(), inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'REVIEWER_ADDED':
embed = { title: 'üîç –ù–æ–≤–∏–π –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π!', color: 0x3b82f6, fields: [
{name: 'üë§', value: data.reviewerName, inline: true},
{name: '‚ûï –î–æ–¥–∞–≤', value: data.addedBy, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
case 'ADMIN_ADDED':
embed = { title: 'üëë –ù–æ–≤–∏–π –∞–¥–º—ñ–Ω!', color: 0x00ff44, fields: [
{name: 'üë§', value: data.adminName, inline: true},
{name: '‚ûï –î–æ–¥–∞–≤', value: data.addedBy, inline: true}
], footer: {text: '–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2'}, timestamp }; break;
}
try { await fetch(webhookUrl, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({embeds:[embed]}) }); } catch(e) { console.log('Webhook err:', e); }
}

// === FIREBASE SAVE/DELETE ===
async function saveTestToFirebase(testObj) {
try {
if (editingTestId) {
await updateDoc(doc(db, 'tests', editingTestId), testObj);
await sendDiscordNotification('TEST_UPDATED', { testName: testObj.name, editedBy: ME.name, questionCount: testObj.questions.length, maxScore: testObj.maxScore, passScore: testObj.passScore, date: now() });
} else {
await addDoc(collection(db, 'tests'), { ...testObj, createdAt: serverTimestamp() });
await sendDiscordNotification('NEW_TEST', { testName: testObj.name, createdBy: testObj.createdBy, questionCount: testObj.questions.length, maxScore: testObj.maxScore, passScore: testObj.passScore, totalTime: 0, date: now() });
}
return true;
} catch(e) { console.error('Save err:', e); alert('‚ùå –ü–æ–º–∏–ª–∫–∞: ' + e.message); return false; }
}

async function deleteTestFromFirebase(id) {
try {
const t = tests.find(x => x.id === id);
await deleteDoc(doc(db, 'tests', id));
results = results.filter(r => r.testId !== id); save();
await sendDiscordNotification('TEST_DELETED', { testName: t?.name||'?', deletedBy: ME.name, date: now() });
return true;
} catch(e) { alert('–ü–æ–º–∏–ª–∫–∞: ' + e.message); return false; }
}

// === RENDER HOME ===
function renderHome() {
const myRes = results.filter(r => r.userId === ME.uid);
const passed = myRes.filter(r => { const t = tests.find(x=>x.id===r.testId); return r.status==='approved'||(r.status==='auto'&&t&&r.score>=t.passScore&&r.reviewedByHuman); }).length;
const failed = myRes.filter(r => { const t = tests.find(x=>x.id===r.testId); return r.status==='rejected'||(r.status==='auto'&&t&&r.score<t.passScore&&r.reviewedByHuman); }).length;
const pending = myRes.filter(r => r.status==='pending'||(r.status==='auto'&&!r.reviewedByHuman)).length;

document.getElementById('statsRow').innerHTML = `
<div class="stat-card"><div class="stat-num">${tests.length}</div><div class="stat-label">–Ü—Å–ø–∏—Ç—ñ–≤</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--success)">${passed}</div><div class="stat-label">–°–∫–ª–∞–¥–µ–Ω–æ</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--danger)">${failed}</div><div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div></div>
<div class="stat-card"><div class="stat-num" style="color:var(--warning)">${pending}</div><div class="stat-label">–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</div></div>`;

if (tests.length === 0) {
document.getElementById('testsGrid').innerHTML = '<div style="color:var(--text-gray);text-align:center;padding:40px;font-size:14px;width:100%">–Ü—Å–ø–∏—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</div>';
} else {
document.getElementById('testsGrid').innerHTML = tests.map(t => {
let totalTime = 0; t.questions.forEach(q => totalTime += (q.timeLimit||30));
const ctx = isAdmin() ? `oncontextmenu="showContextMenu(event,'${t.id}')"` : '';
return `<div class="test-card" onclick="startIntro('${t.id}')" ${ctx}>
<span class="emoji">${t.emoji||'üìù'}</span><h3>${t.name}</h3><p>${t.description||'–ë–µ–∑ –æ–ø–∏—Å—É'}</p>
<div class="test-meta">
<span class="meta-tag">‚ùì ${t.questions.length} –ø–∏—Ç–∞–Ω—å</span>
<span class="meta-tag">üéØ ${t.passScore}/${t.maxScore} –±.</span>
<span class="meta-tag">‚è± ${totalTime}—Å</span>
</div></div>`;
}).join('');
}

if (myRes.length === 0) {
document.getElementById('myResults').innerHTML = '<div style="color:var(--text-gray);text-align:center;padding:30px;font-size:13px">–í–∏ —â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —ñ—Å–ø–∏—Ç–∏</div>';
} else {
document.getElementById('myResults').innerHTML = `<div class="results-table"><table>
<thead><tr><th>–Ü—Å–ø–∏—Ç</th><th>–ë–∞–ª–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π</th><th>–î–∞—Ç–∞</th></tr></thead>
<tbody>${myRes.map(r => {
const t = tests.find(x=>x.id===r.testId); const ps = t?t.passScore:0; let st,stc;
if (r.status==='pending') { st='–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ'; stc='st-pending'; }
else if (r.status==='approved') { st='–°—Ö–≤–∞–ª–µ–Ω–æ'; stc='st-approved'; }
else if (r.status==='rejected') { st='–í—ñ–¥—Ö–∏–ª–µ–Ω–æ'; stc='st-rejected'; }
else { const p=r.score>=ps&&r.reviewedByHuman; st=p?'–°–∫–ª–∞–¥–µ–Ω–æ':r.reviewedByHuman?'–ù–µ —Å–∫–ª–∞–¥–µ–Ω–æ':'–û—á—ñ–∫—É—î'; stc=p?'st-pass':r.reviewedByHuman?'st-fail':'st-pending'; }
return `<tr><td>${t?t.name:'–í–∏–¥–∞–ª–µ–Ω–∏–π'}</td><td><b>${r.score}</b>/${t?t.maxScore:'?'}</td><td><span class="status-badge ${stc}">${st}</span></td><td>${r.reviewer||'SYSTEM'}</td><td>${r.date}</td></tr>`;
}).join('')}</tbody></table></div>`;
}
}

// === START INTRO ===
window.startIntro = id => {
const t = tests.find(x => x.id === id); if (!t) return;
const hasPending = results.find(r => r.testId===id && r.userId===ME.uid && (r.status==='pending'||(r.status==='auto'&&!r.reviewedByHuman)));
if (hasPending) { alert('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ!'); return; }
currentTest = t; agreementAccepted = false;
let totalTime = 0; t.questions.forEach(q => totalTime += (q.timeLimit||30));
const pps = t.maxScore > 0 ? Math.round(t.maxScore/t.questions.length*10)/10 : 0;

let photosHtml = '';
if (t.photos?.length > 0) {
photosHtml = `<div style="margin:25px 0"><h4 style="font-size:14px;font-weight:800;margin-bottom:15px;color:var(--primary-bright)">üì∏ –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏</h4>
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px">
${t.photos.map(p=>`<img src="${p.url}" style="width:100%;height:100px;object-fit:cover;border-radius:12px;cursor:zoom-in;border:1px solid rgba(255,255,255,0.1)" onclick="openLightbox('${p.url}')">`).join('')}
</div></div>`;
}

let agreementHtml = '';
if (t.agreementText?.trim()) {
agreementHtml = `<div class="agreement-box"><label class="agreement-check">
<input type="checkbox" id="agreementCheckbox" onchange="toggleAgreement()">
<div class="agreement-text"><strong>üìú –£–≥–æ–¥–∞:</strong><br>${t.agreementText}</div>
</label></div>`;
} else { agreementAccepted = true; }

document.getElementById('introCard').innerHTML = `
<span class="emoji">${t.emoji||'üìù'}</span><h2>${t.name}</h2><p>${t.description||''}</p>
${photosHtml}
<div style="margin:25px 0;display:grid;grid-template-columns:1fr 1fr;gap:10px;text-align:center">
<div style="background:rgba(0,255,68,0.05);border:1px solid rgba(0,255,68,0.15);border-radius:12px;padding:15px">
<div style="font-size:22px;font-weight:900;color:var(--primary)">${t.questions.length}</div>
<div style="font-size:10px;color:var(--text-gray);margin-top:4px">–ü–ò–¢–ê–ù–¨</div></div>
<div style="background:rgba(251,191,36,0.05);border:1px solid rgba(251,191,36,0.15);border-radius:12px;padding:15px">
<div style="font-size:22px;font-weight:900;color:var(--warning)">${t.passScore}/${t.maxScore}</div>
<div style="font-size:10px;color:var(--text-gray);margin-top:4px">–ü–†–û–•–Ü–î–ù–ò–ô –ë–ê–õ</div></div>
<div style="background:rgba(59,130,246,0.05);border:1px solid rgba(59,130,246,0.15);border-radius:12px;padding:15px">
<div style="font-size:22px;font-weight:900;color:var(--info)">‚è± ${totalTime}—Å</div>
<div style="font-size:10px;color:var(--text-gray);margin-top:4px">–ß–ê–°</div></div>
<div style="background:rgba(16,185,129,0.05);border:1px solid rgba(16,185,129,0.15);border-radius:12px;padding:15px">
<div style="font-size:22px;font-weight:900;color:var(--success)">${pps}</div>
<div style="font-size:10px;color:var(--text-gray);margin-top:4px">–ë–ê–õ–Ü–í/–ü–ò–¢–ê–ù–ù–Ø</div></div>
</div>
${agreementHtml}
<div class="btn-group">
<button class="btn btn-primary" onclick="beginQuiz()" id="startQuizBtn" ${!agreementAccepted?'disabled':''}>üöÄ –†–û–ó–ü–û–ß–ê–¢–ò</button>
<button class="btn btn-secondary" onclick="showView('home')">‚Üê –ù–∞–∑–∞–¥</button>
</div>`;
showView('intro');
};

window.toggleAgreement = () => {
agreementAccepted = document.getElementById('agreementCheckbox').checked;
document.getElementById('startQuizBtn').disabled = !agreementAccepted;
};

window.beginQuiz = () => {
if (!agreementAccepted) { alert('‚ö†Ô∏è –ü—Ä–∏–π–º—ñ—Ç—å —É–≥–æ–¥—É!'); return; }
currentQ = 0; answers = {};
document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
document.getElementById('viewQuiz').classList.add('active');
renderQuestion();
};
</script>
<script type="module">
// –ü–†–û–î–û–í–ñ–ï–ù–ù–Ø —Ç–æ–≥–æ –∂ script –±–ª–æ–∫—É!

// === RENDER CREATE FORM ===
function renderCreateForm(testData) {
if (testData && testData.id) { editingTestId = testData.id; }
if (!testData) { editingTestId = null; }

document.getElementById('createTitle').innerHTML = editingTestId ? '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —ñ—Å–ø–∏—Ç' : '‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç';

const t = testData || { name:'', description:'', emoji:'üìù', maxScore:12, passScore:8, questions:[], photos:[], agreementText:'–Ø –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–∏–π –∑ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è —ñ—Å–ø–∏—Ç—É.' };
currentTestPhotos = t.photos || [];

const qs = t.questions.length > 0 ? t.questions : [{text:'', options:[{text:'',correct:false},{text:'',correct:false},{text:'',correct:false},{text:'',correct:false}], allowFree:false, timeLimit:30, answerType:'normal', photo:null}];

let photosHtml = currentTestPhotos.length > 0 ? `<div class="test-photo-grid">${currentTestPhotos.map((p,pi)=>`<div class="test-photo-item"><img src="${p.url}" alt="–§–æ—Ç–æ ${pi+1}"><button class="photo-delete-mini" onclick="deleteTestPhoto(${pi})">‚úï</button></div>`).join('')}</div>` : '';

let qBlocks = qs.map((q, qi) => {
let qPhotoHtml = q.photo
? `<div class="question-photo-section"><div class="question-photo-preview"><img src="${q.photo}"><button class="question-photo-delete" onclick="deleteQuestionPhoto(${qi})">‚úï</button></div></div>`
: `<div class="question-photo-section"><input type="file" id="qPhotoInput-${qi}" accept="image/*" style="display:none" onchange="handleQuestionPhoto(this,${qi})"><button class="add-question-photo-btn" onclick="document.getElementById('qPhotoInput-${qi}').click()">üì∑ –§–æ—Ç–æ</button></div>`;

let opts = '';
if (q.answerType === 'table') {
const cols = q.tableData?.columns||[]; const rows = q.tableData?.rows||[]; const cr = q.tableData?.correctRowIndex||0;
opts = `<div class="table-builder">
<div style="font-size:11px;font-weight:700;color:var(--primary);margin-bottom:8px">–°–¢–û–í–ü–¶–Ü</div>
<div class="table-builder-head" id="tableCols-${qi}">${cols.map((c,ci)=>`<input class="table-col-input" placeholder="–°—Ç–æ–≤–ø–µ—Ü—å ${ci+1}" value="${c}">`).join('')}</div>
<button class="add-opt-btn" onclick="addTableColumn(${qi})" style="margin-bottom:10px">+ –°—Ç–æ–≤–ø–µ—Ü—å</button>
<div style="font-size:11px;font-weight:700;color:var(--primary);margin-bottom:8px">–†–Ø–î–ö–ò</div>
<div class="table-builder-rows" id="tableRows-${qi}">${rows.map((row,ri)=>`<div class="table-row-builder">
<div class="opt-radio${ri===cr?' checked':''}" onclick="toggleTableCorrect(${qi},${ri})"></div>
${cols.map((c,ci)=>`<input class="table-cell-input" placeholder="${c}" value="${row[ci]||''}">`).join('')}
<button class="opt-del" onclick="delTableRow(${qi},${ri})">‚úï</button></div>`).join('')}</div>
<button class="add-opt-btn" onclick="addTableRow(${qi})">+ –†—è–¥–æ–∫</button></div>`;
} else {
opts = q.options.map((o,oi)=>`<div class="opt-row">
<div class="opt-radio${o.correct?' checked':''}" onclick="toggleCorrect(${qi},${oi})"></div>
<input class="opt-input" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç ${letters[oi]||oi+1}" value="${o.text.replace(/"/g,'&quot;')}">
<button class="opt-del" onclick="delOption(${qi},${oi})">‚úï</button></div>`).join('');
opts += `<button class="add-opt-btn" onclick="addOption(${qi})">+ –í–∞—Ä—ñ–∞–Ω—Ç</button>`;
}

return `<div class="q-block" id="qblock-${qi}">
<div class="q-block-head"><span class="q-num">–ü–∏—Ç–∞–Ω–Ω—è ${qi+1}</span><button class="q-del" onclick="delQuestion(${qi})">üóë</button></div>
<textarea class="form-input" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è..." id="qtext-${qi}" style="margin-bottom:12px;min-height:80px;resize:vertical">${q.text.replace(/"/g,'&quot;')}</textarea>
${qPhotoHtml}
<div style="margin-bottom:10px"><label class="form-label">–ß–∞—Å (—Å–µ–∫—É–Ω–¥)</label><input class="form-input" type="number" id="qtime-${qi}" value="${q.timeLimit||30}" min="5" max="600"></div>
<div class="table-toggle-create" onclick="toggleTableMode(${qi})"><div class="toggle-switch${q.answerType==='table'?' on':''}" id="tableSwitch-${qi}"></div> –¢–∞–±–ª–∏—Ü—è</div>
<div id="opts-${qi}" style="margin-top:12px">${opts}</div>
<div class="free-toggle-create" onclick="toggleFreeCreate(${qi})"><div class="toggle-switch${q.allowFree?' on':''}" id="freeSwitch-${qi}"></div> –í—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</div>
</div>`;
}).join('');

document.getElementById('createForm').innerHTML = `
<div class="form-card">
<div class="form-row-inline"><div class="form-row"><label class="form-label">–ù–∞–∑–≤–∞</label><input class="form-input" id="testName" value="${t.name.replace(/"/g,'&quot;')}" placeholder="–ù–∞–∑–≤–∞..."></div>
<div class="form-row"><label class="form-label">–ï–º–æ–¥–∑—ñ</label><input class="form-input" id="testEmoji" value="${t.emoji}" placeholder="üìù" style="text-align:center;font-size:24px"></div></div>
<div class="form-row"><label class="form-label">–û–ø–∏—Å</label><textarea class="form-input" id="testDesc" rows="2" placeholder="–û–ø–∏—Å...">${t.description||''}</textarea></div>
<div class="form-row-inline"><div class="form-row"><label class="form-label">–ú–∞–∫—Å. –±–∞–ª</label><input class="form-input" id="testMaxScore" type="number" value="${t.maxScore}" min="1"></div>
<div class="form-row"><label class="form-label">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π</label><input class="form-input" id="testPassScore" type="number" value="${t.passScore}" min="0"></div></div>
<div class="form-hint" id="scoreHint">üíé –ó–∞ –ø–∏—Ç–∞–Ω–Ω—è: ${qs.length>0?Math.round(t.maxScore/qs.length*100)/100:0} –±.</div>
</div>
<div class="form-card"><h4 style="font-size:13px;font-weight:800;color:var(--primary-bright);margin-bottom:12px">üì∏ –§–æ—Ç–æ</h4>${photosHtml}
<input type="file" id="testPhotoInput" accept="image/*" style="display:none" onchange="handleTestPhoto(this)">
<button class="upload-photo-btn" onclick="document.getElementById('testPhotoInput').click()">üì∑ –î–æ–¥–∞—Ç–∏ —Ñ–æ—Ç–æ</button></div>
<div class="form-card"><h4 style="font-size:13px;font-weight:800;color:var(--primary-bright);margin-bottom:12px">üìú –£–≥–æ–¥–∞</h4>
<textarea class="form-input" id="agreementText" rows="3" placeholder="–£–≥–æ–¥–∞...">${t.agreementText||''}</textarea></div>
<div class="section-title">üìã –ü–∏—Ç–∞–Ω–Ω—è</div>
<div id="questionsContainer">${qBlocks}</div>
<button class="btn btn-secondary" onclick="addQuestion()" style="width:100%;margin-bottom:20px">+ –î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
<div class="btn-group"><button class="btn btn-primary" onclick="saveTest()">üíæ ${editingTestId?'–ó–±–µ—Ä–µ–≥—Ç–∏':'–°—Ç–≤–æ—Ä–∏—Ç–∏'}</button>
<button class="btn btn-secondary" onclick="editingTestId=null;showView('home')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button></div>`;
}

function getFormQuestions() {
const blocks = document.querySelectorAll('.q-block'); let qs = [];
blocks.forEach((b, qi) => {
const text = document.getElementById('qtext-'+qi)?.value||'';
const timeLimit = parseInt(document.getElementById('qtime-'+qi)?.value)||30;
const tableMode = document.getElementById('tableSwitch-'+qi)?.classList.contains('on')||false;
let opts=[], tableData=null;
if (tableMode) {
const colInputs = document.querySelectorAll(`#tableCols-${qi} .table-col-input`);
const cols = Array.from(colInputs).map(i=>i.value);
const rowDivs = document.querySelectorAll(`#tableRows-${qi} .table-row-builder`);
const rows=[]; let cri=0;
rowDivs.forEach((div,ri)=>{ if(div.querySelector('.opt-radio').classList.contains('checked')) cri=ri; const cells=div.querySelectorAll('.table-cell-input'); rows.push(Array.from(cells).map(c=>c.value)); });
tableData = {columns:cols, rows, correctRowIndex:cri};
} else {
b.querySelectorAll('.opt-row').forEach(r=>{ opts.push({text:r.querySelector('.opt-input').value, correct:r.querySelector('.opt-radio').classList.contains('checked')}); });
}
let qPhoto = null; const ep = b.querySelector('.question-photo-preview img'); if(ep) qPhoto=ep.src;
qs.push({ text, options:opts, allowFree:document.getElementById('freeSwitch-'+qi)?.classList.contains('on')||false, timeLimit, answerType:tableMode?'table':'normal', tableData, photo:qPhoto });
});
return qs;
}

function rebuildQuestions(qs) {
renderCreateForm({ name:document.getElementById('testName').value, description:document.getElementById('testDesc').value, emoji:document.getElementById('testEmoji').value, maxScore:parseInt(document.getElementById('testMaxScore').value), passScore:parseInt(document.getElementById('testPassScore').value), photos:currentTestPhotos, agreementText:document.getElementById('agreementText').value, questions:qs });
}

window.toggleCorrect=(qi,oi)=>{const qs=getFormQuestions();qs[qi].options.forEach((o,i)=>o.correct=i===oi);rebuildQuestions(qs);};
window.delOption=(qi,oi)=>{const qs=getFormQuestions();qs[qi].options.splice(oi,1);rebuildQuestions(qs);};
window.addOption=qi=>{const qs=getFormQuestions();qs[qi].options.push({text:'',correct:false});rebuildQuestions(qs);};
window.delQuestion=qi=>{const qs=getFormQuestions();qs.splice(qi,1);rebuildQuestions(qs);};
window.addQuestion=()=>{const qs=getFormQuestions();qs.push({text:'',options:[{text:'',correct:false},{text:'',correct:false},{text:'',correct:false},{text:'',correct:false}],allowFree:false,timeLimit:30,answerType:'normal',photo:null});rebuildQuestions(qs);};
window.toggleFreeCreate=qi=>{const qs=getFormQuestions();qs[qi].allowFree=!qs[qi].allowFree;rebuildQuestions(qs);};
window.toggleTableMode=qi=>{const qs=getFormQuestions();if(qs[qi].answerType==='table'){qs[qi].answerType='normal';qs[qi].tableData=null;if(!qs[qi].options.length)qs[qi].options=[{text:'',correct:false},{text:'',correct:false},{text:'',correct:false},{text:'',correct:false}];}else{qs[qi].answerType='table';qs[qi].tableData={columns:['–ö–æ–¥','–û–ø–∏—Å'],rows:[['',''],['','']],correctRowIndex:0};qs[qi].options=[];}rebuildQuestions(qs);};
window.addTableColumn=qi=>{const qs=getFormQuestions();qs[qi].tableData.columns.push('');qs[qi].tableData.rows.forEach(r=>r.push(''));rebuildQuestions(qs);};
window.addTableRow=qi=>{const qs=getFormQuestions();qs[qi].tableData.rows.push(new Array(qs[qi].tableData.columns.length).fill(''));rebuildQuestions(qs);};
window.delTableRow=(qi,ri)=>{const qs=getFormQuestions();qs[qi].tableData.rows.splice(ri,1);if(qs[qi].tableData.correctRowIndex>=qs[qi].tableData.rows.length)qs[qi].tableData.correctRowIndex=Math.max(0,qs[qi].tableData.rows.length-1);rebuildQuestions(qs);};
window.toggleTableCorrect=(qi,ri)=>{const qs=getFormQuestions();qs[qi].tableData.correctRowIndex=ri;rebuildQuestions(qs);};

// Photo handlers
window.handleTestPhoto=input=>{if(input.files&&input.files[0]){const r=new FileReader();r.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');let w=img.width,h=img.height,m=800;if(w>h){if(w>m){h*=m/w;w=m;}}else{if(h>m){w*=m/h;h=m;}}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);currentTestPhotos.push({url:c.toDataURL('image/jpeg',0.7)});rebuildQuestions(getFormQuestions());};img.src=e.target.result;};r.readAsDataURL(input.files[0]);}};
window.deleteTestPhoto=pi=>{currentTestPhotos.splice(pi,1);rebuildQuestions(getFormQuestions());};
window.handleQuestionPhoto=(input,qi)=>{if(input.files&&input.files[0]){const r=new FileReader();r.onload=e=>{const img=new Image();img.onload=()=>{const c=document.createElement('canvas');let w=img.width,h=img.height,m=600;if(w>h){if(w>m){h*=m/w;w=m;}}else{if(h>m){w*=m/h;h=m;}}c.width=w;c.height=h;c.getContext('2d').drawImage(img,0,0,w,h);const qs=getFormQuestions();qs[qi].photo=c.toDataURL('image/jpeg',0.7);rebuildQuestions(qs);};img.src=e.target.result;};r.readAsDataURL(input.files[0]);}};
window.deleteQuestionPhoto=qi=>{const qs=getFormQuestions();qs[qi].photo=null;rebuildQuestions(qs);};

window.editTest = id => {
const t = tests.find(x => x.id === id);
if (t) { editingTestId = id; showView('create'); renderCreateForm(t); }
};

window.saveTest = async () => {
const name=document.getElementById('testName').value.trim();
if(!name){alert('‚ùå –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É!');return;}
const qs=getFormQuestions();
for(let i=0;i<qs.length;i++){
if(!qs[i].text.trim()){alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1} –ø–æ—Ä–æ–∂–Ω—î!`);return;}
if(qs[i].answerType==='table'){if(!qs[i].tableData||!qs[i].tableData.rows.length){alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –¥–æ–¥–∞–π—Ç–µ —Ä—è–¥–∫–∏!`);return;}}
else{if(!qs[i].options.some(o=>o.correct)&&!qs[i].allowFree){alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –æ–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥—å!`);return;}}
}
const testObj={name, description:document.getElementById('testDesc').value.trim(), emoji:document.getElementById('testEmoji').value.trim()||'üìù', maxScore:parseInt(document.getElementById('testMaxScore').value)||12, passScore:parseInt(document.getElementById('testPassScore').value)||8, questions:qs, photos:currentTestPhotos, agreementText:document.getElementById('agreementText').value.trim(), createdBy:ME.name};
if(await saveTestToFirebase(testObj)){alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!');editingTestId=null;currentTestPhotos=[];showView('home');}
};
</script>
<script type="module">
// –ü–†–û–î–û–í–ñ–ï–ù–ù–Ø —Ç–æ–≥–æ –∂ script –±–ª–æ–∫—É!

// === REVIEW ===
function renderReview() {
const pending = results.filter(r => r.status==='pending'||(r.status==='auto'&&!r.reviewedByHuman));
if (!pending.length) { document.getElementById('reviewList').innerHTML='<div style="color:var(--text-gray);text-align:center;padding:40px">–ù–µ–º–∞—î –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ ‚úì</div>'; return; }

document.getElementById('reviewList').innerHTML = pending.map(r => {
const t = tests.find(x=>x.id===r.testId);
const qHtml = r.details.map((d,i) => {
let cls = d.status==='correct'?'auto-ok':d.status==='pending'?'pending':'auto-fail';
let pts = d.status==='correct'?`<span class="q-points" style="color:var(--primary)">+${(d.points).toFixed(1)} –±.</span>`:d.status==='wrong'?`<span class="q-points" style="color:var(--danger)">0 –±.</span>`:`<span class="q-points" style="color:var(--warning)">? –±.</span>`;
let pc = '';
if (d.status==='pending') {
const maxPts = t ? Math.round(t.maxScore/t.questions.length*10)/10 : 1;
pc = `<div class="points-control">
<button class="points-btn minus" onclick="adjustPoints('${r.id}',${i},-0.5)">‚àí</button>
<span class="points-display" id="points-${r.id}-${i}">${d.points.toFixed(1)} –±.</span>
<button class="points-btn plus" onclick="adjustPoints('${r.id}',${i},0.5)">+</button>
<button class="btn btn-primary" style="padding:6px 12px;font-size:11px;margin-left:8px" onclick="setMaxPoints('${r.id}',${i},${maxPts})">MAX</button>
<button class="btn btn-secondary" style="padding:6px 12px;font-size:11px" onclick="setMaxPoints('${r.id}',${i},0)">0</button></div>`;
}
return `<div class="review-q ${cls}"><div class="q-title">${i+1}. ${d.qText}</div><div class="q-answer">–í—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.userAnswer}</b></div>
${d.status!=='pending'?`<div class="q-correct">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.correctAnswer}</div>`:''}<div>${pts}</div>${pc}</div>`;
}).join('');

const total = r.details.reduce((s,d)=>s+d.points,0).toFixed(1);
const hasF = r.details.some(d=>d.status==='pending');
const publicInfo = r.isPublic && r.publicInfo ? `<div style="font-size:11px;color:var(--info);margin-top:4px">üìã –ü—ñ–¥—Ä–æ–∑–¥—ñ–ª: ${r.publicInfo.unit}</div>` : '';

return `<div class="review-card">
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px">
<div><h3 style="font-size:16px;font-weight:800">${r.userName}</h3><div style="font-size:12px;color:var(--text-gray)">${r.testName||'–Ü—Å–ø–∏—Ç'} ‚Ä¢ ${r.date}</div>${publicInfo}</div>
<div style="font-size:18px;font-weight:900;color:var(--primary)" id="totalScore-${r.id}">${total} / ${r.maxScore} –±.</div></div>
${qHtml}
<div class="btn-group"><button class="btn btn-primary" onclick="approveResult('${r.id}')">‚úÖ –°—Ö–≤–∞–ª–∏—Ç–∏</button>
<button class="btn btn-danger" onclick="rejectResult('${r.id}')">‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button></div></div>`;
}).join('');
}

window.adjustPoints=(rid,qi,delta)=>{const r=results.find(x=>x.id===rid);if(!r)return;const d=r.details[qi];if(d.status!=='pending')return;const t=tests.find(x=>x.id===r.testId);const mp=t?Math.round(t.maxScore/t.questions.length*10)/10:10;d.points=Math.max(0,Math.min(mp,d.points+delta));d.points=Math.round(d.points*10)/10;const pe=document.getElementById(`points-${rid}-${qi}`);if(pe)pe.textContent=d.points.toFixed(1)+' –±.';const nt=r.details.reduce((s,dd)=>s+dd.points,0).toFixed(1);const te=document.getElementById(`totalScore-${rid}`);if(te)te.textContent=nt+' / '+r.maxScore+' –±.';save();};
window.setMaxPoints=(rid,qi,pts)=>{const r=results.find(x=>x.id===rid);if(!r)return;r.details[qi].points=pts;const pe=document.getElementById(`points-${rid}-${qi}`);if(pe)pe.textContent=pts.toFixed(1)+' –±.';const nt=r.details.reduce((s,d)=>s+d.points,0).toFixed(1);const te=document.getElementById(`totalScore-${rid}`);if(te)te.textContent=nt+' / '+r.maxScore+' –±.';save();};

window.approveResult=async id=>{const r=results.find(x=>x.id===id);if(!r)return;r.score=0;r.details.forEach(d=>{if(d.status==='pending')d.status='correct';r.score+=d.points;});r.score=Math.round(r.score*100)/100;r.status='approved';r.reviewer=ME.name;r.reviewedByHuman=true;save();
await sendDiscordNotification('RESULT_APPROVED',{userName:r.userName,testName:r.testName,finalScore:r.score,maxScore:r.maxScore,reviewer:ME.name,date:now()});renderReview();};

window.rejectResult=async id=>{const r=results.find(x=>x.id===id);if(!r)return;r.details.forEach(d=>{if(d.status==='pending'){d.status='wrong';d.points=0;}});r.score=r.details.reduce((s,d)=>s+d.points,0);r.score=Math.round(r.score*100)/100;r.status='rejected';r.reviewer=ME.name;r.reviewedByHuman=true;save();
await sendDiscordNotification('RESULT_REJECTED',{userName:r.userName,testName:r.testName,score:r.score,maxScore:r.maxScore,reviewer:ME.name,date:now()});renderReview();};

// === MANAGE ===
function renderManage() {
if(!tests.length){document.getElementById('manageList').innerHTML='<div style="color:var(--text-gray);text-align:center;padding:40px">–ù–µ–º–∞—î —ñ—Å–ø–∏—Ç—ñ–≤</div>';return;}
document.getElementById('manageList').innerHTML=tests.map(t=>{
const res=results.filter(r=>r.testId===t.id);const passed=res.filter(r=>(r.status==='approved'||r.status==='auto')&&r.score>=t.passScore&&r.reviewedByHuman).length;
return `<div class="manage-card"><div><b style="font-size:15px">${t.emoji} ${t.name}</b><br><span style="font-size:11px;color:var(--text-gray)">–ü–∏—Ç–∞–Ω—å: ${t.questions.length} ‚Ä¢ –ú–∞–∫—Å: ${t.maxScore}–± ‚Ä¢ –ü—Ä–æ—Ö—ñ–¥: ${t.passScore}–± ‚Ä¢ ${passed}/${res.length}</span></div>
<div style="display:flex;gap:8px;flex-wrap:wrap">
<button class="btn btn-info" onclick="editTest('${t.id}')" style="padding:8px 14px;font-size:11px">‚úèÔ∏è</button>
<button class="btn btn-warning" onclick="clearTestResults('${t.id}')" style="padding:8px 14px;font-size:11px">üßπ</button>
<button class="btn btn-danger" onclick="deleteTest('${t.id}')" style="padding:8px 14px;font-size:11px">üóë</button></div></div>`;
}).join('');
}

window.clearTestResults=async id=>{if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏?')){const t=tests.find(x=>x.id===id);const c=results.filter(r=>r.testId===id).length;results=results.filter(r=>r.testId!==id);save();await sendDiscordNotification('RESULTS_CLEARED',{testName:t?.name||'?',clearedBy:ME.name,count:c,date:now()});renderManage();}};
window.deleteTest=async id=>{if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏?')){if(await deleteTestFromFirebase(id))renderManage();}};

// === SETTINGS ===
function renderSettings() {
document.getElementById('settingsContent').innerHTML=`
<div class="setting-block"><h4>üîó Discord Webhook</h4><div class="form-row"><input class="form-input" id="webhookInput" value="${webhookUrl}" placeholder="https://discord.com/api/webhooks/..."></div>
<div class="btn-group" style="justify-content:flex-start"><button class="btn btn-primary" onclick="saveWebhook()" style="padding:10px 20px;font-size:12px">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
<button class="btn btn-info" onclick="sendTestWebhook()" style="padding:10px 20px;font-size:12px">üß™ –¢–µ—Å—Ç</button></div></div>
<div class="setting-block"><h4>üîç –ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ</h4><div id="reviewersList" style="margin-bottom:12px">
${reviewers.map(r=>`<span class="reviewer-chip">${r}<button onclick="removeReviewer('${r}')">‚úï</button></span>`).join('')||'<span style="color:var(--text-gray);font-size:12px">–ù–µ –¥–æ–¥–∞–Ω–æ</span>'}
</div><div class="people-dropdown"><input class="form-input" id="reviewerSearch" placeholder="–ü–æ—à—É–∫..." oninput="filterPeople('reviewer')" onfocus="filterPeople('reviewer')">
<div class="people-list" id="reviewerDropdown"></div></div></div>`;
}

window.saveWebhook=()=>{webhookUrl=document.getElementById('webhookInput').value.trim();save();alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!');};
window.sendTestWebhook=async()=>{const url=document.getElementById('webhookInput').value.trim();if(!url){alert('‚ùå –í–≤–µ–¥—ñ—Ç—å URL!');return;}try{const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[{title:'üß™ –¢–µ—Å—Ç',description:'Webhook –ø—Ä–∞—Ü—é—î! ‚úÖ',color:0x00ff44,footer:{text:'–î–®–í'},timestamp:new Date().toISOString()}]})});alert(r.ok?'‚úÖ –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!':'‚ùå –ü–æ–º–∏–ª–∫–∞: '+r.status);}catch(e){alert('‚ùå '+e.message);}};
window.removeReviewer=n=>{reviewers=reviewers.filter(r=>r!==n);save();renderSettings();};

window.filterPeople=type=>{const input=document.getElementById(type+'Search');const drop=document.getElementById(type+'Dropdown');const val=input.value.toLowerCase();const list=type==='reviewer'?allUsers.filter(u=>!reviewers.includes(u.name)):allUsers.filter(u=>!adminList.includes(u.name));const filtered=val?list.filter(u=>u.name.toLowerCase().includes(val)):list;
if(!filtered.length){drop.innerHTML='<div style="padding:15px;text-align:center;color:var(--text-gray);font-size:12px">–ù—ñ–∫–æ–≥–æ</div>';drop.classList.add('show');return;}
drop.innerHTML=filtered.map(u=>{const rl=u.role==='admin'?'–ê–¥–º—ñ–Ω':u.role==='instructor'?'–Ü–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä':'–ë—ñ—î—Ü—å';const rc=u.role==='admin'?'var(--primary)':u.role==='instructor'?'var(--warning)':'var(--text-gray)';return `<div class="people-item" onclick="selectPerson('${type}','${u.name}')"><span>${u.name}</span><span style="font-size:10px;color:${rc};font-weight:700">${rl}</span></div>`;}).join('');drop.classList.add('show');};

window.selectPerson=async(type,name)=>{if(type==='reviewer'&&!reviewers.includes(name)){reviewers.push(name);save();await sendDiscordNotification('REVIEWER_ADDED',{reviewerName:name,addedBy:ME.name,date:now()});renderSettings();}
if(type==='admin'&&!adminList.includes(name)){adminList.push(name);save();await sendDiscordNotification('ADMIN_ADDED',{adminName:name,addedBy:ME.name,date:now()});renderAdminList();buildNav();}
document.querySelectorAll('.people-list').forEach(d=>d.classList.remove('show'));};

// === HISTORY ===
function renderHistory() {
const all=[...results];const tp=all.length;const tpass=all.filter(r=>r.score>=r.passScore&&r.reviewedByHuman).length;const tf=all.filter(r=>(r.score<r.passScore&&r.reviewedByHuman)||r.status==='rejected').length;const tpend=all.filter(r=>r.status==='pending'||!r.reviewedByHuman).length;
const uTests=[...new Set(all.map(r=>r.testName))];

let rows=all.length?all.map(r=>{const ip=r.score>=r.passScore&&r.reviewedByHuman;const iff=(r.score<r.passScore&&r.reviewedByHuman)||r.status==='rejected';const ipd=r.status==='pending'||!r.reviewedByHuman;
let sb='';if(ipd)sb='<span class="status-badge st-pending">–û—á—ñ–∫—É—î</span>';else if(ip)sb='<span class="status-badge st-pass">–°–∫–ª–∞–¥–µ–Ω–æ</span>';else sb='<span class="status-badge st-fail">–ù–µ —Å–∫–ª–∞–¥–µ–Ω–æ</span>';
const pct=r.maxScore>0?Math.round(r.score/r.maxScore*100):0;
return `<tr><td>${r.userName}</td><td>${r.testName}</td><td><b>${r.score}</b>/${r.maxScore}</td><td>${pct}%</td><td>${sb}</td><td>${r.reviewer||'SYSTEM'}</td><td>${r.date}</td></tr>`;}).join(''):'<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--text-gray)">–ù–µ–º–∞—î</td></tr>';

document.getElementById('historyContent').innerHTML=`<div class="form-card">
<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:20px">
<div style="text-align:center;padding:15px;background:rgba(0,255,68,0.05);border-radius:12px;border:1px solid rgba(0,255,68,0.15)"><div style="font-size:24px;font-weight:900;color:var(--primary)">${tp}</div><div style="font-size:10px;color:var(--text-gray);margin-top:4px">–°–ü–†–û–ë</div></div>
<div style="text-align:center;padding:15px;background:rgba(16,185,129,0.05);border-radius:12px;border:1px solid rgba(16,185,129,0.15)"><div style="font-size:24px;font-weight:900;color:var(--success)">${tpass}</div><div style="font-size:10px;color:var(--text-gray);margin-top:4px">–°–ö–õ–ê–î.</div></div>
<div style="text-align:center;padding:15px;background:rgba(239,68,68,0.05);border-radius:12px;border:1px solid rgba(239,68,68,0.15)"><div style="font-size:24px;font-weight:900;color:var(--danger)">${tf}</div><div style="font-size:10px;color:var(--text-gray);margin-top:4px">–ü–†–û–í–ê–õ.</div></div>
<div style="text-align:center;padding:15px;background:rgba(251,191,36,0.05);border-radius:12px;border:1px solid rgba(251,191,36,0.15)"><div style="font-size:24px;font-weight:900;color:var(--warning)">${tpend}</div><div style="font-size:10px;color:var(--text-gray);margin-top:4px">–û–ß–Ü–ö–£–Ñ</div></div></div>
<div class="history-filters"><input class="filter-input" id="filterUserInput" placeholder="üîç –ü–æ—à—É–∫..." oninput="applyHistoryFilters()">
<select class="filter-select" id="filterTestSelect" onchange="applyHistoryFilters()"><option value="">–í—Å—ñ —ñ—Å–ø–∏—Ç–∏</option>${uTests.map(n=>`<option value="${n}">${n}</option>`).join('')}</select>
<select class="filter-select" id="filterStatusSelect" onchange="applyHistoryFilters()"><option value="all">–í—Å—ñ</option><option value="pass">–°–∫–ª–∞–¥–µ–Ω–æ</option><option value="fail">–ù–µ —Å–∫–ª–∞–¥.</option><option value="pending">–û—á—ñ–∫—É—î</option></select>
<button class="btn btn-secondary" onclick="resetHistoryFilters()" style="padding:10px 20px;font-size:12px">üîÑ</button>
<button class="btn btn-primary" onclick="exportHistory()" style="padding:10px 20px;font-size:12px">üì• –ï–∫—Å–ø–æ—Ä—Ç</button></div>
<div class="history-table-wrapper"><table class="history-table"><thead><tr><th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th><th>–Ü—Å–ø–∏—Ç</th><th>–ë–∞–ª–∏</th><th>%</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π</th><th>–î–∞—Ç–∞</th></tr></thead><tbody id="historyTableBody">${rows}</tbody></table></div></div>`;
}

window.applyHistoryFilters=()=>{const ui=document.getElementById('filterUserInput').value.toLowerCase();const ts=document.getElementById('filterTestSelect').value;const ss=document.getElementById('filterStatusSelect').value;
let f=results.filter(r=>{if(ui&&!r.userName.toLowerCase().includes(ui))return false;if(ts&&r.testName!==ts)return false;if(ss!=='all'){const ip=r.score>=r.passScore&&r.reviewedByHuman;const iff=(r.score<r.passScore&&r.reviewedByHuman)||r.status==='rejected';const ipd=r.status==='pending'||!r.reviewedByHuman;if(ss==='pass'&&!ip)return false;if(ss==='fail'&&!iff)return false;if(ss==='pending'&&!ipd)return false;}return true;});
let rows=f.length?f.map(r=>{const ip=r.score>=r.passScore&&r.reviewedByHuman;const iff=(r.score<r.passScore&&r.reviewedByHuman)||r.status==='rejected';const ipd=r.status==='pending'||!r.reviewedByHuman;let sb='';if(ipd)sb='<span class="status-badge st-pending">–û—á—ñ–∫—É—î</span>';else if(ip)sb='<span class="status-badge st-pass">–°–∫–ª–∞–¥–µ–Ω–æ</span>';else sb='<span class="status-badge st-fail">–ù–µ —Å–∫–ª–∞–¥.</span>';const pct=r.maxScore>0?Math.round(r.score/r.maxScore*100):0;return `<tr><td>${r.userName}</td><td>${r.testName}</td><td><b>${r.score}</b>/${r.maxScore}</td><td>${pct}%</td><td>${sb}</td><td>${r.reviewer||'SYSTEM'}</td><td>${r.date}</td></tr>`;}).join(''):'<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--text-gray)">–ù–µ–º–∞—î</td></tr>';
document.getElementById('historyTableBody').innerHTML=rows;};
window.resetHistoryFilters=()=>{document.getElementById('filterUserInput').value='';document.getElementById('filterTestSelect').value='';document.getElementById('filterStatusSelect').value='all';applyHistoryFilters();};
window.exportHistory=()=>{let t='–Ü–°–¢–û–†–Ü–Ø –Ü–°–ü–ò–¢–Ü–í –î–®–í\n'+'='.repeat(80)+'\n\n';results.forEach(r=>{const s=r.status==='pending'||!r.reviewedByHuman?'–û—á—ñ–∫—É—î':r.score>=r.passScore&&r.reviewedByHuman?'–°–ö–õ–ê–î–ï–ù–û':'–ù–ï –°–ö–õ–ê–î–ï–ù–û';t+=`${r.userName} | ${r.testName} | ${r.score}/${r.maxScore} | ${s} | ${r.reviewer||'SYSTEM'} | ${r.date}\n`;});const b=new Blob([t],{type:'text/plain'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download=`history_${Date.now()}.txt`;a.click();URL.revokeObjectURL(u);};

// === ADMIN LIST ===
function renderAdminList() {
document.getElementById('adminListContent').innerHTML=`<div class="admin-list-panel">
<h4 style="font-size:13px;font-weight:800;color:var(--primary-bright);margin-bottom:15px">üëë –ê–¥–º—ñ–Ω–∏ —ñ—Å–ø–∏—Ç—ñ–≤</h4>
<div id="adminChips" style="margin-bottom:15px">${adminList.map(n=>`<span class="reviewer-chip" style="background:rgba(251,191,36,0.1);border-color:rgba(251,191,36,0.3);color:var(--warning)">${n}<button onclick="removeAdmin('${n}')">‚úï</button></span>`).join('')||'<span style="color:var(--text-gray);font-size:12px">–ù–µ –¥–æ–¥–∞–Ω–æ</span>'}</div>
<div class="people-dropdown"><input class="form-input" id="adminSearch" placeholder="–ü–æ—à—É–∫..." oninput="filterPeople('admin')" onfocus="filterPeople('admin')"><div class="people-list" id="adminDropdown"></div></div></div>`;
}
window.removeAdmin=n=>{adminList=adminList.filter(a=>a!==n);save();renderAdminList();buildNav();};

console.log('üöÄ –î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† v2.1 ‚Äî –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ!');
</script>
</body>
</html>
