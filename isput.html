<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ========== –ß–ê–°–¢–ò–ù–ê 1: CSS –ó–ú–Ü–ù–ù–Ü –¢–ê –ë–ê–ó–û–í–Ü –°–¢–ò–õ–Ü ========== */
        :root {
            --primary: #00ff44;
            --primary-bright: #e0ffe8;
            --primary-glow: rgba(0, 255, 68, 0.7);
            --primary-dim: rgba(0, 255, 68, 0.15);
            --bg: #030507;
            --card-bg: rgba(10, 12, 16, 0.6);
            --glass-border: rgba(0, 255, 68, 0.3);
            --danger: #ef4444;
            --danger-glow: rgba(239, 68, 68, 0.6);
            --warning: #fbbf24;
            --text-gray: #94a3b8;
            --blue: #3b82f6;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background-color: var(--bg);
            background-image:
                radial-gradient(circle at 15% 50%, rgba(0,255,68,0.2), transparent 50%),
                radial-gradient(circle at 85% 30%, rgba(0,255,68,0.2), transparent 50%);
            background-attachment: fixed;
            color: white; font-family: 'Inter', sans-serif;
            min-height: 100vh; overflow-x: hidden;
            user-select: none; -webkit-user-select: none;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #05070a; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; box-shadow: 0 0 10px var(--primary); }
        input, textarea, select { user-select: text !important; -webkit-user-select: text !important; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 2: –ê–ù–Ü–ú–ê–¶–Ü–á ========== */
        @keyframes fadeInUp { from { opacity:0; transform:translateY(30px); } to { opacity:1; transform:translateY(0); } }
        @keyframes modalPop { from { transform:scale(0.8); opacity:0; } to { transform:scale(1); opacity:1; } }
        @keyframes pulseGlow { 0%,100% { box-shadow: 0 0 15px var(--primary-glow); } 50% { box-shadow: 0 0 35px var(--primary-glow), 0 0 60px rgba(0,255,68,0.3); } }
        @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-5px)} 75%{transform:translateX(5px)} }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes countUp { from { opacity:0; transform:scale(0.5); } to { opacity:1; transform:scale(1); } }
        .fade-in { animation: fadeInUp 0.5s ease forwards; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 3: –®–ê–ü–ö–ê ========== */
        header {
            display:flex; justify-content:space-between; align-items:center;
            padding:15px 5%; background:rgba(3,5,7,0.8);
            border-bottom:1px solid var(--glass-border);
            position:sticky; top:0; z-index:1000;
            box-shadow: 0 0 20px rgba(0,255,102,0.2);
        }
        .logo-box {
            background:var(--primary); color:black; padding:6px 14px;
            border-radius:8px; font-weight:900; text-decoration:none; font-size:15px;
            text-transform:uppercase; box-shadow:0 0 20px var(--primary);
        }
        .header-right { display:flex; align-items:center; gap:12px; flex-wrap:wrap; }
        .nav-btn {
            background:rgba(255,255,255,0.05); border:1px solid var(--glass-border);
            color:var(--primary-bright); padding:8px 16px; border-radius:10px;
            font-weight:700; cursor:pointer; font-size:12px; text-transform:uppercase;
            transition:0.3s;
        }
        .nav-btn:hover { background:var(--primary); color:black; box-shadow:0 0 15px var(--primary); }
        .nav-btn.active { background:var(--primary); color:black; box-shadow:0 0 15px var(--primary); }
        .role-switch {
            display:flex; border-radius:10px; overflow:hidden; border:1px solid var(--glass-border);
        }
        .role-btn {
            padding:8px 14px; font-size:11px; font-weight:800; cursor:pointer;
            border:none; text-transform:uppercase; transition:0.3s;
            background:rgba(255,255,255,0.05); color:var(--text-gray);
        }
        .role-btn.active-role { background:var(--primary); color:black; }
        .back-btn {
            background:rgba(255,255,255,0.05); border:1px solid var(--glass-border);
            color:var(--primary-bright); padding:8px 16px; border-radius:10px;
            font-weight:700; cursor:pointer; font-size:12px; text-decoration:none;
            transition:0.3s;
        }
        .back-btn:hover { background:var(--primary); color:black; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 4: –ù–û–¢–ò–§–Ü–ö–ê–¶–Ü–á ========== */
        .notif-bell { position:relative; cursor:pointer; padding:5px; }
        .notif-bell .bell { font-size:24px; color:var(--warning); filter:drop-shadow(0 0 8px var(--warning)); }
        .notif-badge {
            position:absolute; top:-2px; right:-2px;
            background:var(--danger); color:white; font-size:10px; font-weight:900;
            padding:2px 6px; border-radius:50%; border:2px solid var(--bg);
            display:none; animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%{transform:scale(1);box-shadow:0 0 0 0 rgba(239,68,68,0.7)} 70%{transform:scale(1.1);box-shadow:0 0 0 10px rgba(239,68,68,0)} 100%{transform:scale(1);box-shadow:0 0 0 0 rgba(239,68,68,0)} }
        .notif-dropdown {
            position:absolute; top:70px; right:5%; width:380px;
            background:rgba(10,15,25,0.97); border:1px solid var(--glass-border); border-radius:15px;
            display:none; flex-direction:column; z-index:2000;
            box-shadow:0 0 40px rgba(0,0,0,0.9); overflow:hidden;
        }
        .notif-dropdown.show { display:flex; }
        .notif-drop-header {
            padding:12px 15px; background:rgba(255,255,255,0.05);
            display:flex; justify-content:space-between; align-items:center;
            border-bottom:1px solid var(--glass-border);
        }
        .notif-item {
            padding:12px 15px; border-bottom:1px solid rgba(255,255,255,0.05);
            cursor:pointer; font-size:13px; transition:0.3s;
        }
        .notif-item:hover { background:rgba(255,255,255,0.05); }
        .notif-item.read { opacity:0.4; }
        .notif-item .n-time { font-size:10px; color:var(--text-gray); margin-top:4px; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 5: –ö–û–ù–¢–ï–ô–ù–ï–† + –°–¢–ê–¢–ò–°–¢–ò–ö–ê ========== */
        .main-wrap { padding:30px 5%; max-width:1400px; margin:0 auto; }
        .view { display:none; }
        .view.active { display:block; }

        .stats-row { display:grid; grid-template-columns:repeat(4,1fr); gap:15px; margin-bottom:30px; }
        .stat-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:15px;
            padding:20px; text-align:center; backdrop-filter:blur(10px);
        }
        .stat-card .stat-num { font-size:32px; font-weight:900; color:var(--primary); text-shadow:0 0 15px var(--primary); }
        .stat-card .stat-label { font-size:11px; color:var(--text-gray); text-transform:uppercase; margin-top:5px; font-weight:700; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 6: –ö–ê–†–¢–ö–ò –¢–ï–°–¢–Ü–í ========== */
        .tests-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:20px; margin-bottom:30px; }
        .test-card {
            background:var(--card-bg); border:1px solid rgba(0,255,68,0.2); border-radius:20px;
            padding:25px; backdrop-filter:blur(10px); cursor:pointer;
            transition:0.3s; position:relative; overflow:hidden;
        }
        .test-card:hover {
            transform:translateY(-3px); border-color:var(--primary);
            box-shadow:0 0 30px var(--primary-glow);
        }
        .test-card .tc-emoji { font-size:40px; margin-bottom:12px; }
        .test-card .tc-title { font-size:18px; font-weight:900; margin-bottom:8px; }
        .test-card .tc-desc { font-size:13px; color:var(--text-gray); margin-bottom:15px; line-height:1.5; }
        .test-card .tc-meta { display:flex; gap:10px; flex-wrap:wrap; }
        .tc-badge {
            font-size:10px; font-weight:800; padding:4px 10px; border-radius:6px;
            text-transform:uppercase;
        }
        .tc-badge.green { background:rgba(0,255,68,0.15); color:var(--primary); border:1px solid rgba(0,255,68,0.3); }
        .tc-badge.yellow { background:rgba(251,191,36,0.15); color:var(--warning); border:1px solid rgba(251,191,36,0.3); }
        .tc-badge.blue { background:rgba(59,130,246,0.15); color:var(--blue); border:1px solid rgba(59,130,246,0.3); }
        .tc-badge.red { background:rgba(239,68,68,0.15); color:var(--danger); border:1px solid rgba(239,68,68,0.3); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 7: –Ü–ù–¢–†–û –¢–ï–°–¢–£ ========== */
        .test-intro {
            background:var(--card-bg); border:1px solid var(--primary); border-radius:25px;
            padding:40px; max-width:600px; margin:0 auto; text-align:center;
            box-shadow:0 0 40px rgba(0,255,68,0.2);
        }
        .test-intro .ti-emoji { font-size:60px; margin-bottom:20px; }
        .test-intro .ti-title { font-size:28px; font-weight:900; margin-bottom:10px; }
        .test-intro .ti-desc { font-size:14px; color:var(--text-gray); margin-bottom:25px; line-height:1.6; }
        .ti-info-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:25px; text-align:left; }
        .ti-info-item {
            background:rgba(255,255,255,0.03); padding:12px; border-radius:10px;
            border:1px solid rgba(255,255,255,0.05);
        }
        .ti-info-item .til { font-size:10px; color:var(--text-gray); text-transform:uppercase; font-weight:700; }
        .ti-info-item .tiv { font-size:16px; font-weight:800; margin-top:4px; }
        .btn-start-test {
            width:100%; padding:16px; background:var(--primary); color:black;
            border:none; border-radius:12px; font-weight:900; font-size:16px;
            cursor:pointer; text-transform:uppercase; transition:0.3s;
        }
        .btn-start-test:hover { box-shadow:0 0 30px var(--primary); transform:translateY(-2px); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 8: –ü–†–û–•–û–î–ñ–ï–ù–ù–Ø –¢–ï–°–¢–£ ========== */
        .test-progress-wrap {
            max-width:700px; margin:0 auto;
        }
        .tp-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .tp-counter { font-size:14px; font-weight:800; color:var(--primary-bright); }
        .tp-timer {
            background:rgba(255,255,255,0.05); border:1px solid var(--glass-border);
            padding:8px 18px; border-radius:10px; font-weight:900; font-size:14px;
        }
        .tp-timer.danger { color:var(--danger); border-color:var(--danger); animation:shake 0.3s; }
        .progress-bar-bg {
            width:100%; height:8px; background:rgba(255,255,255,0.1); border-radius:10px;
            margin-bottom:25px; overflow:hidden;
        }
        .progress-bar-fill {
            height:100%; background:var(--primary); border-radius:10px;
            transition:width 0.5s ease; box-shadow:0 0 10px var(--primary);
        }
        .question-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:20px;
            padding:30px; backdrop-filter:blur(10px); margin-bottom:20px;
        }
        .q-points { font-size:11px; color:var(--warning); font-weight:800; margin-bottom:10px; text-transform:uppercase; }
        .q-text { font-size:18px; font-weight:800; margin-bottom:25px; line-height:1.5; }
        .answer-option {
            display:flex; align-items:center; gap:12px;
            padding:15px 20px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.08);
            border-radius:12px; margin-bottom:10px; cursor:pointer; transition:0.3s;
            font-size:14px; font-weight:600;
        }
        .answer-option:hover { border-color:var(--primary); background:rgba(0,255,68,0.05); }
        .answer-option.selected { border-color:var(--primary); background:rgba(0,255,68,0.1); box-shadow:0 0 15px rgba(0,255,68,0.2); }
        .answer-option.correct { border-color:#22c55e; background:rgba(34,197,94,0.15); }
        .answer-option.wrong { border-color:var(--danger); background:rgba(239,68,68,0.15); }
        .answer-option .ao-circle {
            width:22px; height:22px; border-radius:50%; border:2px solid rgba(255,255,255,0.3);
            flex-shrink:0; display:flex; align-items:center; justify-content:center; transition:0.3s;
        }
        .answer-option.selected .ao-circle { border-color:var(--primary); background:var(--primary); }
        .answer-option.correct .ao-circle { border-color:#22c55e; background:#22c55e; }
        .answer-option.wrong .ao-circle { border-color:var(--danger); background:var(--danger); }

        .free-answer-input {
            width:100%; padding:14px; background:rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.1);
            color:white; border-radius:12px; font-size:14px; font-family:inherit; outline:none;
            transition:0.3s; resize:vertical; min-height:60px;
        }
        .free-answer-input:focus { border-color:var(--primary); box-shadow:0 0 15px var(--primary-glow); }
        .free-answer-label { font-size:12px; color:var(--text-gray); margin-bottom:8px; font-weight:700; text-transform:uppercase; }

        .btn-confirm-answer {
            width:100%; padding:15px; background:var(--primary); color:black;
            border:none; border-radius:12px; font-weight:900; font-size:14px;
            cursor:pointer; text-transform:uppercase; transition:0.3s; margin-top:10px;
        }
        .btn-confirm-answer:hover { box-shadow:0 0 20px var(--primary); }
        .btn-confirm-answer:disabled { opacity:0.3; cursor:not-allowed; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 9: –†–ï–ó–£–õ–¨–¢–ê–¢–ò ========== */
        .result-wrap { max-width:700px; margin:0 auto; text-align:center; }
        .result-hero {
            background:var(--card-bg); border-radius:25px; padding:40px;
            border:2px solid var(--primary); margin-bottom:25px;
            box-shadow:0 0 40px rgba(0,255,68,0.2);
        }
        .result-hero.failed { border-color:var(--danger); box-shadow:0 0 40px var(--danger-glow); }
        .result-circle {
            width:140px; height:140px; border-radius:50%; margin:0 auto 20px;
            display:flex; align-items:center; justify-content:center;
            font-size:36px; font-weight:900;
            border:4px solid var(--primary); color:var(--primary);
            animation:countUp 0.8s ease forwards;
        }
        .result-hero.failed .result-circle { border-color:var(--danger); color:var(--danger); }
        .result-status { font-size:28px; font-weight:900; margin-bottom:5px; }
        .result-hero.failed .result-status { color:var(--danger); }
        .result-sub { font-size:14px; color:var(--text-gray); }

        .result-details-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:20px;
            padding:25px; text-align:left; margin-bottom:15px;
        }
        .rd-item { padding:15px 0; border-bottom:1px solid rgba(255,255,255,0.05); }
        .rd-item:last-child { border:none; }
        .rd-q { font-weight:700; margin-bottom:8px; font-size:14px; }
        .rd-your { font-size:13px; margin-bottom:4px; }
        .rd-correct { font-size:13px; color:#22c55e; }
        .rd-wrong-text { color:var(--danger); }
        .rd-points { font-size:12px; color:var(--warning); font-weight:700; margin-top:4px; }
        .rd-free-label { font-size:11px; color:var(--blue); font-weight:700; margin-top:4px; }
        .rd-pending { font-size:12px; color:var(--warning); font-weight:700; margin-top:4px; }

        .result-btns { display:flex; gap:12px; justify-content:center; margin-top:20px; }
        .result-btns button {
            padding:14px 30px; border-radius:12px; font-weight:900; font-size:13px;
            cursor:pointer; text-transform:uppercase; transition:0.3s; border:none;
        }
        .btn-retry { background:var(--primary); color:black; }
        .btn-retry:hover { box-shadow:0 0 20px var(--primary); }
        .btn-home { background:rgba(255,255,255,0.05); color:white; border:1px solid var(--glass-border) !important; }
        .btn-home:hover { border-color:var(--primary) !important; color:var(--primary-bright); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 10: –§–û–†–ú–ê –°–¢–í–û–†–ï–ù–ù–Ø ========== */
        .create-wrap { max-width:800px; margin:0 auto; }
        .form-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:20px;
            padding:30px; margin-bottom:20px; backdrop-filter:blur(10px);
        }
        .form-title { font-size:18px; font-weight:900; margin-bottom:20px; color:var(--primary-bright); }
        .form-group { margin-bottom:18px; }
        .form-label { display:block; font-size:11px; color:var(--text-gray); margin-bottom:8px; text-transform:uppercase; font-weight:700; }
        .form-input {
            width:100%; background:rgba(0,0,0,0.5); border:1px solid rgba(255,255,255,0.1);
            color:white; padding:12px; border-radius:10px; font-size:14px; outline:none;
            font-family:inherit; transition:0.3s;
        }
        .form-input:focus { border-color:var(--primary); box-shadow:0 0 15px var(--primary-glow); }
        textarea.form-input { resize:vertical; min-height:80px; }
        select.form-input { cursor:pointer; }
        .form-row { display:grid; grid-template-columns:1fr 1fr; gap:15px; }

        .range-wrap { display:flex; align-items:center; gap:15px; }
        .range-wrap input[type=range] {
            flex:1; -webkit-appearance:none; height:6px; background:rgba(255,255,255,0.1);
            border-radius:10px; outline:none;
        }
        .range-wrap input[type=range]::-webkit-slider-thumb {
            -webkit-appearance:none; width:20px; height:20px; background:var(--primary);
            border-radius:50%; cursor:pointer; box-shadow:0 0 10px var(--primary);
        }
        .range-val { font-size:20px; font-weight:900; color:var(--primary); min-width:50px; text-align:center; }

        .question-block {
            background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.08);
            border-radius:15px; padding:20px; margin-bottom:15px; position:relative;
        }
        .qb-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
        .qb-num { font-size:13px; font-weight:800; color:var(--primary); }
        .qb-del {
            background:none; border:1px solid var(--danger); color:var(--danger);
            padding:5px 12px; border-radius:8px; font-size:11px; font-weight:700; cursor:pointer;
        }
        .qb-del:hover { background:var(--danger); color:white; }

        .answer-row {
            display:flex; align-items:center; gap:10px; margin-bottom:8px;
        }
        .answer-row input[type=text] {
            flex:1; background:rgba(0,0,0,0.4); border:1px solid rgba(255,255,255,0.08);
            color:white; padding:10px; border-radius:8px; font-size:13px; outline:none; font-family:inherit;
        }
        .answer-row input[type=text]:focus { border-color:var(--primary); }
        .correct-radio {
            width:20px; height:20px; border-radius:50%; border:2px solid rgba(255,255,255,0.2);
            cursor:pointer; flex-shrink:0; display:flex; align-items:center; justify-content:center;
            transition:0.3s; background:transparent;
        }
        .correct-radio.active { border-color:var(--primary); background:var(--primary); }
        .correct-radio:hover { border-color:var(--primary); }
        .del-ans-btn {
            background:none; border:none; color:#555; font-size:18px; cursor:pointer;
            padding:0 5px;
        }
        .del-ans-btn:hover { color:var(--danger); }

        .add-answer-btn, .add-question-btn {
            background:rgba(255,255,255,0.03); border:1px dashed rgba(255,255,255,0.15);
            color:var(--text-gray); padding:10px; border-radius:10px; width:100%;
            cursor:pointer; font-weight:700; font-size:12px; transition:0.3s; margin-top:8px;
        }
        .add-answer-btn:hover, .add-question-btn:hover { border-color:var(--primary); color:var(--primary); }

        .free-answer-toggle {
            display:flex; align-items:center; gap:10px; margin-top:10px;
            font-size:12px; color:var(--text-gray); cursor:pointer; font-weight:600;
        }
        .toggle-box {
            width:38px; height:20px; background:rgba(255,255,255,0.1); border-radius:20px;
            position:relative; cursor:pointer; transition:0.3s; flex-shrink:0;
        }
        .toggle-box.on { background:var(--primary); }
        .toggle-box::after {
            content:''; position:absolute; top:2px; left:2px; width:16px; height:16px;
            background:white; border-radius:50%; transition:0.3s;
        }
        .toggle-box.on::after { left:20px; }

        .btn-create-test {
            width:100%; padding:16px; background:var(--primary); color:black;
            border:none; border-radius:12px; font-weight:900; font-size:15px;
            cursor:pointer; text-transform:uppercase; transition:0.3s;
        }
        .btn-create-test:hover { box-shadow:0 0 30px var(--primary); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 11: –ü–ï–†–ï–í–Ü–†–ö–ê (–†–ï–í–Æ) ========== */
        .review-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:20px;
            padding:25px; margin-bottom:15px; backdrop-filter:blur(10px);
        }
        .review-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px; }
        .review-user { font-weight:900; font-size:16px; }
        .review-test-name { font-size:12px; color:var(--primary); font-weight:700; }
        .review-date { font-size:11px; color:var(--text-gray); }
        .review-q { margin-bottom:12px; }
        .review-q-text { font-size:14px; font-weight:700; margin-bottom:5px; }
        .review-q-answer { font-size:13px; color:var(--text-gray); }
        .review-q-free { font-size:13px; color:var(--blue); padding:10px; background:rgba(59,130,246,0.1); border-radius:8px; margin-top:5px; }
        .review-actions { display:flex; gap:10px; margin-top:15px; }
        .btn-approve {
            padding:12px 25px; background:var(--primary); color:black; border:none;
            border-radius:10px; font-weight:900; font-size:12px; cursor:pointer; text-transform:uppercase;
        }
        .btn-approve:hover { box-shadow:0 0 20px var(--primary); }
        .btn-reject {
            padding:12px 25px; background:none; border:1px solid var(--danger); color:var(--danger);
            border-radius:10px; font-weight:900; font-size:12px; cursor:pointer; text-transform:uppercase;
        }
        .btn-reject:hover { background:var(--danger); color:white; }
        .manual-score-input {
            width:80px; background:rgba(0,0,0,0.5); border:1px solid var(--glass-border);
            color:white; padding:8px 12px; border-radius:8px; font-size:14px; font-weight:700;
            text-align:center; outline:none;
        }
        .manual-score-input:focus { border-color:var(--primary); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 12: –ù–ê–°–¢–†–û–ô–ö–ò ========== */
        .settings-card {
            background:var(--card-bg); border:1px solid var(--glass-border); border-radius:20px;
            padding:30px; margin-bottom:20px; backdrop-filter:blur(10px);
        }
        .settings-title { font-size:16px; font-weight:900; color:var(--primary-bright); margin-bottom:20px; }
        .checker-item {
            display:flex; justify-content:space-between; align-items:center;
            padding:10px 15px; background:rgba(255,255,255,0.03); border-radius:10px;
            margin-bottom:8px; border:1px solid rgba(255,255,255,0.05);
        }
        .checker-item .ci-name { font-weight:700; font-size:14px; }
        .checker-item .ci-remove {
            background:none; border:1px solid var(--danger); color:var(--danger);
            padding:4px 12px; border-radius:6px; font-size:11px; cursor:pointer; font-weight:700;
        }
        .checker-item .ci-remove:hover { background:var(--danger); color:white; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 13: –ö–ï–†–£–í–ê–ù–ù–Ø ========== */
        .manage-test-item {
            display:flex; justify-content:space-between; align-items:center;
            background:rgba(255,255,255,0.03); padding:18px 25px; border-radius:15px;
            margin-bottom:12px; border:1px solid rgba(255,255,255,0.05); flex-wrap:wrap; gap:10px;
        }
        .mti-info { flex:1; }
        .mti-name { font-weight:900; font-size:15px; }
        .mti-meta { font-size:12px; color:var(--text-gray); margin-top:4px; }
        .mti-actions { display:flex; gap:8px; }
        .mti-btn {
            padding:8px 16px; border-radius:8px; font-weight:800; font-size:11px;
            cursor:pointer; text-transform:uppercase; transition:0.3s; border:none;
        }
        .mti-btn.del { background:none; border:1px solid var(--danger); color:var(--danger); }
        .mti-btn.del:hover { background:var(--danger); color:white; }

        /* ========== –ß–ê–°–¢–ò–ù–ê 14: –û–°–¢–ê–ù–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò ========== */
        .results-table {
            width:100%; border-collapse:collapse;
        }
        .results-table th {
            text-align:left; padding:12px 15px; font-size:11px; color:var(--text-gray);
            text-transform:uppercase; font-weight:700; border-bottom:1px solid rgba(255,255,255,0.1);
        }
        .results-table td {
            padding:12px 15px; font-size:13px; border-bottom:1px solid rgba(255,255,255,0.03);
        }
        .status-badge {
            padding:3px 10px; border-radius:6px; font-size:10px; font-weight:900; text-transform:uppercase;
        }
        .status-badge.passed { background:rgba(0,255,68,0.15); color:var(--primary); }
        .status-badge.failed { background:rgba(239,68,68,0.15); color:var(--danger); }
        .status-badge.pending { background:rgba(251,191,36,0.15); color:var(--warning); }
        .status-badge.reviewed { background:rgba(59,130,246,0.15); color:var(--blue); }

        /* ========== –ß–ê–°–¢–ò–ù–ê 15: –ê–î–ê–ü–¢–ò–í–ù–Ü–°–¢–¨ ========== */
        @media(max-width:1024px) {
            .stats-row { grid-template-columns:repeat(2,1fr); }
        }
        @media(max-width:768px) {
            header { padding:14px 15px; }
            .header-right { gap:8px; }
            .nav-btn { padding:6px 10px; font-size:10px; }
            .role-btn { padding:6px 10px; font-size:10px; }
            .stats-row { grid-template-columns:1fr 1fr; }
            .tests-grid { grid-template-columns:1fr; }
            .form-row { grid-template-columns:1fr; }
            .ti-info-grid { grid-template-columns:1fr; }
            .test-intro { padding:25px; }
            .question-card { padding:20px; }
            .result-hero { padding:25px; }
            .manage-test-item { flex-direction:column; align-items:flex-start; }
            .notif-dropdown { right:10px; left:10px; width:auto; }
        }
    </style>
</head>
<body>

    <!-- ====== HEADER ====== -->
    <header>
        <div style="display:flex;align-items:center;gap:15px;">
            <a href="cabinet.html" class="back-btn">‚Üê –ö–ê–ë–Ü–ù–ï–¢</a>
            <a href="isput.html" class="logo-box">–Ü–°–ü–ò–¢</a>
        </div>
        <div class="header-right">
            <button class="nav-btn active" onclick="showView('home')" id="navHome">üè† –ì–û–õ–û–í–ù–ê</button>
            <button class="nav-btn" onclick="showView('review')" id="navReview" style="display:none;">üìã –ü–ï–†–ï–í–Ü–†–ö–ê <span id="reviewBadge" class="tc-badge red" style="display:none;margin-left:5px;padding:2px 6px;font-size:9px;">0</span></button>
            <button class="nav-btn" onclick="showView('create')" id="navCreate" style="display:none;">‚ûï –°–¢–í–û–†–ò–¢–ò</button>
            <button class="nav-btn" onclick="showView('manage')" id="navManage" style="display:none;">‚öôÔ∏è –ö–ï–†–£–í–ê–ù–ù–Ø</button>
            <button class="nav-btn" onclick="showView('settings')" id="navSettings" style="display:none;">üîß –ù–ê–°–¢–†–û–ô–ö–ò</button>

            <div class="notif-bell" onclick="toggleNotifDrop(event)">
                <span class="bell">üîî</span>
                <div class="notif-badge" id="notifBadge">0</div>
            </div>

            <div class="role-switch">
                <button class="role-btn active-role" onclick="setRole('admin')" id="rAdmin">–ê–î–ú–Ü–ù</button>
                <button class="role-btn" onclick="setRole('instructor')" id="rInstr">–Ü–ù–°–¢–†</button>
                <button class="role-btn" onclick="setRole('fighter')" id="rFighter">–ë–Ü–Ñ–¶–¨</button>
            </div>
        </div>
    </header>

    <div class="notif-dropdown" id="notifDrop">
        <div class="notif-drop-header">
            <span style="font-size:12px;font-weight:800;color:var(--primary-bright);">–°–ü–û–í–Ü–©–ï–ù–ù–Ø</span>
            <button onclick="clearNotifs()" style="background:none;border:none;color:var(--text-gray);font-size:10px;cursor:pointer;font-weight:700;">–û–ß–ò–°–¢–ò–¢–ò</button>
        </div>
        <div id="notifList" style="max-height:300px;overflow-y:auto;">
            <div style="color:var(--text-gray);text-align:center;padding:20px;font-size:12px;">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>
        </div>
    </div>

    <!-- ====== MAIN CONTENT ====== -->
    <div class="main-wrap">

        <!-- VIEW: HOME -->
        <div id="viewHome" class="view active">
            <div class="stats-row" id="statsRow"></div>
            <h3 style="color:var(--primary-bright);margin-bottom:20px;font-size:16px;">üìù –î–û–°–¢–£–ü–ù–Ü –¢–ï–°–¢–ò</h3>
            <div class="tests-grid" id="testsGrid"></div>
            <h3 style="color:var(--primary-bright);margin-bottom:15px;margin-top:30px;font-size:16px;">üìä –û–°–¢–ê–ù–ù–Ü –†–ï–ó–£–õ–¨–¢–ê–¢–ò</h3>
            <div style="background:var(--card-bg);border:1px solid var(--glass-border);border-radius:20px;overflow:hidden;backdrop-filter:blur(10px);">
                <table class="results-table" id="resultsTable">
                    <thead><tr><th>–Ü–º'—è</th><th>–¢–µ—Å—Ç</th><th>–ë–∞–ª–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–î–∞—Ç–∞</th></tr></thead>
                    <tbody id="resultsBody"></tbody>
                </table>
            </div>
        </div>

        <!-- VIEW: TEST INTRO -->
        <div id="viewIntro" class="view"></div>

        <!-- VIEW: TAKE TEST -->
        <div id="viewTest" class="view"></div>

        <!-- VIEW: RESULTS -->
        <div id="viewResult" class="view"></div>

        <!-- VIEW: CREATE TEST -->
        <div id="viewCreate" class="view">
            <div class="create-wrap">
                <div class="form-card">
                    <div class="form-title">üìù –°–¢–í–û–†–ï–ù–ù–Ø –ù–û–í–û–ì–û –¢–ï–°–¢–£</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞ —Ç–µ—Å—Ç—É</label>
                            <input type="text" class="form-input" id="ctName" placeholder="–ë–∞–∑–æ–≤–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ï–º–æ–¥–∑—ñ</label>
                            <input type="text" class="form-input" id="ctEmoji" placeholder="üéØ" maxlength="4" style="text-align:center;font-size:24px;">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–û–ø–∏—Å</label>
                        <textarea class="form-input" id="ctDesc" placeholder="–û–ø–∏—à—ñ—Ç—å —Ç–µ—Å—Ç..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                            <select class="form-input" id="ctCat">
                                <option value="–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞">–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞</option>
                                <option value="–¢–∞–∫—Ç–∏–∫–∞">–¢–∞–∫—Ç–∏–∫–∞</option>
                                <option value="–°—Ç–∞—Ç—É—Ç">–°—Ç–∞—Ç—É—Ç</option>
                                <option value="–ó–±—Ä–æ—è">–ó–±—Ä–æ—è</option>
                                <option value="–ú–µ–¥–∏—Ü–∏–Ω–∞">–ú–µ–¥–∏—Ü–∏–Ω–∞</option>
                                <option value="–Ü–Ω—à–µ">–Ü–Ω—à–µ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ß–∞—Å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è (—Å–µ–∫)</label>
                            <input type="number" class="form-input" id="ctTime" value="45" min="10" max="300">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –±–∞–ª</label>
                        <input type="number" class="form-input" id="ctMaxScore" value="12" min="1" max="100">
                        <small style="color:var(--text-gray);font-size:11px;margin-top:5px;display:block;">–ë–∞–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑–ø–æ–¥—ñ–ª—è—Ç—å—Å—è –ø–æ –ø–∏—Ç–∞–Ω–Ω—è—Ö</small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª (%)</label>
                        <div class="range-wrap">
                            <input type="range" id="ctPassScore" min="10" max="100" value="60" oninput="document.getElementById('passVal').innerText=this.value+'%'">
                            <span class="range-val" id="passVal">60%</span>
                        </div>
                    </div>
                </div>

                <div class="form-card">
                    <div class="form-title">‚ùì –ü–ò–¢–ê–ù–ù–Ø</div>
                    <div id="questionsContainer"></div>
                    <button class="add-question-btn" onclick="addQuestionBlock()">+ –î–û–î–ê–¢–ò –ü–ò–¢–ê–ù–ù–Ø</button>
                </div>

                <button class="btn-create-test" onclick="createTest()">‚úÖ –°–¢–í–û–†–ò–¢–ò –¢–ï–°–¢</button>
            </div>
        </div>

        <!-- VIEW: REVIEW -->
        <div id="viewReview" class="view">
            <h3 style="color:var(--primary-bright);margin-bottom:20px;font-size:16px;">üìã –¢–ï–°–¢–ò –ù–ê –ü–ï–†–ï–í–Ü–†–ö–£</h3>
            <div id="reviewList"></div>
        </div>

        <!-- VIEW: MANAGE -->
        <div id="viewManage" class="view">
            <h3 style="color:var(--primary-bright);margin-bottom:20px;font-size:16px;">‚öôÔ∏è –ö–ï–†–£–í–ê–ù–ù–Ø –¢–ï–°–¢–ê–ú–ò</h3>
            <div id="manageList"></div>
        </div>

        <!-- VIEW: SETTINGS -->
        <div id="viewSettings" class="view">
            <div class="create-wrap">
                <div class="settings-card">
                    <div class="settings-title">üîó DISCORD WEBHOOK</div>
                    <div class="form-group">
                        <label class="form-label">URL –í–µ–±—Ö—É–∫–∞</label>
                        <input type="text" class="form-input" id="webhookUrl" placeholder="https://discord.com/api/webhooks/...">
                    </div>
                    <button class="nav-btn" onclick="saveWebhook()" style="width:100%;padding:14px;font-size:13px;">üíæ –ó–ë–ï–†–ï–ì–¢–ò –í–ï–ë–•–£–ö</button>
                    <button class="nav-btn" onclick="testWebhook()" style="width:100%;padding:14px;font-size:13px;margin-top:10px;">üì® –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø</button>
                </div>

                <div class="settings-card">
                    <div class="settings-title">üë• –ü–ï–†–ï–í–Ü–†–Æ–í–ê–ß–Ü</div>
                    <p style="font-size:12px;color:var(--text-gray);margin-bottom:15px;">–¶—ñ –ª—é–¥–∏ –º–æ–∂—É—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ —Ç–µ—Å—Ç–∏ –∑ –≤—ñ–ª—å–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏ (–æ–∫—Ä—ñ–º –∞–¥–º—ñ–Ω—ñ–≤, —è–∫—ñ –∑–∞–≤–∂–¥–∏ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø)</p>
                    <div class="form-group">
                        <label class="form-label">–î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á–∞ (–Ω—ñ–∫)</label>
                        <div style="display:flex;gap:10px;">
                            <input type="text" class="form-input" id="checkerName" placeholder="–ù—ñ–∫–Ω–µ–π–º...">
                            <button class="btn-approve" onclick="addChecker()">–î–û–î–ê–¢–ò</button>
                        </div>
                    </div>
                    <div id="checkersList"></div>
                </div>

                <div class="settings-card">
                    <div class="settings-title">üë§ –í–ê–® –ù–Ü–ö–ù–ï–ô–ú</div>
                    <div class="form-group">
                        <label class="form-label">–Ü–º'—è –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è</label>
                        <input type="text" class="form-input" id="userNameInput" placeholder="–í–∞—à –Ω—ñ–∫–Ω–µ–π–º...">
                    </div>
                    <button class="nav-btn" onclick="saveUserName()" style="width:100%;padding:14px;font-size:13px;">üíæ –ó–ë–ï–†–ï–ì–¢–ò –Ü–ú'–Ø</button>
                </div>
            </div>
        </div>

    </div>

    <!-- ============================== -->
    <!-- ======== JAVASCRIPT ========== -->
    <!-- ============================== -->
    <script>
    (function(){
        'use strict';

        // ========== 16.1: –°–•–û–í–ò–©–ï ==========
        const STORE_KEYS = {
            tests: 'isput_tests',
            results: 'isput_results',
            role: 'isput_role',
            webhook: 'isput_webhook',
            checkers: 'isput_checkers',
            notifs: 'isput_notifs',
            userName: 'isput_username'
        };

        function loadData(key, def) {
            try { const d = localStorage.getItem(key); return d ? JSON.parse(d) : def; }
            catch(e) { return def; }
        }
        function saveData(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

        let tests = loadData(STORE_KEYS.tests, []);
        let results = loadData(STORE_KEYS.results, []);
        let currentRole = loadData(STORE_KEYS.role, 'admin');
        let webhook = loadData(STORE_KEYS.webhook, '');
        let checkers = loadData(STORE_KEYS.checkers, []);
        let notifs = loadData(STORE_KEYS.notifs, []);
        let userName = loadData(STORE_KEYS.userName, '–ë—ñ—î—Ü—å');

        function saveTests() { saveData(STORE_KEYS.tests, tests); }
        function saveResults() { saveData(STORE_KEYS.results, results); }
        function saveNotifs() { saveData(STORE_KEYS.notifs, notifs); }

        // –î–µ—Ñ–æ–ª—Ç–Ω—ñ —Ç–µ—Å—Ç–∏
        if (tests.length === 0) {
            tests = [
                {
                    id: 'def1', name: '–ë–∞–∑–æ–≤–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –î–®–í', emoji: 'üéñÔ∏è',
                    desc: '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–Ω–∞–Ω—å –±–∞–∑–æ–≤–æ—ó –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–µ—Å–∞–Ω—Ç–Ω–∏–∫–∞.',
                    category: '–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞', timePerQ: 45, maxScore: 12, passPercent: 60,
                    createdAt: new Date().toISOString(),
                    questions: [
                        { text: '–©–æ –æ–∑–Ω–∞—á–∞—î –∞–±—Ä–µ–≤—ñ–∞—Ç—É—Ä–∞ –î–®–í?', answers: [
                            { text: '–î–µ—Å–∞–Ω—Ç–Ω–æ-—à—Ç—É—Ä–º–æ–≤—ñ –≤—ñ–π—Å—å–∫–∞', correct: true },
                            { text: '–î–µ—Ä–∂–∞–≤–Ω–∞ —Å–ª—É–∂–±–∞ –≤—ñ–π—Å—å–∫–æ–≤–∞', correct: false },
                            { text: '–î–æ–±—Ä–æ–≤—ñ–ª—å–Ω–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç–∞', correct: false }
                        ], hasFreeAnswer: false },
                        { text: '–Ø–∫–∏–π –æ—Å–Ω–æ–≤–Ω–∏–π –∫–æ–ª—ñ—Ä –±–µ—Ä–µ—Ç—É –î–®–í?', answers: [
                            { text: '–ß–µ—Ä–≤–æ–Ω–∏–π', correct: false },
                            { text: '–ú–∞—Ä—É–Ω—ñ–≤ (–±–æ—Ä–¥–æ–≤–∏–π)', correct: true },
                            { text: '–ó–µ–ª–µ–Ω–∏–π', correct: false },
                            { text: '–ß–æ—Ä–Ω–∏–π', correct: false }
                        ], hasFreeAnswer: false },
                        { text: '–ù–∞–∑–≤—ñ—Ç—å –¥–µ–≤—ñ–∑ –î–®–í', answers: [
                            { text: '–ó–∞–≤–∂–¥–∏ –ø–µ—Ä—à—ñ!', correct: false },
                            { text: '–ù—ñ—Ö—Ç–æ, –∫—Ä—ñ–º –Ω–∞—Å!', correct: true },
                            { text: '–°–∏–ª–∞ —ñ —á–µ—Å—Ç—å!', correct: false }
                        ], hasFreeAnswer: false },
                        { text: '–Ø–∫–∞ –∑–∞–¥–∞—á–∞ –î–®–í –Ω–∞ –ø–æ–ª—ñ –±–æ—é?', answers: [], hasFreeAnswer: true }
                    ]
                },
                {
                    id: 'def2', name: '–¢–∞–∫—Ç–∏—á–Ω–∞ –º–µ–¥–∏—Ü–∏–Ω–∞', emoji: 'üè•',
                    desc: '–û—Å–Ω–æ–≤–∏ —Ç–∞–∫—Ç–∏—á–Ω–æ—ó –º–µ–¥–∏—Ü–∏–Ω–∏ —Ç–∞ –ø–µ—Ä—à–æ—ó –¥–æ–ø–æ–º–æ–≥–∏.',
                    category: '–ú–µ–¥–∏—Ü–∏–Ω–∞', timePerQ: 60, maxScore: 10, passPercent: 50,
                    createdAt: new Date().toISOString(),
                    questions: [
                        { text: '–ü–µ—Ä—à–∏–π –∫—Ä–æ–∫ –ø—Ä–∏ –ø–æ—Ä–∞–Ω–µ–Ω–Ω—ñ –≤ –±–æ—é?', answers: [
                            { text: '–ó—É–ø–∏–Ω–∏—Ç–∏ –∫—Ä–æ–≤–æ—Ç–µ—á—É', correct: false },
                            { text: '–ó–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –±–µ–∑–ø–µ–∫—É', correct: true },
                            { text: '–í–∏–∫–ª–∏–∫–∞—Ç–∏ –º–µ–¥–∏–∫–∞', correct: false }
                        ], hasFreeAnswer: false },
                        { text: '–î–ª—è —á–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è —Ç—É—Ä–Ω—ñ–∫–µ—Ç?', answers: [
                            { text: '–§—ñ–∫—Å–∞—Ü—ñ—è –ø–µ—Ä–µ–ª–æ–º—ñ–≤', correct: false },
                            { text: '–ó—É–ø–∏–Ω–∫–∞ –º–∞—Å–∏–≤–Ω–æ—ó –∫—Ä–æ–≤–æ—Ç–µ—á—ñ', correct: true },
                            { text: '–î–∏—Ö–∞–Ω–Ω—è', correct: false }
                        ], hasFreeAnswer: false },
                        { text: '–û–ø–∏—à—ñ—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º MARCH', answers: [], hasFreeAnswer: true }
                    ]
                }
            ];
            saveTests();
        }

        // ========== 16.2: –†–û–õ–Ü –¢–ê –ù–ê–í–Ü–ì–ê–¶–Ü–Ø ==========
        function setRole(role) {
            currentRole = role;
            saveData(STORE_KEYS.role, role);
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active-role'));
            document.getElementById(role==='admin'?'rAdmin':role==='instructor'?'rInstr':'rFighter').classList.add('active-role');
            updateNavVisibility();
            showView('home');
        }
        window.setRole = setRole;

        function isAdmin() { return currentRole === 'admin'; }
        function isChecker() {
            return isAdmin() || checkers.includes(userName);
        }

        function updateNavVisibility() {
            document.getElementById('navCreate').style.display = isAdmin() ? '' : 'none';
            document.getElementById('navManage').style.display = isAdmin() ? '' : 'none';
            document.getElementById('navSettings').style.display = isAdmin() ? '' : 'none';
            document.getElementById('navReview').style.display = isChecker() ? '' : 'none';
            updateReviewBadge();
        }

        function showView(name) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

            const viewMap = {
                home: 'viewHome', intro: 'viewIntro', test: 'viewTest',
                result: 'viewResult', create: 'viewCreate',
                review: 'viewReview', manage: 'viewManage', settings: 'viewSettings'
            };
            const el = document.getElementById(viewMap[name]);
            if (el) { el.classList.add('active'); el.classList.add('fade-in'); }

            const navMap = { home:'navHome', create:'navCreate', manage:'navManage', review:'navReview', settings:'navSettings' };
            if (navMap[name]) { const nb = document.getElementById(navMap[name]); if(nb) nb.classList.add('active'); }

            if (name === 'home') renderHome();
            if (name === 'review') renderReview();
            if (name === 'manage') renderManage();
            if (name === 'settings') renderSettings();
            if (name === 'create') initCreateForm();
        }
        window.showView = showView;

        // ========== 16.3: –ù–û–¢–ò–§–Ü–ö–ê–¶–Ü–á ==========
        function addNotif(text) {
            notifs.unshift({ text, time: new Date().toLocaleString('uk'), read: false });
            if (notifs.length > 50) notifs = notifs.slice(0, 50);
            saveNotifs();
            renderNotifs();
        }

        function renderNotifs() {
            const list = document.getElementById('notifList');
            const badge = document.getElementById('notifBadge');
            const unread = notifs.filter(n => !n.read).length;

            if (unread > 0) { badge.innerText = unread; badge.style.display = 'block'; }
            else { badge.style.display = 'none'; }

            if (notifs.length === 0) {
                list.innerHTML = '<div style="color:var(--text-gray);text-align:center;padding:20px;font-size:12px;">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>';
                return;
            }
            list.innerHTML = notifs.map((n, i) => `
                <div class="notif-item ${n.read ? 'read' : ''}" onclick="markNotifRead(${i})">
                    <div>üì¢ ${n.text}</div>
                    <div class="n-time">${n.time}</div>
                </div>
            `).join('');
        }
        window.markNotifRead = function(i) {
            notifs[i].read = true; saveNotifs(); renderNotifs();
        };
        window.clearNotifs = function() {
            notifs = []; saveNotifs(); renderNotifs();
        };
        window.toggleNotifDrop = function(e) {
            e.stopPropagation();
            document.getElementById('notifDrop').classList.toggle('show');
        };
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.notif-bell') && !e.target.closest('.notif-dropdown')) {
                document.getElementById('notifDrop').classList.remove('show');
            }
        });

        // ========== 16.4: DISCORD WEBHOOK ==========
        async function sendWebhook(data) {
            if (!webhook) return;
            try {
                await fetch(webhook, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [{
                            title: 'üìù –ù–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç—É',
                            color: data.passed ? 0x00ff44 : 0xef4444,
                            fields: [
                                { name: 'üë§ –ë—ñ—î—Ü—å', value: data.userName, inline: true },
                                { name: 'üìã –¢–µ—Å—Ç', value: data.testName, inline: true },
                                { name: 'üìä –ë–∞–ª–∏', value: `${data.score} / ${data.maxScore} (${data.percent}%)`, inline: true },
                                { name: '‚úÖ –°—Ç–∞—Ç—É—Å', value: data.passed ? '‚úÖ –°–ö–õ–ê–í' : '‚ùå –ù–ï –°–ö–õ–ê–í', inline: true },
                                { name: 'üìÖ –î–∞—Ç–∞', value: data.date, inline: true },
                                { name: 'üìù –í—ñ–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ', value: data.hasFree ? '‚è≥ –ü–æ—Ç—Ä–µ–±—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏' : '–ù–µ–º–∞—î', inline: true }
                            ],
                            footer: { text: '–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†' },
                            timestamp: new Date().toISOString()
                        }]
                    })
                });
            } catch(e) { console.error('Webhook error:', e); }
        }

        window.saveWebhook = function() {
            webhook = document.getElementById('webhookUrl').value.trim();
            saveData(STORE_KEYS.webhook, webhook);
            alert('‚úÖ –í–µ–±—Ö—É–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        };
        window.testWebhook = async function() {
            if (!webhook) { alert('–°–ø–æ—á–∞—Ç–∫—É –≤–≤–µ–¥—ñ—Ç—å URL –≤–µ–±—Ö—É–∫–∞!'); return; }
            await sendWebhook({
                userName: '–¢–µ—Å—Ç–æ–≤–∏–π –±—ñ—î—Ü—å', testName: '–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è',
                score: 10, maxScore: 12, percent: 83, passed: true,
                date: new Date().toLocaleString('uk'), hasFree: false
            });
            alert('üì® –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!');
        };

        // ========== 16.5: –ü–ï–†–ï–í–Ü–†–Æ–í–ê–ß–Ü ==========
        window.addChecker = function() {
            const name = document.getElementById('checkerName').value.trim();
            if (!name) return;
            if (!checkers.includes(name)) {
                checkers.push(name);
                saveData(STORE_KEYS.checkers, checkers);
            }
            document.getElementById('checkerName').value = '';
            renderSettings();
            updateNavVisibility();
        };
        window.removeChecker = function(name) {
            checkers = checkers.filter(c => c !== name);
            saveData(STORE_KEYS.checkers, checkers);
            renderSettings();
            updateNavVisibility();
        };

        window.saveUserName = function() {
            userName = document.getElementById('userNameInput').value.trim() || '–ë—ñ—î—Ü—å';
            saveData(STORE_KEYS.userName, userName);
            updateNavVisibility();
            alert('‚úÖ –Ü–º\'—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ: ' + userName);
        };

        // ========== 16.6: –†–ï–ù–î–ï–† –ì–û–õ–û–í–ù–û–á ==========
        function renderHome() {
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const total = tests.length;
            const myResults = results.filter(r => r.userName === userName);
            const passedCount = myResults.filter(r => r.status === 'passed').length;
            const failedCount = myResults.filter(r => r.status === 'failed').length;
            const avgScore = myResults.length > 0
                ? Math.round(myResults.reduce((s, r) => s + (r.percent || 0), 0) / myResults.length)
                : 0;

            document.getElementById('statsRow').innerHTML = `
                <div class="stat-card"><div class="stat-num">${total}</div><div class="stat-label">–¢–µ—Å—Ç—ñ–≤</div></div>
                <div class="stat-card"><div class="stat-num" style="color:#22c55e;">${passedCount}</div><div class="stat-label">–°–∫–ª–∞–¥–µ–Ω–æ</div></div>
                <div class="stat-card"><div class="stat-num" style="color:var(--danger);">${failedCount}</div><div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div></div>
                <div class="stat-card"><div class="stat-num">${avgScore}%</div><div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</div></div>
            `;

            // –ö–∞—Ä—Ç–∫–∏ —Ç–µ—Å—Ç—ñ–≤
            const grid = document.getElementById('testsGrid');
            grid.innerHTML = tests.map(t => {
                const qCount = t.questions.length;
                const hasFree = t.questions.some(q => q.hasFreeAnswer);
                return `
                <div class="test-card" onclick="openIntro('${t.id}')">
                    <div class="tc-emoji">${t.emoji || 'üìù'}</div>
                    <div class="tc-title">${t.name}</div>
                    <div class="tc-desc">${t.desc || ''}</div>
                    <div class="tc-meta">
                        <span class="tc-badge green">${qCount} –ø–∏—Ç–∞–Ω—å</span>
                        <span class="tc-badge yellow">${t.category || '–Ü–Ω—à–µ'}</span>
                        <span class="tc-badge blue">–ü—Ä–æ—Ö—ñ–¥: ${t.passPercent}%</span>
                        <span class="tc-badge green">–ú–∞–∫—Å: ${t.maxScore} –±.</span>
                        ${hasFree ? '<span class="tc-badge red">‚úç –í—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</span>' : ''}
                    </div>
                </div>`;
            }).join('') || '<p style="color:var(--text-gray);font-size:14px;">–¢–µ—Å—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>';

            // –†–µ–∑—É–ª—å—Ç–∞—Ç–∏
            const tbody = document.getElementById('resultsBody');
            const sortedResults = [...results].sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 20);
            tbody.innerHTML = sortedResults.map(r => {
                let statusClass = r.status === 'passed' ? 'passed' : r.status === 'pending' ? 'pending' : r.status === 'reviewed' ? 'reviewed' : 'failed';
                let statusText = r.status === 'passed' ? '–°–ö–õ–ê–í' : r.status === 'pending' ? '–ü–ï–†–ï–í–Ü–†–ö–ê' : r.status === 'reviewed' ? '–ü–ï–†–ï–í–Ü–†–ï–ù–û' : '–ù–ï –°–ö–õ–ê–í';
                return `<tr>
                    <td>${r.userName}</td>
                    <td>${r.testName}</td>
                    <td>${r.score}/${r.maxScore} (${r.percent}%)</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td style="font-size:11px;color:var(--text-gray);">${new Date(r.date).toLocaleString('uk')}</td>
                </tr>`;
            }).join('') || '<tr><td colspan="5" style="text-align:center;color:var(--text-gray);padding:30px;">–†–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</td></tr>';
        }

        // ========== 16.7: –Ü–ù–¢–†–û –¢–ï–°–¢–£ ==========
        window.openIntro = function(testId) {
            const t = tests.find(x => x.id === testId);
            if (!t) return;
            const qCount = t.questions.length;
            const pointsPerQ = (t.maxScore / qCount).toFixed(1);
            const hasFree = t.questions.some(q => q.hasFreeAnswer);

            document.getElementById('viewIntro').innerHTML = `
                <div class="test-intro fade-in">
                    <div class="ti-emoji">${t.emoji || 'üìù'}</div>
                    <div class="ti-title">${t.name}</div>
                    <div class="ti-desc">${t.desc || ''}</div>
                    <div class="ti-info-grid">
                        <div class="ti-info-item"><div class="til">–ü–∏—Ç–∞–Ω—å</div><div class="tiv">${qCount}</div></div>
                        <div class="ti-info-item"><div class="til">–ß–∞—Å –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è</div><div class="tiv">${t.timePerQ} —Å–µ–∫</div></div>
                        <div class="ti-info-item"><div class="til">–ú–∞–∫—Å. –±–∞–ª</div><div class="tiv">${t.maxScore}</div></div>
                        <div class="ti-info-item"><div class="til">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π %</div><div class="tiv">${t.passPercent}%</div></div>
                        <div class="ti-info-item"><div class="til">–ë–∞–ª –∑–∞ –ø–∏—Ç–∞–Ω–Ω—è</div><div class="tiv">${pointsPerQ} –±.</div></div>
                        <div class="ti-info-item"><div class="til">–í—ñ–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ</div><div class="tiv">${hasFree ? '‚úç –Ñ' : '–ù–µ–º–∞—î'}</div></div>
                    </div>
                    <button class="btn-start-test" onclick="startTest('${t.id}')">üöÄ –†–û–ó–ü–û–ß–ê–¢–ò –¢–ï–°–¢</button>
                </div>
            `;
            showView('intro');
        };

        // ========== 16.8: –ü–†–û–•–û–î–ñ–ï–ù–ù–Ø –¢–ï–°–¢–£ ==========
        let currentTest = null;
        let currentQ = 0;
        let answers = [];
        let timer = null;
        let timeLeft = 0;
        let confirmed = false;

        window.startTest = function(testId) {
            currentTest = tests.find(x => x.id === testId);
            if (!currentTest) return;
            currentQ = 0;
            answers = currentTest.questions.map(() => ({ selected: -1, freeText: '', confirmed: false }));
            confirmed = false;
            showView('test');
            renderQuestion();
        };

        function renderQuestion() {
            if (!currentTest) return;
            const wrap = document.getElementById('viewTest');
            const q = currentTest.questions[currentQ];
            const total = currentTest.questions.length;
            const pointsPerQ = (currentTest.maxScore / total);
            const progressPct = ((currentQ) / total * 100).toFixed(0);

            confirmed = answers[currentQ].confirmed;

            let answersHTML = '';
            if (q.answers && q.answers.length > 0) {
                answersHTML = q.answers.map((a, i) => {
                    let cls = '';
                    if (confirmed) {
                        if (a.correct) cls = 'correct';
                        else if (i === answers[currentQ].selected && !a.correct) cls = 'wrong';
                    } else if (i === answers[currentQ].selected) {
                        cls = 'selected';
                    }
                    return `<div class="answer-option ${cls}" onclick="${confirmed ? '' : `selectAnswer(${i})`}" style="${confirmed ? 'pointer-events:none;' : ''}">
                        <div class="ao-circle">${confirmed && a.correct ? '‚úì' : confirmed && i === answers[currentQ].selected && !a.correct ? '‚úó' : ''}</div>
                        <span>${a.text}</span>
                    </div>`;
                }).join('');
            }

            let freeHTML = '';
            if (q.hasFreeAnswer) {
                freeHTML = `
                    <div style="margin-top:15px;">
                        <div class="free-answer-label">‚úç –í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–≤—ñ–ª—å–Ω–∞ —Ñ–æ—Ä–º–∞):</div>
                        <textarea class="free-answer-input" id="freeInput" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." ${confirmed ? 'disabled' : ''} oninput="updateFreeAnswer(this.value)">${answers[currentQ].freeText || ''}</textarea>
                    </div>
                `;
            }

            let btnText = confirmed ? (currentQ < total - 1 ? '–ù–ê–°–¢–£–ü–ù–ï –ü–ò–¢–ê–ù–ù–Ø ‚Üí' : 'üìä –ó–ê–í–ï–†–®–ò–¢–ò –¢–ï–°–¢') : '–ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –í–Ü–î–ü–û–í–Ü–î–¨';
            let canConfirm = true;
            if (!confirmed) {
                const hasChoice = q.answers && q.answers.length > 0 && answers[currentQ].selected >= 0;
                const hasFree = q.hasFreeAnswer && (answers[currentQ].freeText || '').trim().length > 0;
                if (q.answers && q.answers.length > 0 && !q.hasFreeAnswer) canConfirm = hasChoice;
                else if (q.hasFreeAnswer && (!q.answers || q.answers.length === 0)) canConfirm = hasFree;
                else canConfirm = hasChoice || hasFree;
            }

            wrap.innerHTML = `
                <div class="test-progress-wrap fade-in">
                    <div class="tp-header">
                        <div class="tp-counter">–ü–∏—Ç–∞–Ω–Ω—è ${currentQ + 1} / ${total}</div>
                        <div class="tp-timer" id="timerDisplay">${confirmed ? '‚úì' : '‚è± --'}</div>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" style="width:${progressPct}%"></div>
                    </div>
                    <div class="question-card">
                        <div class="q-points">üíé ${pointsPerQ.toFixed(1)} –±–∞–ª—ñ–≤ –∑–∞ –ø–∏—Ç–∞–Ω–Ω—è</div>
                        <div class="q-text">${q.text}</div>
                        ${answersHTML}
                        ${freeHTML}
                    </div>
                    <button class="btn-confirm-answer" id="btnConfirm" onclick="${confirmed ? 'nextQuestion()' : 'confirmAnswer()'}" ${canConfirm ? '' : 'disabled'}>${btnText}</button>
                </div>
            `;

            if (!confirmed) startTimer();
            else clearTimerInterval();
        }

        window.selectAnswer = function(i) {
            if (confirmed) return;
            answers[currentQ].selected = i;
            renderQuestion();
        };

        window.updateFreeAnswer = function(val) {
            answers[currentQ].freeText = val;
            const btn = document.getElementById('btnConfirm');
            const q = currentTest.questions[currentQ];
            const hasChoice = q.answers && q.answers.length > 0 && answers[currentQ].selected >= 0;
            const hasFree = q.hasFreeAnswer && val.trim().length > 0;
            if (q.answers && q.answers.length > 0 && !q.hasFreeAnswer) btn.disabled = !hasChoice;
            else if (q.hasFreeAnswer && (!q.answers || q.answers.length === 0)) btn.disabled = !hasFree;
            else btn.disabled = !(hasChoice || hasFree);
        };

        window.confirmAnswer = function() {
            clearTimerInterval();
            answers[currentQ].confirmed = true;
            confirmed = true;
            renderQuestion();
        };

        window.nextQuestion = function() {
            if (currentQ < currentTest.questions.length - 1) {
                currentQ++;
                confirmed = false;
                renderQuestion();
            } else {
                finishTest();
            }
        };

        function startTimer() {
            clearTimerInterval();
            timeLeft = currentTest.timePerQ;
            updateTimerDisplay();
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearTimerInterval();
                    answers[currentQ].confirmed = true;
                    confirmed = true;
                    renderQuestion();
                }
            }, 1000);
        }

        function clearTimerInterval() { if (timer) { clearInterval(timer); timer = null; } }

        function updateTimerDisplay() {
            const el = document.getElementById('timerDisplay');
            if (!el) return;
            el.innerText = '‚è± ' + timeLeft + '—Å';
            if (timeLeft <= 10) el.classList.add('danger');
            else el.classList.remove('danger');
        }

        // ========== 16.9: –§–Ü–ù–Ü–® –¢–ï–°–¢–£ ==========
        function finishTest() {
            clearTimerInterval();
            const total = currentTest.questions.length;
            const pointsPerQ = currentTest.maxScore / total;
            let autoScore = 0;
            let hasFreeAnswers = false;
            const details = [];

            currentTest.questions.forEach((q, i) => {
                const ans = answers[i];
                let earnedPoints = 0;
                let isCorrect = false;
                let yourAnswer = '–ù–µ –≤—ñ–¥–ø–æ–≤—ñ–≤';
                let correctAnswer = '';
                let isFree = false;

                if (q.answers && q.answers.length > 0) {
                    const correctIdx = q.answers.findIndex(a => a.correct);
                    correctAnswer = correctIdx >= 0 ? q.answers[correctIdx].text : '';
                    if (ans.selected >= 0) {
                        yourAnswer = q.answers[ans.selected].text;
                        if (q.answers[ans.selected].correct) {
                            earnedPoints = pointsPerQ;
                            isCorrect = true;
                        }
                    }
                }

                if (q.hasFreeAnswer) {
                    hasFreeAnswers = true;
                    isFree = true;
                    if (ans.freeText && ans.freeText.trim()) {
                        yourAnswer = (yourAnswer !== '–ù–µ –≤—ñ–¥–ø–æ–≤—ñ–≤' ? yourAnswer + ' | –í—ñ–ª—å–Ω–∞: ' : '') + ans.freeText.trim();
                    }
                    // –í—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å - –±–∞–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á —è–∫—â–æ —Ü–µ —î–¥–∏–Ω–∏–π —Å–ø–æ—Å—ñ–± –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
                    if (!q.answers || q.answers.length === 0) {
                        isCorrect = null; // pending
                        earnedPoints = 0;
                    }
                }

                autoScore += earnedPoints;
                details.push({ question: q.text, yourAnswer, correctAnswer, earned: earnedPoints, max: pointsPerQ, isCorrect, isFree, freeText: ans.freeText || '' });
            });

            autoScore = Math.round(autoScore * 100) / 100;
            const percent = Math.round((autoScore / currentTest.maxScore) * 100);
            const passed = !hasFreeAnswers && percent >= currentTest.passPercent;
            const status = hasFreeAnswers ? 'pending' : (passed ? 'passed' : 'failed');

            const result = {
                id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                testId: currentTest.id,
                testName: currentTest.name,
                userName: userName,
                score: autoScore,
                maxScore: currentTest.maxScore,
                percent: percent,
                passPercent: currentTest.passPercent,
                status: status,
                details: details,
                date: new Date().toISOString(),
                hasFreeAnswers: hasFreeAnswers,
                reviewedScore: null,
                reviewComment: ''
            };

            results.push(result);
            saveResults();

            // Webhook
            sendWebhook({
                userName: userName,
                testName: currentTest.name,
                score: autoScore,
                maxScore: currentTest.maxScore,
                percent: percent,
                passed: status === 'passed',
                date: new Date().toLocaleString('uk'),
                hasFree: hasFreeAnswers
            });

            // –ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ–≤
            if (hasFreeAnswers) {
                addNotif(`‚è≥ ${userName} –∑–¥–∞–≤ —Ç–µ—Å—Ç "${currentTest.name}" ‚Äî –ø–æ—Ç—Ä–µ–±—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤—ñ–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π!`);
            }

            renderResult(result);
            showView('result');
            updateReviewBadge();
        }

        // ========== 16.10: –†–ï–ù–î–ï–† –†–ï–ó–£–õ–¨–¢–ê–¢–£ ==========
        function renderResult(r) {
            const wrap = document.getElementById('viewResult');
            const isPassed = r.status === 'passed';
            const isPending = r.status === 'pending';
            const heroClass = isPassed ? '' : 'failed';

            let statusText = isPassed ? '‚úÖ –¢–ï–°–¢ –°–ö–õ–ê–î–ï–ù–û!' : isPending ? '‚è≥ –û–ß–Ü–ö–£–Ñ –ü–ï–†–ï–í–Ü–†–ö–ò' : '‚ùå –¢–ï–°–¢ –ù–ï –°–ö–õ–ê–î–ï–ù–û';
            let subText = isPassed
                ? `–í—ñ—Ç–∞—î–º–æ! –í–∏ –Ω–∞–±—Ä–∞–ª–∏ ${r.score} –∑ ${r.maxScore} –±–∞–ª—ñ–≤ (${r.percent}%)`
                : isPending
                    ? `–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${r.score}/${r.maxScore} (${r.percent}%). –í—ñ–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á.`
                    : `–í–∏ –Ω–∞–±—Ä–∞–ª–∏ ${r.score} –∑ ${r.maxScore} –±–∞–ª—ñ–≤ (${r.percent}%). –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π: ${r.passPercent}%`;

            let detailsHTML = r.details.map((d, i) => {
                let icon = d.isCorrect === true ? '‚úÖ' : d.isCorrect === null ? '‚è≥' : '‚ùå';
                return `
                <div class="rd-item">
                    <div class="rd-q">${icon} ${i + 1}. ${d.question}</div>
                    <div class="rd-your ${d.isCorrect === false ? 'rd-wrong-text' : ''}">–í–∞—à–∞: ${d.yourAnswer}</div>
                    ${d.correctAnswer ? `<div class="rd-correct">–ü—Ä–∞–≤–∏–ª—å–Ω–∞: ${d.correctAnswer}</div>` : ''}
                    <div class="rd-points">${d.earned.toFixed(1)} / ${d.max.toFixed(1)} –±–∞–ª—ñ–≤</div>
                    ${d.isFree && d.isCorrect === null ? '<div class="rd-pending">‚è≥ –û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á–µ–º</div>' : ''}
                </div>`;
            }).join('');

            wrap.innerHTML = `
                <div class="result-wrap fade-in">
                    <div class="result-hero ${heroClass}">
                        <div class="result-circle">${r.percent}%</div>
                        <div class="result-status">${statusText}</div>
                        <div class="result-sub">${subText}</div>
                    </div>
                    <div class="result-details-card">
                        <div style="font-size:14px;font-weight:800;margin-bottom:15px;color:var(--primary-bright);">üìã –î–ï–¢–ê–õ–¨–ù–ò–ô –†–û–ó–ë–Ü–†</div>
                        ${detailsHTML}
                    </div>
                    <div class="result-btns">
                        <button class="btn-retry" onclick="openIntro('${r.testId}')">üîÑ –ü–†–û–ô–¢–ò –ó–ù–û–í–£</button>
                        <button class="btn-home" onclick="showView('home')">üè† –ù–ê –ì–û–õ–û–í–ù–£</button>
                    </div>
                </div>
            `;
        }

        // ========== 16.11: –°–¢–í–û–†–ï–ù–ù–Ø –¢–ï–°–¢–£ ==========
        let createQuestions = [];

        function initCreateForm() {
            createQuestions = [{ text: '', answers: [{ text: '', correct: true }, { text: '', correct: false }], hasFreeAnswer: false }];
            document.getElementById('ctName').value = '';
            document.getElementById('ctDesc').value = '';
            document.getElementById('ctEmoji').value = 'üìù';
            document.getElementById('ctMaxScore').value = '12';
            document.getElementById('ctPassScore').value = '60';
            document.getElementById('passVal').innerText = '60%';
            document.getElementById('ctTime').value = '45';
            renderCreateQuestions();
        }

        function renderCreateQuestions() {
            const cont = document.getElementById('questionsContainer');
            cont.innerHTML = createQuestions.map((q, qi) => {
                let answersHTML = q.answers.map((a, ai) => `
                    <div class="answer-row">
                        <div class="correct-radio ${a.correct ? 'active' : ''}" onclick="setCorrectAnswer(${qi}, ${ai})" title="–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å"></div>
                        <input type="text" value="${a.text}" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ..." onchange="updateAnswerText(${qi}, ${ai}, this.value)">
                        ${q.answers.length > 1 ? `<button class="del-ans-btn" onclick="removeAnswer(${qi}, ${ai})">‚úï</button>` : ''}
                    </div>
                `).join('');

                return `
                <div class="question-block">
                    <div class="qb-header">
                        <span class="qb-num">–ü–ò–¢–ê–ù–ù–Ø #${qi + 1}</span>
                        ${createQuestions.length > 1 ? `<button class="qb-del" onclick="removeQuestion(${qi})">–í–ò–î–ê–õ–ò–¢–ò</button>` : ''}
                    </div>
                    <div class="form-group">
                        <input type="text" class="form-input" value="${q.text}" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è..." onchange="updateQuestionText(${qi}, this.value)">
                    </div>
                    <div class="form-label" style="margin-bottom:8px;">–í–ê–†–Ü–ê–ù–¢–ò –í–Ü–î–ü–û–í–Ü–î–ï–ô (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å ‚óâ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó):</div>
                    ${answersHTML}
                    <button class="add-answer-btn" onclick="addAnswer(${qi})">+ –î–û–î–ê–¢–ò –í–ê–†–Ü–ê–ù–¢</button>
                    <div class="free-answer-toggle" onclick="toggleFreeAnswer(${qi})">
                        <div class="toggle-box ${q.hasFreeAnswer ? 'on' : ''}"></div>
                        <span>‚úç –î–æ–∑–≤–æ–ª–∏—Ç–∏ –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å (—Ç–µ–∫—Å—Ç–æ–≤–µ –ø–æ–ª–µ)</span>
                    </div>
                </div>`;
            }).join('');
        }

        window.addQuestionBlock = function() {
            createQuestions.push({ text: '', answers: [{ text: '', correct: true }, { text: '', correct: false }], hasFreeAnswer: false });
            renderCreateQuestions();
        };
        window.removeQuestion = function(qi) {
            createQuestions.splice(qi, 1);
            renderCreateQuestions();
        };
        window.updateQuestionText = function(qi, val) { createQuestions[qi].text = val; };
        window.updateAnswerText = function(qi, ai, val) { createQuestions[qi].answers[ai].text = val; };
        window.setCorrectAnswer = function(qi, ai) {
            createQuestions[qi].answers.forEach((a, i) => a.correct = (i === ai));
            renderCreateQuestions();
        };
        window.addAnswer = function(qi) {
            createQuestions[qi].answers.push({ text: '', correct: false });
            renderCreateQuestions();
        };
        window.removeAnswer = function(qi, ai) {
            if (createQuestions[qi].answers.length <= 1) return;
            const wasCorrect = createQuestions[qi].answers[ai].correct;
            createQuestions[qi].answers.splice(ai, 1);
            if (wasCorrect && createQuestions[qi].answers.length > 0) createQuestions[qi].answers[0].correct = true;
            renderCreateQuestions();
        };
        window.toggleFreeAnswer = function(qi) {
            createQuestions[qi].hasFreeAnswer = !createQuestions[qi].hasFreeAnswer;
            renderCreateQuestions();
        };

        window.createTest = function() {
            const name = document.getElementById('ctName').value.trim();
            const emoji = document.getElementById('ctEmoji').value.trim() || 'üìù';
            const desc = document.getElementById('ctDesc').value.trim();
            const cat = document.getElementById('ctCat').value;
            const timePerQ = parseInt(document.getElementById('ctTime').value) || 45;
            const maxScore = parseInt(document.getElementById('ctMaxScore').value) || 12;
            const passPercent = parseInt(document.getElementById('ctPassScore').value) || 60;

            if (!name) { alert('–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–µ—Å—Ç—É!'); return; }
            if (createQuestions.length === 0) { alert('–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è!'); return; }

            for (let i = 0; i < createQuestions.length; i++) {
                const q = createQuestions[i];
                if (!q.text.trim()) { alert(`–ü–∏—Ç–∞–Ω–Ω—è #${i + 1}: –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç!`); return; }
                if (q.answers.length > 0) {
                    for (let j = 0; j < q.answers.length; j++) {
                        if (!q.answers[j].text.trim()) { alert(`–ü–∏—Ç–∞–Ω–Ω—è #${i + 1}, –≤–∞—Ä—ñ–∞–Ω—Ç #${j + 1}: –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç!`); return; }
                    }
                }
                if (!q.hasFreeAnswer && q.answers.length === 0) {
                    alert(`–ü–∏—Ç–∞–Ω–Ω—è #${i + 1}: –¥–æ–¥–∞–π—Ç–µ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –∞–±–æ —É–≤—ñ–º–∫–Ω—ñ—Ç—å –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å!`); return;
                }
            }

            const newTest = {
                id: Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
                name, emoji, desc, category: cat, timePerQ, maxScore, passPercent,
                createdAt: new Date().toISOString(),
                questions: createQuestions.map(q => ({
                    text: q.text.trim(),
                    answers: q.answers.map(a => ({ text: a.text.trim(), correct: a.correct })),
                    hasFreeAnswer: q.hasFreeAnswer
                }))
            };

            tests.push(newTest);
            saveTests();
            addNotif(`üìù –°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π —Ç–µ—Å—Ç: "${name}"`);
            alert('‚úÖ –¢–µ—Å—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!');
            showView('home');
        };

        // ========== 16.12: –ü–ï–†–ï–í–Ü–†–ö–ê (–†–ï–í–Æ) ==========
        function getPendingResults() {
            return results.filter(r => r.status === 'pending');
        }

        function updateReviewBadge() {
            const count = getPendingResults().length;
            const badge = document.getElementById('reviewBadge');
            if (count > 0) { badge.innerText = count; badge.style.display = 'inline'; }
            else { badge.style.display = 'none'; }
        }

        function renderReview() {
            const list = document.getElementById('reviewList');
            const pending = getPendingResults();
            if (pending.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:var(--text-gray);padding:50px;font-size:14px;">‚úÖ –ù–µ–º–∞—î —Ç–µ—Å—Ç—ñ–≤ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É</div>';
                return;
            }

            list.innerHTML = pending.map(r => {
                const freeDetails = r.details.filter(d => d.isFree);
                let questionsHTML = r.details.map((d, i) => {
                    let html = `
                        <div class="review-q">
                            <div class="review-q-text">${i + 1}. ${d.question}</div>
                            <div class="review-q-answer">–í—ñ–¥–ø–æ–≤—ñ–¥—å: ${d.yourAnswer}</div>
                    `;
                    if (d.isFree && d.freeText) {
                        html += `<div class="review-q-free">‚úç –í—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: ${d.freeText}</div>`;
                    }
                    if (d.isCorrect === true) html += '<div style="font-size:12px;color:#22c55e;margin-top:4px;">‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ: +' + d.earned.toFixed(1) + ' –±.</div>';
                    else if (d.isCorrect === false) html += '<div style="font-size:12px;color:var(--danger);margin-top:4px;">‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ: 0 –±.</div>';
                    else html += '<div style="font-size:12px;color:var(--warning);margin-top:4px;">‚è≥ –û—á—ñ–∫—É—î –æ—Ü—ñ–Ω–∫–∏</div>';
                    html += '</div>';
                    return html;
                }).join('');

                return `
                <div class="review-card fade-in">
                    <div class="review-header">
                        <div>
                            <div class="review-user">üë§ ${r.userName}</div>
                            <div class="review-test-name">üìã ${r.testName}</div>
                        </div>
                        <div>
                            <div class="review-date">${new Date(r.date).toLocaleString('uk')}</div>
                            <div style="font-size:12px;color:var(--text-gray);margin-top:4px;">–ê–≤—Ç–æ: ${r.score}/${r.maxScore} (${r.percent}%)</div>
                        </div>
                    </div>
                    ${questionsHTML}
                    <div style="margin-top:15px;padding-top:15px;border-top:1px solid rgba(255,255,255,0.1);">
                        <div style="display:flex;align-items:center;gap:15px;margin-bottom:15px;flex-wrap:wrap;">
                            <span style="font-size:13px;font-weight:700;">–§—ñ–Ω–∞–ª—å–Ω–∏–π –±–∞–ª:</span>
                            <input type="number" class="manual-score-input" id="reviewScore_${r.id}" value="${r.score}" min="0" max="${r.maxScore}" step="0.5">
                            <span style="font-size:12px;color:var(--text-gray);">–∑ ${r.maxScore}</span>
                        </div>
                        <div class="review-actions">
                            <button class="btn-approve" onclick="approveResult('${r.id}')">‚úÖ –ó–ê–†–ê–•–£–í–ê–¢–ò</button>
                            <button class="btn-reject" onclick="rejectResult('${r.id}')">‚ùå –ù–ï –ó–ê–†–ê–•–£–í–ê–¢–ò</button>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        window.approveResult = function(resultId) {
            const r = results.find(x => x.id === resultId);
            if (!r) return;
            const scoreInput = document.getElementById('reviewScore_' + resultId);
            const finalScore = parseFloat(scoreInput.value) || 0;
            const finalPercent = Math.round((finalScore / r.maxScore) * 100);
            r.score = finalScore;
            r.percent = finalPercent;
            r.status = finalPercent >= r.passPercent ? 'passed' : 'failed';
            r.reviewedScore = finalScore;
            saveResults();
            addNotif(`‚úÖ –¢–µ—Å—Ç "${r.testName}" –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –¥–ª—è ${r.userName}: ${finalScore}/${r.maxScore} ‚Äî ${r.status === 'passed' ? '–°–ö–õ–ê–í' : '–ù–ï –°–ö–õ–ê–í'}`);

            // Webhook –ø—Ä–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
            sendWebhook({
                userName: r.userName, testName: r.testName + ' (–ü–ï–†–ï–í–Ü–†–ï–ù–û)',
                score: finalScore, maxScore: r.maxScore, percent: finalPercent,
                passed: r.status === 'passed',
                date: new Date().toLocaleString('uk'), hasFree: false
            });

            renderReview();
            updateReviewBadge();
        };

        window.rejectResult = function(resultId) {
            const r = results.find(x => x.id === resultId);
            if (!r) return;
            r.status = 'failed';
            r.score = 0;
            r.percent = 0;
            r.reviewedScore = 0;
            saveResults();
            addNotif(`‚ùå –¢–µ—Å—Ç "${r.testName}" –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ –¥–ª—è ${r.userName}`);
            sendWebhook({
                userName: r.userName, testName: r.testName + ' (–í–Ü–î–•–ò–õ–ï–ù–û)',
                score: 0, maxScore: r.maxScore, percent: 0,
                passed: false, date: new Date().toLocaleString('uk'), hasFree: false
            });
            renderReview();
            updateReviewBadge();
        };

        // ========== 16.13: –ö–ï–†–£–í–ê–ù–ù–Ø ==========
        function renderManage() {
            const list = document.getElementById('manageList');
            list.innerHTML = tests.map(t => {
                const qCount = t.questions.length;
                const resCount = results.filter(r => r.testId === t.id).length;
                return `
                <div class="manage-test-item">
                    <div class="mti-info">
                        <div class="mti-name">${t.emoji || 'üìù'} ${t.name}</div>
                        <div class="mti-meta">${qCount} –ø–∏—Ç–∞–Ω—å ¬∑ ${resCount} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ ¬∑ –ú–∞–∫—Å: ${t.maxScore} –±. ¬∑ –ü—Ä–æ—Ö—ñ–¥: ${t.passPercent}%</div>
                    </div>
                    <div class="mti-actions">
                        <button class="mti-btn del" onclick="deleteTest('${t.id}')">üóë –í–ò–î–ê–õ–ò–¢–ò</button>
                    </div>
                </div>`;
            }).join('') || '<p style="color:var(--text-gray);text-align:center;padding:30px;">–¢–µ—Å—Ç—ñ–≤ –Ω–µ–º–∞—î</p>';
        }

        window.deleteTest = function(id) {
            if (!confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–µ—Å—Ç —Ç–∞ –≤—Å—ñ –π–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏?')) return;
            tests = tests.filter(t => t.id !== id);
            results = results.filter(r => r.testId !== id);
            saveTests();
            saveResults();
            renderManage();
            updateReviewBadge();
        };

        // ========== 16.14: –ù–ê–°–¢–†–û–ô–ö–ò ==========
        function renderSettings() {
            document.getElementById('webhookUrl').value = webhook || '';
            document.getElementById('userNameInput').value = userName || '';
            const cList = document.getElementById('checkersList');
            cList.innerHTML = checkers.map(c => `
                <div class="checker-item">
                    <span class="ci-name">üë§ ${c}</span>
                    <button class="ci-remove" onclick="removeChecker('${c}')">–í–ò–î–ê–õ–ò–¢–ò</button>
                </div>
            `).join('') || '<p style="color:var(--text-gray);font-size:12px;padding:10px;">–ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ–≤ –Ω–µ –¥–æ–¥–∞–Ω–æ</p>';
        }

        // ========== 16.15: –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø ==========
        function init() {
            // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —Ä–æ–ª—å
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active-role'));
            document.getElementById(currentRole==='admin'?'rAdmin':currentRole==='instructor'?'rInstr':'rFighter').classList.add('active-role');
            updateNavVisibility();
            renderNotifs();
            showView('home');
        }

        init();
    })();
    </script>
</body>
</html>
