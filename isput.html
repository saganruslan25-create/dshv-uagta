<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{--p:#00ff44;--pb:#b8ffd0;--pg:rgba(0,255,68,0.6);--pd:rgba(0,255,68,0.12);--bg:#030507;--card:rgba(8,12,18,0.85);--gl:rgba(0,255,68,0.25);--dn:#ff4757;--dg:rgba(255,71,87,0.5);--wn:#ffa502;--wg:rgba(255,165,2,0.4);--inf:#3b82f6;--ig:rgba(59,130,246,0.4);--ok:#2ed573;--og:rgba(46,213,115,0.4);--tx:#e2e8f0;--td:#64748b;--tw:#fff;--br:rgba(0,255,68,0.18);--bh:rgba(0,255,68,0.5)}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:'Inter',sans-serif;min-height:100vh;overflow-x:hidden;user-select:none;-webkit-user-select:none}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse 800px 600px at 10% 40%,rgba(0,255,68,0.08),transparent),radial-gradient(ellipse 600px 500px at 90% 20%,rgba(0,255,68,0.06),transparent),radial-gradient(ellipse 900px 400px at 50% 90%,rgba(0,255,68,0.04),transparent);pointer-events:none;z-index:0}
input,textarea,select{user-select:text!important;-webkit-user-select:text!important}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--p);border-radius:10px}

@keyframes fadeUp{from{opacity:0;transform:translateY(25px)}to{opacity:1;transform:translateY(0)}}
@keyframes scaleIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}
@keyframes glowPulse{0%,100%{box-shadow:0 0 15px var(--pg),0 0 30px rgba(0,255,68,0.15)}50%{box-shadow:0 0 30px var(--pg),0 0 70px rgba(0,255,68,0.3)}}
@keyframes shake{0%,100%{transform:translateX(0)}15%,45%,75%{transform:translateX(-6px)}30%,60%,90%{transform:translateX(6px)}}
@keyframes shimmer{0%{left:-100%}100%{left:200%}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
@keyframes neonText{0%,100%{text-shadow:0 0 7px var(--p),0 0 15px var(--p),0 0 30px rgba(0,255,68,0.4)}50%{text-shadow:0 0 14px var(--p),0 0 30px var(--p),0 0 60px rgba(0,255,68,0.6),0 0 90px rgba(0,255,68,0.3)}}
@keyframes timerPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
@keyframes borderGlow{0%,100%{border-color:rgba(0,255,68,0.2)}50%{border-color:rgba(0,255,68,0.6)}}

/* ===== HEADER ===== */
header{display:flex;justify-content:space-between;align-items:center;padding:14px 4%;background:rgba(3,5,7,0.95);border-bottom:1px solid var(--br);position:sticky;top:0;z-index:1000;backdrop-filter:blur(30px)}
header::after{content:'';position:absolute;bottom:-1px;left:0;width:100%;height:2px;background:linear-gradient(90deg,transparent,var(--p),transparent);opacity:0.7}
.logo{display:flex;align-items:center;gap:12px;text-decoration:none;color:#000}
.logo-icon{background:var(--p);padding:8px 16px;border-radius:10px;font-weight:900;font-size:14px;letter-spacing:2px;box-shadow:0 0 25px var(--pg);transition:0.3s}
.logo:hover .logo-icon{box-shadow:0 0 35px var(--pg),0 0 70px rgba(0,255,68,0.3);transform:translateY(-2px)}
.logo-sub{font-size:11px;color:var(--p);font-weight:800;letter-spacing:3px;text-transform:uppercase}
.hdr-r{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
.hdr-nm{color:var(--pb);font-weight:800;font-size:14px}
.hdr-rl{padding:5px 14px;border-radius:8px;font-size:10px;font-weight:900;text-transform:uppercase;letter-spacing:1.5px;border:1px solid}
.rl-a{background:rgba(0,255,68,0.15);color:var(--p);border-color:var(--p);box-shadow:0 0 15px rgba(0,255,68,0.25)}
.rl-i{background:rgba(255,165,2,0.12);color:var(--wn);border-color:var(--wn)}
.rl-f{background:rgba(100,116,139,0.12);color:var(--td);border-color:rgba(100,116,139,0.3)}

/* ===== NAVIGATION ‚Äî LARGE BUTTONS ===== */
.nav{display:flex;gap:8px;flex-wrap:wrap}
.nb{
  background:rgba(255,255,255,0.03);
  border:2px solid rgba(255,255,255,0.08);
  color:var(--td);
  padding:16px 30px;
  border-radius:14px;
  font-weight:800;
  cursor:pointer;
  font-size:14px;
  transition:all 0.3s ease;
  text-transform:uppercase;
  letter-spacing:1px;
  position:relative;
  overflow:hidden;
  min-width:160px;
  text-align:center;
}
.nb::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,68,0.08),transparent);transition:left 0.5s}
.nb:hover{border-color:var(--p);color:var(--pb);background:var(--pd);transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,255,68,0.25)}
.nb:hover::after{left:150%}
.nb:active{transform:translateY(0) scale(0.96)}
.nb.on{background:var(--p);color:#000;border-color:var(--p);box-shadow:0 0 30px var(--pg);font-weight:900}

/* ===== NOTIF ===== */
.nw{position:relative;cursor:pointer;padding:5px}
.bl{font-size:22px;transition:0.3s;filter:drop-shadow(0 0 8px var(--wn))}
.bl:hover{transform:scale(1.2) rotate(15deg)}
.bb{position:absolute;top:-4px;right:-4px;background:var(--dn);color:#fff;font-size:9px;font-weight:900;padding:2px 6px;border-radius:50%;border:2px solid var(--bg);display:none;animation:timerPulse 1.5s infinite}
#nP{position:absolute;top:42px;right:0;width:340px;background:rgba(8,12,20,0.98);border:1px solid var(--gl);border-radius:16px;display:none;flex-direction:column;z-index:2000;box-shadow:0 20px 60px rgba(0,0,0,0.9),0 0 40px rgba(0,255,68,0.1);overflow:hidden;animation:slideDown 0.25s}
.nh{padding:14px 18px;background:rgba(0,255,68,0.04);display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--br)}
.ni{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.02);cursor:pointer;transition:0.2s;font-size:12px}
.ni:hover{background:rgba(0,255,68,0.06)}
.ni.rd{opacity:0.3}

/* ===== MAIN ===== */
.mn{max-width:1200px;margin:0 auto;padding:35px 24px;position:relative;z-index:1}
.vw{display:none;animation:fadeUp 0.45s ease}.vw.on{display:block}

/* ===== SECTION TITLES ===== */
.st{font-size:18px;font-weight:900;color:var(--pb);margin-bottom:28px;display:flex;align-items:center;gap:12px;text-transform:uppercase;letter-spacing:2px}
.st::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,var(--br),transparent 80%)}

/* ===== STATS ===== */
.sts{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:35px}
.ss{background:var(--card);border:1px solid var(--br);border-radius:18px;padding:28px 18px;text-align:center;backdrop-filter:blur(10px);transition:all 0.35s;position:relative;overflow:hidden}
.ss::before{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,68,0.05),transparent);transition:left 0.6s}
.ss:hover{border-color:var(--bh);transform:translateY(-5px);box-shadow:0 10px 40px rgba(0,255,68,0.15)}
.ss:hover::before{left:150%}
.sv{font-size:38px;font-weight:900;margin-bottom:6px}
.sv.g{color:var(--p);text-shadow:0 0 20px var(--pg)}.sv.r{color:var(--dn);text-shadow:0 0 15px var(--dg)}.sv.y{color:var(--wn);text-shadow:0 0 15px var(--wg)}.sv.w{color:#fff}
.sl{font-size:10px;font-weight:700;color:var(--td);text-transform:uppercase;letter-spacing:2px}

/* ===== TEST CARDS ===== */
.tg{display:flex;flex-wrap:wrap;justify-content:center;gap:22px;margin-bottom:45px}
.tc{background:var(--card);border:1px solid var(--br);border-radius:22px;padding:35px 28px;width:320px;backdrop-filter:blur(10px);transition:all 0.4s;cursor:pointer;position:relative;overflow:hidden}
.tc::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--p),rgba(0,255,68,0.2),var(--p));opacity:0;transition:opacity 0.3s}
.tc::after{content:'';position:absolute;top:0;left:-80%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,255,68,0.04),transparent);transition:left 0.7s;pointer-events:none}
.tc:hover{border-color:var(--p);transform:translateY(-8px) scale(1.02);box-shadow:0 20px 60px rgba(0,255,68,0.18),0 0 0 1px rgba(0,255,68,0.3)}
.tc:hover::before{opacity:1}.tc:hover::after{left:150%}
.tc:active{transform:translateY(-3px) scale(0.99)}
.te{font-size:56px;margin-bottom:18px;display:block;animation:float 4s ease-in-out infinite}
.tc h3{font-size:17px;font-weight:800;margin-bottom:8px;color:var(--tw);line-height:1.3}
.tc p{font-size:12px;color:var(--td);margin-bottom:18px;line-height:1.6}
.tt{display:flex;gap:8px;flex-wrap:wrap}
.tg-i{font-size:10px;padding:5px 12px;border-radius:8px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
.tg-g{background:rgba(0,255,68,0.1);color:var(--p);border:1px solid rgba(0,255,68,0.2)}
.tg-y{background:rgba(255,165,2,0.1);color:var(--wn);border:1px solid rgba(255,165,2,0.2)}
.tg-b{background:rgba(59,130,246,0.1);color:var(--inf);border:1px solid rgba(59,130,246,0.2)}

/* ===== RESULTS TABLE ===== */
.tb{width:100%;border-collapse:collapse}
.tb th{text-align:left;padding:14px 16px;font-size:10px;color:var(--p);text-transform:uppercase;letter-spacing:1.5px;border-bottom:2px solid var(--br);font-weight:900}
.tb td{padding:13px 16px;font-size:12px;border-bottom:1px solid rgba(255,255,255,0.03)}
.tb tr{transition:0.25s}
.tb tr:hover td{background:rgba(0,255,68,0.03)}
.bd{padding:4px 12px;border-radius:7px;font-size:9px;font-weight:900;text-transform:uppercase;display:inline-block;letter-spacing:0.5px}
.bd-p{background:rgba(46,213,115,0.12);color:var(--ok);border:1px solid rgba(46,213,115,0.25)}
.bd-f{background:rgba(255,71,87,0.12);color:var(--dn);border:1px solid rgba(255,71,87,0.25)}
.bd-w{background:rgba(255,165,2,0.12);color:var(--wn);border:1px solid rgba(255,165,2,0.25)}
.bd-o{background:rgba(0,255,68,0.12);color:var(--p);border:1px solid rgba(0,255,68,0.25)}
.bd-r{background:rgba(255,71,87,0.12);color:var(--dn);border:1px solid rgba(255,71,87,0.25)}

/* ===== INTRO ===== */
.intr{max-width:620px;margin:55px auto;background:var(--card);border:1px solid var(--gl);border-radius:26px;padding:55px 45px;text-align:center;backdrop-filter:blur(10px);position:relative;overflow:hidden;box-shadow:0 25px 70px rgba(0,0,0,0.5),0 0 50px rgba(0,255,68,0.1);animation:borderGlow 3s infinite}
.intr::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--p),var(--wn),var(--p));background-size:200% 100%;animation:shimmer 4s linear infinite}
.intr .te{font-size:80px;margin-bottom:22px}
.intr h2{font-size:28px;font-weight:900;margin-bottom:10px;letter-spacing:-0.5px}
.is{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin:30px 0;text-align:center}
.ist{background:rgba(255,255,255,0.02);border:1px solid var(--br);border-radius:16px;padding:20px 14px;transition:0.3s}
.ist:hover{border-color:var(--bh);transform:translateY(-2px)}
.isv{font-size:24px;font-weight:900;margin-bottom:4px}
.isl{font-size:9px;color:var(--td);font-weight:700;text-transform:uppercase;letter-spacing:1.5px}

/* ===== QUIZ ===== */
.qz{max-width:750px;margin:25px auto}
.qp{width:100%;height:6px;background:rgba(255,255,255,0.04);border-radius:10px;margin-bottom:24px;overflow:hidden}
.qpf{height:100%;background:linear-gradient(90deg,var(--p),#00ff88,var(--p));background-size:200%;border-radius:10px;transition:width 0.5s;box-shadow:0 0 15px var(--pg);animation:shimmer 3s linear infinite}
.qh{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.qc{font-size:13px;color:var(--td);font-weight:700;text-transform:uppercase;letter-spacing:1.5px}
.qt{font-size:36px;font-weight:900;transition:0.3s}
.qt.ok{color:var(--p);text-shadow:0 0 20px var(--pg)}
.qt.wr{color:var(--wn);text-shadow:0 0 20px var(--wg);animation:timerPulse 0.8s infinite}
.qt.cr{color:var(--dn);text-shadow:0 0 20px var(--dg);animation:timerPulse 0.4s infinite}
.qd{background:var(--card);border:1px solid var(--gl);border-radius:22px;padding:35px;margin-bottom:22px;backdrop-filter:blur(10px);box-shadow:0 8px 30px rgba(0,0,0,0.35)}
.qd h3{font-size:17px;font-weight:700;line-height:1.7;white-space:pre-wrap;word-wrap:break-word}
.qa{display:flex;flex-direction:column;gap:12px;margin-bottom:22px}
.ab{background:rgba(255,255,255,0.02);border:2px solid rgba(255,255,255,0.06);border-radius:16px;padding:18px 22px;color:var(--tx);font-size:14px;font-weight:600;cursor:pointer;text-align:left;transition:all 0.3s;display:flex;align-items:center;gap:16px;position:relative;overflow:hidden}
.ab:hover{border-color:rgba(0,255,68,0.35);background:rgba(0,255,68,0.05);transform:translateX(6px)}
.ab:active{transform:scale(0.97)}
.ab.sl{border-color:var(--p);background:rgba(0,255,68,0.1);box-shadow:0 0 25px rgba(0,255,68,0.12)}
.al{width:42px;height:42px;border-radius:14px;background:rgba(255,255,255,0.04);display:flex;align-items:center;justify-content:center;font-weight:900;font-size:15px;color:var(--td);flex-shrink:0;border:1px solid rgba(255,255,255,0.08);transition:0.3s}
.ab.sl .al{background:var(--p);color:#000;border-color:var(--p);box-shadow:0 0 12px var(--pg)}

/* Free answer */
.fa{margin-top:16px}
.ft{display:flex;align-items:center;gap:12px;cursor:pointer;padding:16px 20px;border-radius:14px;border:2px dashed rgba(255,255,255,0.08);background:rgba(255,255,255,0.01);transition:0.3s;font-size:14px;color:var(--td);font-weight:700}
.ft:hover{border-color:var(--p);color:var(--pb)}
.ft.ac{border-color:var(--p);color:var(--p);background:rgba(0,255,68,0.06);border-style:solid}
.fi{width:100%;margin-top:12px;background:rgba(0,0,0,0.4);border:1px solid rgba(255,255,255,0.08);color:#fff;padding:16px;border-radius:14px;font-size:14px;outline:none;font-family:inherit;resize:vertical;min-height:90px;transition:0.3s}
.fi:focus{border-color:var(--p);box-shadow:0 0 18px rgba(0,255,68,0.15)}

/* ===== GRID TABLE (Google Forms style) ‚Äî NOW AS QUESTION TYPE ===== */
.gt{width:100%;overflow-x:auto;margin:15px 0}
.gt table{border-collapse:collapse;width:100%;min-width:400px}
.gt th,.gt td{padding:16px 14px;text-align:center;border:1px solid rgba(255,255,255,0.05);font-size:13px}
.gt th{color:var(--p);font-weight:800;background:rgba(0,255,68,0.05);font-size:11px;text-transform:uppercase;letter-spacing:1px}
.gt td:first-child{text-align:left;font-weight:700;color:var(--pb);background:rgba(0,255,68,0.02);min-width:160px;font-size:13px}
.gt .gr{width:26px;height:26px;border:2px solid rgba(255,255,255,0.15);border-radius:50%;cursor:pointer;margin:0 auto;transition:0.3s;position:relative}
.gt .gr:hover{border-color:var(--p);box-shadow:0 0 12px rgba(0,255,68,0.3);transform:scale(1.1)}
.gt .gr.on{border-color:var(--p);background:var(--p);box-shadow:0 0 15px var(--pg)}
.gt .gr.on::after{content:'‚úì';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#000;font-size:12px;font-weight:900}

/* ===== RESULT ===== */
.rs{max-width:680px;margin:40px auto;text-align:center;animation:scaleIn 0.5s}
.rc{width:170px;height:170px;border-radius:50%;margin:0 auto 28px;display:flex;flex-direction:column;align-items:center;justify-content:center;border:4px solid;position:relative}
.rc.ps{border-color:var(--p);box-shadow:0 0 50px var(--pg),0 0 100px rgba(0,255,68,0.2);animation:glowPulse 2.5s infinite}
.rc.fl{border-color:var(--dn);box-shadow:0 0 40px var(--dg)}
.rc.pd{border-color:var(--wn);box-shadow:0 0 40px var(--wg)}
.rsc{font-size:42px;font-weight:900}
.rmx{font-size:11px;color:var(--td);font-weight:700}
.rss{font-size:28px;font-weight:900;margin-bottom:10px}
.rss.ps{color:var(--p);animation:neonText 3s infinite}
.rss.fl{color:var(--dn);text-shadow:0 0 20px var(--dg)}
.rss.pd{color:var(--wn);text-shadow:0 0 20px var(--wg)}
.rd{background:var(--card);border:1px solid rgba(255,255,255,0.04);border-radius:16px;padding:20px;margin-bottom:12px;text-align:left;display:flex;align-items:flex-start;gap:14px;transition:0.25s}
.rd:hover{border-color:var(--br);transform:translateX(4px)}
.rm{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;font-weight:900}
.rm.ok{background:rgba(0,255,68,0.12);color:var(--p)}
.rm.no{background:rgba(255,71,87,0.12);color:var(--dn)}
.rm.wt{background:rgba(255,165,2,0.12);color:var(--wn)}

/* ===== BUTTONS ‚Äî LARGE, FULL WIDTH WHERE NEEDED ===== */
.btn{
  padding:18px 36px;
  border:none;
  border-radius:16px;
  font-weight:900;
  font-size:15px;
  cursor:pointer;
  text-transform:uppercase;
  letter-spacing:1px;
  transition:all 0.3s;
  position:relative;
  overflow:hidden;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  min-width:200px;
}
.btn:active{transform:scale(0.95)}
.btn-g{background:var(--p);color:#000;box-shadow:0 5px 25px rgba(0,255,68,0.35)}
.btn-g:hover{background:var(--pb);box-shadow:0 10px 45px rgba(0,255,68,0.55);transform:translateY(-4px)}
.btn-r{background:rgba(255,71,87,0.08);border:2px solid var(--dn);color:var(--dn)}
.btn-r:hover{background:var(--dn);color:#fff;transform:translateY(-4px);box-shadow:0 10px 35px var(--dg)}
.btn-s{background:rgba(255,255,255,0.03);border:2px solid rgba(255,255,255,0.12);color:var(--tx)}
.btn-s:hover{border-color:var(--p);color:var(--pb);background:var(--pd);transform:translateY(-4px);box-shadow:0 8px 30px rgba(0,255,68,0.2)}
.btn-w{background:rgba(255,165,2,0.08);border:2px solid var(--wn);color:var(--wn)}
.btn-w:hover{background:var(--wn);color:#000;transform:translateY(-4px);box-shadow:0 10px 35px var(--wg)}
.btn-i{background:rgba(59,130,246,0.08);border:2px solid var(--inf);color:var(--inf)}
.btn-i:hover{background:var(--inf);color:#fff;transform:translateY(-4px);box-shadow:0 10px 35px var(--ig)}
.btn-dis{opacity:0.35;cursor:not-allowed!important;pointer-events:none}
.btn-full{width:100%;min-width:unset}
.bts{display:flex;gap:14px;justify-content:center;margin-top:28px;flex-wrap:wrap}

/* ===== FORMS ===== */
.cd{background:var(--card);border:1px solid var(--br);border-radius:20px;padding:35px;backdrop-filter:blur(10px);margin-bottom:22px}
.fr{margin-bottom:20px}
.fl{display:block;font-size:11px;color:var(--p);margin-bottom:8px;text-transform:uppercase;font-weight:900;letter-spacing:1.5px}
.fin{width:100%;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.08);color:#fff;padding:15px;border-radius:12px;font-size:14px;outline:none;font-family:inherit;transition:0.3s}
.fin:focus{border-color:var(--p);box-shadow:0 0 15px rgba(0,255,68,0.15)}
.fin::placeholder{color:rgba(255,255,255,0.15)}
.fg{display:grid;grid-template-columns:1fr 1fr;gap:16px}

/* ===== Q BUILDER ===== */
.qb{background:rgba(255,255,255,0.02);border:2px solid rgba(255,255,255,0.06);border-radius:20px;padding:28px;margin-bottom:18px;transition:0.3s;position:relative}
.qb.er{border-color:var(--dn)!important;animation:shake 0.5s;box-shadow:0 0 30px var(--dg)}
.qbn{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.qbl{font-size:14px;font-weight:900;color:var(--p);text-transform:uppercase;letter-spacing:1.5px}
.qbd{background:none;border:none;color:var(--dn);cursor:pointer;font-size:20px;opacity:0.4;transition:0.3s;padding:5px}
.qbd:hover{opacity:1;transform:scale(1.2)}

/* Type tabs inside question */
.tps{display:flex;gap:8px;margin-bottom:14px}
.tp{
  padding:12px 22px;
  border-radius:12px;
  font-size:13px;
  font-weight:800;
  cursor:pointer;
  border:2px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.02);
  color:var(--td);
  transition:0.3s;
  text-transform:uppercase;
  letter-spacing:0.5px;
}
.tp:hover{border-color:var(--p);color:var(--pb)}
.tp.on{background:var(--p);color:#000;border-color:var(--p);box-shadow:0 0 15px var(--pg)}

/* Options row */
.or{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.orc{width:28px;height:28px;border-radius:50%;border:2px solid rgba(255,255,255,0.15);cursor:pointer;transition:0.3s;flex-shrink:0;display:flex;align-items:center;justify-content:center}
.orc:hover{border-color:var(--p);box-shadow:0 0 8px rgba(0,255,68,0.3)}
.orc.on{border-color:var(--p);background:var(--p);box-shadow:0 0 12px var(--pg)}
.orc.on::after{content:'‚úì';color:#000;font-size:13px;font-weight:900}
.oin{flex:1;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.06);color:#fff;padding:12px 16px;border-radius:10px;font-size:13px;outline:none;font-family:inherit;transition:0.3s}
.oin:focus{border-color:var(--p)}
.odl{background:none;border:none;color:var(--dn);cursor:pointer;font-size:16px;opacity:0.3;transition:0.3s;padding:5px}
.odl:hover{opacity:1;transform:scale(1.2)}
.ao{
  background:none;
  border:2px dashed rgba(255,255,255,0.08);
  color:var(--td);
  padding:14px;
  border-radius:12px;
  cursor:pointer;
  font-size:13px;
  font-weight:800;
  width:100%;
  transition:0.3s;
  text-transform:uppercase;
  letter-spacing:0.5px;
  margin-top:8px;
}
.ao:hover{border-color:var(--p);color:var(--p);background:rgba(0,255,68,0.03)}

/* Free answer switch */
.fsw{display:flex;align-items:center;gap:12px;margin-top:14px;cursor:pointer;font-size:13px;color:var(--td);font-weight:700;transition:0.3s}
.fsw:hover{color:var(--p)}
.sw{width:42px;height:22px;border-radius:11px;background:rgba(255,255,255,0.08);position:relative;transition:0.3s;flex-shrink:0}
.sw.on{background:var(--p)}
.sw::after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:#fff;transition:0.3s;box-shadow:0 2px 4px rgba(0,0,0,0.3)}
.sw.on::after{left:22px}

/* Timer input */
.tr{display:flex;align-items:center;gap:12px;margin-top:14px}
.tr label{font-size:12px;color:var(--td);font-weight:700}
.ti{width:80px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.08);color:#fff;padding:8px 12px;border-radius:10px;font-size:13px;outline:none;font-family:inherit;text-align:center}

/* ===== TABLE BUILDER (inside question) ===== */
.tbb{margin-top:14px;border:1px solid rgba(255,255,255,0.06);border-radius:14px;padding:18px}
.tbb h5{font-size:11px;color:var(--wn);font-weight:800;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px}
.tbb .or{margin-bottom:8px}

/* ===== MANAGE CARDS ===== */
.mc{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:18px;padding:24px 28px;margin-bottom:14px;display:flex;justify-content:space-between;align-items:center;transition:0.35s;flex-wrap:wrap;gap:14px}
.mc:hover{border-color:var(--br);background:rgba(0,255,68,0.02);transform:translateX(4px)}

/* ===== SETTINGS ===== */
.sb{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:18px;padding:28px;margin-bottom:18px}
.sb h4{font-size:14px;font-weight:900;color:var(--pb);margin-bottom:16px;display:flex;align-items:center;gap:10px}
.ch{display:inline-flex;align-items:center;gap:6px;background:rgba(0,255,68,0.08);border:1px solid rgba(0,255,68,0.2);color:var(--pb);padding:8px 16px;border-radius:10px;font-size:12px;font-weight:700;margin:4px;transition:0.3s}
.ch:hover{border-color:var(--p);transform:translateY(-2px)}
.ch button{background:none;border:none;color:var(--dn);cursor:pointer;font-size:14px;margin-left:4px;transition:0.2s}
.ch button:hover{transform:scale(1.3)}
.ch-y{background:rgba(255,165,2,0.08);border-color:rgba(255,165,2,0.2);color:var(--wn)}
.pd{position:relative}
.pl{position:absolute;top:100%;left:0;right:0;background:rgba(8,12,20,0.98);border:1px solid var(--gl);border-radius:14px;max-height:220px;overflow-y:auto;z-index:100;display:none;box-shadow:0 15px 50px rgba(0,0,0,0.8),0 0 30px rgba(0,255,68,0.08)}
.pl.sh{display:block;animation:slideDown 0.2s}
.pi{padding:14px 18px;cursor:pointer;font-size:13px;display:flex;justify-content:space-between;transition:0.2s}
.pi:hover{background:rgba(0,255,68,0.06)}

/* ===== REVIEW ===== */
.rvc{background:var(--card);border:1px solid rgba(255,255,255,0.05);border-radius:20px;padding:30px;margin-bottom:18px;box-shadow:0 5px 25px rgba(0,0,0,0.3)}
.rvq{margin-bottom:16px;padding:18px;background:rgba(255,255,255,0.015);border-radius:14px;border-left:4px solid}
.rvq.ok{border-color:var(--p)}.rvq.no{border-color:var(--dn)}.rvq.wt{border-color:var(--wn)}

/* ===== RESPONSIVE ===== */
@media(max-width:900px){
  .nav{justify-content:center}
  .nb{padding:12px 18px;font-size:12px;min-width:130px}
}
@media(max-width:768px){
  .sts{grid-template-columns:1fr 1fr}
  .tg{flex-direction:column;align-items:stretch}
  .tc{width:100%}
  .hdr-r{gap:8px}
  .fg{grid-template-columns:1fr}
  #nP{right:-40px;width:300px}
  header{padding:12px 15px}
  .intr{margin:25px 15px;padding:30px 22px}
  .nb{padding:12px 14px;font-size:11px;min-width:100px}
  .btn{padding:14px 24px;font-size:13px;min-width:160px}
}
@media(max-width:480px){
  .sts{grid-template-columns:1fr}
  header{flex-direction:column;gap:12px}
  .btn{min-width:unset;width:100%}
  .bts{flex-direction:column}
  .nb{min-width:unset;flex:1}
}
</style>
</head>
<body>

<header>
<a href="cabinet.html" class="logo"><span class="logo-icon">‚öî –î–®–í</span><span class="logo-sub">–Ü—Å–ø–∏—Ç –¶–µ–Ω—Ç—Ä</span></a>
<div class="hdr-r">
<div class="nav" id="nav"></div>
<div class="nw" onclick="toggleN(event)"><span class="bl">üîî</span><div class="bb" id="bB">0</div>
<div id="nP"><div class="nh"><span style="font-size:10px;font-weight:900;color:var(--p)">–°–ü–û–í–Ü–©–ï–ù–ù–Ø</span><button onclick="clrN()" style="background:none;border:none;color:var(--td);font-size:9px;cursor:pointer;font-weight:800">–û–ß–ò–°–¢–ò–¢–ò</button></div><div id="nL"><div style="color:var(--td);text-align:center;padding:20px;font-size:11px">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div></div></div></div>
<span class="hdr-nm" id="hN">...</span>
<span class="hdr-rl" id="hR">...</span>
</div>
</header>

<div class="mn">
<div class="vw on" id="vH"><div class="sts" id="sts"></div><div class="st">üìã –î–æ—Å—Ç—É–ø–Ω—ñ —ñ—Å–ø–∏—Ç–∏</div><div class="tg" id="tG"></div><div class="st">üìä –ú–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</div><div id="mR"></div></div>
<div class="vw" id="vI"><div class="intr" id="iC"></div></div>
<div class="vw" id="vQ"><div class="qz" id="qB"></div></div>
<div class="vw" id="vR"><div class="rs" id="rB"></div></div>
<div class="vw" id="vC"><div class="st" id="cT">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç</div><div id="cF"></div></div>
<div class="vw" id="vRv"><div class="st">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</div><div id="rvL"></div></div>
<div class="vw" id="vM"><div class="st">‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è —ñ—Å–ø–∏—Ç–∞–º–∏</div><div id="mL"></div></div>
<div class="vw" id="vS"><div class="st">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div><div id="sC"></div></div>
<div class="vw" id="vA"><div class="st">üëë –ê–¥–º—ñ–Ω –ø—Ä–∞–≤–∞</div><div id="aC"></div></div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import{getAuth,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import{getFirestore,doc,getDoc,getDocs,collection}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const app=initializeApp({apiKey:"AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",authDomain:"dsv-gta.firebaseapp.com",projectId:"dsv-gta",storageBucket:"dsv-gta.firebasestorage.app",messagingSenderId:"661591588818",appId:"1:661591588818:web:a8e8dca3d061447e24d20b"});
const auth=getAuth(app),db=getFirestore(app);

let ME={name:'–ù–µ–≤—ñ–¥–æ–º–∏–π',role:'fighter',uid:''};
let allU=[];
let T=JSON.parse(localStorage.getItem('iT')||'[]');
let R=JSON.parse(localStorage.getItem('iR')||'[]');
let rv=JSON.parse(localStorage.getItem('iRv')||'[]');
let al=JSON.parse(localStorage.getItem('iAl')||'[]');
let wh=localStorage.getItem('iWh')||'';
let cT=null,cQ=0,an={},ti=null,tL=30,eI=null;
const sv=()=>{localStorage.setItem('iT',JSON.stringify(T));localStorage.setItem('iR',JSON.stringify(R));localStorage.setItem('iRv',JSON.stringify(rv));localStorage.setItem('iAl',JSON.stringify(al));localStorage.setItem('iWh',wh)};
const L='–ê–ë–í–ì“ê–î–ï–ñ–ó–ò–ö';
const isA=()=>ME.role==='admin'||al.includes(ME.name);
const isRv=()=>isA()||rv.includes(ME.name);
const gid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);
const dtt=()=>{const d=new Date();return d.toLocaleDateString('uk')+' '+d.toLocaleTimeString('uk',{hour:'2-digit',minute:'2-digit'})};

onAuthStateChanged(auth,async u=>{
if(!u){location.href='index.html';return}
ME.uid=u.uid;
try{const s=await getDoc(doc(db,'users',u.uid));if(s.exists()){const d=s.data();ME.name=d.name||'–ù–µ–≤—ñ–¥–æ–º–∏–π';ME.role=d.role||'fighter'}
const a=await getDocs(collection(db,'users'));allU=[];a.forEach(s=>{const d=s.data();allU.push({uid:s.id,name:d.name||'---',role:d.role||'fighter'})})}catch(e){}
document.getElementById('hN').textContent=ME.name;
const r=document.getElementById('hR');
if(ME.role==='admin'){r.textContent='–ê–î–ú–Ü–ù';r.className='hdr-rl rl-a'}
else if(ME.role==='instructor'){r.textContent='–Ü–ù–°–¢–†–£–ö–¢–û–†';r.className='hdr-rl rl-i'}
else{r.textContent='–ë–Ü–Ñ–¶–¨';r.className='hdr-rl rl-f'}
bNav();go('H');
});

// ===== NOTIFICATIONS =====
let nf=JSON.parse(localStorage.getItem('iNf')||'[]');
function aN(t){nf.unshift({text:t,time:dtt(),read:false});if(nf.length>20)nf.pop();localStorage.setItem('iNf',JSON.stringify(nf));rN()}
function rN(){const l=document.getElementById('nL'),b=document.getElementById('bB'),u=nf.filter(n=>!n.read).length;
if(u>0){b.textContent=u;b.style.display='block'}else b.style.display='none';
if(!nf.length){l.innerHTML='<div style="color:var(--td);text-align:center;padding:20px;font-size:11px">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>';return}
l.innerHTML=nf.map((n,i)=>`<div class="ni${n.read?' rd':''}" onclick="rdNf(${i})"><div style="font-size:11px;font-weight:600;margin-bottom:3px">${n.text}</div><div style="font-size:9px;color:var(--td)">${n.time}</div></div>`).join('')}
window.rdNf=i=>{nf[i].read=true;localStorage.setItem('iNf',JSON.stringify(nf));rN()};
window.clrN=()=>{nf=[];localStorage.setItem('iNf','[]');rN()};
window.toggleN=e=>{e.stopPropagation();const p=document.getElementById('nP');p.style.display=p.style.display==='flex'?'none':'flex'};
document.addEventListener('click',e=>{if(!e.target.closest('.nw'))document.getElementById('nP').style.display='none'});

// ===== WEBHOOK =====
async function sWh(embed){if(!wh)return;try{await fetch(wh,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[embed]})})}catch(e){}}
function whRes(r,t,rev){
const p=r.st==='approved'||(r.st==='auto'&&r.sc>=t.ps);
sWh({title:p?'‚úÖ  –Ü–°–ü–ò–¢ –°–ö–õ–ê–î–ï–ù–û':'‚ùå  –Ü–°–ü–ò–¢ –ù–ï –°–ö–õ–ê–î–ï–ù–û',color:p?0x00ff44:0xff4757,
fields:[
{name:'',value:'‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê',inline:false},
{name:'üë§  –ë–æ—î—Ü—å',value:'```'+r.userName+'```',inline:true},
{name:'üìù  –Ü—Å–ø–∏—Ç',value:'```'+t.nm+'```',inline:true},
{name:'\u200b',value:'\u200b',inline:false},
{name:'üìä  –†–µ–∑—É–ª—å—Ç–∞—Ç',value:'```'+r.sc+' / '+t.ms+' –±–∞–ª—ñ–≤```',inline:true},
{name:'üéØ  –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª',value:'```'+t.ps+' –±–∞–ª—ñ–≤```',inline:true},
{name:'\u200b',value:'\u200b',inline:false},
{name:'üìã  –°—Ç–∞—Ç—É—Å',value:p?'```‚úÖ –°–∫–ª–∞–¥–µ–Ω–æ```':'```‚ùå –ù–µ —Å–∫–ª–∞–¥–µ–Ω–æ```',inline:true},
{name:'üîç  –ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π',value:'```'+(rev||'SYSTEM')+'```',inline:true},
{name:'\u200b',value:'\u200b',inline:false},
{name:'üìÖ  –î–∞—Ç–∞',value:'```'+r.dt+'```',inline:false},
{name:'',value:'‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê',inline:false}
],footer:{text:'‚öî –î–®–í ‚Ä¢ –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† ‚Ä¢ '+(p?'–í—ñ—Ç–∞—î–º–æ!':'–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑')},timestamp:new Date().toISOString()})}
function whNtf(){if(!wh)return;sWh({title:'üì¢  –ù–û–í–ò–ô –Ü–°–ü–ò–¢ –ù–ê –ü–ï–†–ï–í–Ü–†–ö–£',color:0xffa502,description:'–ù–∞–¥—ñ–π—à–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ –≤—ñ–ª—å–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏.\n–ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ä—É—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞.',fields:[{name:'‚è≥ –°—Ç–∞—Ç—É—Å',value:'```–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏```',inline:true},{name:'üìÖ –ß–∞—Å',value:'```'+dtt()+'```',inline:true}],footer:{text:'‚öî –î–®–í ‚Ä¢ –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†'},timestamp:new Date().toISOString()})}

// ===== NAVIGATION =====
function bNav(){const n=document.getElementById('nav');
let h='<button class="nb on" onclick="go(\'H\')">üìã –Ü–°–ü–ò–¢–ò</button>';
if(isA())h+='<button class="nb" onclick="go(\'C\')">‚ûï –°–¢–í–û–†–ò–¢–ò –Ü–°–ü–ò–¢</button><button class="nb" onclick="go(\'M\')">‚öôÔ∏è –ö–ï–†–£–í–ê–ù–ù–Ø</button><button class="nb" onclick="go(\'S\')">üîß –ù–ê–°–¢–†–û–ô–ö–ò</button><button class="nb" onclick="go(\'A\')">üëë –ê–î–ú–Ü–ù–ò</button>';
if(isRv())h+='<button class="nb" onclick="go(\'Rv\')">üîç –ü–ï–†–ï–í–Ü–†–ö–ê</button>';
n.innerHTML=h}

const vm={'H':'vH','I':'vI','Q':'vQ','R':'vR','C':'vC','Rv':'vRv','M':'vM','S':'vS','A':'vA'};

window.go=v=>{
document.querySelectorAll('.vw').forEach(e=>e.classList.remove('on'));
document.getElementById(vm[v]).classList.add('on');
document.querySelectorAll('.nb').forEach(b=>b.classList.remove('on'));
const bs=document.querySelectorAll('.nb');
const idx={'H':0,'C':1,'M':2,'S':3,'A':4,'Rv':isA()?5:1};
if(bs[idx[v]])bs[idx[v]].classList.add('on');
if(v==='H')rH();if(v==='C')rC();if(v==='Rv')rRv();if(v==='M')rM();if(v==='S')rS();if(v==='A')rA();
window.scrollTo({top:0,behavior:'smooth'});
};

// ===== HOME =====
function rH(){
const my=R.filter(r=>r.uid===ME.uid);
const ps=my.filter(r=>{const t=T.find(x=>x.id===r.tid);return(r.st==='approved'||(r.st==='auto'&&t&&r.sc>=t.ps))}).length;
const fl=my.filter(r=>{const t=T.find(x=>x.id===r.tid);return(r.st==='rejected'||(r.st==='auto'&&t&&r.sc<t.ps))}).length;
const pd=my.filter(r=>r.st==='pending').length;
document.getElementById('sts').innerHTML=`<div class="ss"><div class="sv w">${T.length}</div><div class="sl">–Ü—Å–ø–∏—Ç—ñ–≤</div></div><div class="ss"><div class="sv g">${ps}</div><div class="sl">–°–∫–ª–∞–¥–µ–Ω–æ</div></div><div class="ss"><div class="sv r">${fl}</div><div class="sl">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div></div><div class="ss"><div class="sv y">${pd}</div><div class="sl">–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</div></div>`;

if(!T.length)document.getElementById('tG').innerHTML='<div style="color:var(--td);text-align:center;padding:60px;width:100%;font-size:14px">–Ü—Å–ø–∏—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</div>';
else document.getElementById('tG').innerHTML=T.map(t=>{
const tt=t.qs.reduce((s,q)=>s+(q.tm||30),0);
return`<div class="tc" onclick="goI('${t.id}')"><span class="te">${t.em||'üìù'}</span><h3>${t.nm}</h3><p>${t.ds||'–ë–µ–∑ –æ–ø–∏—Å—É'}</p><div class="tt"><span class="tg-i tg-g">‚ùì ${t.qs.length} –ø–∏—Ç–∞–Ω—å</span><span class="tg-i tg-y">üéØ ${t.ps}/${t.ms} –±.</span><span class="tg-i tg-b">‚è± ${tt}—Å</span></div></div>`}).join('');

if(!my.length)document.getElementById('mR').innerHTML='<div style="color:var(--td);text-align:center;padding:40px;font-size:13px">–í–∏ —â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —ñ—Å–ø–∏—Ç–∏</div>';
else{const rows=my.map(r=>{const t=T.find(x=>x.id===r.tid);const psc=t?t.ps:0;let sn,sc;
if(r.st==='pending'){sn='–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ';sc='bd-w'}else if(r.st==='approved'){sn='–°—Ö–≤–∞–ª–µ–Ω–æ';sc='bd-o'}else if(r.st==='rejected'){sn='–í—ñ–¥—Ö–∏–ª–µ–Ω–æ';sc='bd-r'}else{const p=r.sc>=psc;sn=p?'–°–∫–ª–∞–¥–µ–Ω–æ':'–ù–µ —Å–∫–ª–∞–¥–µ–Ω–æ';sc=p?'bd-p':'bd-f'}
return`<tr><td style="font-weight:700">${t?t.nm:'–í–∏–¥–∞–ª–µ–Ω–∏–π'}</td><td><b style="color:var(--p)">${r.sc}</b> / ${t?t.ms:'?'}</td><td><span class="bd ${sc}">${sn}</span></td><td>${r.rv||'SYSTEM'}</td><td style="color:var(--td)">${r.dt}</td></tr>`}).join('');
document.getElementById('mR').innerHTML=`<div style="overflow-x:auto"><table class="tb"><thead><tr><th>–Ü—Å–ø–∏—Ç</th><th>–ë–∞–ª–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π</th><th>–î–∞—Ç–∞</th></tr></thead><tbody>${rows}</tbody></table></div>`}
}

// ===== INTRO =====
window.goI=id=>{const t=T.find(x=>x.id===id);if(!t)return;
const hp=R.find(r=>r.tid===id&&r.uid===ME.uid&&r.st==='pending');
const ha=R.filter(r=>r.tid===id&&r.uid===ME.uid&&r.st==='auto');
if(hp){alert('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ!');return}
if(ha.length>0&&!R.find(r=>r.tid===id&&r.uid===ME.uid&&(r.st==='approved'||r.st==='rejected'))){alert('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –ª—é–¥–∏–Ω–æ—é!');return}
cT=t;const pp=t.qs.length?Math.round(t.ms/t.qs.length*100)/100:0;
const tt=t.qs.reduce((s,q)=>s+(q.tm||30),0);
document.getElementById('iC').innerHTML=`<span class="te">${t.em||'üìù'}</span><h2>${t.nm}</h2><p style="color:var(--td);font-size:13px;margin-bottom:8px">${t.ds||''}</p>
<div class="is"><div class="ist"><div class="isv" style="color:var(--p)">${t.qs.length}</div><div class="isl">–ü–∏—Ç–∞–Ω—å</div></div>
<div class="ist"><div class="isv" style="color:var(--wn)">${t.ps} / ${t.ms}</div><div class="isl">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª</div></div>
<div class="ist"><div class="isv" style="color:var(--inf)">‚è± ${tt}—Å</div><div class="isl">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å</div></div>
<div class="ist"><div class="isv" style="color:var(--ok)">${pp}</div><div class="isl">–ë–∞–ª—ñ–≤ –∑–∞ –ø–∏—Ç–∞–Ω–Ω—è</div></div></div>
<div class="bts"><button class="btn btn-g" onclick="stQ()">üöÄ –†–û–ó–ü–û–ß–ê–¢–ò –Ü–°–ü–ò–¢</button><button class="btn btn-s" onclick="go('H')">‚Üê –ü–û–í–ï–†–ù–£–¢–ò–°–¨ –ù–ê–ó–ê–î</button></div>`;
go('I');
};

// ===== QUIZ =====
window.stQ=()=>{cQ=0;an={};go('Q');rQ()};
function rQ(){if(!cT)return;const q=cT.qs[cQ],tot=cT.qs.length,pp=tot?Math.round(cT.ms/tot*100)/100:0;
const pr=((cQ)/tot)*100;clearInterval(ti);tL=q.tm||30;

let isGrid=q.tp==='grid';
let opts='';

if(isGrid){
const cols=q.cols||[];const rows=q.rows||[];
let th='<th style="min-width:160px"></th>';cols.forEach(c=>{th+=`<th>${c}</th>`});
let trs='';rows.forEach((r,ri)=>{let tds=`<td>${r}</td>`;cols.forEach((c,ci)=>{
const sel=an[cQ]?.type==='grid'&&an[cQ]?.value?.[ri]===ci;
tds+=`<td><div class="gr${sel?' on':''}" onclick="selG(${ri},${ci})"></div></td>`});
trs+=`<tr>${tds}</tr>`});
opts=`<div class="gt"><table><thead><tr>${th}</tr></thead><tbody>${trs}</tbody></table></div>`;
} else {
opts=q.opts.map((o,i)=>{const sel=an[cQ]?.type==='choice'&&an[cQ]?.value===i;
return`<div class="ab${sel?' sl':''}" onclick="selA(${i})"><div class="al">${L[i]||i+1}</div><div>${o.tx}</div></div>`}).join('');
}

const hf=q.af,fa=an[cQ]?.type==='free',fv=fa?an[cQ]?.value:'';
document.getElementById('qB').innerHTML=`<div class="qp"><div class="qpf" style="width:${pr}%"></div></div>
<div class="qh"><div class="qc">–ü–∏—Ç–∞–Ω–Ω—è ${cQ+1} –∑ ${tot} ¬∑ <span style="color:var(--p)">${pp} –±.</span></div><div class="qt ok" id="tm">${tL}</div></div>
<div class="qd"><h3>${q.tx}</h3></div><div class="qa">${opts}</div>
${hf?`<div class="fa"><div class="ft${fa?' ac':''}" onclick="tgF()">‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç–∏ —Å–≤—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç</div>${fa?`<textarea class="fi" id="fI" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">${fv}</textarea>`:''}</div>`:''}
<div class="bts">${cQ>0?'<button class="btn btn-s" onclick="prQ()">‚Üê –ù–ê–ó–ê–î</button>':''}<button class="btn btn-g" onclick="nxQ()">${cQ===tot-1?'üèÅ –ó–ê–í–ï–†–®–ò–¢–ò –Ü–°–ü–ò–¢':'–î–ê–õ–Ü ‚Üí'}</button></div>`;
stTm()}

function stTm(){const el=()=>document.getElementById('tm');ti=setInterval(()=>{tL--;const d=el();if(d){d.textContent=tL;
if(tL<=5){d.className='qt cr'}else if(tL<=10){d.className='qt wr'}else{d.className='qt ok'}}
if(tL<=0){clearInterval(ti);nxQ()}},1000)}

window.selA=i=>{an[cQ]={type:'choice',value:i};rQ()};
window.selG=(ri,ci)=>{if(!an[cQ]||an[cQ].type!=='grid')an[cQ]={type:'grid',value:{}};an[cQ].value[ri]=ci;rQ()};
window.tgF=()=>{if(an[cQ]?.type==='free')delete an[cQ];else an[cQ]={type:'free',value:''};rQ()};
window.prQ=()=>{if(cQ>0){svF();clearInterval(ti);cQ--;rQ()}};
window.nxQ=()=>{svF();clearInterval(ti);if(cQ>=cT.qs.length-1)fnQ();else{cQ++;rQ()}};
function svF(){const f=document.getElementById('fI');if(f&&an[cQ]?.type==='free')an[cQ].value=f.value}

// ===== FINISH =====
function fnQ(){const t=cT,tot=t.qs.length,pp=tot?t.ms/tot:0;
let sc=0,dt2=[],hf=false;
t.qs.forEach((q,i)=>{const a=an[i];let d={qt:q.tx,ans:false,ok:false,pt:0,ua:'',ca:'',fr:false,st:'wrong'};

if(q.tp==='grid'){
const cols=q.cols||[];const rows=q.rows||[];const corr=q.gcorr||{};
d.ca=rows.map((r,ri)=>r+': '+(cols[corr[ri]]||'?')).join(', ');
if(a?.type==='grid'){
d.ans=true;let allOk=true;
rows.forEach((r,ri)=>{if(a.value[ri]!==corr[ri])allOk=false});
d.ua=rows.map((r,ri)=>r+': '+(cols[a.value?.[ri]]||'‚Äî')).join(', ');
if(allOk){d.ok=true;d.pt=pp;sc+=pp;d.st='correct'}
} else {d.ua='–ë–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ'}
} else {
const ci=q.opts.findIndex(o=>o.cr);d.ca=ci>=0?q.opts[ci].tx:'‚Äî';
if(!a){d.ua='–ë–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ'}
else if(a.type==='choice'){d.ua=q.opts[a.value]?.tx||'‚Äî';d.ans=true;if(q.opts[a.value]?.cr){d.ok=true;d.pt=pp;sc+=pp;d.st='correct'}}
else if(a.type==='free'){d.ua=a.value||'–ü–æ—Ä–æ–∂–Ω—å–æ';d.ans=true;d.fr=true;d.st='pending';hf=true}
}
dt2.push(d)});
sc=Math.round(sc*100)/100;
const st=hf?'pending':'auto';
const r={id:gid(),tid:t.id,tn:t.nm,uid:ME.uid,userName:ME.name,sc,ms:t.ms,ps:t.ps,dts:dt2,dt:dtt(),st,rv:hf?null:'SYSTEM'};
R.push(r);sv();
if(!hf){whRes(r,{nm:t.nm,ms:t.ms,ps:t.ps},'SYSTEM');const p=sc>=t.ps;aN(p?`‚úÖ –Ü—Å–ø–∏—Ç "${t.nm}" —Å–∫–ª–∞–¥–µ–Ω–æ: ${sc}/${t.ms}`:`‚ùå –Ü—Å–ø–∏—Ç "${t.nm}" –Ω–µ —Å–∫–ª–∞–¥–µ–Ω–æ: ${sc}/${t.ms}`)}
else{whNtf();aN(`‚è≥ –Ü—Å–ø–∏—Ç "${t.nm}" –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É`)}
rRes(r);go('R')}

// ===== RESULT =====
function rRes(r){const t=T.find(x=>x.id===r.tid),psc=t?t.ps:0;
const ip=r.st==='pending',pd=r.sc>=psc;
const cl=ip?'pd':pd?'ps':'fl';
let dh=r.dts.map((d,i)=>{let mc=d.st==='correct'?'ok':d.st==='pending'?'wt':'no';
let mi=d.st==='correct'?'‚úì':d.st==='pending'?'?':'‚úó';
let pt=d.st==='correct'?`<span style="color:var(--p);font-weight:900">+${Math.round(d.pt*10)/10} –±.</span>`:d.st==='pending'?`<span style="color:var(--wn);font-weight:900">? –±. ‚Äî –ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</span>`:`<span style="color:var(--dn);font-weight:900">0 –±.</span>`;
return`<div class="rd"><div class="rm ${mc}">${mi}</div><div style="flex:1"><div style="font-size:14px;font-weight:700;margin-bottom:5px">${i+1}. ${d.qt}</div><div style="font-size:13px;color:var(--tx)">–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.ua}</b></div>${d.st!=='pending'?`<div style="font-size:11px;color:var(--p);margin-top:4px">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.ca}</div>`:''}${pt}</div></div>`}).join('');

const hasPending=R.find(x=>x.tid===r.tid&&x.uid===ME.uid&&r.st==='pending');
const hasAuto=R.find(x=>x.tid===r.tid&&x.uid===ME.uid&&x.st==='auto'&&!R.find(y=>y.tid===r.tid&&y.uid===ME.uid&&(y.st==='approved'||y.st==='rejected')));
const canR=!hasPending&&!hasAuto;

document.getElementById('rB').innerHTML=`<div class="rc ${cl}"><div class="rsc" style="color:${ip?'var(--wn)':pd?'var(--p)':'var(--dn)'}">${r.sc}</div><div class="rmx">–∑ ${r.ms} –±–∞–ª—ñ–≤</div></div>
<div class="rss ${cl}">${ip?'‚è≥ –ù–ê –ü–ï–†–ï–í–Ü–†–¶–Ü':pd?'‚úÖ –Ü–°–ü–ò–¢ –°–ö–õ–ê–î–ï–ù–û':'‚ùå –ù–ï –°–ö–õ–ê–î–ï–ù–û'}</div>
<p style="color:var(--td);font-size:14px;margin-bottom:30px">${ip?'–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—é–¥–∏–Ω–æ—é':'–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª: '+psc+' –∑ '+r.ms}</p>
<div style="text-align:left">${dh}</div>
<div class="bts">${canR?`<button class="btn btn-g" onclick="goI('${r.tid}')">üîÑ –ü–†–û–ô–¢–ò –ó–ù–û–í–£</button>`:`<button class="btn btn-s btn-dis">üîí –û–ß–Ü–ö–£–ô–¢–ï –ü–ï–†–ï–í–Ü–†–ö–ò</button>`}<button class="btn btn-s" onclick="go('H')">üè† –ù–ê –ì–û–õ–û–í–ù–£</button></div>`}

// ===== CREATE / EDIT =====
function rC(td){eI=td?td.id:null;document.getElementById('cT').innerHTML=eI?'‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —ñ—Å–ø–∏—Ç':'‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç';
const t=td||{nm:'',ds:'',em:'üìù',ms:12,ps:8,qs:[]};
const qs=t.qs.length?t.qs:[{tx:'',opts:[{tx:'',cr:false},{tx:'',cr:false},{tx:'',cr:false},{tx:'',cr:false}],af:false,tm:30,tp:'normal'}];
document.getElementById('cF').innerHTML=`<div class="cd"><div class="fg"><div class="fr"><label class="fl">–ù–∞–∑–≤–∞ —ñ—Å–ø–∏—Ç—É</label><input class="fin" id="tN" value="${(t.nm||'').replace(/"/g,'&quot;')}" placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É..."></div><div class="fr"><label class="fl">–ï–º–æ–¥–∑—ñ</label><input class="fin" id="tE" value="${t.em||'üìù'}" placeholder="üìù" style="text-align:center;font-size:24px"></div></div>
<div class="fr"><label class="fl">–û–ø–∏—Å</label><textarea class="fin" id="tD" rows="2" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å...">${t.ds||''}</textarea></div>
<div class="fg"><div class="fr"><label class="fl">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π –±–∞–ª</label><input class="fin" id="tM" type="number" value="${t.ms||12}" min="1"></div><div class="fr"><label class="fl">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª</label><input class="fin" id="tP" type="number" value="${t.ps||8}" min="0"></div></div>
<div style="font-size:12px;color:var(--td);margin-top:10px;padding:10px;background:rgba(0,255,68,0.03);border-radius:10px;border:1px solid var(--br)" id="sH">üíé –ó–∞ –∫–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è: <b style="color:var(--p)">${qs.length?Math.round((t.ms||12)/qs.length*100)/100:0} –±–∞–ª—ñ–≤</b></div></div>
<div class="st">üìã –ü–∏—Ç–∞–Ω–Ω—è</div><div id="qC">${bQs(qs)}</div>
<button class="btn btn-s btn-full" onclick="addQ()" style="margin-bottom:22px">‚ûï –î–û–î–ê–¢–ò –ù–û–í–ï –ü–ò–¢–ê–ù–ù–Ø</button>
<div class="bts"><button class="btn btn-g" onclick="svT()">üíæ ${eI?'–ó–ë–ï–†–ï–ì–¢–ò –ó–ú–Ü–ù–ò':'–°–¢–í–û–†–ò–¢–ò –Ü–°–ü–ò–¢'}</button><button class="btn btn-s" onclick="go('H')">–°–ö–ê–°–£–í–ê–¢–ò</button>${wh?'<button class="btn btn-i" onclick="tWh()">üì© –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø</button>':''}</div>`;
document.getElementById('tM').addEventListener('input',uH)}

function bQs(qs){return qs.map((q,qi)=>{
const isGrid=q.tp==='grid';
let optsH='';

if(isGrid){
const cols=q.cols||[''];const rows=q.rows||[''];const gc=q.gcorr||{};
let colsH=cols.map((c,ci)=>`<div class="or"><input class="oin" placeholder="–°—Ç–æ–≤–ø–µ—Ü—å ${ci+1}" value="${(c||'').replace(/"/g,'&quot;')}" data-qi="${qi}" data-ci="${ci}"><button class="odl" onclick="dCol(${qi},${ci})">‚úï</button></div>`).join('');
let rowsH=rows.map((r,ri)=>`<div class="or"><input class="oin" placeholder="–†—è–¥–æ–∫ ${ri+1}" value="${(r||'').replace(/"/g,'&quot;')}" data-qi="${qi}" data-ri="${ri}">
<select class="oin" style="width:140px;flex:none" data-qi="${qi}" data-gri="${ri}">${cols.map((c,ci)=>`<option value="${ci}"${gc[ri]===ci?' selected':''}>${c||'–°—Ç–æ–≤–ø.'+(ci+1)}</option>`).join('')}</select>
<button class="odl" onclick="dRow(${qi},${ri})">‚úï</button></div>`).join('');
optsH=`<div class="tbb"><h5>üìä –°—Ç–æ–≤–ø—Ü—ñ (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–≤–µ—Ä—Ö—É)</h5>${colsH}<button class="ao" onclick="aCol(${qi})">+ –î–û–î–ê–¢–ò –°–¢–û–í–ü–ï–¶–¨</button></div>
<div class="tbb" style="margin-top:10px"><h5>üìã –†—è–¥–∫–∏ (–≤–∞—Ä—ñ–∞–Ω—Ç–∏ –∑–ª—ñ–≤–∞)</h5>${rowsH}<button class="ao" onclick="aRow(${qi})">+ –î–û–î–ê–¢–ò –†–Ø–î–û–ö</button></div>`;
} else {
optsH=q.opts.map((o,oi)=>`<div class="or"><div class="orc${o.cr?' on':''}" onclick="tgC(${qi},${oi})"></div><input class="oin" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç ${L[oi]||oi+1}" value="${(o.tx||'').replace(/"/g,'&quot;')}" data-qi="${qi}" data-oi="${oi}"><button class="odl" onclick="dO(${qi},${oi})">‚úï</button></div>`).join('');
optsH+=`<button class="ao" onclick="aO(${qi})">+ –î–û–î–ê–¢–ò –í–ê–†–Ü–ê–ù–¢ –í–Ü–î–ü–û–í–Ü–î–Ü</button>`;
}

return`<div class="qb" id="qb${qi}"><div class="qbn"><span class="qbl">üìå –ü–∏—Ç–∞–Ω–Ω—è ${qi+1}</span><button class="qbd" onclick="dQ(${qi})">üóëÔ∏è</button></div>
<div class="tps"><div class="tp${q.tp!=='grid'?' on':''}" onclick="sTp(${qi},'normal')">üìù –ó–≤–∏—á–∞–π–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è</div><div class="tp${q.tp==='grid'?' on':''}" onclick="sTp(${qi},'grid')">üìä –¢–∞–±–ª–∏—Ü—è (—Å—Ç–æ–≤–ø—Ü—ñ)</div></div>
<div class="fr"><label class="fl">–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è</label><textarea class="fin" placeholder="–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è..." id="qt${qi}" rows="3" style="resize:vertical">${(q.tx||'').replace(/</g,'&lt;')}</textarea></div>
<div id="os${qi}">${optsH}</div>
${!isGrid?`<div class="fsw" onclick="tgFr(${qi})"><div class="sw${q.af?' on':''}" id="fs${qi}"></div> –î–æ–∑–≤–æ–ª–∏—Ç–∏ –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å</div>`:''}<div class="tr"><label>‚è± –ß–∞—Å –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (—Å–µ–∫—É–Ω–¥–∏):</label><input class="ti" type="number" id="qtm${qi}" value="${q.tm||30}" min="10" max="600"></div></div>`}).join('')}

function uH(){const ms=parseInt(document.getElementById('tM').value)||0,cnt=document.querySelectorAll('.qb').length;
document.getElementById('sH').innerHTML=`üíé –ó–∞ –∫–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è: <b style="color:var(--p)">${cnt?Math.round(ms/cnt*100)/100:0} –±–∞–ª—ñ–≤</b>`}

function gQs(){const bs=document.querySelectorAll('.qb');let qs=[];bs.forEach((b,qi)=>{
const tx=document.getElementById('qt'+qi)?.value||'';
const tm=parseInt(document.getElementById('qtm'+qi)?.value)||30;
const tpBtns=b.querySelectorAll('.tp');
let tp='normal';if(tpBtns[1]&&tpBtns[1].classList.contains('on'))tp='grid';

if(tp==='grid'){
const colInps=b.querySelectorAll('[data-ci]');const rowInps=b.querySelectorAll('[data-ri]');const gcSels=b.querySelectorAll('[data-gri]');
let cols=[];colInps.forEach(c=>cols.push(c.value));
let rows=[];rowInps.forEach(r=>rows.push(r.value));
let gc={};gcSels.forEach(s=>{gc[s.dataset.gri]=parseInt(s.value)||0});
qs.push({tx,tp:'grid',cols,rows,gcorr:gc,opts:[],af:false,tm:Math.max(10,Math.min(600,tm))});
} else {
const rs=b.querySelectorAll('.or');let opts=[];
rs.forEach(r=>{const inp=r.querySelector('.oin'),rad=r.querySelector('.orc');if(inp&&rad)opts.push({tx:inp.value,cr:rad.classList.contains('on')})});
const sw=document.getElementById('fs'+qi);
qs.push({tx,tp:'normal',opts,af:sw?.classList.contains('on')||false,tm:Math.max(10,Math.min(600,tm)),cols:[],rows:[],gcorr:{}});
}});return qs}

function rbQs(qs){document.getElementById('qC').innerHTML=bQs(qs)}
window.tgC=(qi,oi)=>{const qs=gQs();qs[qi].opts.forEach((o,i)=>o.cr=i===oi);rbQs(qs)};
window.dO=(qi,oi)=>{const qs=gQs();qs[qi].opts.splice(oi,1);rbQs(qs)};
window.aO=qi=>{const qs=gQs();qs[qi].opts.push({tx:'',cr:false});rbQs(qs)};
window.dQ=qi=>{const qs=gQs();if(qs.length<=1){alert('‚ùå –ü–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è!');return}qs.splice(qi,1);rbQs(qs);uH()};
window.addQ=()=>{const qs=gQs();qs.push({tx:'',tp:'normal',opts:[{tx:'',cr:false},{tx:'',cr:false},{tx:'',cr:false},{tx:'',cr:false}],af:false,tm:30,cols:[],rows:[],gcorr:{}});rbQs(qs);uH();setTimeout(()=>{const el=document.getElementById('qb'+(qs.length-1));if(el)el.scrollIntoView({behavior:'smooth',block:'center'})},100)};
window.tgFr=qi=>{const qs=gQs();qs[qi].af=!qs[qi].af;rbQs(qs)};
window.sTp=(qi,tp)=>{const qs=gQs();qs[qi].tp=tp;if(tp==='grid'&&(!qs[qi].cols||!qs[qi].cols.length)){qs[qi].cols=['',''];qs[qi].rows=[''];qs[qi].gcorr={0:0}}rbQs(qs)};
window.aCol=qi=>{const qs=gQs();qs[qi].cols.push('');rbQs(qs)};
window.dCol=(qi,ci)=>{const qs=gQs();if(qs[qi].cols.length<=1){alert('‚ùå –ú—ñ–Ω—ñ–º—É–º 1 —Å—Ç–æ–≤–ø–µ—Ü—å!');return}qs[qi].cols.splice(ci,1);rbQs(qs)};
window.aRow=qi=>{const qs=gQs();qs[qi].rows.push('');qs[qi].gcorr[qs[qi].rows.length-1]=0;rbQs(qs)};
window.dRow=(qi,ri)=>{const qs=gQs();if(qs[qi].rows.length<=1){alert('‚ùå –ú—ñ–Ω—ñ–º—É–º 1 —Ä—è–¥–æ–∫!');return}qs[qi].rows.splice(ri,1);rbQs(qs)};

window.svT=()=>{const nm=document.getElementById('tN').value.trim(),ds=document.getElementById('tD').value.trim(),em=document.getElementById('tE').value.trim()||'üìù',
ms=parseInt(document.getElementById('tM').value)||12,ps=parseInt(document.getElementById('tP').value)||8,qs=gQs();
if(!nm){alert('‚ùå –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —ñ—Å–ø–∏—Ç—É!');return}
if(!qs.length){alert('‚ùå –î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è!');return}
for(let i=0;i<qs.length;i++){if(!qs[i].tx.trim()){const el=document.getElementById('qb'+i);if(el){el.classList.add('er');el.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(()=>el.classList.remove('er'),2500)}alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –≤–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç!`);return}
if(qs[i].tp!=='grid'&&!qs[i].opts.some(o=>o.cr)&&!qs[i].af){const el=document.getElementById('qb'+i);if(el){el.classList.add('er');el.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(()=>el.classList.remove('er'),2500)}alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –æ–±–µ—Ä—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å –∞–±–æ —É–≤—ñ–º–∫–Ω—ñ—Ç—å –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å!`);return}}
if(ps>ms){alert('‚ùå –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –±—ñ–ª—å—à–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ!');return}
const obj={id:eI||gid(),nm,ds,em,ms,ps,qs,ca:dtt(),cb:ME.name};
if(eI){const idx=T.findIndex(t=>t.id===eI);if(idx>=0)T[idx]=obj}else T.push(obj);
sv();eI=null;aN(`üìù –Ü—Å–ø–∏—Ç "${nm}" ${eI?'–æ–Ω–æ–≤–ª–µ–Ω–æ':'—Å—Ç–≤–æ—Ä–µ–Ω–æ'}`);alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!');go('H')};

window.tWh=()=>{sWh({title:'üß™ –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø',color:0x3b82f6,description:'Webhook –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ! ‚úÖ',fields:[{name:'üë§ –í—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫',value:'```'+ME.name+'```',inline:true},{name:'üìÖ –î–∞—Ç–∞',value:'```'+dtt()+'```',inline:true}],footer:{text:'‚öî –î–®–í ‚Ä¢ –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†'},timestamp:new Date().toISOString()});alert('üì© –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!')};

// ===== REVIEW =====
function rRv(){const pd=R.filter(r=>r.st==='pending');
if(!pd.length){document.getElementById('rvL').innerHTML='<div style="color:var(--td);text-align:center;padding:60px;font-size:14px">‚úÖ –ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</div>';return}
document.getElementById('rvL').innerHTML=pd.map(r=>{const t=T.find(x=>x.id===r.tid);
const pp=t&&t.qs.length?t.ms/t.qs.length:0;
let qh=r.dts.map((d,i)=>{let c=d.st==='correct'?'ok':d.st==='pending'?'wt':'no';
let pt=d.st==='correct'?`<span style="color:var(--p);font-size:12px;font-weight:900">+${Math.round(d.pt*10)/10} –±.</span>`:d.st==='pending'?`<span style="color:var(--wn);font-size:12px;font-weight:900">? –±. (–º–∞–∫—Å ${Math.round(pp*10)/10} –±.)</span>`:`<span style="color:var(--dn);font-size:12px;font-weight:900">0 –±.</span>`;
return`<div class="rvq ${c}"><div style="font-size:14px;font-weight:700;margin-bottom:6px">${i+1}. ${d.qt}</div><div style="font-size:13px;color:var(--tx)">–í—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.ua}</b></div>${d.st!=='pending'?`<div style="font-size:11px;color:var(--p);margin-top:4px">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.ca}</div>`:'<div style="font-size:11px;color:var(--wn);margin-top:4px">‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±—É—î —Ä—É—á–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</div>'}${pt}</div>`}).join('');
return`<div class="rvc"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:14px">
<div><h3 style="font-size:17px;font-weight:900">${r.userName}</h3><div style="font-size:12px;color:var(--td)">${r.tn||'–Ü—Å–ø–∏—Ç'} ¬∑ ${r.dt}</div></div>
<div style="font-size:28px;font-weight:900;color:var(--p)">${r.sc} <span style="font-size:14px;color:var(--td)">/ ${r.ms}</span></div></div>${qh}
<div class="bts" style="margin-top:20px"><button class="btn btn-g" onclick="apR('${r.id}')">‚úÖ –°–•–í–ê–õ–ò–¢–ò –†–ï–ó–£–õ–¨–¢–ê–¢</button><button class="btn btn-r" onclick="rjR('${r.id}')">‚ùå –í–Ü–î–•–ò–õ–ò–¢–ò –†–ï–ó–£–õ–¨–¢–ê–¢</button></div></div>`}).join('')}

window.apR=id=>{const r=R.find(x=>x.id===id);if(!r)return;const t=T.find(x=>x.id===r.tid);
const pp=t&&t.qs.length?t.ms/t.qs.length:0;
r.dts.forEach(d=>{if(d.st==='pending'){d.st='correct';d.pt=pp;r.sc+=pp}});
r.sc=Math.round(r.sc*100)/100;r.st='approved';r.rv=ME.name;sv();
whRes(r,t||{nm:r.tn,ms:r.ms,ps:r.ps},ME.name);
aN(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç ${r.userName} —Å—Ö–≤–∞–ª–µ–Ω–æ ‚Äî ${ME.name}`);rRv()};
window.rjR=id=>{const r=R.find(x=>x.id===id);if(!r)return;const t=T.find(x=>x.id===r.tid);
r.dts.forEach(d=>{if(d.st==='pending'){d.st='wrong';d.pt=0}});
r.st='rejected';r.rv=ME.name;sv();
whRes(r,t||{nm:r.tn,ms:r.ms,ps:r.ps},ME.name);
aN(`‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç ${r.userName} –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ ‚Äî ${ME.name}`);rRv()};

// ===== MANAGE =====
function rM(){if(!T.length){document.getElementById('mL').innerHTML='<div style="color:var(--td);text-align:center;padding:60px;font-size:14px">–ù–µ–º–∞—î —ñ—Å–ø–∏—Ç—ñ–≤</div>';return}
document.getElementById('mL').innerHTML=T.map(t=>{const res=R.filter(r=>r.tid===t.id),p=res.filter(r=>(r.st==='approved'||r.st==='auto')&&r.sc>=t.ps).length;
return`<div class="mc"><div><b style="font-size:16px">${t.em} ${t.nm}</b><br><span style="font-size:12px;color:var(--td)">–ü–∏—Ç–∞–Ω—å: ${t.qs.length} ¬∑ –ú–∞–∫—Å: ${t.ms}–± ¬∑ –ü—Ä–æ—Ö—ñ–¥: ${t.ps}–± ¬∑ –°–∫–ª–∞–ª–∏: ${p}/${res.length}</span></div>
<div style="display:flex;gap:10px;flex-wrap:wrap"><button class="btn btn-i" onclick="edT('${t.id}')" style="padding:12px 22px;font-size:12px;min-width:auto">‚úèÔ∏è –†–ï–î–ê–ì–£–í–ê–¢–ò</button><button class="btn btn-w" onclick="clT('${t.id}')" style="padding:12px 22px;font-size:12px;min-width:auto">üßπ –û–ß–ò–°–¢–ò–¢–ò</button><button class="btn btn-r" onclick="dlT('${t.id}')" style="padding:12px 22px;font-size:12px;min-width:auto">üóëÔ∏è –í–ò–î–ê–õ–ò–¢–ò</button></div></div>`}).join('')}

window.edT=id=>{const t=T.find(x=>x.id===id);if(t){rC(t);go('C')}};
window.clT=id=>{if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ü—å–æ–≥–æ —ñ—Å–ø–∏—Ç—É?')){R=R.filter(r=>r.tid!==id);sv();rM();aN('üßπ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –æ—á–∏—â–µ–Ω–æ')}};
window.dlT=id=>{if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —ñ—Å–ø–∏—Ç –Ω–∞–∑–∞–≤–∂–¥–∏?')){T=T.filter(t=>t.id!==id);R=R.filter(r=>r.tid!==id);sv();rM();aN('üóëÔ∏è –Ü—Å–ø–∏—Ç –≤–∏–¥–∞–ª–µ–Ω–æ')}};

// ===== SETTINGS =====
function rS(){document.getElementById('sC').innerHTML=`<div class="sb"><h4>üîó Discord Webhook</h4>
<div class="fr"><label class="fl">URL Webhook</label><input class="fin" id="wIn" value="${wh}" placeholder="https://discord.com/api/webhooks/..."></div>
<div class="bts" style="justify-content:flex-start"><button class="btn btn-g" onclick="svWh()" style="min-width:auto;padding:14px 28px">üíæ –ó–ë–ï–†–ï–ì–¢–ò WEBHOOK</button><button class="btn btn-i" onclick="tWh()" style="min-width:auto;padding:14px 28px">üì© –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø</button></div></div>
<div class="sb"><h4>üîç –ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ —ñ—Å–ø–∏—Ç—ñ–≤</h4>
<p style="font-size:11px;color:var(--td);margin-bottom:14px">–¶—ñ –ª—é–¥–∏ –º–æ–∂—É—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –≤—ñ–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–æ–∫—Ä—ñ–º –∞–¥–º—ñ–Ω—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –¥–æ—Å—Ç—É–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ)</p>
<div id="rCh" style="margin-bottom:14px">${rv.map(r=>`<span class="ch">${r}<button onclick="rmRv('${r}')">‚úï</button></span>`).join('')||'<span style="color:var(--td);font-size:12px">–ù–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á–∞</span>'}</div>
<div class="pd"><input class="fin" id="rvS" placeholder="üîç –ü–æ—à—É–∫ –ª—é–¥–∏–Ω–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è..." oninput="fP('rv')" onfocus="fP('rv')"><div class="pl" id="rvD"></div></div></div>`}

window.svWh=()=>{wh=document.getElementById('wIn').value.trim();sv();alert('‚úÖ Webhook –∑–±–µ—Ä–µ–∂–µ–Ω–æ!')};
window.rmRv=n=>{rv=rv.filter(r=>r!==n);sv();rS()};
window.fP=tp=>{const inp=document.getElementById(tp+'S'),drop=document.getElementById(tp+'D'),val=inp.value.toLowerCase();
const list=tp==='rv'?allU.filter(u=>!rv.includes(u.name)):allU.filter(u=>!al.includes(u.name));
const f=val?list.filter(u=>u.name.toLowerCase().includes(val)):list;
if(!f.length){drop.innerHTML='<div style="padding:18px;text-align:center;color:var(--td);font-size:12px">–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';drop.classList.add('sh');return}
drop.innerHTML=f.map(u=>{const rl=u.role==='admin'?'–ê–¥–º—ñ–Ω':u.role==='instructor'?'–Ü–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä':'–ë—ñ—î—Ü—å';const rc=u.role==='admin'?'var(--p)':u.role==='instructor'?'var(--wn)':'var(--td)';
return`<div class="pi" onclick="sP('${tp}','${u.name.replace(/'/g,"\\'")}')"><span style="font-weight:700">${u.name}</span><span style="font-size:10px;color:${rc};font-weight:800">${rl}</span></div>`}).join('');drop.classList.add('sh')};
window.sP=(tp,nm)=>{if(tp==='rv'&&!rv.includes(nm)){rv.push(nm);sv();rS()}
if(tp==='adm'&&!al.includes(nm)){al.push(nm);sv();rA();bNav()}
document.querySelectorAll('.pl').forEach(d=>d.classList.remove('sh'))};
document.addEventListener('click',e=>{if(!e.target.closest('.pd'))document.querySelectorAll('.pl').forEach(d=>d.classList.remove('sh'))});

// ===== ADMINS =====
function rA(){document.getElementById('aC').innerHTML=`<div class="sb"><h4>üëë –ê–¥–º—ñ–Ω –ø—Ä–∞–≤–∞ –≤ —ñ—Å–ø–∏—Ç–∞—Ö</h4>
<p style="font-size:11px;color:var(--td);margin-bottom:16px">–¶—ñ –ª—é–¥–∏ –º–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è, –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ—Å–ø–∏—Ç—ñ–≤ (–æ–∫—Ä—ñ–º —Ä–æ–ª—ñ admin –∑ Firebase)</p>
<div id="aCh" style="margin-bottom:14px">${al.map(n=>`<span class="ch ch-y">${n}<button onclick="rmAl('${n}')">‚úï</button></span>`).join('')||'<span style="color:var(--td);font-size:12px">–ù–µ –¥–æ–¥–∞–Ω–æ –∂–æ–¥–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</span>'}</div>
<div class="pd"><input class="fin" id="admS" placeholder="üîç –ü–æ—à—É–∫ –ª—é–¥–∏–Ω–∏ –¥–ª—è –Ω–∞–¥–∞–Ω–Ω—è –ø—Ä–∞–≤..." oninput="fP('adm')" onfocus="fP('adm')"><div class="pl" id="admD"></div></div></div>`}
window.rmAl=n=>{al=al.filter(a=>a!==n);sv();rA();bNav()};

// ===== SECURITY =====
document.onkeydown=e=>{if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&[73,74,67].includes(e.keyCode))||(e.ctrlKey&&e.keyCode===85))return false};

rN();
</script>
</body>
</html>
