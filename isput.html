<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #00ff44;
  --primary-bright: #b8ffd0;
  --primary-glow: rgba(0,255,68,0.6);
  --primary-dim: rgba(0,255,68,0.12);
  --bg: #030507;
  --bg-card: rgba(8,12,18,0.85);
  --bg-card-hover: rgba(12,18,26,0.95);
  --glass: rgba(0,255,68,0.25);
  --glass-dim: rgba(0,255,68,0.1);
  --danger: #ff4757;
  --danger-glow: rgba(255,71,87,0.5);
  --warning: #ffa502;
  --warning-glow: rgba(255,165,2,0.4);
  --info: #3b82f6;
  --info-glow: rgba(59,130,246,0.4);
  --success: #2ed573;
  --success-glow: rgba(46,213,115,0.4);
  --text: #e2e8f0;
  --text-dim: #64748b;
  --text-bright: #ffffff;
  --border: rgba(0,255,68,0.18);
  --border-hover: rgba(0,255,68,0.5);
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }
body {
  background: var(--bg);
  color: var(--text);
  font-family: 'Inter', -apple-system, sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  user-select: none;
  -webkit-user-select: none;
}
body::before {
  content: '';
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background:
    radial-gradient(ellipse 800px 600px at 10% 40%, rgba(0,255,68,0.07), transparent),
    radial-gradient(ellipse 600px 500px at 90% 20%, rgba(0,255,68,0.05), transparent),
    radial-gradient(ellipse 900px 400px at 50% 90%, rgba(0,255,68,0.03), transparent);
  pointer-events: none; z-index: 0;
}
input, textarea, select { user-select: text !important; -webkit-user-select: text !important; }
::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

/* === ANIMATIONS === */
@keyframes fadeUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
@keyframes glowPulse { 0%,100% { box-shadow: 0 0 15px var(--primary-glow), 0 0 30px rgba(0,255,68,0.15); } 50% { box-shadow: 0 0 25px var(--primary-glow), 0 0 60px rgba(0,255,68,0.25); } }
@keyframes borderPulse { 0%,100% { border-color: rgba(0,255,68,0.2); } 50% { border-color: rgba(0,255,68,0.6); } }
@keyframes shake { 0%,100% { transform: translateX(0); } 15%,45%,75% { transform: translateX(-6px); } 30%,60%,90% { transform: translateX(6px); } }
@keyframes shimmer { 0% { left: -100%; } 100% { left: 200%; } }
@keyframes float { 0%,100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
@keyframes neonText { 0%,100% { text-shadow: 0 0 7px var(--primary), 0 0 15px var(--primary), 0 0 30px rgba(0,255,68,0.4); } 50% { text-shadow: 0 0 12px var(--primary), 0 0 25px var(--primary), 0 0 50px rgba(0,255,68,0.6), 0 0 80px rgba(0,255,68,0.3); } }
@keyframes timerPulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.08); } }
@keyframes dotBlink { 0%,100% { opacity: 0.2; } 50% { opacity: 1; } }

/* === HEADER === */
header {
  display: flex; justify-content: space-between; align-items: center;
  padding: 14px 4%; background: rgba(3,5,7,0.92);
  border-bottom: 1px solid var(--border);
  position: sticky; top: 0; z-index: 1000;
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
}
header::after {
  content: ''; position: absolute; bottom: -1px; left: 0; width: 100%; height: 2px;
  background: linear-gradient(90deg, transparent 0%, var(--primary) 50%, transparent 100%);
  opacity: 0.6;
}
.logo {
  display: flex; align-items: center; gap: 10px;
  text-decoration: none; color: black;
}
.logo-icon {
  background: var(--primary); padding: 7px 14px; border-radius: 10px;
  font-weight: 900; font-size: 13px; letter-spacing: 1.5px;
  box-shadow: 0 0 20px var(--primary-glow), 0 0 40px rgba(0,255,68,0.15);
  transition: 0.3s;
}
.logo:hover .logo-icon { box-shadow: 0 0 30px var(--primary-glow), 0 0 60px rgba(0,255,68,0.3); transform: translateY(-1px); }
.logo-sub { font-size: 11px; color: var(--primary); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; }
.hdr-right { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.hdr-name { color: var(--primary-bright); font-weight: 800; font-size: 13px; }
.hdr-role {
  padding: 5px 12px; border-radius: 8px; font-size: 10px; font-weight: 900;
  text-transform: uppercase; letter-spacing: 1px; border: 1px solid;
}
.role-admin { background: rgba(0,255,68,0.12); color: var(--primary); border-color: var(--primary); box-shadow: 0 0 12px rgba(0,255,68,0.2); }
.role-instructor { background: rgba(255,165,2,0.12); color: var(--warning); border-color: var(--warning); }
.role-fighter { background: rgba(100,116,139,0.12); color: var(--text-dim); border-color: rgba(100,116,139,0.3); }

/* === NAV === */
.nav-bar {
  display: flex; gap: 5px; flex-wrap: wrap;
}
.nav-btn {
  background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06);
  color: var(--text-dim); padding: 9px 16px; border-radius: 10px;
  font-weight: 700; cursor: pointer; font-size: 11px; transition: all 0.25s ease;
  text-transform: uppercase; letter-spacing: 0.5px; position: relative; overflow: hidden;
}
.nav-btn:hover {
  border-color: var(--primary); color: var(--primary-bright);
  background: var(--primary-dim); transform: translateY(-2px);
  box-shadow: 0 4px 20px rgba(0,255,68,0.15);
}
.nav-btn:active { transform: translateY(0) scale(0.97); }
.nav-btn.active {
  background: var(--primary); color: #000; border-color: var(--primary);
  box-shadow: 0 0 20px var(--primary-glow); font-weight: 900;
}

/* === NOTIF === */
.notif-wrap { position: relative; cursor: pointer; padding: 4px; }
.bell { font-size: 20px; transition: 0.3s; filter: drop-shadow(0 0 6px var(--warning)); }
.bell:hover { transform: scale(1.15) rotate(12deg); }
.bell-badge {
  position: absolute; top: -3px; right: -3px; background: var(--danger);
  color: white; font-size: 9px; font-weight: 900; padding: 1px 5px;
  border-radius: 50%; border: 2px solid var(--bg); display: none;
}
#notifPanel {
  position: absolute; top: 40px; right: 0; width: 320px;
  background: rgba(8,12,20,0.98); border: 1px solid var(--glass);
  border-radius: 14px; display: none; flex-direction: column; z-index: 2000;
  box-shadow: 0 15px 50px rgba(0,0,0,0.8), 0 0 30px rgba(0,255,68,0.08);
  overflow: hidden; animation: slideDown 0.25s ease;
}
.notif-head {
  padding: 12px 16px; background: rgba(0,255,68,0.04);
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--border);
}
.notif-item {
  padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.02);
  cursor: pointer; transition: 0.2s; font-size: 12px;
}
.notif-item:hover { background: rgba(0,255,68,0.04); }
.notif-item.read { opacity: 0.35; }

/* === MAIN === */
.main { max-width: 1100px; margin: 0 auto; padding: 30px 20px; position: relative; z-index: 1; }
.view { display: none; animation: fadeUp 0.4s ease; }
.view.active { display: block; }

/* === SECTION TITLE === */
.s-title {
  font-size: 16px; font-weight: 900; color: var(--primary-bright);
  margin-bottom: 22px; display: flex; align-items: center; gap: 10px;
  text-transform: uppercase; letter-spacing: 1.5px;
}
.s-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--border), transparent 80%); }

/* === STATS === */
.stats {
  display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 30px;
}
.stat {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 16px; padding: 24px 16px; text-align: center;
  backdrop-filter: blur(10px); transition: all 0.3s ease; position: relative; overflow: hidden;
}
.stat::before {
  content: ''; position: absolute; top: 0; left: -100%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0,255,68,0.04), transparent);
  transition: left 0.5s ease;
}
.stat:hover::before { left: 150%; }
.stat:hover { border-color: var(--border-hover); transform: translateY(-4px); box-shadow: 0 8px 30px rgba(0,255,68,0.12); }
.stat-val { font-size: 34px; font-weight: 900; margin-bottom: 5px; }
.stat-val.green { color: var(--primary); text-shadow: 0 0 15px var(--primary-glow); }
.stat-val.red { color: var(--danger); text-shadow: 0 0 10px var(--danger-glow); }
.stat-val.yellow { color: var(--warning); text-shadow: 0 0 10px var(--warning-glow); }
.stat-val.white { color: white; }
.stat-lbl { font-size: 10px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; }

/* === TEST CARDS === */
.tests-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-bottom: 40px; }
.t-card {
  background: var(--bg-card); border: 1px solid var(--border);
  border-radius: 20px; padding: 30px 24px; width: 300px;
  backdrop-filter: blur(10px); transition: all 0.35s ease;
  cursor: pointer; position: relative; overflow: hidden;
}
.t-card::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--primary), rgba(0,255,68,0.2), var(--primary));
  opacity: 0; transition: opacity 0.3s;
}
.t-card::after {
  content: ''; position: absolute; top: 0; left: -80%; width: 60%; height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0,255,68,0.03), transparent);
  transition: left 0.7s ease; pointer-events: none;
}
.t-card:hover {
  border-color: var(--primary); transform: translateY(-6px) scale(1.01);
  box-shadow: 0 15px 50px rgba(0,255,68,0.15), 0 0 0 1px rgba(0,255,68,0.3);
  background: var(--bg-card-hover);
}
.t-card:hover::before { opacity: 1; }
.t-card:hover::after { left: 150%; }
.t-card:active { transform: translateY(-2px) scale(0.99); }
.t-emoji { font-size: 52px; margin-bottom: 16px; display: block; animation: float 4s ease-in-out infinite; }
.t-card h3 { font-size: 16px; font-weight: 800; margin-bottom: 6px; color: var(--text-bright); line-height: 1.3; }
.t-card p { font-size: 12px; color: var(--text-dim); margin-bottom: 16px; line-height: 1.5; }
.t-tags { display: flex; gap: 6px; flex-wrap: wrap; }
.tag {
  font-size: 9px; padding: 4px 10px; border-radius: 6px; font-weight: 700;
  text-transform: uppercase; letter-spacing: 0.5px;
}
.tag-g { background: rgba(0,255,68,0.08); color: var(--primary); border: 1px solid rgba(0,255,68,0.15); }
.tag-y { background: rgba(255,165,2,0.08); color: var(--warning); border: 1px solid rgba(255,165,2,0.15); }
.tag-b { background: rgba(59,130,246,0.08); color: var(--info); border: 1px solid rgba(59,130,246,0.15); }

/* === TABLE === */
.tbl { width: 100%; border-collapse: collapse; }
.tbl th { text-align: left; padding: 12px 14px; font-size: 10px; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; border-bottom: 2px solid var(--border); font-weight: 800; }
.tbl td { padding: 11px 14px; font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.03); }
.tbl tr { transition: 0.2s; }
.tbl tr:hover td { background: rgba(0,255,68,0.02); }
.badge { padding: 3px 10px; border-radius: 6px; font-size: 9px; font-weight: 800; text-transform: uppercase; display: inline-block; }
.badge-pass { background: rgba(46,213,115,0.12); color: var(--success); border: 1px solid rgba(46,213,115,0.25); }
.badge-fail { background: rgba(255,71,87,0.12); color: var(--danger); border: 1px solid rgba(255,71,87,0.25); }
.badge-pend { background: rgba(255,165,2,0.12); color: var(--warning); border: 1px solid rgba(255,165,2,0.25); }
.badge-ok { background: rgba(0,255,68,0.12); color: var(--primary); border: 1px solid rgba(0,255,68,0.25); }
.badge-rej { background: rgba(255,71,87,0.12); color: var(--danger); border: 1px solid rgba(255,71,87,0.25); }

/* === INTRO === */
.intro {
  max-width: 560px; margin: 50px auto; background: var(--bg-card);
  border: 1px solid var(--glass); border-radius: 24px; padding: 45px 35px;
  text-align: center; backdrop-filter: blur(10px); position: relative; overflow: hidden;
  box-shadow: 0 20px 60px rgba(0,0,0,0.4), 0 0 40px rgba(0,255,68,0.08);
}
.intro::before {
  content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--warning), var(--primary));
  background-size: 200% 100%; animation: shimmer 4s linear infinite;
}
.intro .t-emoji { font-size: 70px; margin-bottom: 20px; }
.intro h2 { font-size: 24px; font-weight: 900; margin-bottom: 8px; letter-spacing: -0.5px; }
.intro-stats {
  display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
  margin: 28px 0; text-align: center;
}
.intro-stat {
  background: rgba(255,255,255,0.02); border: 1px solid var(--border);
  border-radius: 14px; padding: 18px 12px; transition: 0.3s;
}
.intro-stat:hover { border-color: var(--border-hover); }
.intro-stat-val { font-size: 22px; font-weight: 900; margin-bottom: 3px; }
.intro-stat-lbl { font-size: 9px; color: var(--text-dim); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

/* === QUIZ === */
.quiz { max-width: 680px; margin: 20px auto; }
.q-progress { width: 100%; height: 5px; background: rgba(255,255,255,0.04); border-radius: 10px; margin-bottom: 22px; overflow: hidden; }
.q-progress-fill { height: 100%; background: linear-gradient(90deg, var(--primary), #00ff88); border-radius: 10px; transition: width 0.4s ease; box-shadow: 0 0 12px var(--primary-glow); }
.q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 18px; }
.q-counter { font-size: 11px; color: var(--text-dim); font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.q-timer { font-size: 30px; font-weight: 900; transition: 0.3s; }
.q-timer.normal { color: var(--primary); text-shadow: 0 0 15px var(--primary-glow); }
.q-timer.warn { color: var(--warning); text-shadow: 0 0 15px var(--warning-glow); animation: timerPulse 0.8s infinite; }
.q-timer.danger { color: var(--danger); text-shadow: 0 0 15px var(--danger-glow); animation: timerPulse 0.4s infinite; }
.q-card {
  background: var(--bg-card); border: 1px solid var(--glass);
  border-radius: 20px; padding: 28px; margin-bottom: 18px;
  backdrop-filter: blur(10px);
  box-shadow: 0 5px 25px rgba(0,0,0,0.3);
}
.q-card h3 { font-size: 17px; font-weight: 700; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
.q-answers { display: flex; flex-direction: column; gap: 10px; margin-bottom: 18px; }
.a-btn {
  background: rgba(255,255,255,0.02); border: 2px solid rgba(255,255,255,0.06);
  border-radius: 14px; padding: 15px 18px; color: var(--text);
  font-size: 14px; font-weight: 600; cursor: pointer; text-align: left;
  transition: all 0.25s ease; display: flex; align-items: center; gap: 14px;
  position: relative; overflow: hidden;
}
.a-btn:hover { border-color: rgba(0,255,68,0.3); background: rgba(0,255,68,0.04); transform: translateX(4px); }
.a-btn:active { transform: scale(0.98); }
.a-btn.sel { border-color: var(--primary); background: rgba(0,255,68,0.08); box-shadow: 0 0 20px rgba(0,255,68,0.1); }
.a-btn.correct { border-color: var(--success) !important; background: rgba(46,213,115,0.1) !important; }
.a-btn.wrong { border-color: var(--danger) !important; background: rgba(255,71,87,0.08) !important; }
.a-letter {
  width: 34px; height: 34px; border-radius: 10px; background: rgba(255,255,255,0.04);
  display: flex; align-items: center; justify-content: center;
  font-weight: 900; font-size: 12px; color: var(--text-dim);
  flex-shrink: 0; border: 1px solid rgba(255,255,255,0.08); transition: 0.3s;
}
.a-btn.sel .a-letter { background: var(--primary); color: black; border-color: var(--primary); box-shadow: 0 0 10px var(--primary-glow); }
.free-area { margin-top: 14px; }
.free-toggle {
  display: flex; align-items: center; gap: 10px; cursor: pointer;
  padding: 12px 16px; border-radius: 12px; border: 1px dashed rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.01); transition: 0.3s;
  font-size: 13px; color: var(--text-dim); font-weight: 600;
}
.free-toggle:hover { border-color: var(--primary); color: var(--primary-bright); }
.free-toggle.on { border-color: var(--primary); color: var(--primary); background: rgba(0,255,68,0.05); border-style: solid; }
.free-input {
  width: 100%; margin-top: 10px; background: rgba(0,0,0,0.35);
  border: 1px solid rgba(255,255,255,0.08); color: white; padding: 14px;
  border-radius: 12px; font-size: 14px; outline: none; font-family: inherit;
  resize: vertical; min-height: 80px; transition: 0.3s;
}
.free-input:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0,255,68,0.12); }

/* === RESULT === */
.result { max-width: 620px; margin: 35px auto; text-align: center; animation: scaleIn 0.5s ease; }
.r-circle {
  width: 150px; height: 150px; border-radius: 50%; margin: 0 auto 25px;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  border: 4px solid; position: relative;
}
.r-circle.pass { border-color: var(--primary); box-shadow: 0 0 40px var(--primary-glow), 0 0 80px rgba(0,255,68,0.15); animation: glowPulse 2.5s infinite; }
.r-circle.fail { border-color: var(--danger); box-shadow: 0 0 30px var(--danger-glow); }
.r-circle.pend { border-color: var(--warning); box-shadow: 0 0 30px var(--warning-glow); }
.r-score { font-size: 38px; font-weight: 900; }
.r-max { font-size: 11px; color: var(--text-dim); font-weight: 700; }
.r-status { font-size: 26px; font-weight: 900; margin-bottom: 8px; }
.r-status.pass { color: var(--primary); animation: neonText 3s infinite; }
.r-status.fail { color: var(--danger); text-shadow: 0 0 15px var(--danger-glow); }
.r-status.pend { color: var(--warning); text-shadow: 0 0 15px var(--warning-glow); }
.r-detail {
  background: var(--bg-card); border: 1px solid rgba(255,255,255,0.04);
  border-radius: 14px; padding: 16px; margin-bottom: 8px; text-align: left;
  display: flex; align-items: flex-start; gap: 12px; transition: 0.2s;
}
.r-detail:hover { border-color: var(--border); }
.r-mark { width: 28px; height: 28px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 13px; flex-shrink: 0; font-weight: 900; }
.r-mark.ok { background: rgba(0,255,68,0.12); color: var(--primary); }
.r-mark.no { background: rgba(255,71,87,0.12); color: var(--danger); }
.r-mark.wait { background: rgba(255,165,2,0.12); color: var(--warning); }

/* === BUTTONS === */
.btn {
  padding: 13px 26px; border: none; border-radius: 12px;
  font-weight: 800; font-size: 12px; cursor: pointer;
  text-transform: uppercase; letter-spacing: 0.5px;
  transition: all 0.25s ease; position: relative; overflow: hidden;
  display: inline-flex; align-items: center; gap: 6px;
}
.btn:active { transform: scale(0.96); }
.btn-g { background: var(--primary); color: black; box-shadow: 0 4px 15px rgba(0,255,68,0.25); }
.btn-g:hover { background: var(--primary-bright); box-shadow: 0 6px 25px rgba(0,255,68,0.4); transform: translateY(-2px); }
.btn-r { background: rgba(255,71,87,0.08); border: 1px solid var(--danger); color: var(--danger); }
.btn-r:hover { background: var(--danger); color: white; transform: translateY(-2px); box-shadow: 0 6px 20px var(--danger-glow); }
.btn-s { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); color: var(--text); }
.btn-s:hover { border-color: var(--primary); color: var(--primary-bright); background: var(--primary-dim); transform: translateY(-2px); }
.btn-w { background: rgba(255,165,2,0.08); border: 1px solid var(--warning); color: var(--warning); }
.btn-w:hover { background: var(--warning); color: black; transform: translateY(-2px); box-shadow: 0 6px 20px var(--warning-glow); }
.btn-i { background: rgba(59,130,246,0.08); border: 1px solid var(--info); color: var(--info); }
.btn-i:hover { background: var(--info); color: white; transform: translateY(-2px); box-shadow: 0 6px 20px var(--info-glow); }
.btn-disabled { opacity: 0.35; cursor: not-allowed !important; }
.btn-disabled:hover { transform: none !important; box-shadow: none !important; }
.btns { display: flex; gap: 10px; justify-content: center; margin-top: 22px; flex-wrap: wrap; }

/* === FORMS === */
.card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 18px; padding: 28px; backdrop-filter: blur(10px); margin-bottom: 18px; }
.f-row { margin-bottom: 16px; }
.f-label { display: block; font-size: 10px; color: var(--primary); margin-bottom: 7px; text-transform: uppercase; font-weight: 800; letter-spacing: 1px; }
.f-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08); color: white; padding: 13px; border-radius: 11px; font-size: 13px; outline: none; font-family: inherit; transition: 0.3s; }
.f-input:focus { border-color: var(--primary); box-shadow: 0 0 12px rgba(0,255,68,0.12); }
.f-input::placeholder { color: rgba(255,255,255,0.15); }
.f-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.f-hint { font-size: 10px; color: var(--text-dim); margin-top: 5px; }

/* === Q BUILDER === */
.qb {
  background: rgba(255,255,255,0.015); border: 1px solid rgba(255,255,255,0.05);
  border-radius: 16px; padding: 22px; margin-bottom: 14px; transition: 0.3s; position: relative;
}
.qb.err { border-color: var(--danger) !important; animation: shake 0.5s; box-shadow: 0 0 20px var(--danger-glow); }
.qb-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.qb-num { font-size: 11px; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }
.qb-del { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 16px; opacity: 0.4; transition: 0.3s; }
.qb-del:hover { opacity: 1; transform: scale(1.15); }
.opt-row { display: flex; align-items: center; gap: 10px; margin-bottom: 7px; }
.opt-radio {
  width: 22px; height: 22px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.15);
  cursor: pointer; transition: 0.3s; flex-shrink: 0; display: flex; align-items: center; justify-content: center;
}
.opt-radio:hover { border-color: var(--primary); }
.opt-radio.on { border-color: var(--primary); background: var(--primary); box-shadow: 0 0 8px var(--primary-glow); }
.opt-radio.on::after { content: '‚úì'; color: black; font-size: 11px; font-weight: 900; }
.opt-input {
  flex: 1; background: rgba(0,0,0,0.25); border: 1px solid rgba(255,255,255,0.06);
  color: white; padding: 10px 13px; border-radius: 9px; font-size: 12px; outline: none;
  font-family: inherit; transition: 0.3s;
}
.opt-input:focus { border-color: var(--primary); }
.opt-del { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 13px; opacity: 0.3; transition: 0.3s; }
.opt-del:hover { opacity: 1; }
.add-opt {
  background: none; border: 1px dashed rgba(255,255,255,0.08); color: var(--text-dim);
  padding: 8px; border-radius: 9px; cursor: pointer; font-size: 11px; width: 100%;
  transition: 0.3s; font-weight: 600;
}
.add-opt:hover { border-color: var(--primary); color: var(--primary); }
.free-sw { display: flex; align-items: center; gap: 8px; margin-top: 10px; cursor: pointer; font-size: 11px; color: var(--text-dim); font-weight: 600; transition: 0.3s; }
.free-sw:hover { color: var(--primary); }
.sw { width: 34px; height: 18px; border-radius: 10px; background: rgba(255,255,255,0.08); position: relative; transition: 0.3s; flex-shrink: 0; }
.sw.on { background: var(--primary); }
.sw::after { content: ''; position: absolute; top: 2px; left: 2px; width: 14px; height: 14px; border-radius: 50%; background: white; transition: 0.3s; }
.sw.on::after { left: 18px; }
.time-row { display: flex; align-items: center; gap: 8px; margin-top: 10px; }
.time-row label { font-size: 11px; color: var(--text-dim); font-weight: 600; }
.time-input { width: 70px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08); color: white; padding: 6px 10px; border-radius: 8px; font-size: 12px; outline: none; font-family: inherit; text-align: center; }

/* === MANAGE === */
.m-card {
  background: var(--bg-card); border: 1px solid rgba(255,255,255,0.04);
  border-radius: 14px; padding: 18px 20px; margin-bottom: 10px;
  display: flex; justify-content: space-between; align-items: center;
  transition: 0.3s; flex-wrap: wrap; gap: 10px;
}
.m-card:hover { border-color: var(--border); background: rgba(0,255,68,0.02); }

/* === SETTINGS === */
.set-block {
  background: var(--bg-card); border: 1px solid rgba(255,255,255,0.04);
  border-radius: 16px; padding: 22px; margin-bottom: 14px;
}
.set-block h4 { font-size: 12px; font-weight: 800; color: var(--primary-bright); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
.chip {
  display: inline-flex; align-items: center; gap: 5px;
  background: rgba(0,255,68,0.08); border: 1px solid rgba(0,255,68,0.18);
  color: var(--primary-bright); padding: 5px 11px; border-radius: 8px;
  font-size: 11px; font-weight: 700; margin: 3px;
}
.chip button { background: none; border: none; color: var(--danger); cursor: pointer; font-size: 13px; margin-left: 3px; transition: 0.2s; }
.chip button:hover { transform: scale(1.2); }
.chip-y { background: rgba(255,165,2,0.08); border-color: rgba(255,165,2,0.2); color: var(--warning); }
.p-drop { position: relative; }
.p-list {
  position: absolute; top: 100%; left: 0; right: 0;
  background: rgba(8,12,20,0.98); border: 1px solid var(--glass);
  border-radius: 12px; max-height: 180px; overflow-y: auto; z-index: 100;
  display: none; box-shadow: 0 10px 40px rgba(0,0,0,0.7);
}
.p-list.show { display: block; animation: slideDown 0.2s ease; }
.p-item { padding: 10px 14px; cursor: pointer; font-size: 12px; display: flex; justify-content: space-between; transition: 0.2s; }
.p-item:hover { background: rgba(0,255,68,0.06); }

/* === REVIEW === */
.rev-card {
  background: var(--bg-card); border: 1px solid rgba(255,255,255,0.05);
  border-radius: 18px; padding: 25px; margin-bottom: 14px;
}
.rev-q { margin-bottom: 12px; padding: 14px; background: rgba(255,255,255,0.015); border-radius: 11px; border-left: 3px solid; }
.rev-q.ok { border-color: var(--primary); }
.rev-q.no { border-color: var(--danger); }
.rev-q.wait { border-color: var(--warning); }

/* === RESPONSIVE === */
@media(max-width:768px) {
  .stats { grid-template-columns: 1fr 1fr; }
  .tests-grid { flex-direction: column; align-items: stretch; }
  .t-card { width: 100%; }
  .nav-bar { justify-content: center; }
  .hdr-right { gap: 8px; }
  .f-grid { grid-template-columns: 1fr; }
  #notifPanel { right: -40px; width: 290px; }
  header { padding: 12px 15px; }
  .intro { margin: 25px 15px; padding: 30px 20px; }
}
@media(max-width:480px) {
  .stats { grid-template-columns: 1fr; }
  header { flex-direction: column; gap: 10px; }
}
</style>
</head>
<body>

<header>
  <a href="cabinet.html" class="logo"><span class="logo-icon">‚öî –î–®–í</span><span class="logo-sub">–Ü—Å–ø–∏—Ç –¶–µ–Ω—Ç—Ä</span></a>
  <div class="hdr-right">
    <div class="nav-bar" id="nav"></div>
    <div class="notif-wrap" onclick="toggleNotifs(event)">
      <span class="bell">üîî</span><div class="bell-badge" id="bellBadge">0</div>
      <div id="notifPanel">
        <div class="notif-head"><span style="font-size:10px;font-weight:800;color:var(--primary)">–°–ü–û–í–Ü–©–ï–ù–ù–Ø</span><button onclick="clearNotifs()" style="background:none;border:none;color:var(--text-dim);font-size:9px;cursor:pointer;font-weight:700">–û–ß–ò–°–¢–ò–¢–ò</button></div>
        <div id="notifList"><div style="color:var(--text-dim);text-align:center;padding:18px;font-size:11px">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div></div>
      </div>
    </div>
    <span class="hdr-name" id="hdrName">...</span>
    <span class="hdr-role" id="hdrRole">...</span>
  </div>
</header>

<div class="main">
  <div class="view active" id="vHome"><div class="stats" id="stats"></div><div class="s-title">üìã –î–æ—Å—Ç—É–ø–Ω—ñ —ñ—Å–ø–∏—Ç–∏</div><div class="tests-grid" id="testsGrid"></div><div class="s-title">üìä –ú–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</div><div id="myRes"></div></div>
  <div class="view" id="vIntro"><div class="intro" id="introCard"></div></div>
  <div class="view" id="vQuiz"><div class="quiz" id="quizBox"></div></div>
  <div class="view" id="vResult"><div class="result" id="resultBox"></div></div>
  <div class="view" id="vCreate"><div class="s-title" id="createTitle">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç</div><div id="createForm"></div></div>
  <div class="view" id="vReview"><div class="s-title">üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π</div><div id="reviewList"></div></div>
  <div class="view" id="vManage"><div class="s-title">‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è —ñ—Å–ø–∏—Ç–∞–º–∏</div><div id="manageList"></div></div>
  <div class="view" id="vSettings"><div class="s-title">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</div><div id="setContent"></div></div>
  <div class="view" id="vAdmins"><div class="s-title">üëë –ê–¥–º—ñ–Ω –ø—Ä–∞–≤–∞</div><div id="admContent"></div></div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import{getAuth,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import{getFirestore,doc,getDoc,getDocs,collection}from"https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const app=initializeApp({apiKey:"AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",authDomain:"dsv-gta.firebaseapp.com",projectId:"dsv-gta",storageBucket:"dsv-gta.firebasestorage.app",messagingSenderId:"661591588818",appId:"1:661591588818:web:a8e8dca3d061447e24d20b"});
const auth=getAuth(app),db=getFirestore(app);

let ME={name:'–ù–µ–≤—ñ–¥–æ–º–∏–π',role:'fighter',uid:''};
let allUsers=[];
let tests=JSON.parse(localStorage.getItem('isput_tests')||'[]');
let results=JSON.parse(localStorage.getItem('isput_results')||'[]');
let reviewers=JSON.parse(localStorage.getItem('isput_reviewers')||'[]');
let adminList=JSON.parse(localStorage.getItem('isput_admins')||'[]');
let webhookUrl=localStorage.getItem('isput_webhook')||'';
let curTest=null,curQ=0,ans={},tmr=null,tLeft=30,editId=null;
const sv=()=>{localStorage.setItem('isput_tests',JSON.stringify(tests));localStorage.setItem('isput_results',JSON.stringify(results));localStorage.setItem('isput_reviewers',JSON.stringify(reviewers));localStorage.setItem('isput_admins',JSON.stringify(adminList));localStorage.setItem('isput_webhook',webhookUrl)};
const L='–ê–ë–í–ì“ê–î–ï–ñ–ó–ò';
const isAdm=()=>ME.role==='admin'||adminList.includes(ME.name);
const isRev=()=>isAdm()||reviewers.includes(ME.name);
const gid=()=>Date.now().toString(36)+Math.random().toString(36).substr(2,5);
const dt=()=>{const d=new Date();return d.toLocaleDateString('uk')+' '+d.toLocaleTimeString('uk',{hour:'2-digit',minute:'2-digit'})};

// === FIREBASE ===
onAuthStateChanged(auth,async u=>{
  if(!u){location.href='index.html';return}
  ME.uid=u.uid;
  try{const s=await getDoc(doc(db,'users',u.uid));if(s.exists()){const d=s.data();ME.name=d.name||'–ù–µ–≤—ñ–¥–æ–º–∏–π';ME.role=d.role||'fighter'}
  const a=await getDocs(collection(db,'users'));allUsers=[];a.forEach(s=>{const d=s.data();allUsers.push({uid:s.id,name:d.name||'---',role:d.role||'fighter'})})}catch(e){}
  document.getElementById('hdrName').textContent=ME.name;
  const r=document.getElementById('hdrRole');
  if(ME.role==='admin'){r.textContent='–ê–î–ú–Ü–ù';r.className='hdr-role role-admin'}
  else if(ME.role==='instructor'){r.textContent='–Ü–ù–°–¢–†–£–ö–¢–û–†';r.className='hdr-role role-instructor'}
  else{r.textContent='–ë–Ü–Ñ–¶–¨';r.className='hdr-role role-fighter'}
  buildNav();go('Home');
});

// === NOTIFS ===
let notifs=JSON.parse(localStorage.getItem('isput_notifs')||'[]');
function addN(t){notifs.unshift({text:t,time:dt(),read:false});if(notifs.length>20)notifs.pop();localStorage.setItem('isput_notifs',JSON.stringify(notifs));rndN()}
function rndN(){const l=document.getElementById('notifList'),b=document.getElementById('bellBadge'),u=notifs.filter(n=>!n.read).length;
if(u>0){b.textContent=u;b.style.display='block'}else b.style.display='none';
if(!notifs.length){l.innerHTML='<div style="color:var(--text-dim);text-align:center;padding:18px;font-size:11px">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>';return}
l.innerHTML=notifs.map((n,i)=>`<div class="notif-item${n.read?' read':''}" onclick="rdN(${i})"><div style="font-size:11px;font-weight:600;margin-bottom:2px">${n.text}</div><div style="font-size:9px;color:var(--text-dim)">${n.time}</div></div>`).join('')}
window.rdN=i=>{notifs[i].read=true;localStorage.setItem('isput_notifs',JSON.stringify(notifs));rndN()};
window.clearNotifs=()=>{notifs=[];localStorage.setItem('isput_notifs','[]');rndN()};
window.toggleNotifs=e=>{e.stopPropagation();const p=document.getElementById('notifPanel');p.style.display=p.style.display==='flex'?'none':'flex'};
document.addEventListener('click',e=>{if(!e.target.closest('.notif-wrap'))document.getElementById('notifPanel').style.display='none'});

// === WEBHOOK ===
async function wh(embed){if(!webhookUrl)return;try{await fetch(webhookUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[embed]})})}catch(e){}}
function whResult(r,t,rev){
  const p=r.status==='approved'||(r.status==='auto'&&r.score>=t.passScore);
  wh({title:p?'‚úÖ  –Ü–°–ü–ò–¢ –°–ö–õ–ê–î–ï–ù–û':'‚ùå  –Ü–°–ü–ò–¢ –ù–ï –°–ö–õ–ê–î–ï–ù–û',color:p?0x00ff44:0xff4757,
  fields:[
    {name:'',value:'‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',inline:false},
    {name:'üë§  –ë–æ—î—Ü—å',value:'```'+r.userName+'```',inline:true},
    {name:'üìù  –Ü—Å–ø–∏—Ç',value:'```'+t.name+'```',inline:true},
    {name:'\u200b',value:'\u200b',inline:true},
    {name:'üìä  –†–µ–∑—É–ª—å—Ç–∞—Ç',value:'```'+r.score+' / '+t.maxScore+' –±–∞–ª—ñ–≤```',inline:true},
    {name:'üéØ  –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª',value:'```'+t.passScore+' –±–∞–ª—ñ–≤```',inline:true},
    {name:'\u200b',value:'\u200b',inline:true},
    {name:'üîç  –ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π',value:'```'+(rev||'SYSTEM')+'```',inline:true},
    {name:'üìÖ  –î–∞—Ç–∞',value:'```'+r.date+'```',inline:true},
    {name:'',value:'‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ',inline:false}
  ],footer:{text:'‚öî –î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†'},timestamp:new Date().toISOString()})}
function whNotify(){if(!webhookUrl)return;wh({title:'üì¢  –ù–û–í–ò–ô –Ü–°–ü–ò–¢ –ù–ê –ü–ï–†–ï–í–Ü–†–ö–£',color:0xffa502,description:'–ù–∞–¥—ñ–π—à–æ–≤ –Ω–æ–≤–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑ –≤—ñ–ª—å–Ω–∏–º–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—è–º–∏.\n–ü–æ—Ç—Ä—ñ–±–Ω–∞ —Ä—É—á–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á–µ–º.',footer:{text:'‚öî –î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†'},timestamp:new Date().toISOString()})}

// === NAV ===
function buildNav(){const n=document.getElementById('nav');let h='<button class="nav-btn active" onclick="go(\'Home\')">üè†</button>';
if(isAdm()){h+='<button class="nav-btn" onclick="go(\'Create\')">‚ûï</button><button class="nav-btn" onclick="go(\'Manage\')">‚öôÔ∏è</button><button class="nav-btn" onclick="go(\'Settings\')">üîß</button><button class="nav-btn" onclick="go(\'Admins\')">üëë</button>'}
if(isRev())h+='<button class="nav-btn" onclick="go(\'Review\')">üîç</button>';n.innerHTML=h}

window.go=v=>{
  document.querySelectorAll('.view').forEach(e=>e.classList.remove('active'));
  document.getElementById('v'+v).classList.add('active');
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const map={Home:0,Create:1,Manage:2,Settings:3,Admins:4,Review:isAdm()?5:1};
  const btns=document.querySelectorAll('.nav-btn');if(btns[map[v]])btns[map[v]].classList.add('active');
  if(v==='Home')rndHome();if(v==='Create')rndCreate();if(v==='Review')rndReview();if(v==='Manage')rndManage();if(v==='Settings')rndSet();if(v==='Admins')rndAdm();
  window.scrollTo({top:0,behavior:'smooth'});
};

// === HOME ===
function rndHome(){
  const my=results.filter(r=>r.userId===ME.uid);
  const passed=my.filter(r=>{const t=tests.find(x=>x.id===r.testId);return(r.status==='approved'||(r.status==='auto'&&t&&r.score>=t.passScore))}).length;
  const failed=my.filter(r=>{const t=tests.find(x=>x.id===r.testId);return(r.status==='rejected'||(r.status==='auto'&&t&&r.score<t.passScore))}).length;
  const pend=my.filter(r=>r.status==='pending').length;
  document.getElementById('stats').innerHTML=`<div class="stat"><div class="stat-val white">${tests.length}</div><div class="stat-lbl">–Ü—Å–ø–∏—Ç—ñ–≤</div></div><div class="stat"><div class="stat-val green">${passed}</div><div class="stat-lbl">–°–∫–ª–∞–¥–µ–Ω–æ</div></div><div class="stat"><div class="stat-val red">${failed}</div><div class="stat-lbl">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div></div><div class="stat"><div class="stat-val yellow">${pend}</div><div class="stat-lbl">–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</div></div>`;

  if(!tests.length)document.getElementById('testsGrid').innerHTML='<div style="color:var(--text-dim);text-align:center;padding:40px;width:100%;font-size:13px">–Ü—Å–ø–∏—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</div>';
  else document.getElementById('testsGrid').innerHTML=tests.map(t=>{const pps=t.questions.length?Math.round(t.maxScore/t.questions.length*10)/10:0;
    return`<div class="t-card" onclick="goIntro('${t.id}')"><span class="t-emoji">${t.emoji||'üìù'}</span><h3>${t.name}</h3><p>${t.description||'–ë–µ–∑ –æ–ø–∏—Å—É'}</p><div class="t-tags"><span class="tag tag-g">‚ùì ${t.questions.length} –ø–∏—Ç–∞–Ω—å</span><span class="tag tag-y">üéØ ${t.passScore}/${t.maxScore} –±.</span><span class="tag tag-b">üíé ${pps} –±./–ø–∏—Ç.</span></div></div>`}).join('');

  if(!my.length)document.getElementById('myRes').innerHTML='<div style="color:var(--text-dim);text-align:center;padding:30px;font-size:12px">–í–∏ —â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —ñ—Å–ø–∏—Ç–∏</div>';
  else{const rows=my.map(r=>{const t=tests.find(x=>x.id===r.testId);const ps=t?t.passScore:0;let st,sc;
    if(r.status==='pending'){st='–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ';sc='badge-pend'}else if(r.status==='approved'){st='–°—Ö–≤–∞–ª–µ–Ω–æ';sc='badge-ok'}else if(r.status==='rejected'){st='–í—ñ–¥—Ö–∏–ª–µ–Ω–æ';sc='badge-rej'}else{const p=r.score>=ps;st=p?'–°–∫–ª–∞–¥–µ–Ω–æ':'–ù–µ —Å–∫–ª–∞–¥–µ–Ω–æ';sc=p?'badge-pass':'badge-fail'}
    return`<tr><td style="font-weight:700">${t?t.name:'–í–∏–¥–∞–ª–µ–Ω–∏–π'}</td><td><b>${r.score}</b> / ${t?t.maxScore:'?'}</td><td><span class="badge ${sc}">${st}</span></td><td>${r.reviewer||'SYSTEM'}</td><td style="color:var(--text-dim)">${r.date}</td></tr>`}).join('');
    document.getElementById('myRes').innerHTML=`<div style="overflow-x:auto"><table class="tbl"><thead><tr><th>–Ü—Å–ø–∏—Ç</th><th>–ë–∞–ª–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π</th><th>–î–∞—Ç–∞</th></tr></thead><tbody>${rows}</tbody></table></div>`}
}

// === INTRO ===
window.goIntro=id=>{const t=tests.find(x=>x.id===id);if(!t)return;
  const hp=results.find(r=>r.testId===id&&r.userId===ME.uid&&r.status==='pending');
  if(hp){alert('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –ª—é–¥–∏–Ω–æ—é! –î–æ—á–µ–∫–∞–π—Ç–µ—Å—å.');return}
  curTest=t;const pps=t.questions.length?Math.round(t.maxScore/t.questions.length*10)/10:0;
  const totalTime=t.questions.reduce((s,q)=>s+(q.time||30),0);
  document.getElementById('introCard').innerHTML=`<span class="t-emoji">${t.emoji||'üìù'}</span><h2>${t.name}</h2><p style="color:var(--text-dim);font-size:13px;margin-bottom:5px">${t.description||''}</p>
  <div class="intro-stats"><div class="intro-stat"><div class="intro-stat-val" style="color:var(--primary)">${t.questions.length}</div><div class="intro-stat-lbl">–ü–∏—Ç–∞–Ω—å</div></div>
  <div class="intro-stat"><div class="intro-stat-val" style="color:var(--warning)">${t.passScore}/${t.maxScore}</div><div class="intro-stat-lbl">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª</div></div>
  <div class="intro-stat"><div class="intro-stat-val" style="color:var(--info)">‚è± ${totalTime}—Å</div><div class="intro-stat-lbl">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å</div></div>
  <div class="intro-stat"><div class="intro-stat-val" style="color:var(--success)">${pps}</div><div class="intro-stat-lbl">–ë–∞–ª—ñ–≤ –∑–∞ –ø–∏—Ç–∞–Ω–Ω—è</div></div></div>
  <div class="btns"><button class="btn btn-g" onclick="startQ()">üöÄ –†–û–ó–ü–û–ß–ê–¢–ò</button><button class="btn btn-s" onclick="go('Home')">‚Üê –ù–∞–∑–∞–¥</button></div>`;
  go('Intro');
};

// === QUIZ ===
window.startQ=()=>{curQ=0;ans={};go('Quiz');rndQ()};
function rndQ(){if(!curTest)return;const q=curTest.questions[curQ],tot=curTest.questions.length,pps=tot?Math.round(curTest.maxScore/tot*10)/10:0;
  const prog=((curQ)/tot)*100;clearInterval(tmr);tLeft=q.time||30;
  let opts=q.options.map((o,i)=>{const sel=ans[curQ]?.type==='choice'&&ans[curQ]?.value===i;
    return`<div class="a-btn${sel?' sel':''}" onclick="selAns(${i})"><div class="a-letter">${L[i]||i+1}</div><div>${o.text}</div></div>`}).join('');
  const hf=q.allowFree,fa=ans[curQ]?.type==='free',fv=fa?ans[curQ]?.value:'';
  document.getElementById('quizBox').innerHTML=`<div class="q-progress"><div class="q-progress-fill" style="width:${prog}%"></div></div>
  <div class="q-header"><div class="q-counter">–ü–∏—Ç–∞–Ω–Ω—è ${curQ+1} –∑ ${tot} ¬∑ <span style="color:var(--primary)">${pps} –±.</span></div><div class="q-timer normal" id="tmr">${tLeft}</div></div>
  <div class="q-card"><h3>${q.text}</h3></div><div class="q-answers">${opts}</div>
  ${hf?`<div class="free-area"><div class="free-toggle${fa?' on':''}" onclick="togFree()">‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç–∏ —Å–≤—ñ–π –≤–∞—Ä—ñ–∞–Ω—Ç</div>${fa?`<textarea class="free-input" id="freeIn" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...">${fv}</textarea>`:''}</div>`:''}
  <div class="btns">${curQ>0?'<button class="btn btn-s" onclick="prevQ()">‚Üê –ù–∞–∑–∞–¥</button>':''}<button class="btn btn-g" onclick="nextQ()">${curQ===tot-1?'üèÅ –ó–∞–≤–µ—Ä—à–∏—Ç–∏':'–î–∞–ª—ñ ‚Üí'}</button></div>`;
  startTmr()}

function startTmr(){const el=()=>document.getElementById('tmr');tmr=setInterval(()=>{tLeft--;const d=el();if(d){d.textContent=tLeft;
  if(tLeft<=5){d.className='q-timer danger'}else if(tLeft<=10){d.className='q-timer warn'}else{d.className='q-timer normal'}}
  if(tLeft<=0){clearInterval(tmr);nextQ()}},1000)}

window.selAns=i=>{ans[curQ]={type:'choice',value:i};rndQ()};
window.togFree=()=>{if(ans[curQ]?.type==='free')delete ans[curQ];else ans[curQ]={type:'free',value:''};rndQ()};
window.prevQ=()=>{if(curQ>0){saveFree();clearInterval(tmr);curQ--;rndQ()}};
window.nextQ=()=>{saveFree();clearInterval(tmr);if(curQ>=curTest.questions.length-1)finishQ();else{curQ++;rndQ()}};
function saveFree(){const f=document.getElementById('freeIn');if(f&&ans[curQ]?.type==='free')ans[curQ].value=f.value}

// === FINISH ===
function finishQ(){const t=curTest,tot=t.questions.length,pps=tot?t.maxScore/tot:0;
  let score=0,details=[],hasFree=false;
  t.questions.forEach((q,i)=>{const a=ans[i];let d={qText:q.text,answered:false,correct:false,points:0,userAnswer:'',correctAnswer:'',isFree:false,status:'wrong'};
    const ci=q.options.findIndex(o=>o.correct);d.correctAnswer=ci>=0?q.options[ci].text:'‚Äî';
    if(!a){d.userAnswer='–ë–µ–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ'}
    else if(a.type==='choice'){d.userAnswer=q.options[a.value]?.text||'‚Äî';d.answered=true;if(q.options[a.value]?.correct){d.correct=true;d.points=pps;score+=pps;d.status='correct'}}
    else if(a.type==='free'){d.userAnswer=a.value||'–ü–æ—Ä–æ–∂–Ω—å–æ';d.answered=true;d.isFree=true;d.status='pending';hasFree=true}
    details.push(d)});
  score=Math.round(score*100)/100;
  const status=hasFree?'pending':'auto';
  const r={id:gid(),testId:t.id,testName:t.name,userId:ME.uid,userName:ME.name,score,maxScore:t.maxScore,passScore:t.passScore,details,date:dt(),status,reviewer:hasFree?null:'SYSTEM'};
  results.push(r);sv();
  if(!hasFree){whResult(r,t,'SYSTEM');const p=score>=t.passScore;addN(p?`‚úÖ –Ü—Å–ø–∏—Ç "${t.name}" —Å–∫–ª–∞–¥–µ–Ω–æ: ${score}/${t.maxScore}`:`‚ùå –Ü—Å–ø–∏—Ç "${t.name}" –Ω–µ —Å–∫–ª–∞–¥–µ–Ω–æ: ${score}/${t.maxScore}`)}
  else{whNotify();addN(`‚è≥ –Ü—Å–ø–∏—Ç "${t.name}" –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É`)}
  rndResult(r);go('Result')}

// === RESULT ===
function rndResult(r){const t=tests.find(x=>x.id===r.testId),ps=t?t.passScore:0;
  const ip=r.status==='pending',passed=!ip&&r.score>=ps;
  const cls=ip?'pend':passed?'pass':'fail';
  let dh=r.details.map((d,i)=>{let mc=d.status==='correct'?'ok':d.status==='pending'?'wait':'no';
    let mi=d.status==='correct'?'‚úì':d.status==='pending'?'?':'‚úó';
    let pt=d.status==='correct'?`<span style="color:var(--primary);font-weight:800">+${Math.round(d.points*10)/10} –±.</span>`:d.status==='pending'?`<span style="color:var(--warning);font-weight:800">–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ</span>`:`<span style="color:var(--danger);font-weight:800">0 –±.</span>`;
    return`<div class="r-detail"><div class="r-mark ${mc}">${mi}</div><div style="flex:1"><div style="font-size:12px;font-weight:700;margin-bottom:3px">${i+1}. ${d.qText}</div><div style="font-size:11px;color:var(--text)">–í—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.userAnswer}</b></div>${d.status!=='pending'?`<div style="font-size:10px;color:var(--primary);margin-top:2px">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.correctAnswer}</div>`:''}${pt}</div></div>`}).join('');

  const canRetry=!ip&&!results.find(x=>x.testId===r.testId&&x.userId===ME.uid&&x.status==='pending');
  document.getElementById('resultBox').innerHTML=`<div class="r-circle ${cls}"><div class="r-score" style="color:${ip?'var(--warning)':passed?'var(--primary)':'var(--danger)'}">${r.score}</div><div class="r-max">–∑ ${r.maxScore} –±–∞–ª—ñ–≤</div></div>
  <div class="r-status ${cls}">${ip?'‚è≥ –ù–ê –ü–ï–†–ï–í–Ü–†–¶–Ü':passed?'‚úÖ –Ü–°–ü–ò–¢ –°–ö–õ–ê–î–ï–ù–û':'‚ùå –ù–ï –°–ö–õ–ê–î–ï–ù–û'}</div>
  <p style="color:var(--text-dim);font-size:12px;margin-bottom:25px">${ip?'–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ª—é–¥–∏–Ω–æ—é':'–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª: '+ps}</p>
  <div style="text-align:left">${dh}</div>
  <div class="btns">${canRetry?`<button class="btn btn-g" onclick="goIntro('${r.testId}')">üîÑ –ü—Ä–æ–π—Ç–∏ –∑–Ω–æ–≤—É</button>`:`<button class="btn btn-s btn-disabled" onclick="alert('‚ö†Ô∏è –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –ª—é–¥–∏–Ω–æ—é!')">üîÑ –ü—Ä–æ–π—Ç–∏ –∑–Ω–æ–≤—É</button>`}<button class="btn btn-s" onclick="go('Home')">üè† –ù–∞ –≥–æ–ª–æ–≤–Ω—É</button></div>`}

// === CREATE / EDIT ===
function rndCreate(td){editId=td?td.id:null;document.getElementById('createTitle').innerHTML=editId?'‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ —ñ—Å–ø–∏—Ç':'‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ—Å–ø–∏—Ç';
  const t=td||{name:'',description:'',emoji:'üìù',maxScore:12,passScore:8,questions:[]};
  const qs=t.questions.length?t.questions:[{text:'',options:[{text:'',correct:false},{text:'',correct:false},{text:'',correct:false},{text:'',correct:false}],allowFree:false,time:30}];
  document.getElementById('createForm').innerHTML=`<div class="card"><div class="f-grid"><div class="f-row"><label class="f-label">–ù–∞–∑–≤–∞</label><input class="f-input" id="tName" value="${t.name.replace(/"/g,'&quot;')}" placeholder="–ù–∞–∑–≤–∞ —ñ—Å–ø–∏—Ç—É..."></div><div class="f-row"><label class="f-label">–ï–º–æ–¥–∑—ñ</label><input class="f-input" id="tEmoji" value="${t.emoji}" placeholder="üìù" style="text-align:center;font-size:22px"></div></div>
  <div class="f-row"><label class="f-label">–û–ø–∏—Å</label><textarea class="f-input" id="tDesc" rows="2" placeholder="–û–ø–∏—Å...">${t.description||''}</textarea></div>
  <div class="f-grid"><div class="f-row"><label class="f-label">–ú–∞–∫—Å. –±–∞–ª</label><input class="f-input" id="tMax" type="number" value="${t.maxScore}" min="1"></div><div class="f-row"><label class="f-label">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª</label><input class="f-input" id="tPass" type="number" value="${t.passScore}" min="0"></div></div>
  <div class="f-hint" id="scoreH">üíé –ó–∞ –∫–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è: ${qs.length?Math.round(t.maxScore/qs.length*100)/100:0} –±–∞–ª—ñ–≤</div></div>
  <div class="s-title">üìã –ü–∏—Ç–∞–Ω–Ω—è</div><div id="qsCont">${bldQs(qs)}</div>
  <button class="btn btn-s" onclick="addQ()" style="width:100%;margin-bottom:18px">+ –î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
  <div class="btns"><button class="btn btn-g" onclick="saveT()">üíæ ${editId?'–ó–±–µ—Ä–µ–≥—Ç–∏':'–°—Ç–≤–æ—Ä–∏—Ç–∏'}</button><button class="btn btn-s" onclick="go('Home')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>${webhookUrl?'<button class="btn btn-i" onclick="testWh()">üì© –¢–µ—Å—Ç</button>':''}</div>`;
  document.getElementById('tMax').addEventListener('input',updH)}

function bldQs(qs){return qs.map((q,qi)=>{let opts=q.options.map((o,oi)=>`<div class="opt-row"><div class="opt-radio${o.correct?' on':''}" onclick="togC(${qi},${oi})"></div><input class="opt-input" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç ${L[oi]||oi+1}" value="${o.text.replace(/"/g,'&quot;')}" data-qi="${qi}" data-oi="${oi}"><button class="opt-del" onclick="delO(${qi},${oi})">‚úï</button></div>`).join('');
  return`<div class="qb" id="qb-${qi}"><div class="qb-head"><span class="qb-num">–ü–∏—Ç–∞–Ω–Ω—è ${qi+1}</span><button class="qb-del" onclick="delQ(${qi})">üóë</button></div>
  <textarea class="f-input" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è..." id="qt-${qi}" rows="2" style="margin-bottom:10px;resize:vertical">${q.text.replace(/</g,'&lt;')}</textarea>
  <div id="os-${qi}">${opts}</div><button class="add-opt" onclick="addO(${qi})">+ –î–æ–¥–∞—Ç–∏ –≤–∞—Ä—ñ–∞–Ω—Ç</button>
  <div class="free-sw" onclick="togF(${qi})"><div class="sw${q.allowFree?' on':''}" id="fs-${qi}"></div> –í—ñ–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å</div>
  <div class="time-row"><label>‚è± –ß–∞—Å (—Å–µ–∫):</label><input class="time-input" type="number" id="qtm-${qi}" value="${q.time||30}" min="10" max="600"></div></div>`}).join('')}

function updH(){const ms=parseInt(document.getElementById('tMax').value)||0,cnt=document.querySelectorAll('.qb').length;
  document.getElementById('scoreH').textContent=`üíé –ó–∞ –∫–æ–∂–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è: ${cnt?Math.round(ms/cnt*100)/100:0} –±–∞–ª—ñ–≤`}

function getQs(){const blocks=document.querySelectorAll('.qb');let qs=[];blocks.forEach((b,qi)=>{const text=document.getElementById('qt-'+qi)?.value||'';
  const rows=b.querySelectorAll('.opt-row');let opts=[];rows.forEach(r=>{const inp=r.querySelector('.opt-input'),rad=r.querySelector('.opt-radio');opts.push({text:inp.value,correct:rad.classList.contains('on')})});
  const sw=document.getElementById('fs-'+qi);const tm=parseInt(document.getElementById('qtm-'+qi)?.value)||30;
  qs.push({text,options:opts,allowFree:sw?.classList.contains('on')||false,time:Math.max(10,Math.min(600,tm))})});return qs}

function rebuildQs(qs){document.getElementById('qsCont').innerHTML=bldQs(qs)}
window.togC=(qi,oi)=>{const qs=getQs();qs[qi].options.forEach((o,i)=>o.correct=i===oi);rebuildQs(qs)};
window.delO=(qi,oi)=>{const qs=getQs();qs[qi].options.splice(oi,1);rebuildQs(qs)};
window.addO=qi=>{const qs=getQs();qs[qi].options.push({text:'',correct:false});rebuildQs(qs)};
window.delQ=qi=>{const qs=getQs();qs.splice(qi,1);rebuildQs(qs);updH()};
window.addQ=()=>{const qs=getQs();qs.push({text:'',options:[{text:'',correct:false},{text:'',correct:false},{text:'',correct:false},{text:'',correct:false}],allowFree:false,time:30});rebuildQs(qs);updH()};
window.togF=qi=>{const qs=getQs();qs[qi].allowFree=!qs[qi].allowFree;rebuildQs(qs)};

window.saveT=()=>{const name=document.getElementById('tName').value.trim(),desc=document.getElementById('tDesc').value.trim(),emoji=document.getElementById('tEmoji').value.trim()||'üìù',
  maxS=parseInt(document.getElementById('tMax').value)||12,passS=parseInt(document.getElementById('tPass').value)||8,qs=getQs();
  if(!name){alert('‚ùå –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É!');return}
  for(let i=0;i<qs.length;i++){if(!qs[i].text.trim()){const el=document.getElementById('qb-'+i);if(el){el.classList.add('err');el.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(()=>el.classList.remove('err'),2000)}alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –Ω–µ–º–∞—î —Ç–µ–∫—Å—Ç—É!`);return}
    if(!qs[i].options.some(o=>o.correct)&&!qs[i].allowFree){const el=document.getElementById('qb-'+i);if(el){el.classList.add('err');el.scrollIntoView({behavior:'smooth',block:'center'});setTimeout(()=>el.classList.remove('err'),2000)}alert(`‚ùå –ü–∏—Ç–∞–Ω–Ω—è ${i+1}: –æ–±–µ—Ä—ñ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å!`);return}}
  const obj={id:editId||gid(),name,description:desc,emoji,maxScore:maxS,passScore:passS,questions:qs,createdAt:dt(),createdBy:ME.name};
  if(editId){const idx=tests.findIndex(t=>t.id===editId);if(idx>=0)tests[idx]=obj}else tests.push(obj);
  sv();editId=null;addN(`üìù –Ü—Å–ø–∏—Ç "${name}" ${editId?'–æ–Ω–æ–≤–ª–µ–Ω–æ':'—Å—Ç–≤–æ—Ä–µ–Ω–æ'}`);alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!');go('Home')};
window.testWh=()=>{wh({title:'üß™ –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø',color:0x3b82f6,description:'–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†–£.',fields:[{name:'üë§ –í—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫',value:'```'+ME.name+'```',inline:true},{name:'üìÖ –î–∞—Ç–∞',value:'```'+dt()+'```',inline:true}],footer:{text:'‚öî –î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†'},timestamp:new Date().toISOString()});alert('üì© –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!')};

// === REVIEW ===
function rndReview(){const pend=results.filter(r=>r.status==='pending');
  if(!pend.length){document.getElementById('reviewList').innerHTML='<div style="color:var(--text-dim);text-align:center;padding:40px;font-size:13px">–ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ ‚úì</div>';return}
  document.getElementById('reviewList').innerHTML=pend.map(r=>{const t=tests.find(x=>x.id===r.testId);
    let qh=r.details.map((d,i)=>{let c=d.status==='correct'?'ok':d.status==='pending'?'wait':'no';
      let pt=d.status==='correct'?`<span style="color:var(--primary);font-size:11px;font-weight:800">+${Math.round(d.points*10)/10} –±.</span>`:d.status==='pending'?`<span style="color:var(--warning);font-size:11px;font-weight:800">? –±.</span>`:`<span style="color:var(--danger);font-size:11px;font-weight:800">0 –±.</span>`;
      return`<div class="rev-q ${c}"><div style="font-size:12px;font-weight:700;margin-bottom:4px">${i+1}. ${d.qText}</div><div style="font-size:11px;color:var(--text)">–í—ñ–¥–ø–æ–≤—ñ–¥—å: <b>${d.userAnswer}</b></div>${d.status!=='pending'?`<div style="font-size:10px;color:var(--primary);margin-top:2px">–ü—Ä–∞–≤–∏–ª—å–Ω–æ: ${d.correctAnswer}</div>`:''}${pt}</div>`}).join('');
    return`<div class="rev-card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px">
      <div><h3 style="font-size:15px;font-weight:800">${r.userName}</h3><div style="font-size:11px;color:var(--text-dim)">${r.testName||'–Ü—Å–ø–∏—Ç'} ¬∑ ${r.date}</div></div>
      <div style="font-size:20px;font-weight:900;color:var(--primary)">${r.score} / ${r.maxScore}</div></div>${qh}
      <div class="btns" style="margin-top:15px"><button class="btn btn-g" onclick="appR('${r.id}')">‚úÖ –°—Ö–≤–∞–ª–∏—Ç–∏</button><button class="btn btn-r" onclick="rejR('${r.id}')">‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button></div></div>`}).join('')}

window.appR=id=>{const r=results.find(x=>x.id===id);if(!r)return;const t=tests.find(x=>x.id===r.testId);
  const pps=t?t.maxScore/t.questions.length:0;r.details.forEach(d=>{if(d.status==='pending'){d.status='correct';d.points=pps;r.score+=pps}});
  r.score=Math.round(r.score*100)/100;r.status='approved';r.reviewer=ME.name;sv();
  whResult(r,t||{passScore:0,maxScore:r.maxScore,name:r.testName},ME.name);
  addN(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç ${r.userName} —Å—Ö–≤–∞–ª–µ–Ω–æ ‚Äî ${ME.name}`);rndReview()};
window.rejR=id=>{const r=results.find(x=>x.id===id);if(!r)return;const t=tests.find(x=>x.id===r.testId);
  r.details.forEach(d=>{if(d.status==='pending'){d.status='wrong';d.points=0}});
  r.status='rejected';r.reviewer=ME.name;sv();
  whResult(r,t||{passScore:0,maxScore:r.maxScore,name:r.testName},ME.name);
  addN(`‚ùå –†–µ–∑—É–ª—å—Ç–∞—Ç ${r.userName} –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ ‚Äî ${ME.name}`);rndReview()};

// === MANAGE ===
function rndManage(){if(!tests.length){document.getElementById('manageList').innerHTML='<div style="color:var(--text-dim);text-align:center;padding:40px;font-size:13px">–ù–µ–º–∞—î —ñ—Å–ø–∏—Ç—ñ–≤</div>';return}
  document.getElementById('manageList').innerHTML=tests.map(t=>{const res=results.filter(r=>r.testId===t.id),p=res.filter(r=>(r.status==='approved'||r.status==='auto')&&r.score>=t.passScore).length;
    return`<div class="m-card"><div><b>${t.emoji} ${t.name}</b><br><span style="font-size:10px;color:var(--text-dim)">–ü–∏—Ç–∞–Ω—å: ${t.questions.length} ¬∑ –ú–∞–∫—Å: ${t.maxScore}–± ¬∑ –ü—Ä–æ—Ö—ñ–¥: ${t.passScore}–± ¬∑ –°–∫–ª–∞–ª–∏: ${p}/${res.length}</span></div>
    <div style="display:flex;gap:6px;flex-wrap:wrap"><button class="btn btn-i" onclick="editT('${t.id}')" style="padding:7px 12px;font-size:10px">‚úèÔ∏è</button><button class="btn btn-w" onclick="clrT('${t.id}')" style="padding:7px 12px;font-size:10px">üßπ</button><button class="btn btn-r" onclick="delT('${t.id}')" style="padding:7px 12px;font-size:10px">üóë</button></div></div>`}).join('')}

window.editT=id=>{const t=tests.find(x=>x.id===id);if(t){rndCreate(t);go('Create')}};
window.clrT=id=>{if(confirm('–û—á–∏—Å—Ç–∏—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏?')){results=results.filter(r=>r.testId!==id);sv();rndManage()}};
window.delT=id=>{if(confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —ñ—Å–ø–∏—Ç?')){tests=tests.filter(t=>t.id!==id);results=results.filter(r=>r.testId!==id);sv();rndManage();addN('üóë –Ü—Å–ø–∏—Ç –≤–∏–¥–∞–ª–µ–Ω–æ')}};

// === SETTINGS ===
function rndSet(){document.getElementById('setContent').innerHTML=`<div class="set-block"><h4>üîó Discord Webhook</h4>
  <div class="f-row"><input class="f-input" id="whIn" value="${webhookUrl}" placeholder="https://discord.com/api/webhooks/..."></div>
  <div class="btns" style="justify-content:flex-start"><button class="btn btn-g" onclick="saveWh()" style="padding:9px 18px;font-size:11px">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button><button class="btn btn-i" onclick="testWh()" style="padding:9px 18px;font-size:11px">üì© –¢–µ—Å—Ç</button></div></div>
  <div class="set-block"><h4>üîç –ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ</h4>
  <div id="revChips" style="margin-bottom:10px">${reviewers.map(r=>`<span class="chip">${r}<button onclick="rmRev('${r}')">‚úï</button></span>`).join('')||'<span style="color:var(--text-dim);font-size:11px">–ù–µ –¥–æ–¥–∞–Ω–æ</span>'}</div>
  <div class="p-drop"><input class="f-input" id="revSrch" placeholder="–ü–æ—à—É–∫ –ª—é–¥–∏–Ω–∏..." oninput="fltP('rev')" onfocus="fltP('rev')"><div class="p-list" id="revDrop"></div></div></div>`}

window.saveWh=()=>{webhookUrl=document.getElementById('whIn').value.trim();sv();alert('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ!')};
window.rmRev=n=>{reviewers=reviewers.filter(r=>r!==n);sv();rndSet()};
window.fltP=type=>{const inp=document.getElementById(type+'Srch'),drop=document.getElementById(type+'Drop'),val=inp.value.toLowerCase();
  const list=type==='rev'?allUsers.filter(u=>!reviewers.includes(u.name)):allUsers.filter(u=>!adminList.includes(u.name));
  const f=val?list.filter(u=>u.name.toLowerCase().includes(val)):list;
  if(!f.length){drop.innerHTML='<div style="padding:14px;text-align:center;color:var(--text-dim);font-size:11px">–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ</div>';drop.classList.add('show');return}
  drop.innerHTML=f.map(u=>{const rl=u.role==='admin'?'–ê–¥–º—ñ–Ω':u.role==='instructor'?'–Ü–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä':'–ë—ñ—î—Ü—å';const rc=u.role==='admin'?'var(--primary)':u.role==='instructor'?'var(--warning)':'var(--text-dim)';
    return`<div class="p-item" onclick="selP('${type}','${u.name}')"><span>${u.name}</span><span style="font-size:9px;color:${rc};font-weight:700">${rl}</span></div>`}).join('');drop.classList.add('show')};
window.selP=(type,name)=>{if(type==='rev'&&!reviewers.includes(name)){reviewers.push(name);sv();rndSet()}
  if(type==='adm'&&!adminList.includes(name)){adminList.push(name);sv();rndAdm();buildNav()}
  document.querySelectorAll('.p-list').forEach(d=>d.classList.remove('show'))};
document.addEventListener('click',e=>{if(!e.target.closest('.p-drop'))document.querySelectorAll('.p-list').forEach(d=>d.classList.remove('show'))});

// === ADMIN LIST ===
function rndAdm(){document.getElementById('admContent').innerHTML=`<div class="set-block"><h4>üëë –ê–¥–º—ñ–Ω –ø—Ä–∞–≤–∞ –≤ —ñ—Å–ø–∏—Ç–∞—Ö</h4>
  <p style="font-size:10px;color:var(--text-dim);margin-bottom:14px">–¶—ñ –ª—é–¥–∏ –º–∞—é—Ç—å –ø–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø (–æ–∫—Ä—ñ–º —Ä–æ–ª—ñ admin –∑ Firebase)</p>
  <div id="admChips" style="margin-bottom:10px">${adminList.map(n=>`<span class="chip chip-y">${n}<button onclick="rmAdm('${n}')">‚úï</button></span>`).join('')||'<span style="color:var(--text-dim);font-size:11px">–ù–µ –¥–æ–¥–∞–Ω–æ</span>'}</div>
  <div class="p-drop"><input class="f-input" id="admSrch" placeholder="–ü–æ—à—É–∫ –ª—é–¥–∏–Ω–∏..." oninput="fltP('adm')" onfocus="fltP('adm')"><div class="p-list" id="admDrop"></div></div></div>`}
window.rmAdm=n=>{adminList=adminList.filter(a=>a!==n);sv();rndAdm();buildNav()};

// === SECURITY ===
document.onkeydown=e=>{if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&[73,74,67].includes(e.keyCode))||(e.ctrlKey&&e.keyCode===85))return false};

// INIT
rndN();
</script>
</body>
</html>
