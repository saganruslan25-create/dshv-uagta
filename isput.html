<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–®–í | –Ü–°–ü–ò–¢ –¶–ï–ù–¢–†</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff44;
            --primary-dim: #00cc36;
            --primary-bright: #e0ffe8;
            --primary-glow: rgba(0,255,68,0.5);
            --primary-bg: rgba(0,255,68,0.06);
            --bg: #030507;
            --bg-card: rgba(10,14,20,0.7);
            --bg-card-solid: #0a0e14;
            --border: rgba(0,255,68,0.15);
            --border-hover: rgba(0,255,68,0.4);
            --danger: #ef4444;
            --danger-glow: rgba(239,68,68,0.4);
            --warning: #f59e0b;
            --warning-bg: rgba(245,158,11,0.1);
            --success: #22c55e;
            --text: #ffffff;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --radius: 16px;
            --radius-sm: 10px;
            --radius-xs: 6px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Inter', -apple-system, sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-user-select: none; user-select: none;
        }

        body::before {
            content: '';
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: 
                radial-gradient(ellipse at 20% 50%, rgba(0,255,68,0.08), transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(0,255,68,0.06), transparent 60%);
            pointer-events: none; z-index: 0;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0,255,68,0.3); border-radius: 10px; }

        input, textarea, select { -webkit-user-select: text; user-select: text; font-family: inherit; }

        /* ‚ïê‚ïê‚ïê HEADER ‚ïê‚ïê‚ïê */
        .header {
            position: sticky; top: 0; z-index: 100;
            display: flex; align-items: center; justify-content: space-between;
            padding: 14px 5%;
            background: rgba(3,5,7,0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }
        .header-left { display: flex; align-items: center; gap: 16px; }
        .logo {
            background: var(--primary); color: #000;
            padding: 6px 14px; border-radius: 8px;
            font-weight: 900; font-size: 14px;
            text-decoration: none; text-transform: uppercase;
            box-shadow: 0 0 15px rgba(0,255,68,0.3);
        }
        .header-title { font-size: 14px; font-weight: 700; color: var(--text-secondary); letter-spacing: 1px; }
        .header-right { display: flex; align-items: center; gap: 10px; }
        .role-badge {
            padding: 5px 12px; border-radius: 6px;
            font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;
        }
        .role-admin { background: rgba(0,255,68,0.15); color: var(--primary); border: 1px solid rgba(0,255,68,0.3); }
        .role-instructor { background: var(--warning-bg); color: var(--warning); border: 1px solid rgba(245,158,11,0.3); }
        .role-fighter { background: rgba(148,163,184,0.1); color: var(--text-secondary); border: 1px solid rgba(148,163,184,0.2); }
        .user-name { font-size: 13px; font-weight: 700; color: var(--primary-bright); }
        .btn-header {
            background: rgba(255,255,255,0.04); border: 1px solid var(--border);
            color: var(--text-secondary); padding: 8px 14px; border-radius: var(--radius-xs);
            font-size: 11px; font-weight: 700; cursor: pointer; text-transform: uppercase;
            transition: all 0.2s;
        }
        .btn-header:hover { border-color: var(--primary); color: var(--primary-bright); background: var(--primary-bg); }
        .btn-back-cab {
            background: none; border: 1px solid var(--border);
            color: var(--text-secondary); padding: 8px 14px; border-radius: var(--radius-xs);
            font-size: 11px; font-weight: 700; cursor: pointer;
            text-decoration: none; transition: all 0.2s;
        }
        .btn-back-cab:hover { border-color: var(--primary); color: var(--primary-bright); }

        /* ‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê */
        .tabs-bar {
            display: flex; justify-content: center; gap: 4px;
            padding: 12px 5%;
            background: rgba(3,5,7,0.5);
            border-bottom: 1px solid rgba(255,255,255,0.03);
            flex-wrap: wrap;
        }
        .tab-btn {
            background: transparent; border: none;
            color: var(--text-muted); padding: 10px 20px; border-radius: var(--radius-sm);
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.2s; position: relative;
        }
        .tab-btn:hover { color: var(--text-secondary); background: rgba(255,255,255,0.03); }
        .tab-btn.active {
            color: var(--primary-bright); background: var(--primary-bg);
        }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 20%; right: 20%;
            height: 2px; background: var(--primary); border-radius: 2px;
        }
        .tab-badge {
            background: var(--danger); color: white;
            font-size: 9px; font-weight: 800; padding: 1px 5px; border-radius: 10px;
            margin-left: 6px; vertical-align: top;
        }

        /* ‚ïê‚ïê‚ïê CONTENT ‚ïê‚ïê‚ïê */
        .content { position: relative; z-index: 1; max-width: 1200px; margin: 0 auto; padding: 30px 5%; }
        .view { display: none; animation: fadeIn 0.3s ease; }
        .view.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ‚ïê‚ïê‚ïê HOME VIEW ‚ïê‚ïê‚ïê */
        .section-title {
            font-size: 13px; font-weight: 800; color: var(--text-muted);
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 20px;
        }

        .stats-row {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
            margin-bottom: 35px;
        }
        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 20px; text-align: center;
            transition: all 0.2s;
        }
        .stat-card:hover { border-color: var(--border-hover); transform: translateY(-2px); }
        .stat-value { font-size: 28px; font-weight: 900; color: var(--primary-bright); margin-bottom: 4px; }
        .stat-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

        .tests-grid {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 16px;
            margin-bottom: 40px;
        }
        .test-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 24px;
            width: 280px; cursor: pointer; transition: all 0.25s;
            display: flex; flex-direction: column;
        }
        .test-card:hover {
            border-color: var(--primary); transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(0,255,68,0.12);
        }
        .test-emoji { font-size: 36px; margin-bottom: 14px; }
        .test-name { font-size: 16px; font-weight: 800; margin-bottom: 6px; color: var(--text); }
        .test-desc { font-size: 12px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5; flex-grow: 1; }
        .test-meta { display: flex; gap: 12px; flex-wrap: wrap; }
        .test-tag {
            font-size: 10px; font-weight: 700; padding: 4px 10px;
            border-radius: 20px; text-transform: uppercase; letter-spacing: 0.3px;
        }
        .tag-green { background: rgba(0,255,68,0.1); color: var(--primary); }
        .tag-yellow { background: var(--warning-bg); color: var(--warning); }
        .tag-gray { background: rgba(148,163,184,0.1); color: var(--text-secondary); }

        .empty-state {
            text-align: center; padding: 60px 20px;
            color: var(--text-muted); font-size: 14px;
        }
        .empty-state .empty-icon { font-size: 48px; margin-bottom: 16px; display: block; }

        /* ‚ïê‚ïê‚ïê RESULTS TABLE ‚ïê‚ïê‚ïê */
        .results-section { margin-top: 10px; }
        .results-table {
            width: 100%; border-collapse: collapse;
            background: var(--bg-card); border-radius: var(--radius); overflow: hidden;
            border: 1px solid var(--border);
        }
        .results-table th {
            background: rgba(255,255,255,0.03); padding: 12px 16px;
            font-size: 11px; font-weight: 700; color: var(--text-muted);
            text-transform: uppercase; text-align: left; letter-spacing: 0.5px;
        }
        .results-table td {
            padding: 12px 16px; font-size: 13px; border-top: 1px solid rgba(255,255,255,0.03);
            color: var(--text-secondary);
        }
        .results-table tr:hover td { background: rgba(255,255,255,0.02); }
        .status-badge {
            padding: 3px 10px; border-radius: 20px; font-size: 10px; font-weight: 800;
            text-transform: uppercase; display: inline-block;
        }
        .status-pass { background: rgba(34,197,94,0.15); color: var(--success); }
        .status-fail { background: rgba(239,68,68,0.15); color: var(--danger); }
        .status-pending { background: var(--warning-bg); color: var(--warning); }
        .status-review { background: rgba(59,130,246,0.15); color: #3b82f6; }

        /* ‚ïê‚ïê‚ïê INTRO TEST ‚ïê‚ïê‚ïê */
        .intro-card {
            max-width: 560px; margin: 40px auto;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 40px; text-align: center;
        }
        .intro-emoji { font-size: 56px; margin-bottom: 20px; display: block; }
        .intro-title { font-size: 24px; font-weight: 900; margin-bottom: 8px; }
        .intro-desc { font-size: 14px; color: var(--text-muted); margin-bottom: 30px; line-height: 1.6; }
        .intro-info {
            display: flex; justify-content: center; gap: 30px; margin-bottom: 30px;
            flex-wrap: wrap;
        }
        .intro-info-item { text-align: center; }
        .intro-info-val { font-size: 22px; font-weight: 900; color: var(--primary-bright); }
        .intro-info-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; font-weight: 600; margin-top: 2px; }

        /* ‚ïê‚ïê‚ïê QUIZ VIEW ‚ïê‚ïê‚ïê */
        .quiz-container { max-width: 700px; margin: 0 auto; }
        .quiz-top-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding: 14px 20px;
            background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius);
        }
        .quiz-progress-text { font-size: 13px; font-weight: 700; color: var(--text-secondary); }
        .quiz-timer {
            font-size: 14px; font-weight: 800; color: var(--primary-bright);
            display: flex; align-items: center; gap: 6px;
        }
        .quiz-timer.warning { color: var(--warning); }
        .quiz-timer.danger { color: var(--danger); animation: blink 0.5s infinite; }
        @keyframes blink { 50% { opacity: 0.4; } }

        .quiz-progress-bar {
            width: 100%; height: 4px; background: rgba(255,255,255,0.05);
            border-radius: 4px; margin-bottom: 24px; overflow: hidden;
        }
        .quiz-progress-fill {
            height: 100%; background: var(--primary); border-radius: 4px;
            transition: width 0.4s ease;
        }

        .quiz-question-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 30px; margin-bottom: 20px;
        }
        .quiz-q-number { font-size: 11px; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .quiz-q-text { font-size: 17px; font-weight: 700; line-height: 1.5; margin-bottom: 24px; }

        .quiz-option {
            display: flex; align-items: center; gap: 14px;
            padding: 14px 18px; margin-bottom: 8px;
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06);
            border-radius: var(--radius-sm); cursor: pointer; transition: all 0.2s;
        }
        .quiz-option:hover { border-color: var(--border-hover); background: var(--primary-bg); }
        .quiz-option.selected { border-color: var(--primary); background: rgba(0,255,68,0.08); }
        .quiz-option.correct { border-color: var(--success); background: rgba(34,197,94,0.1); }
        .quiz-option.wrong { border-color: var(--danger); background: rgba(239,68,68,0.08); }
        .quiz-option-letter {
            width: 32px; height: 32px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 800;
            background: rgba(255,255,255,0.05); color: var(--text-secondary);
            flex-shrink: 0; transition: all 0.2s;
        }
        .quiz-option.selected .quiz-option-letter { background: var(--primary); color: #000; }
        .quiz-option.correct .quiz-option-letter { background: var(--success); color: #000; }
        .quiz-option.wrong .quiz-option-letter { background: var(--danger); color: #fff; }
        .quiz-option-text { font-size: 14px; font-weight: 500; }

        .quiz-free-input {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08);
            color: white; padding: 14px 18px; border-radius: var(--radius-sm);
            font-size: 14px; resize: vertical; min-height: 80px; outline: none;
            transition: border-color 0.2s; margin-top: 8px;
        }
        .quiz-free-input:focus { border-color: var(--primary); }
        .quiz-free-label { font-size: 12px; color: var(--text-muted); font-weight: 600; margin-top: 16px; margin-bottom: 6px; }

        .quiz-nav { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }

        /* ‚ïê‚ïê‚ïê RESULT VIEW ‚ïê‚ïê‚ïê */
        .result-card {
            max-width: 600px; margin: 30px auto;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 40px; text-align: center;
        }
        .result-icon { font-size: 56px; margin-bottom: 16px; display: block; }
        .result-title { font-size: 24px; font-weight: 900; margin-bottom: 6px; }
        .result-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 24px; }
        .result-score {
            display: inline-flex; align-items: baseline; gap: 6px;
            font-size: 48px; font-weight: 900; margin-bottom: 24px;
        }
        .result-score-max { font-size: 20px; color: var(--text-muted); font-weight: 600; }
        .result-details { text-align: left; margin-top: 30px; }
        .result-q-item {
            padding: 16px; margin-bottom: 8px;
            background: rgba(255,255,255,0.02); border-radius: var(--radius-sm);
            border-left: 3px solid var(--text-muted);
        }
        .result-q-item.q-correct { border-left-color: var(--success); }
        .result-q-item.q-wrong { border-left-color: var(--danger); }
        .result-q-item.q-pending { border-left-color: var(--warning); }
        .result-q-title { font-size: 13px; font-weight: 700; margin-bottom: 4px; }
        .result-q-answer { font-size: 12px; color: var(--text-secondary); }

        /* ‚ïê‚ïê‚ïê CREATE / EDIT TEST ‚ïê‚ïê‚ïê */
        .form-card {
            max-width: 750px; margin: 0 auto;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 30px;
        }
        .form-title { font-size: 18px; font-weight: 900; margin-bottom: 24px; color: var(--primary-bright); }
        .form-row { margin-bottom: 20px; }
        .form-label { display: block; font-size: 11px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .form-input {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08);
            color: white; padding: 12px 16px; border-radius: var(--radius-sm);
            font-size: 14px; outline: none; transition: border-color 0.2s;
        }
        .form-input:focus { border-color: var(--primary); }
        .form-input-sm { padding: 10px 14px; font-size: 13px; }
        .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }

        .question-block {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05);
            border-radius: var(--radius); padding: 20px; margin-bottom: 16px;
            transition: all 0.3s;
        }
        .question-block.has-error {
            border-color: var(--danger); animation: shakeX 0.4s;
            box-shadow: 0 0 20px var(--danger-glow);
        }
        @keyframes shakeX { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-6px); } 75% { transform: translateX(6px); } }
        .q-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .q-number { font-size: 12px; font-weight: 800; color: var(--primary); }
        .q-remove { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; transition: color 0.2s; }
        .q-remove:hover { color: var(--danger); }

        .option-row {
            display: flex; align-items: center; gap: 10px; margin-bottom: 8px;
        }
        .option-radio {
            width: 20px; height: 20px; border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.15); background: transparent;
            cursor: pointer; transition: all 0.2s; flex-shrink: 0;
        }
        .option-radio.correct-mark { border-color: var(--primary); background: var(--primary); }
        .option-remove { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; }
        .option-remove:hover { color: var(--danger); }
        .btn-add-option {
            background: none; border: 1px dashed rgba(255,255,255,0.1);
            color: var(--text-muted); padding: 8px 14px; border-radius: var(--radius-xs);
            font-size: 12px; cursor: pointer; font-weight: 600; transition: all 0.2s;
        }
        .btn-add-option:hover { border-color: var(--primary); color: var(--primary); }

        .toggle-row { display: flex; align-items: center; gap: 10px; margin-top: 12px; }
        .toggle-switch {
            width: 38px; height: 20px; background: rgba(255,255,255,0.1);
            border-radius: 20px; position: relative; cursor: pointer; transition: background 0.2s;
        }
        .toggle-switch.on { background: var(--primary); }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 16px; height: 16px; background: white; border-radius: 50%;
            transition: transform 0.2s;
        }
        .toggle-switch.on::after { transform: translateX(18px); }
        .toggle-label { font-size: 12px; color: var(--text-secondary); font-weight: 600; }

        /* ‚ïê‚ïê‚ïê REVIEW VIEW ‚ïê‚ïê‚ïê */
        .review-card {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 24px; margin-bottom: 16px;
        }
        .review-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
        .review-user { font-size: 15px; font-weight: 800; }
        .review-date { font-size: 11px; color: var(--text-muted); }
        .review-answer-block { margin-bottom: 12px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: var(--radius-sm); }
        .review-q { font-size: 12px; font-weight: 700; color: var(--text-secondary); margin-bottom: 4px; }
        .review-a { font-size: 13px; color: var(--text); }

        /* ‚ïê‚ïê‚ïê MANAGE VIEW ‚ïê‚ïê‚ïê */
        .manage-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px 20px; margin-bottom: 8px;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius-sm); transition: all 0.2s;
        }
        .manage-item:hover { border-color: var(--border-hover); }
        .manage-actions { display: flex; gap: 8px; }

        /* ‚ïê‚ïê‚ïê SETTINGS VIEW ‚ïê‚ïê‚ïê */
        .settings-block {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 24px; margin-bottom: 16px;
        }
        .settings-title { font-size: 14px; font-weight: 800; margin-bottom: 16px; color: var(--primary-bright); }
        .reviewer-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 14px; margin-bottom: 6px;
            background: rgba(255,255,255,0.02); border-radius: var(--radius-xs);
        }
        .reviewer-name { font-size: 13px; font-weight: 600; }
        .reviewer-remove { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 14px; }
        .reviewer-remove:hover { color: var(--danger); }
        .people-dropdown {
            position: absolute; z-index: 50; background: var(--bg-card-solid);
            border: 1px solid var(--border); border-radius: var(--radius-sm);
            max-height: 200px; overflow-y: auto; width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .people-dropdown-item {
            padding: 10px 14px; cursor: pointer; font-size: 13px;
            display: flex; justify-content: space-between; transition: background 0.15s;
        }
        .people-dropdown-item:hover { background: var(--primary-bg); }

        /* ‚ïê‚ïê‚ïê BUTTONS ‚ïê‚ïê‚ïê */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 12px 24px; border-radius: var(--radius-sm); border: none;
            font-size: 13px; font-weight: 700; cursor: pointer;
            text-transform: uppercase; letter-spacing: 0.3px;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { background: var(--primary-bright); box-shadow: 0 0 20px rgba(0,255,68,0.3); transform: translateY(-1px); }
        .btn-secondary { background: rgba(255,255,255,0.05); color: var(--text-secondary); border: 1px solid rgba(255,255,255,0.1); }
        .btn-secondary:hover { border-color: var(--primary); color: var(--primary-bright); }
        .btn-danger { background: rgba(239,68,68,0.1); color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }
        .btn-danger:hover { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning-bg); color: var(--warning); border: 1px solid rgba(245,158,11,0.3); }
        .btn-warning:hover { background: var(--warning); color: #000; }
        .btn-sm { padding: 8px 16px; font-size: 11px; }
        .btn-block { width: 100%; }

        /* ‚ïê‚ïê‚ïê MODAL ‚ïê‚ïê‚ïê */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
            display: none; align-items: center; justify-content: center;
            z-index: 200; padding: 20px;
        }
        .modal-overlay.show { display: flex; }
        .modal-box {
            background: var(--bg-card-solid); border: 1px solid var(--border);
            border-radius: var(--radius); padding: 30px; max-width: 420px; width: 100%;
            animation: modalIn 0.25s ease;
        }
        @keyframes modalIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal-title { font-size: 16px; font-weight: 800; margin-bottom: 12px; text-align: center; }
        .modal-text { font-size: 13px; color: var(--text-secondary); text-align: center; margin-bottom: 20px; line-height: 1.5; }
        .modal-actions { display: flex; gap: 10px; justify-content: center; }

        /* ‚ïê‚ïê‚ïê NOTIFICATIONS ‚ïê‚ïê‚ïê */
        .notif-bell { position: relative; cursor: pointer; padding: 4px; }
        .notif-bell-icon { font-size: 20px; }
        .notif-badge {
            position: absolute; top: -4px; right: -4px;
            background: var(--danger); color: white; font-size: 9px; font-weight: 800;
            padding: 1px 5px; border-radius: 20px; display: none;
        }
        .notif-panel {
            position: absolute; top: 50px; right: 0; width: 320px;
            background: var(--bg-card-solid); border: 1px solid var(--border);
            border-radius: var(--radius); overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.7); display: none; z-index: 150;
        }
        .notif-panel.show { display: block; }
        .notif-panel-header {
            padding: 12px 16px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05); background: rgba(255,255,255,0.02);
        }
        .notif-item {
            padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.03);
            cursor: pointer; transition: background 0.15s; font-size: 12px; color: var(--text-secondary);
        }
        .notif-item:hover { background: rgba(255,255,255,0.03); }
        .notif-item.unread { color: var(--text); }
        .notif-time { font-size: 10px; color: var(--text-muted); margin-top: 3px; }

        /* ‚ïê‚ïê‚ïê RESPONSIVE ‚ïê‚ïê‚ïê */
        @media (max-width: 768px) {
            .header { padding: 12px 16px; }
            .header-title { display: none; }
            .content { padding: 20px 16px; }
            .stats-row { grid-template-columns: 1fr 1fr; }
            .test-card { width: 100%; }
            .form-grid-2, .form-grid-3 { grid-template-columns: 1fr; }
            .intro-info { gap: 20px; }
            .quiz-question-card { padding: 20px; }
            .result-card { padding: 24px; }
            .results-table { font-size: 12px; }
            .results-table th, .results-table td { padding: 8px 10px; }
            .manage-item { flex-direction: column; gap: 10px; align-items: flex-start; }
            .tabs-bar { gap: 2px; padding: 8px 12px; }
            .tab-btn { padding: 8px 12px; font-size: 12px; }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="header">
        <div class="header-left">
            <a href="cabinet.html" class="logo">–î–®–í</a>
            <span class="header-title">–Ü–°–ü–ò–¢ –¶–ï–ù–¢–†</span>
        </div>
        <div class="header-right">
            <div class="notif-bell" id="notifBell">
                <span class="notif-bell-icon">üîî</span>
                <span class="notif-badge" id="notifBadge">0</span>
                <div class="notif-panel" id="notifPanel">
                    <div class="notif-panel-header">
                        <span style="font-size:11px;font-weight:800;color:var(--primary-bright);">–°–ü–û–í–Ü–©–ï–ù–ù–Ø</span>
                        <button onclick="clearNotifs()" style="background:none;border:none;color:var(--text-muted);font-size:10px;cursor:pointer;font-weight:700;">–û–ß–ò–°–¢–ò–¢–ò</button>
                    </div>
                    <div id="notifList"><div class="notif-item" style="text-align:center;color:var(--text-muted);">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div></div>
                </div>
            </div>
            <span class="role-badge" id="roleBadge">...</span>
            <span class="user-name" id="userName">...</span>
            <a href="cabinet.html" class="btn-back-cab">–ö–ê–ë–Ü–ù–ï–¢</a>
        </div>
    </div>

    <!-- TABS -->
    <div class="tabs-bar" id="tabsBar">
        <button class="tab-btn active" data-view="home" onclick="showView('home')">üè† –ì–æ–ª–æ–≤–Ω–∞</button>
        <button class="tab-btn" data-view="create" id="tabCreate" style="display:none;" onclick="showView('create')">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
        <button class="tab-btn" data-view="review" id="tabReview" style="display:none;" onclick="showView('review')">üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ <span class="tab-badge" id="reviewBadge" style="display:none;">0</span></button>
        <button class="tab-btn" data-view="manage" id="tabManage" style="display:none;" onclick="showView('manage')">‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è</button>
        <button class="tab-btn" data-view="settings" id="tabSettings" style="display:none;" onclick="showView('settings')">üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

    <div class="content">
        <!-- HOME -->
        <div class="view active" id="viewHome">
            <div class="section-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="stats-row">
                <div class="stat-card"><div class="stat-value" id="statTests">0</div><div class="stat-label">–¢–µ—Å—Ç—ñ–≤</div></div>
                <div class="stat-card"><div class="stat-value" id="statPassed">0</div><div class="stat-label">–°–∫–ª–∞–¥–µ–Ω–æ</div></div>
                <div class="stat-card"><div class="stat-value" id="statFailed">0</div><div class="stat-label">–ü—Ä–æ–≤–∞–ª–µ–Ω–æ</div></div>
                <div class="stat-card"><div class="stat-value" id="statAvg">0</div><div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</div></div>
            </div>
            <div class="section-title">üìù –î–æ—Å—Ç—É–ø–Ω—ñ —Ç–µ—Å—Ç–∏</div>
            <div class="tests-grid" id="testsGrid"></div>
            <div class="section-title" style="margin-top:20px;">üìÑ –ú–æ—ó —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</div>
            <div id="myResults"></div>
        </div>

        <!-- INTRO -->
        <div class="view" id="viewIntro"></div>

        <!-- QUIZ -->
        <div class="view" id="viewQuiz"></div>

        <!-- RESULT -->
        <div class="view" id="viewResult"></div>

        <!-- CREATE/EDIT -->
        <div class="view" id="viewCreate"></div>

        <!-- REVIEW -->
        <div class="view" id="viewReview"></div>

        <!-- MANAGE -->
        <div class="view" id="viewManage"></div>

        <!-- SETTINGS -->
        <div class="view" id="viewSettings"></div>
    </div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal">
        <div class="modal-box">
            <div class="modal-title" id="modalTitle"></div>
            <div class="modal-text" id="modalText"></div>
            <div class="modal-actions" id="modalActions"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const app = initializeApp({
            apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
            authDomain: "dsv-gta.firebaseapp.com",
            projectId: "dsv-gta",
            storageBucket: "dsv-gta.firebasestorage.app",
            messagingSenderId: "661591588818",
            appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
        });
        const auth = getAuth(app);
        const db = getFirestore(app);

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           STATE
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        let currentUser = { name: '...', role: 'fighter', uid: '' };
        let allUsers = [];
        let tests = JSON.parse(localStorage.getItem('isput_tests') || '[]');
        let results = JSON.parse(localStorage.getItem('isput_results') || '[]');
        let reviewers = JSON.parse(localStorage.getItem('isput_reviewers') || '[]');
        let webhookUrl = localStorage.getItem('isput_webhook') || '';
        let notifications = JSON.parse(localStorage.getItem('isput_notifs') || '[]');
        let currentQuiz = null;
        let editingTestId = null;

        const save = () => {
            localStorage.setItem('isput_tests', JSON.stringify(tests));
            localStorage.setItem('isput_results', JSON.stringify(results));
            localStorage.setItem('isput_reviewers', JSON.stringify(reviewers));
            localStorage.setItem('isput_webhook', webhookUrl);
            localStorage.setItem('isput_notifs', JSON.stringify(notifications));
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           FIREBASE AUTH + USERS
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = 'index.html'; return; }
            currentUser.uid = user.uid;
            try {
                const uDoc = await getDoc(doc(db, 'users', user.uid));
                if (uDoc.exists()) {
                    const d = uDoc.data();
                    currentUser.name = d.name || '–ù–µ–≤—ñ–¥–æ–º–∏–π';
                    currentUser.role = d.role || 'fighter';
                }
                const snap = await getDocs(collection(db, 'users'));
                allUsers = [];
                snap.forEach(s => { const d = s.data(); allUsers.push({ uid: s.id, name: d.name || '???', role: d.role || 'fighter' }); });
            } catch(e) { console.log('Firebase error:', e); }
            initApp();
        });

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           INIT
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function initApp() {
            document.getElementById('userName').textContent = currentUser.name;
            const rb = document.getElementById('roleBadge');
            if (currentUser.role === 'admin') { rb.textContent = '–ê–î–ú–Ü–ù'; rb.className = 'role-badge role-admin'; }
            else if (currentUser.role === 'instructor') { rb.textContent = '–Ü–ù–°–¢–†–£–ö–¢–û–†'; rb.className = 'role-badge role-instructor'; }
            else { rb.textContent = '–ë–Ü–Ñ–¶–¨'; rb.className = 'role-badge role-fighter'; }

            const isPriv = currentUser.role === 'admin' || isReviewer();
            if (currentUser.role === 'admin') {
                ['tabCreate','tabManage','tabSettings'].forEach(id => document.getElementById(id).style.display = '');
            }
            if (isPriv) {
                document.getElementById('tabReview').style.display = '';
            }

            showView('home');
            updateNotifUI();
            updateReviewBadge();
        }

        function isReviewer() {
            return reviewers.some(r => r.uid === currentUser.uid || r.name === currentUser.name);
        }
        function canReview() {
            return currentUser.role === 'admin' || isReviewer();
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           NAVIGATION
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        window.showView = (view) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            const tabBtn = document.querySelector(`.tab-btn[data-view="${view}"]`);
            if (tabBtn) tabBtn.classList.add('active');
            const el = document.getElementById('view' + view.charAt(0).toUpperCase() + view.slice(1));
            if (el) el.classList.add('active');
            if (view === 'home') renderHome();
            else if (view === 'create') renderCreateForm(null);
            else if (view === 'review') renderReview();
            else if (view === 'manage') renderManage();
            else if (view === 'settings') renderSettings();
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           NOTIFICATIONS
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function addNotif(text) {
            notifications.unshift({ text, time: new Date().toLocaleString('uk-UA'), read: false });
            if (notifications.length > 30) notifications.pop();
            save();
            updateNotifUI();
        }
        function updateNotifUI() {
            const unread = notifications.filter(n => !n.read).length;
            const badge = document.getElementById('notifBadge');
            badge.textContent = unread;
            badge.style.display = unread > 0 ? 'block' : 'none';
            const list = document.getElementById('notifList');
            if (notifications.length === 0) {
                list.innerHTML = '<div class="notif-item" style="text-align:center;color:var(--text-muted);">–ù–µ–º–∞—î —Å–ø–æ–≤—ñ—â–µ–Ω—å</div>';
            } else {
                list.innerHTML = notifications.map((n, i) =>
                    `<div class="notif-item ${n.read ? '' : 'unread'}" onclick="readNotif(${i})">${n.text}<div class="notif-time">${n.time}</div></div>`
                ).join('');
            }
        }
        window.readNotif = (i) => { notifications[i].read = true; save(); updateNotifUI(); };
        window.clearNotifs = () => { notifications = []; save(); updateNotifUI(); };
        document.getElementById('notifBell').addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('notifPanel').classList.toggle('show');
        });
        document.addEventListener('click', () => document.getElementById('notifPanel').classList.remove('show'));

        function updateReviewBadge() {
            const pending = results.filter(r => r.status === 'pending-review');
            const badge = document.getElementById('reviewBadge');
            if (pending.length > 0) { badge.textContent = pending.length; badge.style.display = ''; }
            else { badge.style.display = 'none'; }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           DISCORD WEBHOOK
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        async function sendWebhook(data) {
            if (!webhookUrl) return;
            try {
                await fetch(webhookUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        embeds: [{
                            title: data.title || '–Ü–°–ü–ò–¢ –¶–ï–ù–¢–†',
                            description: data.desc || '',
                            color: data.color || 0x00ff44,
                            fields: data.fields || [],
                            footer: { text: `–î–®–í –Ü–°–ü–ò–¢ –¶–ï–ù–¢–† ‚Ä¢ ${new Date().toLocaleString('uk-UA')}` }
                        }]
                    })
                });
            } catch(e) {}
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           MODAL
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function showModal(title, text, actions) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').textContent = text;
            document.getElementById('modalActions').innerHTML = actions;
            document.getElementById('modal').classList.add('show');
        }
        window.closeModal = () => document.getElementById('modal').classList.remove('show');

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           HOME VIEW
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderHome() {
            const myRes = results.filter(r => r.uid === currentUser.uid);
            const passed = myRes.filter(r => r.status === 'passed').length;
            const failed = myRes.filter(r => r.status === 'failed').length;
            const avg = myRes.length > 0 ? Math.round(myRes.reduce((s, r) => s + (r.score || 0), 0) / myRes.length * 10) / 10 : 0;

            document.getElementById('statTests').textContent = tests.length;
            document.getElementById('statPassed').textContent = passed;
            document.getElementById('statFailed').textContent = failed;
            document.getElementById('statAvg').textContent = avg;

            const grid = document.getElementById('testsGrid');
            if (tests.length === 0) {
                grid.innerHTML = '<div class="empty-state"><span class="empty-icon">üì≠</span>–¢–µ—Å—Ç—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</div>';
            } else {
                grid.innerHTML = tests.map(t => `
                    <div class="test-card" onclick="startIntro('${t.id}')">
                        <div class="test-emoji">${t.emoji || 'üìù'}</div>
                        <div class="test-name">${esc(t.name)}</div>
                        <div class="test-desc">${esc(t.description || '–ë–µ–∑ –æ–ø–∏—Å—É')}</div>
                        <div class="test-meta">
                            <span class="test-tag tag-green">${t.questions.length} –ø–∏—Ç–∞–Ω—å</span>
                            <span class="test-tag tag-yellow">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π: ${t.passScore}/${t.maxScore}</span>
                            ${t.category ? `<span class="test-tag tag-gray">${esc(t.category)}</span>` : ''}
                        </div>
                    </div>
                `).join('');
            }

            const resDiv = document.getElementById('myResults');
            if (myRes.length === 0) {
                resDiv.innerHTML = '<div class="empty-state" style="padding:30px;">–í–∏ —â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ –∂–æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç—É</div>';
            } else {
                resDiv.innerHTML = `<table class="results-table"><thead><tr>
                    <th>–¢–µ—Å—Ç</th><th>–ë–∞–ª–∏</th><th>–°—Ç–∞—Ç—É—Å</th><th>–ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π</th><th>–î–∞—Ç–∞</th>
                </tr></thead><tbody>${myRes.map(r => {
                    const t = tests.find(t => t.id === r.testId);
                    let statusCls = 'status-pending', statusTxt = '–û—á—ñ–∫—É—î';
                    if (r.status === 'passed') { statusCls = 'status-pass'; statusTxt = '–°–∫–ª–∞–¥–µ–Ω–æ'; }
                    else if (r.status === 'failed') { statusCls = 'status-fail'; statusTxt = '–ü—Ä–æ–≤–∞–ª–µ–Ω–æ'; }
                    else if (r.status === 'pending-review') { statusCls = 'status-review'; statusTxt = '–ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ'; }
                    return `<tr>
                        <td style="font-weight:700;">${t ? esc(t.name) : '–í–∏–¥–∞–ª–µ–Ω–∏–π —Ç–µ—Å—Ç'}</td>
                        <td>${r.score}/${r.maxScore}</td>
                        <td><span class="status-badge ${statusCls}">${statusTxt}</span></td>
                        <td style="color:var(--text-muted);">${r.reviewer || '‚Äî'}</td>
                        <td style="color:var(--text-muted);">${r.date || '‚Äî'}</td>
                    </tr>`;
                }).join('')}</tbody></table>`;
            }
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           INTRO
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        window.startIntro = (id) => {
            const t = tests.find(x => x.id === id);
            if (!t) return;
            // Check if has pending result
            const pending = results.find(r => r.uid === currentUser.uid && r.testId === id && (r.status === 'pending-review'));
            if (pending) {
                showModal('‚è≥ –û—á—ñ–∫—É–π—Ç–µ', '–í–∞—à –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —ñ—Å–ø–∏—Ç —â–µ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ. –î–æ—á–µ–∫–∞–π—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.', '<button class="btn btn-secondary" onclick="closeModal()">–ó—Ä–æ–∑—É–º—ñ–ª–æ</button>');
                return;
            }
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const el = document.getElementById('viewIntro');
            el.classList.add('active');
            const ppq = t.maxScore > 0 && t.questions.length > 0 ? Math.round(t.maxScore / t.questions.length * 10) / 10 : 0;
            el.innerHTML = `
                <div class="intro-card">
                    <span class="intro-emoji">${t.emoji || 'üìù'}</span>
                    <div class="intro-title">${esc(t.name)}</div>
                    <div class="intro-desc">${esc(t.description || '')}</div>
                    <div class="intro-info">
                        <div class="intro-info-item"><div class="intro-info-val">${t.questions.length}</div><div class="intro-info-label">–ü–∏—Ç–∞–Ω—å</div></div>
                        <div class="intro-info-item"><div class="intro-info-val">${t.maxScore}</div><div class="intro-info-label">–ú–∞–∫—Å. –±–∞–ª</div></div>
                        <div class="intro-info-item"><div class="intro-info-val">${t.passScore}</div><div class="intro-info-label">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π</div></div>
                        <div class="intro-info-item"><div class="intro-info-val">${ppq}</div><div class="intro-info-label">–ë–∞–ª/–ø–∏—Ç–∞–Ω–Ω—è</div></div>
                    </div>
                    <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
                        <button class="btn btn-primary" onclick="beginQuiz('${t.id}')">–†–æ–∑–ø–æ—á–∞—Ç–∏ —ñ—Å–ø–∏—Ç</button>
                        <button class="btn btn-secondary" onclick="showView('home')">–ù–∞–∑–∞–¥</button>
                    </div>
                </div>
            `;
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           QUIZ
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        window.beginQuiz = (id) => {
            const t = tests.find(x => x.id === id);
            if (!t) return;
            currentQuiz = {
                testId: id, test: t, current: 0,
                answers: t.questions.map(() => ({ selected: -1, freeText: '' })),
                startTime: Date.now(), timerInterval: null, timeLeft: 30
            };
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('viewQuiz').classList.add('active');
            renderQuestion();
        };

        function renderQuestion() {
            if (!currentQuiz) return;
            const q = currentQuiz.test.questions[currentQuiz.current];
            const total = currentQuiz.test.questions.length;
            const i = currentQuiz.current;
            const ans = currentQuiz.answers[i];
            const pct = ((i + 1) / total * 100).toFixed(0);
            const letters = '–ê–ë–í–ì–î–ï–ñ–ó–ò–ö–õ–ú–ù'.split('');

            currentQuiz.timeLeft = 30;
            if (currentQuiz.timerInterval) clearInterval(currentQuiz.timerInterval);
            currentQuiz.timerInterval = setInterval(() => {
                currentQuiz.timeLeft--;
                const tEl = document.getElementById('quizTimer');
                if (tEl) {
                    tEl.textContent = currentQuiz.timeLeft + '—Å';
                    tEl.parentElement.className = 'quiz-timer' + (currentQuiz.timeLeft <= 10 ? (currentQuiz.timeLeft <= 5 ? ' danger' : ' warning') : '');
                }
                if (currentQuiz.timeLeft <= 0) { nextQuestion(); }
            }, 1000);

            const el = document.getElementById('viewQuiz');
            el.innerHTML = `
                <div class="quiz-container">
                    <div class="quiz-top-bar">
                        <span class="quiz-progress-text">–ü–∏—Ç–∞–Ω–Ω—è ${i + 1} –∑ ${total}</span>
                        <div class="quiz-timer"><span>‚è±</span><span id="quizTimer">30—Å</span></div>
                    </div>
                    <div class="quiz-progress-bar"><div class="quiz-progress-fill" style="width:${pct}%"></div></div>
                    <div class="quiz-question-card">
                        <div class="quiz-q-number">–ü–∏—Ç–∞–Ω–Ω—è ${i + 1}</div>
                        <div class="quiz-q-text">${esc(q.text)}</div>
                        ${q.options.map((o, oi) => `
                            <div class="quiz-option ${ans.selected === oi ? 'selected' : ''}" onclick="selectOption(${oi})">
                                <div class="quiz-option-letter">${letters[oi] || oi + 1}</div>
                                <div class="quiz-option-text">${esc(o.text)}</div>
                            </div>
                        `).join('')}
                        ${q.allowFree ? `
                            <div class="quiz-free-label">‚úç –ê–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å —Å–≤–æ—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å:</div>
                            <textarea class="quiz-free-input" placeholder="–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å..." oninput="setFreeText(this.value)">${esc(ans.freeText)}</textarea>
                        ` : ''}
                    </div>
                    <div class="quiz-nav">
                        ${i > 0 ? '<button class="btn btn-secondary" onclick="prevQuestion()">‚Üê –ù–∞–∑–∞–¥</button>' : ''}
                        ${i < total - 1
                            ? '<button class="btn btn-primary" onclick="nextQuestion()">–î–∞–ª—ñ ‚Üí</button>'
                            : '<button class="btn btn-primary" onclick="finishQuiz()">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ ‚úì</button>'
                        }
                    </div>
                </div>
            `;
        }

        window.selectOption = (oi) => {
            if (!currentQuiz) return;
            currentQuiz.answers[currentQuiz.current].selected = oi;
            renderQuestion();
        };
        window.setFreeText = (val) => {
            if (!currentQuiz) return;
            currentQuiz.answers[currentQuiz.current].freeText = val;
        };
        window.prevQuestion = () => {
            if (!currentQuiz || currentQuiz.current <= 0) return;
            currentQuiz.current--;
            renderQuestion();
        };
        window.nextQuestion = () => {
            if (!currentQuiz) return;
            if (currentQuiz.current < currentQuiz.test.questions.length - 1) {
                currentQuiz.current++;
                renderQuestion();
            }
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           FINISH QUIZ
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        window.finishQuiz = () => {
            if (!currentQuiz) return;
            if (currentQuiz.timerInterval) clearInterval(currentQuiz.timerInterval);

            const t = currentQuiz.test;
            const ppq = t.questions.length > 0 ? t.maxScore / t.questions.length : 0;
            let score = 0;
            let hasFree = false;
            const details = [];

            t.questions.forEach((q, i) => {
                const ans = currentQuiz.answers[i];
                let correct = false;
                let needsReview = false;
                let answerText = '';

                if (ans.freeText && q.allowFree) {
                    needsReview = true;
                    hasFree = true;
                    answerText = ans.freeText;
                } else if (ans.selected >= 0 && q.options[ans.selected]) {
                    answerText = q.options[ans.selected].text;
                    if (q.options[ans.selected].correct) {
                        correct = true;
                        score += ppq;
                    }
                } else {
                    answerText = '(–Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–≤)';
                }
                details.push({ qText: q.text, answerText, correct, needsReview, qIndex: i });
            });

            score = Math.round(score * 10) / 10;
            let status;
            if (hasFree) {
                status = 'pending-review';
            } else {
                status = score >= t.passScore ? 'passed' : 'failed';
            }

            const result = {
                id: 'r' + Date.now(),
                testId: t.id,
                testName: t.name,
                uid: currentUser.uid,
                userName: currentUser.name,
                score, maxScore: t.maxScore, passScore: t.passScore,
                status,
                reviewer: hasFree ? '‚Äî' : 'SYSTEM',
                date: new Date().toLocaleString('uk-UA'),
                details,
                answers: currentQuiz.answers
            };
            results.push(result);
            save();

            // Webhook
            const statusText = status === 'passed' ? '‚úÖ –°—Ö–≤–∞–ª–µ–Ω–æ' : status === 'failed' ? '‚ùå –í—ñ–¥—Ö–∏–ª–µ–Ω–æ' : '‚è≥ –ù–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ';
            sendWebhook({
                title: `üìã –ù–æ–≤–∏–π —ñ—Å–ø–∏—Ç: ${t.name}`,
                desc: `–ë–æ—î—Ü—å **${currentUser.name}** –∑–∞–≤–µ—Ä—à–∏–≤ —ñ—Å–ø–∏—Ç`,
                color: status === 'passed' ? 0x22c55e : status === 'failed' ? 0xef4444 : 0xf59e0b,
                fields: [
                    { name: 'üë§ –ë–æ—î—Ü—å', value: currentUser.name, inline: true },
                    { name: 'üìä –ë–∞–ª–∏', value: `${score}/${t.maxScore}`, inline: true },
                    { name: 'üìå –°—Ç–∞—Ç—É—Å', value: statusText, inline: true },
                    { name: 'üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π', value: hasFree ? '–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏' : 'SYSTEM', inline: true },
                    { name: 'üìÖ –î–∞—Ç–∞', value: new Date().toLocaleString('uk-UA'), inline: true }
                ]
            });

            if (hasFree) {
                addNotif(`–Ü—Å–ø–∏—Ç "${t.name}" –≤—ñ–¥ ${currentUser.name} –æ—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏`);
            }

            updateReviewBadge();
            renderResult(result);
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           RESULT VIEW
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderResult(r) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const el = document.getElementById('viewResult');
            el.classList.add('active');

            const isPassed = r.status === 'passed';
            const isPending = r.status === 'pending-review';
            let icon = isPassed ? 'üéâ' : isPending ? '‚è≥' : 'üòî';
            let title = isPassed ? '–Ü—Å–ø–∏—Ç —Å–∫–ª–∞–¥–µ–Ω–æ!' : isPending ? '–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏' : '–Ü—Å–ø–∏—Ç –Ω–µ —Å–∫–ª–∞–¥–µ–Ω–æ';
            let subtitle = isPassed ? '–í—ñ—Ç–∞—î–º–æ! –í–∏ —É—Å–ø—ñ—à–Ω–æ –ø—Ä–æ–π—à–ª–∏ —ñ—Å–ø–∏—Ç.' : isPending ? '–í–∞—à—ñ –≤—ñ–ª—å–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±—É–¥—É—Ç—å –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ.' : `–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª: ${r.passScore}. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.`;
            let scoreColor = isPassed ? 'var(--success)' : isPending ? 'var(--warning)' : 'var(--danger)';

            el.innerHTML = `
                <div class="result-card">
                    <span class="result-icon">${icon}</span>
                    <div class="result-title" style="color:${scoreColor}">${title}</div>
                    <div class="result-subtitle">${subtitle}</div>
                    <div class="result-score" style="color:${scoreColor}">
                        ${r.score}<span class="result-score-max">/ ${r.maxScore}</span>
                    </div>
                    <div class="result-details">
                        ${r.details.map(d => {
                            let cls = d.needsReview ? 'q-pending' : d.correct ? 'q-correct' : 'q-wrong';
                            let icon2 = d.needsReview ? '‚è≥' : d.correct ? '‚úì' : '‚úó';
                            return `<div class="result-q-item ${cls}">
                                <div class="result-q-title">${icon2} ${esc(d.qText)}</div>
                                <div class="result-q-answer">–í—ñ–¥–ø–æ–≤—ñ–¥—å: ${esc(d.answerText)}</div>
                            </div>`;
                        }).join('')}
                    </div>
                    <div style="margin-top:24px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
                        ${!isPending ? `<button class="btn btn-primary" onclick="startIntro('${r.testId}')">–ü—Ä–æ–π—Ç–∏ –∑–Ω–æ–≤—É</button>` : ''}
                        <button class="btn btn-secondary" onclick="showView('home')">–ù–∞ –≥–æ–ª–æ–≤–Ω—É</button>
                    </div>
                </div>
            `;
            currentQuiz = null;
        }

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           CREATE / EDIT TEST
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderCreateForm(testId) {
            editingTestId = testId;
            const existing = testId ? tests.find(t => t.id === testId) : null;
            const el = document.getElementById('viewCreate');

            const name = existing ? existing.name : '';
            const desc = existing ? (existing.description || '') : '';
            const cat = existing ? (existing.category || '') : '';
            const emoji = existing ? (existing.emoji || 'üìù') : 'üìù';
            const maxScore = existing ? existing.maxScore : 12;
            const passScore = existing ? existing.passScore : 8;
            const qs = existing ? existing.questions : [{ text: '', options: [{ text: '', correct: false }, { text: '', correct: false }], allowFree: false }];

            window._createQuestions = JSON.parse(JSON.stringify(qs));

            el.innerHTML = `
                <div class="form-card">
                    <div class="form-title">${existing ? '‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç—É' : '‚ûï –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç—É'}</div>
                    <div class="form-grid-2">
                        <div class="form-row"><label class="form-label">–ù–∞–∑–≤–∞ —Ç–µ—Å—Ç—É</label><input class="form-input" id="cName" value="${esc(name)}"></div>
                        <div class="form-row"><label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label><input class="form-input" id="cCat" value="${esc(cat)}"></div>
                    </div>
                    <div class="form-row"><label class="form-label">–û–ø–∏—Å</label><textarea class="form-input" id="cDesc" rows="2">${esc(desc)}</textarea></div>
                    <div class="form-grid-3">
                        <div class="form-row"><label class="form-label">–ï–º–æ–¥–∑—ñ</label><input class="form-input" id="cEmoji" value="${emoji}"></div>
                        <div class="form-row"><label class="form-label">–ú–∞–∫—Å. –±–∞–ª</label><input class="form-input" id="cMaxScore" type="number" value="${maxScore}" min="1" oninput="updateScorePreview()"></div>
                        <div class="form-row"><label class="form-label">–ü—Ä–æ—Ö—ñ–¥–Ω–∏–π –±–∞–ª</label><input class="form-input" id="cPassScore" type="number" value="${passScore}" min="1" oninput="updateScorePreview()"></div>
                    </div>
                    <div id="scorePreview" style="font-size:12px;color:var(--text-muted);margin-bottom:20px;"></div>
                    <div class="section-title" style="margin-top:10px;">–ü–∏—Ç–∞–Ω–Ω—è</div>
                    <div id="questionsContainer"></div>
                    <button class="btn btn-secondary btn-block" style="margin-top:12px;" onclick="addQuestion()">+ –î–æ–¥–∞—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è</button>
                    <div style="display:flex;gap:10px;margin-top:24px;">
                        <button class="btn btn-primary" onclick="saveTest()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —Ç–µ—Å—Ç</button>
                        <button class="btn btn-secondary" onclick="showView('home')">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    </div>
                </div>
            `;
            renderQuestions();
            updateScorePreview();
        }

        window.updateScorePreview = () => {
            const max = parseInt(document.getElementById('cMaxScore').value) || 0;
            const qs = window._createQuestions || [];
            const ppq = qs.length > 0 ? Math.round(max / qs.length * 100) / 100 : 0;
            document.getElementById('scorePreview').textContent = `–ë–∞–ª –∑–∞ –ø–∏—Ç–∞–Ω–Ω—è: ${ppq} √ó ${qs.length} –ø–∏—Ç–∞–Ω—å = ${max}`;
        };

        function renderQuestions() {
            const container = document.getElementById('questionsContainer');
            const qs = window._createQuestions;
            const letters = '–ê–ë–í–ì–î–ï–ñ–ó–ò–ö–õ–ú–ù'.split('');
            container.innerHTML = qs.map((q, qi) => `
                <div class="question-block" id="qBlock${qi}">
                    <div class="q-header">
                        <span class="q-number">–ü–∏—Ç–∞–Ω–Ω—è ${qi + 1}</span>
                        <button class="q-remove" onclick="removeQuestion(${qi})">‚úï</button>
                    </div>
                    <div class="form-row">
                        <input class="form-input form-input-sm" placeholder="–¢–µ–∫—Å—Ç –ø–∏—Ç–∞–Ω–Ω—è..." value="${esc(q.text)}" oninput="window._createQuestions[${qi}].text=this.value">
                    </div>
                    <div id="opts${qi}">
                        ${q.options.map((o, oi) => `
                            <div class="option-row">
                                <div class="option-radio ${o.correct ? 'correct-mark' : ''}" onclick="markCorrect(${qi},${oi})"></div>
                                <span style="font-size:12px;font-weight:700;color:var(--text-muted);width:16px;">${letters[oi]}</span>
                                <input class="form-input form-input-sm" style="flex:1" placeholder="–í–∞—Ä—ñ–∞–Ω—Ç ${letters[oi]}..." value="${esc(o.text)}" oninput="window._createQuestions[${qi}].options[${oi}].text=this.value">
                                <button class="option-remove" onclick="removeOption(${qi},${oi})">‚úï</button>
                            </div>
                        `).join('')}
                    </div>
                    <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">
                        <button class="btn-add-option" onclick="addOption(${qi})">+ –í–∞—Ä—ñ–∞–Ω—Ç</button>
                    </div>
                    <div class="toggle-row">
                        <div class="toggle-switch ${q.allowFree ? 'on' : ''}" onclick="toggleFree(${qi},this)"></div>
                        <span class="toggle-label">–î–æ–∑–≤–æ–ª–∏—Ç–∏ –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å</span>
                    </div>
                </div>
            `).join('');
            updateScorePreview();
        }

        window.addQuestion = () => {
            window._createQuestions.push({ text: '', options: [{ text: '', correct: false }, { text: '', correct: false }], allowFree: false });
            renderQuestions();
        };
        window.removeQuestion = (qi) => {
            if (window._createQuestions.length <= 1) return;
            window._createQuestions.splice(qi, 1);
            renderQuestions();
        };
        window.addOption = (qi) => {
            window._createQuestions[qi].options.push({ text: '', correct: false });
            renderQuestions();
        };
        window.removeOption = (qi, oi) => {
            if (window._createQuestions[qi].options.length <= 1) return;
            window._createQuestions[qi].options.splice(oi, 1);
            renderQuestions();
        };
        window.markCorrect = (qi, oi) => {
            window._createQuestions[qi].options.forEach((o, i) => o.correct = i === oi);
            renderQuestions();
        };
        window.toggleFree = (qi, el) => {
            window._createQuestions[qi].allowFree = !window._createQuestions[qi].allowFree;
            el.classList.toggle('on');
        };

        window.saveTest = () => {
            const name = document.getElementById('cName').value.trim();
            const desc = document.getElementById('cDesc').value.trim();
            const cat = document.getElementById('cCat').value.trim();
            const emoji = document.getElementById('cEmoji').value.trim() || 'üìù';
            const maxScore = parseInt(document.getElementById('cMaxScore').value) || 12;
            const passScore = parseInt(document.getElementById('cPassScore').value) || 8;
            const qs = window._createQuestions;

            if (!name) { showModal('‚ùå –ü–æ–º–∏–ª–∫–∞', '–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–µ—Å—Ç—É', '<button class="btn btn-secondary" onclick="closeModal()">OK</button>'); return; }

            let firstError = -1;
            qs.forEach((q, i) => {
                if (!q.text.trim() && firstError < 0) firstError = i;
                const hasCorrect = q.options.some(o => o.correct);
                if (!hasCorrect && !q.allowFree && firstError < 0) firstError = i;
            });
            if (firstError >= 0) {
                const block = document.getElementById('qBlock' + firstError);
                if (block) {
                    block.classList.add('has-error');
                    block.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(() => block.classList.remove('has-error'), 2000);
                }
                showModal('‚ùå –ü–æ–º–∏–ª–∫–∞', `–ü–∏—Ç–∞–Ω–Ω—è ${firstError + 1}: –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —Ç–µ–∫—Å—Ç —Ç–∞ –ø–æ–∑–Ω–∞—á—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–∞–±–æ —É–≤—ñ–º–∫–Ω—ñ—Ç—å –≤—ñ–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å)`, '<button class="btn btn-secondary" onclick="closeModal()">OK</button>');
                return;
            }

            if (editingTestId) {
                const idx = tests.findIndex(t => t.id === editingTestId);
                if (idx >= 0) {
                    tests[idx] = { ...tests[idx], name, description: desc, category: cat, emoji, maxScore, passScore, questions: qs };
                }
            } else {
                tests.push({ id: 't' + Date.now(), name, description: desc, category: cat, emoji, maxScore, passScore, questions: qs });
            }
            save();
            editingTestId = null;
            showView('home');
            addNotif(`–¢–µ—Å—Ç "${name}" ${editingTestId ? '–æ–Ω–æ–≤–ª–µ–Ω–æ' : '—Å—Ç–≤–æ—Ä–µ–Ω–æ'}`);
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           REVIEW VIEW
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderReview() {
            const el = document.getElementById('viewReview');
            const pending = results.filter(r => r.status === 'pending-review');
            if (pending.length === 0) {
                el.innerHTML = '<div class="empty-state"><span class="empty-icon">‚úÖ</span>–ù–µ–º–∞—î —ñ—Å–ø–∏—Ç—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</div>';
                return;
            }
            el.innerHTML = `
                <div class="section-title">üìã –Ü—Å–ø–∏—Ç–∏ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—Ü—ñ (${pending.length})</div>
                ${pending.map(r => {
                    const t = tests.find(t => t.id === r.testId);
                    return `<div class="review-card">
                        <div class="review-header">
                            <div>
                                <div class="review-user">üë§ ${esc(r.userName)}</div>
                                <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">${t ? esc(t.name) : '–í–∏–¥–∞–ª–µ–Ω–∏–π —Ç–µ—Å—Ç'} ‚Ä¢ ${r.date}</div>
                            </div>
                            <div style="font-size:14px;font-weight:800;">–ë–∞–ª–∏: ${r.score}/${r.maxScore}</div>
                        </div>
                        ${r.details.map(d => `
                            <div class="review-answer-block">
                                <div class="review-q">${esc(d.qText)}</div>
                                <div class="review-a">${d.needsReview ? '‚úç ' : ''}${esc(d.answerText)}</div>
                            </div>
                        `).join('')}
                        <div style="display:flex;gap:10px;margin-top:14px;">
                            <button class="btn btn-primary btn-sm" onclick="reviewAction('${r.id}','passed')">‚úÖ –°—Ö–≤–∞–ª–∏—Ç–∏</button>
                            <button class="btn btn-danger btn-sm" onclick="reviewAction('${r.id}','failed')">‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                        </div>
                    </div>`;
                }).join('')}
            `;
        }

        window.reviewAction = (rid, status) => {
            const r = results.find(x => x.id === rid);
            if (!r) return;
            r.status = status;
            r.reviewer = currentUser.name;
            save();

            const statusText = status === 'passed' ? '‚úÖ –°—Ö–≤–∞–ª–µ–Ω–æ' : '‚ùå –í—ñ–¥—Ö–∏–ª–µ–Ω–æ';
            sendWebhook({
                title: `üìã –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–ø–∏—Ç—É`,
                desc: `–Ü—Å–ø–∏—Ç –±—ñ–π—Ü—è **${r.userName}** –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ`,
                color: status === 'passed' ? 0x22c55e : 0xef4444,
                fields: [
                    { name: 'üë§ –ë–æ—î—Ü—å', value: r.userName, inline: true },
                    { name: 'üìä –ë–∞–ª–∏', value: `${r.score}/${r.maxScore}`, inline: true },
                    { name: 'üìå –°—Ç–∞—Ç—É—Å', value: statusText, inline: true },
                    { name: 'üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π', value: currentUser.name, inline: true },
                    { name: 'üìÖ –î–∞—Ç–∞', value: new Date().toLocaleString('uk-UA'), inline: true }
                ]
            });

            addNotif(`${statusText} —ñ—Å–ø–∏—Ç "${r.testName}" –¥–ª—è ${r.userName} ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è—é—á–∏–π: ${currentUser.name}`);
            updateReviewBadge();
            renderReview();
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           MANAGE VIEW
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderManage() {
            const el = document.getElementById('viewManage');
            if (tests.length === 0) {
                el.innerHTML = '<div class="empty-state"><span class="empty-icon">üì≠</span>–¢–µ—Å—Ç—ñ–≤ –Ω–µ–º–∞—î</div>';
                return;
            }
            el.innerHTML = `
                <div class="section-title">‚öôÔ∏è –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Ç–µ—Å—Ç–∞–º–∏</div>
                ${tests.map(t => {
                    const res = results.filter(r => r.testId === t.id);
                    return `<div class="manage-item">
                        <div>
                            <div style="font-weight:800;font-size:14px;">${t.emoji} ${esc(t.name)}</div>
                            <div style="font-size:11px;color:var(--text-muted);margin-top:3px;">${t.questions.length} –ø–∏—Ç–∞–Ω—å ‚Ä¢ ${res.length} —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ ‚Ä¢ –ü—Ä–æ—Ö—ñ–¥–Ω–∏–π: ${t.passScore}/${t.maxScore}</div>
                        </div>
                        <div class="manage-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTest('${t.id}')">‚úèÔ∏è</button>
                            <button class="btn btn-warning btn-sm" onclick="clearResults('${t.id}')">üóë –†–µ–∑—É–ª—å—Ç–∞—Ç–∏</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteTest('${t.id}')">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                        </div>
                    </div>`;
                }).join('')}
            `;
        }

        window.editTest = (id) => {
            renderCreateForm(id);
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.getElementById('viewCreate').classList.add('active');
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            const tabBtn = document.querySelector('.tab-btn[data-view="create"]');
            if (tabBtn) tabBtn.classList.add('active');
        };

        window.deleteTest = (id) => {
            showModal('‚ö†Ô∏è –í–∏–¥–∞–ª–µ–Ω–Ω—è', '–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Ç–µ—Å—Ç?',
                `<button class="btn btn-danger btn-sm" onclick="confirmDelete('${id}')">–í–∏–¥–∞–ª–∏—Ç–∏</button>
                 <button class="btn btn-secondary btn-sm" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>`
            );
        };
        window.confirmDelete = (id) => {
            tests = tests.filter(t => t.id !== id);
            results = results.filter(r => r.testId !== id);
            save();
            closeModal();
            renderManage();
        };
        window.clearResults = (id) => {
            results = results.filter(r => r.testId !== id);
            save();
            renderManage();
        };

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           SETTINGS VIEW
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function renderSettings() {
            const el = document.getElementById('viewSettings');
            el.innerHTML = `
                <div class="settings-block">
                    <div class="settings-title">üîó Discord Webhook</div>
                    <div class="form-row">
                        <input class="form-input" id="sWebhook" value="${esc(webhookUrl)}" placeholder="https://discord.com/api/webhooks/...">
                    </div>
                    <button class="btn btn-primary btn-sm" onclick="saveWebhook()" style="margin-top:8px;">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                </div>
                <div class="settings-block">
                    <div class="settings-title">üë• –ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ</div>
                    <div id="reviewersList">
                        ${reviewers.map((r, i) => `
                            <div class="reviewer-item">
                                <span class="reviewer-name">${esc(r.name)} <span style="font-size:10px;color:var(--text-muted);">(${r.role})</span></span>
                                <button class="reviewer-remove" onclick="removeReviewer(${i})">‚úï</button>
                            </div>
                        `).join('') || '<div style="font-size:12px;color:var(--text-muted);padding:10px;">–ü–µ—Ä–µ–≤—ñ—Ä—é–≤–∞—á—ñ–≤ –Ω–µ –¥–æ–¥–∞–Ω–æ</div>'}
                    </div>
                    <div style="position:relative;margin-top:12px;">
                        <input class="form-input form-input-sm" id="addReviewerInput" placeholder="–ü–æ—à—É–∫ –ª—é–¥–∏–Ω–∏..." oninput="filterPeople(this.value)" onfocus="filterPeople(this.value)">
                        <div class="people-dropdown" id="peopleDropdown" style="display:none;"></div>
                    </div>
                </div>
            `;
        }

        window.saveWebhook = () => {
            webhookUrl = document.getElementById('sWebhook').value.trim();
            save();
            showModal('‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ', 'Webhook URL –∑–±–µ—Ä–µ–∂–µ–Ω–æ', '<button class="btn btn-secondary" onclick="closeModal()">OK</button>');
        };

        window.filterPeople = (val) => {
            const dd = document.getElementById('peopleDropdown');
            const filtered = allUsers.filter(u =>
                u.name.toLowerCase().includes(val.toLowerCase()) &&
                !reviewers.some(r => r.uid === u.uid)
            );
            if (filtered.length === 0 || !val) { dd.style.display = 'none'; return; }
            dd.style.display = 'block';
            dd.innerHTML = filtered.map(u => `
                <div class="people-dropdown-item" onclick="addReviewerFromList('${u.uid}','${esc(u.name)}','${u.role}')">
                    <span>${esc(u.name)}</span>
                    <span style="font-size:10px;color:var(--text-muted);">${u.role}</span>
                </div>
            `).join('');
        };

        window.addReviewerFromList = (uid, name, role) => {
            reviewers.push({ uid, name, role });
            save();
            document.getElementById('addReviewerInput').value = '';
            document.getElementById('peopleDropdown').style.display = 'none';
            renderSettings();
        };

        window.removeReviewer = (i) => {
            reviewers.splice(i, 1);
            save();
            renderSettings();
        };

        document.addEventListener('click', (e) => {
            if (!e.target.closest('#addReviewerInput') && !e.target.closest('#peopleDropdown')) {
                const dd = document.getElementById('peopleDropdown');
                if (dd) dd.style.display = 'none';
            }
        });

        /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
           UTILS
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
        function esc(s) { if (!s) return ''; const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

        // Anti-cheat: block devtools
        document.onkeydown = function(e) {
            if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && [73,74,67].includes(e.keyCode)) || (e.ctrlKey && e.keyCode === 85)) return false;
        };
    </script>
</body>
</html>
