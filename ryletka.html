<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –†–£–õ–ï–¢–ö–ê –£–î–ê–ß–Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-blue: #00eaff; /* –ù–µ–æ–Ω–æ–≤–∏–π —Å–∏–Ω—ñ–π */
            --primary-dark: #0088cc;
            --primary-glow: rgba(0, 234, 255, 0.4);
            --iron-dark: #111116;
            --iron-light: #2a2d35;
            --iron-border: #3e4456;
            --text-main: #e2e8f0;
            --text-dim: #94a3b8;
            --danger: #ff4444;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--iron-dark);
            background-image: 
                radial-gradient(circle at 50% 30%, rgba(0, 234, 255, 0.1) 0%, transparent 70%),
                linear-gradient(0deg, #0a0a0a, #111116);
            color: var(--text-main); 
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--iron-dark); }
        ::-webkit-scrollbar-thumb { background: var(--primary-dark); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-blue); }

        /* HEADER */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 5%; background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid var(--iron-border);
            backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000;
        }
        .logo {
            background: var(--primary-blue);
            color: #000; padding: 5px 10px; font-weight: 900; text-decoration: none; border-radius: 4px;
            box-shadow: 0 0 10px var(--primary-glow);
            text-transform: uppercase;
        }
        .user-info {
            display: flex; align-items: center; gap: 15px;
            font-size: 14px; font-weight: 700;
            background: rgba(0, 234, 255, 0.1);
            padding: 8px 15px; border-radius: 8px; border: 1px solid rgba(0, 234, 255, 0.2);
        }
        .balance-display span { color: var(--primary-blue); font-size: 18px; font-weight: 900; }
        
        /* MAIN CONTAINER */
        .container {
            max-width: 1200px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            padding-bottom: 50px;
        }

        /* WHEEL SECTION */
        .wheel-section {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--iron-border);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
            border-radius: 50%;
            border: 8px solid var(--iron-light);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
        }

        /* Wheel Visuals (CSS Gradients) */
        .wheel {
            width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg, #ff4757 0deg 9%, 
                #f5b041 9deg 18%, 
                #eab308 18deg 27%, 
                #10b981 27deg 36%, 
                #3b82f6 36deg 45%, 
                #6366f1 45deg 54%, 
                #8b5cf6 54deg 63%, 
                #d946ef 63deg 72%, 
                #f43f5e 72deg 81%, 
                #ff4757 81deg 90%, 
                #f5b041 90deg 100%
            );
            transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1);
        }
        
        /* The Pointer/Marker */
        .marker {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0; 
            height: 0; 
            border-left: 10px solid white;
            border-bottom: 10px solid white;
            transform-origin: top center;
            filter: drop-shadow(0 0 5px black);
            z-index: 2;
        }

        /* Controls */
        .multipliers {
            display: flex; justify-content: center; gap: 15px;
            margin: 30px 0;
        }
        
        .btn-mult {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--primary-dark);
            color: white;
            width: 60px; height: 60px;
            border-radius: 10px;
            font-weight: 800;
            cursor: pointer;
            transition: 0.3s;
            display: flex; align-items: center; justify-content: center;
            font-size: 20px;
        }
        .btn-mult.active {
            background: var(--primary-blue);
            color: black;
            box-shadow: 0 0 15px var(--primary-glow);
            border-color: var(--primary-blue);
        }
        .btn-mult:hover:not(.active) { background: rgba(0, 234, 255, 0.1); }

        .btn-spin {
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary-dark), #005577);
            color: white;
            border: none;
            padding: 15px 60px;
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 0 20px var(--primary-glow);
            letter-spacing: 2px;
            transition: 0.2s;
        }
        .btn-spin:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 30px var(--primary-glow);
        }
        .btn-spin:disabled {
            background: #333;
            cursor: not-allowed;
            opacity: 0.5;
            box-shadow: none;
        }

        /* INVENTORY / STORE */
        .inventory-section {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--iron-border);
            border-radius: 20px;
            padding: 20px;
        }
        .section-title {
            margin-top: 0; font-size: 14px; font-weight: 700; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;
        }
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
        }
        .store-item {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--iron-border);
            border-radius: 10px;
            padding: 10px;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .store-item:hover {
            border-color: var(--primary-blue);
            background: rgba(0, 234, 255, 0.05);
        }
        .item-icon {
            font-size: 24px;
        }
        .item-name {
            font-size: 12px;
            color: #fff;
            font-weight: 600;
        }
        .item-price {
            font-size: 11px;
            color: var(--primary-blue);
            font-weight: 700;
        }

        /* ADMIN PANEL (ADMIN PANEL) */
        .admin-panel {
            margin-top: 40px;
            padding: 20px;
            background: rgba(239, 68, 68, 0.05);
            border: 1px solid var(--danger);
            border-radius: 15px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }
        .admin-header {
            color: var(--danger);
            font-size: 14px; font-weight: 800;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .admin-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .admin-input, .admin-select {
            background: #000; border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 6px;
            font-family: inherit;
            outline: none;
        }
        .btn-admin {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-weight: 700;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-admin:hover {
            background: #ff6b6b;
            box-shadow: 0 0 15px var(--danger-glow);
        }

        /* MODAL FOR WIN/LOSE */
        .result-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center; align-items: center;
            z-index: 3000;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }
        .modal-content {
            background: #15171a;
            border: 2px solid var(--primary-blue);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px var(--primary-glow);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 400px; width: 90%;
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .win-amount { font-size: 48px; font-weight: 900; color: var(--primary-blue); margin: 10px 0; text-shadow: 0 0 20px var(--primary-glow); }
        .lose-text { font-size: 24px; color: #666; margin-top: 10px; }
        .btn-close-modal { margin-top: 30px; background: #333; border: none; color: white; padding: 10px 30px; border-radius: 8px; cursor: pointer; font-weight: 700; }
        .btn-close-modal:hover { background: #555; }

    </style>
</head>
<body oncontextmenu="return false;">

    <header>
        <a href="cabinet.html" class="logo">‚Üê –ù–ê–ó–ê–î</a>
        <div class="user-info">
            <span>–ë–ê–õ–ê–ù–°:</span>
            <span id="userBalance" class="balance-display">0</span>
        </div>
    </header>

    <div class="container">
        
        <!-- –õ–Ü–í–ê –ß–ê–°–¢–ò–ù–ê -->
        <div class="wheel-section">
            <div class="wheel-container">
                <div class="wheel" id="wheel"></div>
                <div class="marker" id="marker"></div>
                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ö—Ä—É—Ç–∏" -->
                <button class="btn-spin" id="spinBtn">–ö–†–£–¢–ò</button>
            </div>

            <div class="multipliers">
                <button class="btn-mult active" onclick="setMultiplier(1)">x1</button>
                <button class="btn-mult" onclick="setMultiplier(2)">x2</button>
                <button class="btn-mult" onclick="setMultiplier(3)">x3</button>
                <button class="btn-mult" onclick="setMultiplier(5)">x5</button>
            </div>

            <div id="spinResult" style="margin-top: 15px; font-weight: 700; color: var(--text-dim); height: 20px;"></div>
        </div>

        <!-- –ü–†–ê–í–ê –ß–ê–°–¢–ò–ù–ê (–ú–∞–≥–∞–∑–∏–Ω) -->
        <div class="inventory-section" id="inventorySection">
            <div class="section-title">
                <span>üõí –ú–ê–ì–ê–ó–ò–ù</span>
                <!-- –ê–¥–º—ñ–Ω—Å—å–∫–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è -->
                <button id="openAdminBtn" style="display:none; border:none; background:rgba(255,255,255,0.1); color:var(--text-dim); cursor:pointer; border-radius:4px; padding: 5px 10px;">‚öô –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø</button>
            </div>
            <div class="items-grid" id="storeGrid">
                <!-- –¢–æ–≤–∞—Ä–∏ –≥–µ–Ω–µ—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

    </div>

    <!-- –ê–î–ú–Ü–ù –ü–ê–ù–ï–õ–¨ (–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –±–∞–ª–∞–Ω—Å–æ–º) -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">‚öô –ö–ï–†–£–í–ê–ù–ù–Ø –ë–ê–õ–ê–ù–°–û–ú</div>
        <div class="admin-form">
            <label style="color: #ccc; font-size: 12px; margin-bottom: 5px;">–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞:</label>
            <select id="userSelect" class="admin-select">
                <option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...</option>
            </select>
            
            <label style="color: #ccc; font-size: 12px; margin-bottom: 5px;">–°—É–º–∞ –¥–ª—è –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è:</label>
            <input type="number" id="adminAmount" class="admin-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É...">
            
            <label style="color: #888; font-size: 11px; margin-bottom: 10px;">
                –í–∏–±–µ—Ä—ñ—Ç—å –¥—ñ—é (–∑–∞–≤–∂–¥–∏ –Ω–∞–¥—Å–∏–ª–∞—î—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç):
            </label>
            <select id="adminActionType" class="admin-select">
                <option value="add">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å</option>
            </select>

            <button class="btn-admin" onclick="adminSubmit()">–ù–ê–ß–ò–°–õ–ò–¢–ò / –ü–û–ü–û–í–ù–ò–¢–ò</button>
            <div id="adminMsg" style="color: #4ade80; font-size: 12px; margin-top: 5px;"></div>
        </div>
        <div style="text-align: right; margin-top: 10px;">
            <button class="btn-close-modal" style="margin-top:0; background: transparent; color: #555; border: 1px solid #333; padding: 5px 10px; border-radius: 4px; cursor: pointer;" onclick="document.getElementById('adminPanel').style.display='none'">‚úï –ó–ê–ö–†–ò–¢–ò</button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –í–Ü–ö–ù–û –†–ï–ó–£–õ–¨–¢–ê–¢–£ -->
    <div class="result-modal" id="resultModal">
        <div class="modal-content">
            <h2 id="resTitle">–í–ò–ì–†–ê–®!</h2>
            <div id="resAmount" class="win-amount">5000</div>
            <p style="color: #ccc;">–ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª–µ–Ω–æ.</p>
            <button class="btn-close-modal">–û–ö</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.8/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, collection, onSnapshot, setDoc, getDocs, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/10.8.8/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.firebasestorage.app",
        messagingSenderId: "661591588818",
        appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –Ü–ì–†–ò ---
    // 0 = –ß–µ—Ä–≤–æ–Ω–∏–π (–ü—Ä–æ–≥—Ä)
    // 1 = –ñ–æ–≤—Ç–∏–π (x2)
    // 2 = –ü–æ–º–∞—Ä–∞–Ω–∂–µ–≤–∏–π (x3)
    // 3 - 9 = –°–∏–Ω—ñ–π (x5)
    // 10-36 = –ó–µ–ª–µ–Ω–∏–π (x5)
    
    const prizes = [
        { name: "–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è", value: 0, multiplier: 1, color: "red" },
        { name: "x2 –ú–Ω–æ–∂–Ω–∏–∫", value: 0, multiplier: 2, color: "yellow" },
        { name: "–ü–æ–º–∞—Ä–∞–Ω–∂–µ–≤–∏–π", value: 0, multiplier: 3, color: "orange" },
        { name: "500 –ì–†–ù", value: 500, multiplier: 1, color: "blue" },
        { name: "1000 –ì–†–ù", value: 1000, multiplier: 1, "color": "green" },
        { 11: "x5 –ú–Ω–æ–∂–Ω–∏–∫", value: 0, multiplier: 5, color: "cyan" },
        { 12: "x5 –ú–Ω–æ–∂–Ω–∏–∫", value: 0, multiplier: 5, color: "cyan" },
        // –ó–∞–ø–æ–≤–Ω—é—î–º–æ —ñ–Ω—à—ñ –ø–æ–∑–∏—Ü—ñ—ó –ø—É—Å—Ç–∏–º–∏ –º–Ω–æ–∂–Ω–∏–∫–∞–º–∏ –¥–ª—è –±–∞–ª–∞–Ω—Å–æ–≤—É
        ...Array(30).fill(null).map((_, i) => ({ name: "–ù—ñ—á–æ–≥–æ", value: 0, multiplier: 5, color: "#333" }))
    ];
    
    // –¢–û–í–∞—Ä–∏ (–ú–∞–≥–∞–∑–∏–Ω) - –ü—Ä–∏–∫–ª–∞–¥–Ω–∏–π —Å–ø–∏—Å–æ–∫. 
    // 'price' - —Å–∫—ñ–ª—å–∫–∏ –∫–æ—à—Ç—É—î —Ü–µ –≤ –≥—Ä—ñ—à–∞—Ö (–±–∞–ª–∞–Ω—Å).
    const storeItems = [
        { id: 1, name: "–ë–∞–ª–∞–Ω—Å x2", icon: "üí∞", price: 500, type: "add", value: 500 }, // –ü—Ä–∏–∫–ª–∞–¥: –ö—É–ø—É—î—à 500 –±–∞–ª–∞–Ω—Å –∑–∞ 500
        { id: 2, name: "x1 –ú–Ω–æ–∂–Ω–∏–∫", icon: "üçÄ", price: 1000, type: "item", value: 0 },  // –ö—É–ø—É—î—à –¥–æ—Å—Ç—É–ø –¥–æ x2 –Ω–∞ 1 —Å–ø—ñ–Ω
        { id: 3, name: "x5 –ú–Ω–æ–∂–Ω–∏–∫", icon: "üöÄ", price: 5000, type: "item", value: 5 }, // –ö—É–ø—É—î—à –¥–æ—Å—Ç—É–ø –¥–æ x5 –Ω–∞ 1 —Å–ø—ñ–Ω
        { id: 4, name: "–î–µ–Ω—å–≥—ñ", icon: "üìÖ", price: 10000, type: "item", value: 0 },
        { id: 5, name: "VIP", icon: "üëë", price: 15000, type: "role", value: 0 }
    ];

    let currentMultiplier = 1;
    let userBalance = 0;
    let userRole = 'user'; // 'fighter', 'admin', 'instructor'
    let isSpinning = false;

    document.onkeydown = function(e) {
        if(e.keyCode == 123 || (e.ctrlKey && e.shiftKey && [73, 74, 67].includes(e.keyCode)) || (e && e.ctrlKey && e.keyCode == 85)) return false;
    };
    setInterval(() => console.clear(), 500);

    onAuthStateChanged(auth, async (user) => {
        if (!user) {
            window.location.href = "index.html";
            return;
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ä–æ–ª—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω–∫–∏, —ñ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä/–≥—Ä–∞–≤–µ—Ü—å –±–∞—á–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É)
        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()) {
            const data = userDoc.data();
            userRole = data.role || 'user';
            userBalance = data.balance || 0;
            updateBalanceDisplay();

            if (userRole === 'admin') {
                document.getElementById('openAdminBtn').style.display = 'block';
                loadUsersForAdmin();
                loadStore();
            } else {
                document.getElementById('adminPanel').style.display = 'none';
                loadStore();
            }
        }
    });

    function updateBalanceDisplay() {
        const el = document.getElementById('userBalance');
        if(el) el.innerText = userBalance + " –ì–†–ù";
    }

    // --- –ú–ê–ì–ê–ó–ò–ù ---
    function loadStore() {
        const grid = document.getElementById('storeGrid');
        grid.innerHTML = "";
        storeItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'store-item';
            div.onclick = () => buyItem(item);
            div.innerHTML = `
                <div class="item-icon">${item.icon}</div>
                <div class="item-name">${item.name}</div>
                <div class="item-price">${item.price} –ì–†–ù</div>
            `;
            grid.appendChild(div);
        });
    }

    async function buyItem(item) {
        if (isSpinning) {
            alert("–ü–æ—á–µ–∫–∞–π—Ç–µ —Å–ø—ñ–Ω!");
            return;
        }
        
        if (userBalance < item.price) {
            alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å—ñ!");
            return;
        }

        const confirmMsg = `–ö—É–ø–∏—Ç–∏ ${item.name} –∑–∞ ${item.price} –ì–†–ù?`;
        if (!confirm(confirmMsg)) return;

        try {
            // –õ–û–ì–Ü–ö–ê –ü–û–ö–£–ü–ö–ò
            const user = auth.currentUser;
            if(!user) return;

            const newBalance = userBalance - item.price;
            
            await updateDoc(doc(db, "users", user.uid), { balance: newBalance });
            
            alert("–ö—É–ø—ñ–≤–ª–µ–Ω–æ: " + item.name);
        } catch (e) {
            console.error(e);
            alert("–ü–æ–º–∏–ª–∫–∞ –ø–æ–∫—É–ø–∫–∏.");
        }
    }

    // --- –ê–î–ú–Ü–ù –§–£–ù–ö–¶–Ü–á ---
    async function loadUsersForAdmin() {
        const select = document.getElementById('userSelect');
        select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞...</option>';
        
        const q = query(collection(db, "users"), orderBy("balance", "desc"));
        const snap = await getDocs(q);
        
        snap.forEach(docSnap => {
            const u = docSnap.data();
            const option = document.createElement('option');
            option.value = docSnap.id;
            option.text = `${u.name} (–ë–∞–ª–∞–Ω—Å: ${u.balance || 0})`;
            select.appendChild(option);
        });
    }

    window.adminSubmit = async () => {
        const uid = document.getElementById('userSelect').value;
        const amount = parseInt(document.getElementById('adminAmount').value);
        
        if (!uid || !amount || amount <= 0) {
            alert("–í–∏–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –≤–≤–µ–¥—ñ—Ç—å —Å—É–º—É.");
            return;
        }

        const docRef = doc(db, "users", uid);
        const snap = await getDoc(docRef);

        if (!snap.exists()) {
            alert("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.");
            return;
        }

        const currentBal = snap.data().balance || 0;
        const newBalance = currentBal + amount;

        // –ù–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ —á–∞—Ç
        await addDoc(collection(db, "chats"), {
            text: `‚úÖ –í–∞–º –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ **${amount} –ì–†–ù**. –ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–æ ${newBalance}.`,
            author: "SYSTEM",
            createdAt: new Date()
        });

        await updateDoc(docRef, { balance: newBalance });
        
        document.getElementById('adminMsg').innerText = `–£—Å–ø—ñ—à–Ω–æ! –ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è ID: ${uid}.`;
        setTimeout(() => document.getElementById('adminMsg').innerText = "", 2000);
    };

    // --- –õ–û–ì–Ü–ö–ê –†–£–õ–ï–¢–ö–ò ---
    function setMultiplier(mult) {
        if (isSpinning) return;
        currentMultiplier = mult;
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è UI –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.btn-mult').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        const spinCost = 100 * currentMultiplier;
        const btn = document.getElementById('spinBtn');
        
        if (userRole === 'admin') {
            btn.innerText = `–ö–†–£–¢–ò (x${mult})`;
            btn.style.opacity = '1';
        } else {
            if (userBalance >= spinCost) {
                btn.innerText = `–ö–†–£–¢–ò (-${spinCost} –ì–†–ù)`;
                btn.disabled = false;
            } else {
                btn.innerText = `–ù–ï–î–û–°–¢–ê–¢–ù–¨–û –ë–ê–õ–ê–ù–°–£ (-${spinCost} –ì–†–ù)`;
                btn.disabled = true;
            }
        }
    }

    window.spinWheel = async () => {
        if (isSpinning) return;

        const spinCost = 100 * currentMultiplier;

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å—É –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤
        if (userRole !== 'admin') {
            if (userBalance < spinCost) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å—ñ –¥–ª—è —Ü—ñ—î—ó —Å—Ç–∞–≤–∫–∏!");
                return;
            }
            
            // –ó–Ω—ñ–º–∞—î–º–æ –±–∞–ª–∞–Ω—Å (—Å–ø–∏—Å—É—î–º–æ –≤ –±–∞–∑—É –ø—ñ–∑–Ω—ñ—à–µ)
            const user = auth.currentUser;
            await updateDoc(doc(db, "users", user.uid), { balance: (userBalance - spinCost) });
        }

        // –ü–æ—á–∏–Ω–∞—î–º–æ —Å–ø—ñ–Ω
        isSpinning = true;
        const btn = document.getElementById('spinWheelBtn'); // –ü–æ–º–∏–ª–∫–∞ –≤ HTML, –≤–∏–ø—Ä–∞–≤–∏–≤ –Ω–∞ spinBtn
        document.getElementById('spinBtn').innerText = "–ì–†–ê–Ñ–ú–û..."; // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –∫–Ω–æ–ø–∫–∏
        
        const wheel = document.getElementById('wheel');
        let rotations = 0; // –°–∫—ñ–ª—å–∫–∏ –æ–±–µ—Ä—Ç—ñ–≤
        const totalRotations = 5 + Math.floor(Math.random() * 5); // –í—ñ–¥ 5 –¥–æ 10 –æ–±–µ—Ä—Ç—ñ–≤
        let currentRotation = 0;

        const wheelInterval = setInterval(() => {
            currentRotation += 15;
            wheel.style.transform = `rotate(${currentRotation}deg)`;
            rotations++;

            if (rotations >= totalRotations) {
                clearInterval(wheelInterval);
                isSping = false;
                handleResult(currentRotation);
                // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –∫–Ω–æ–ø–∫—É –≤ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
                setMultiplier(currentMultiplier);
            }
        }, 100);
    };

    async function handleResult(finalRotation) {
        const wheel = document.getElementById('wheel');
        const normalizedDeg = finalRotation % 360;
        
        // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–µ–∫—Ç–æ—Ä—É
        // 360 –≥—Ä–∞–¥—É—Å—ñ–≤ / 37 —Å–µ–∫—Ç–æ—Ä—ñ–≤ = ~9.7 –≥—Ä–∞–¥—É—Å—ñ–≤ –Ω–∞ —Å–µ–∫—Ç–æ—Ä
        const sectorIndex = Math.floor(normalizedDeg / 10);
        
        const prize = prizes[sectorIndex] || prizes[prizes.length - 1];
        
        const user = auth.currentUser;
        
        let message = "";
        let amount = 0;

        if (prize.multiplier !== 1) {
            message = `–í–∏ –≤–∏–≥—Ä–∞–ª–∏ –º–Ω–æ–∂–Ω–∏–∫ x${prize.multiplier}!`;
        } else if (prize.value > 0) {
            amount = prize.value;
            message = `–í–∏ –≤–∏–≥—Ä–∞–ª–∏ ${prize.name}!`;
            
            // –Ø–∫—â–æ –≤–∏–≥—Ä–∞–≤ –≥—Ä–æ—à—ñ, –¥–æ–¥–∞—î–º–æ –¥–æ –±–∞–ª–∞–Ω—Å—É
            await updateDoc(doc(db, "users", user.uid), {
                balance: increment(userBalance, amount)
            });
        } else {
            message = "–ù—ñ—á–æ–≥–æ.";
        }

        showResultModal(message, amount, prize);
        
        // –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–ª–∞–Ω—Å –ª–æ–∫–∞–ª—å–Ω–æ, —â–æ–± UI –æ–Ω–æ–≤–∏–≤—Å—è –º–∏—Ç—Ç—î–≤–æ
        if(userRole !== 'admin') {
            userBalance += amount;
            updateBalanceDisplay();
        }
    }

    function showResultModal(text, amount, prize) {
        const modal = document.getElementById('resultModal');
        const title = document.getElementById('resTitle');
        const amountDiv = document.getElementById('resAmount');
        
        if (amount > 0) {
            title.innerText = "–í–ò–ì–†–ê–®!";
            amountDiv.innerText = `+${amount} –ì–†–ù`;
            amountDiv.style.color = prize.color || 'var(--primary-blue)';
        } else {
            title.innerText = "–ù–ï –ü–û–©–ê–°–¢–ò–í–°–Ø –°–ü–†–û–ë–ê";
            amountDiv.innerText = "0";
            amountDiv.style.color = "#666";
        }
        
        document.getElementById('resTitle').innerText = text; // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É
        modal.style.display = 'flex';
    }

    function increment(current, value) {
        return (current || 0) + value;
    }

    // –ó–∞–∫—Ä–∏—Ç—Ç—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –≤—ñ–∫–Ω–∞
    document.querySelector('.btn-close-modal').onclick = () => {
        document.getElementById('resultModal').style.display = 'none';
    }

</script>

</body>
</html>
