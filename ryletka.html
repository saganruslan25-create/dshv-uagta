<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –†–£–õ–ï–¢–ö–ê –£–î–ê–ß–Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --primary-bright: #4ade80;
            --accent: #f97316;
            --bg: #030507;
            --card-bg: rgba(10, 12, 16, 0.7);
            --glass-border: rgba(34, 197, 94, 0.2);
            --text-gray: #94a3b8;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg);
            background-image: radial-gradient(circle at 50% 0%, rgba(34, 197, 94, 0.1) 0%, transparent 50%);
            color: white; font-family: 'Inter', sans-serif;
            min-height: 100vh; overflow-x: hidden;
        }

        /* HEADER & BALANCE */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 5%; background: rgba(3, 5, 7, 0.8);
            backdrop-filter: blur(15px); border-bottom: 1px solid var(--glass-border);
            position: sticky; top: 0; z-index: 1000;
        }
        .balance-box {
            display: flex; align-items: center; gap: 10px;
            background: rgba(249, 115, 22, 0.1); border: 1px solid var(--accent);
            padding: 8px 15px; border-radius: 12px; font-weight: 800;
        }
        .coin-icon { color: var(--accent); font-size: 18px; }
        .btn-plus {
            background: var(--accent); color: white; border: none;
            width: 24px; height: 24px; border-radius: 6px; cursor: pointer;
            font-weight: 900; display: flex; align-items: center; justify-content: center;
        }

        /* LAYOUT */
        .main-container {
            display: grid; grid-template-columns: 280px 1fr; gap: 30px;
            max-width: 1600px; margin: 30px auto; padding: 0 5%;
        }

        /* SIDEBAR MENU */
        .sidebar {
            background: var(--card-bg); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; display: flex; flex-direction: column; gap: 10px;
            height: fit-content;
        }
        .menu-btn {
            padding: 15px; border-radius: 12px; border: 1px solid transparent;
            background: rgba(255,255,255,0.03); color: white; text-align: left;
            font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        .menu-btn:hover, .menu-btn.active {
            background: rgba(34, 197, 94, 0.1); border-color: var(--primary); color: var(--primary-bright);
        }

        /* CONTENT SECTIONS */
        .content-section { display: none; animation: fadeIn 0.4s ease; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ROULETTE CAROUSEL */
        .roulette-wrapper {
            position: relative; background: #0a0c10; border: 1px solid var(--glass-border);
            border-radius: 30px; padding: 40px; text-align: center; overflow: hidden;
            margin-bottom: 40px;
        }
        .roulette-title { font-size: 48px; font-weight: 900; letter-spacing: 5px; color: var(--accent); margin-bottom: 30px; text-transform: uppercase; }
        
        .carousel-container {
            position: relative; height: 220px; margin: 40px 0; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.05); border-radius: 20px;
        }
        .carousel-track {
            display: flex; gap: 15px; position: absolute; left: 0; transition: transform 5s cubic-bezier(0.1, 0, 0.1, 1);
            padding: 0 50%;
        }
        .prize-item {
            min-width: 180px; height: 200px; background: rgba(255,255,255,0.02);
            border: 1px solid rgba(255,255,255,0.05); border-radius: 20px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 15px; position: relative;
        }
        .prize-img { width: 100px; height: 100px; object-fit: contain; margin-bottom: 10px; }
        .prize-name { font-size: 12px; font-weight: 800; color: var(--text-gray); }

        .center-line {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 4px; height: 100%; background: var(--accent); z-index: 10;
            box-shadow: 0 0 15px var(--accent);
        }

        /* CONTROLS */
        .spin-controls { display: flex; gap: 20px; justify-content: center; align-items: center; margin-top: 30px; }
        .multiplier-group { display: flex; gap: 5px; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 10px; }
        .mult-btn {
            width: 45px; height: 45px; border: none; background: transparent; color: var(--text-gray);
            font-weight: 800; cursor: pointer; border-radius: 8px;
        }
        .mult-btn.active { background: var(--accent); color: white; }

        .btn-spin {
            padding: 18px 40px; border-radius: 15px; border: none; font-weight: 900;
            cursor: pointer; text-transform: uppercase; font-size: 16px; transition: 0.3s;
        }
        .btn-free { background: #222; color: white; border: 1px solid #444; }
        .btn-paid { background: linear-gradient(to right, #ea580c, #f97316); color: white; box-shadow: 0 0 20px rgba(249, 115, 22, 0.4); }
        .btn-spin:hover { transform: scale(1.05); }
        .btn-spin:disabled { opacity: 0.5; cursor: not-allowed; }

        /* ADMIN CONSOLE */
        .admin-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; }
        .console-box { background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 20px; padding: 25px; }
        .log-item {
            padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 13px;
            color: var(--text-gray); display: flex; justify-content: space-between;
        }

        /* REFILL FORM */
        .refill-form { display: flex; flex-direction: column; gap: 15px; }
        .accordion-select {
            width: 100%; background: #000; border: 1px solid #333; color: white;
            padding: 12px; border-radius: 10px; outline: none;
        }
        .input-sum {
            width: 100%; background: #000; border: 1px solid #333; color: white;
            padding: 12px; border-radius: 10px; font-size: 16px;
        }

        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content { background: #0a0f1a; border: 1px solid var(--primary); padding: 30px; border-radius: 25px; width: 400px; text-align: center; }

        @media (max-width: 1024px) {
            .main-container { grid-template-columns: 1fr; }
            .sidebar { flex-direction: row; overflow-x: auto; }
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <header>
        <a href="cabinet.html" style="text-decoration: none; color: var(--primary); font-weight: 900;">‚¨Ö –ù–ê–ó–ê–î –í –ö–ê–ë–Ü–ù–ï–¢</a>
        <div class="balance-box">
            <span class="coin-icon">ü™ô</span>
            <span id="userBalance">0</span>
            <button class="btn-plus" onclick="switchSection('admin')">+</button>
        </div>
    </header>

    <div class="main-container">
        <div class="sidebar">
            <button class="menu-btn active" onclick="switchSection('roulette', this)">üé≤ –†–£–õ–ï–¢–ö–ê</button>
            <button class="menu-btn" id="adminMenuBtn" style="display:none;" onclick="switchSection('admin', this)">üõ°Ô∏è –ê–î–ú–Ü–ù –ö–û–ù–°–û–õ–¨</button>
            <button class="menu-btn" onclick="switchSection('shop', this)">üõí –ú–ê–ì–ê–ó–ò–ù (WIP)</button>
        </div>

        <div class="content-wrapper">
            <!-- ROULETTE SECTION -->
            <div id="rouletteSection" class="content-section active">
                <div class="roulette-wrapper">
                    <div class="roulette-title">–†–£–õ–ï–¢–ö–ê</div>
                    <div class="carousel-container">
                        <div class="center-line"></div>
                        <div id="carouselTrack" class="carousel-track"></div>
                    </div>
                    
                    <div class="spin-controls">
                        <div class="multiplier-group">
                            <button class="mult-btn active" onclick="setMultiplier(1, this)">x1</button>
                            <button class="mult-btn" onclick="setMultiplier(2, this)">x2</button>
                            <button class="mult-btn" onclick="setMultiplier(3, this)">x3</button>
                            <button class="mult-btn" onclick="setMultiplier(5, this)">x5</button>
                        </div>
                        <button class="btn-spin btn-free" onclick="spinRoulette(true)">–ö—Ä—É—Ç–∏—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ</button>
                        <button class="btn-spin btn-paid" id="btnSpinPaid" onclick="spinRoulette(false)">–ö—Ä—É—Ç–∏—Ç–∏ –∑–∞ 89 –±–∞–ª—ñ–≤</button>
                    </div>
                </div>

                <h3 style="color:var(--primary-bright); text-transform: uppercase; letter-spacing: 2px;">–ô–º–æ–≤—ñ—Ä–Ω–∏–π –¥—Ä–æ–ø</h3>
                <div id="dropGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-top:20px;"></div>
            </div>

            <!-- ADMIN SECTION -->
            <div id="adminSection" class="content-section">
                <h2 style="margin-bottom: 25px; color: var(--primary-bright);">–ê–î–ú–Ü–ù –ö–û–ù–°–û–õ–¨</h2>
                <div class="admin-grid">
                    <div class="console-box">
                        <h4 style="margin-top:0; border-bottom: 1px solid #333; padding-bottom:10px;">–Ü—Å—Ç–æ—Ä—ñ—è –æ–ø–µ—Ä–∞—Ü—ñ–π</h4>
                        <div id="adminLogs" style="max-height: 400px; overflow-y: auto;"></div>
                    </div>
                    <div class="console-box refill-form">
                        <h4 style="margin-top:0;">–ù–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤</h4>
                        <label style="font-size:12px; color:var(--text-gray);">–û–ë–ï–†–Ü–¢–¨ –ë–Ü–ô–¶–Ø</label>
                        <select id="userSelect" class="accordion-select">
                            <option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤...</option>
                        </select>
                        <label style="font-size:12px; color:var(--text-gray);">–°–£–ú–ê –ë–ê–õ–Ü–í</label>
                        <input type="number" id="refillAmount" class="input-sum" placeholder="0">
                        <button class="btn-spin btn-paid" style="width:100%;" onclick="confirmRefill()">–ü–æ–ø–æ–≤–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å</button>
                    </div>
                </div>
            </div>

            <!-- SHOP SECTION -->
            <div id="shopSection" class="content-section">
                <div style="text-align:center; padding: 100px; opacity: 0.5;">
                    <h1 style="font-size: 50px;">üõí</h1>
                    <h2>–ú–ê–ì–ê–ó–ò–ù –í –†–û–ó–†–û–ë–¶–Ü</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- CONFIRM MODAL -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="modalTitle">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h3>
            <p id="modalDesc" style="color:var(--text-gray); font-size:14px; margin:20px 0;"></p>
            <div style="display:flex; gap:10px;">
                <button class="btn-spin btn-free" style="flex:1;" onclick="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                <button id="modalActionBtn" class="btn-spin btn-paid" style="flex:1;">–¢–ê–ö, –ü–Ü–î–¢–í–ï–†–î–ñ–£–Æ</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, collection, onSnapshot, query, orderBy, addDoc, serverTimestamp, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
            authDomain: "dsv-gta.firebaseapp.com",
            projectId: "dsv-gta",
            storageBucket: "dsv-gta.firebasestorage.app",
            messagingSenderId: "661591588818",
            appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let user = null;
        let userData = null;
        let multiplier = 1;
        let isSpinning = false;

        const prizes = [
            { name: "BMW M5 CS", type: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å", rarity: "legendary", img: "https://i.ibb.co/LnxY5t9/car1.png" },
            { name: "–°–∫—ñ–Ω - –ì—Ä–∞–±—ñ–∂–Ω–∏–∫", type: "–°–∫—ñ–Ω", rarity: "epic", img: "https://i.ibb.co/VvzK2Bv/skin1.png" },
            { name: "Lexus LX 570", type: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å", rarity: "legendary", img: "https://i.ibb.co/9V5Lq8d/car2.png" },
            { name: "–õ–æ—Ö–∏–Ω–∞", type: "–ü—Ä–µ–¥–º–µ—Ç", rarity: "common", img: "https://i.ibb.co/7X8mF9k/berry.png" },
            { name: "Mercedes-Benz Actros", type: "–ê–≤—Ç–æ–º–æ–±—ñ–ª—å", rarity: "rare", img: "https://i.ibb.co/vYm6p1Y/truck.png" },
            { name: "–°–∫—ñ–Ω - –î–∏–≤–µ—Ä—Å–∞–Ω—Ç", type: "–°–∫—ñ–Ω", rarity: "epic", img: "https://i.ibb.co/VvzK2Bv/skin1.png" }
        ];

        onAuthStateChanged(auth, async (u) => {
            if (!u) { window.location.href = "index.html"; return; }
            user = u;
            onSnapshot(doc(db, "users", u.uid), (snap) => {
                userData = snap.data();
                document.getElementById('userBalance').innerText = userData.points || 0;
                if (userData.role === 'admin' || userData.role === 'instructor') {
                    document.getElementById('adminMenuBtn').style.display = 'block';
                    loadAllUsers();
                    loadLogs();
                }
            });
            initRoulette();
        });

        function initRoulette() {
            const track = document.getElementById('carouselTrack');
            const grid = document.getElementById('dropGrid');
            track.innerHTML = "";
            grid.innerHTML = "";

            // –ü–æ—á–∞—Ç–∫–æ–≤–µ –Ω–∞–ø–æ–≤–Ω–µ–Ω–Ω—è —Ç—Ä–µ–∫—É (—Ä–∞–Ω–¥–æ–º–Ω—ñ –ø—Ä–µ–¥–º–µ—Ç–∏)
            for (let i = 0; i < 50; i++) {
                const p = prizes[Math.floor(Math.random() * prizes.length)];
                track.appendChild(createPrizeNode(p));
            }

            // –°—ñ—Ç–∫–∞ –¥—Ä–æ–ø—É
            prizes.forEach(p => {
                const card = document.createElement('div');
                card.className = 'prize-item';
                card.style.height = 'auto';
                card.innerHTML = `<img src="${p.img}" class="prize-img"><b>${p.name}</b><small>${p.type}</small>`;
                grid.appendChild(card);
            });
        }

        function createPrizeNode(p) {
            const el = document.createElement('div');
            el.className = 'prize-item';
            el.innerHTML = `<img src="${p.img}" class="prize-img"><span class="prize-name">${p.name}</span>`;
            return el;
        }

        window.switchSection = (id, btn) => {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id + 'Section').classList.add('active');
            if(btn) btn.classList.add('active');
        };

        window.setMultiplier = (val, btn) => {
            multiplier = val;
            document.querySelectorAll('.mult-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('btnSpinPaid').innerText = `–ö—Ä—É—Ç–∏—Ç–∏ –∑–∞ ${89 * multiplier} –±–∞–ª—ñ–≤`;
        };

        window.spinRoulette = async (isFree) => {
            if (isSpinning) return;
            const cost = 89 * multiplier;
            if (!isFree && (userData.points || 0) < cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤!");

            isSpinning = true;
            const track = document.getElementById('carouselTrack');
            track.style.transition = 'none';
            track.style.transform = 'translateX(0)';
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const winIdx = 40 + Math.floor(Math.random() * 5);
            const winner = prizes[Math.floor(Math.random() * prizes.length)];
            
            // –ü–µ—Ä–µ–º–∞–ª—å–æ–≤—É—î–º–æ —Ç—Ä–µ–∫ –¥–ª—è –ø–ª–∞–≤–Ω–æ—ó –∞–Ω—ñ–º–∞—Ü—ñ—ó
            track.innerHTML = "";
            for (let i = 0; i < 60; i++) {
                const p = (i === winIdx) ? winner : prizes[Math.floor(Math.random() * prizes.length)];
                track.appendChild(createPrizeNode(p));
            }

            setTimeout(() => {
                track.style.transition = 'transform 5s cubic-bezier(0.1, 0, 0.1, 1)';
                const offset = winIdx * 195; // 180 width + 15 gap
                track.style.transform = `translateX(-${offset}px)`;
            }, 50);

            setTimeout(async () => {
                isSpinning = false;
                if (!isFree) {
                    await updateDoc(doc(db, "users", user.uid), {
                        points: (userData.points || 0) - cost
                    });
                }
                alert(`üéâ –í–∏ –≤–∏–≥—Ä–∞–ª–∏: ${winner.name}! (x${multiplier})`);
            }, 5500);
        };

        // ADMIN FUNCTIONS
        async function loadAllUsers() {
            const select = document.getElementById('userSelect');
            const snap = await getDocs(collection(db, "users"));
            select.innerHTML = '<option value="">–û–±–µ—Ä—ñ—Ç—å –±—ñ–π—Ü—è...</option>';
            snap.forEach(d => {
                const u = d.data();
                select.innerHTML += `<option value="${d.id}">${u.name} (${u.rank})</option>`;
            });
        }

        function loadLogs() {
            const logs = document.getElementById('adminLogs');
            onSnapshot(query(collection(db, "roulette_logs"), orderBy("timestamp", "desc")), (snap) => {
                logs.innerHTML = "";
                snap.forEach(d => {
                    const l = d.data();
                    logs.innerHTML += `<div class="log-item">
                        <span><b>${l.admin}</b> ‚ûî ${l.target}</span>
                        <span style="color:var(--primary);">+${l.amount}</span>
                    </div>`;
                });
            });
        }

        window.confirmRefill = () => {
            const targetId = document.getElementById('userSelect').value;
            const amount = parseInt(document.getElementById('refillAmount').value);
            const targetName = document.getElementById('userSelect').selectedOptions[0].text;

            if (!targetId || !amount) return alert("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!");

            document.getElementById('modalTitle').innerText = "–ü–Ü–î–¢–í–ï–†–î–ñ–ï–ù–ù–Ø –ù–ê–†–ê–•–£–í–ê–ù–ù–Ø";
            document.getElementById('modalDesc').innerText = `–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –Ω–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ ${amount} –±–∞–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É ${targetName}?`;
            document.getElementById('confirmModal').style.display = 'flex';
            
            document.getElementById('modalActionBtn').onclick = async () => {
                const targetRef = doc(db, "users", targetId);
                const targetSnap = await getDoc(targetRef);
                const currentPoints = targetSnap.data().points || 0;
                
                await updateDoc(targetRef, { points: currentPoints + amount });
                await addDoc(collection(db, "roulette_logs"), {
                    admin: userData.name,
                    target: targetName.split('(')[0].trim(),
                    amount: amount,
                    timestamp: serverTimestamp()
                });

                closeModal();
                alert(`–ë–∞–ª–∞–Ω—Å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${targetName} —É—Å–ø—ñ—à–Ω–æ –ø–æ–ø–æ–≤–Ω–µ–Ω–æ –Ω–∞ ${amount} –±–∞–ª—ñ–≤!`);
            };
        };

        window.closeModal = () => document.getElementById('confirmModal').style.display = 'none';

    </script>
</body>
</html>
`
      }
    ]
  }
</changes>
