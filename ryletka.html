<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–î–®–í | –ö–û–õ–ï–°–û –§–û–†–¢–£–ù–ò - –û–ù–û–í–õ–ï–ù–û</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #22c55e;
            --primary-glow: rgba(34, 197, 94, 0.5);
            --accent: #f97316;
            --accent-glow: rgba(249, 115, 22, 0.5);
            --bg: #020305;
            --card-bg: rgba(10, 15, 25, 0.9);
            --glass-border: rgba(34, 197, 94, 0.3);
            --text-gray: #94a3b8;
            --danger: #ef4444;
            --currency: #fbbf24;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg);
            background-image: 
                radial-gradient(circle at 50% -20%, var(--primary-glow) 0%, transparent 50%),
                radial-gradient(circle at 0% 100%, rgba(14, 165, 233, 0.1) 0%, transparent 40%);
            color: white; 
            font-family: 'Inter', sans-serif;
            min-height: 100vh; 
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 70px;
            user-select: none;
            -webkit-user-select: none;
        }

        input, textarea, select {
            user-select: text !important;
            -webkit-user-select: text !important;
            cursor: text;
        }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #05070a; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse { 
            0%, 100% { transform: scale(1); box-shadow: 0 0 40px var(--accent-glow); }
            50% { transform: scale(1.02); box-shadow: 0 0 60px var(--accent-glow); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px var(--primary-glow); }
            50% { box-shadow: 0 0 40px var(--primary-glow), 0 0 60px var(--primary-glow); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .neon-text {
            text-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow);
            letter-spacing: 3px; 
            text-transform: uppercase;
        }

        /* HEADER */
        header {
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 12px 4%; 
            background: rgba(2, 3, 5, 0.95);
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid var(--glass-border);
            position: sticky; 
            top: 0; 
            z-index: 1000;
            flex-wrap: wrap; 
            gap: 10px;
        }

        .header-back {
            color: var(--text-gray); 
            text-decoration: none; 
            font-weight: 900; 
            font-size: 11px; 
            text-transform: uppercase;
            padding: 8px 12px;
            border-radius: 8px;
            transition: 0.3s;
        }
        .header-back:hover { background: rgba(255,255,255,0.05); }

        .header-stats {
            display: flex; 
            gap: 8px; 
            align-items: center; 
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex; 
            align-items: center; 
            gap: 6px;
            background: rgba(255, 255, 255, 0.05); 
            border: 1px solid var(--glass-border);
            padding: 8px 14px; 
            border-radius: 12px; 
            font-weight: 800; 
            font-size: 13px;
            transition: 0.3s;
            white-space: nowrap;
        }

        .stat-item.currency-stat { border-color: var(--currency); }
        .stat-item.exchange-btn {
            cursor: pointer; 
            background: linear-gradient(135deg, #fbbf24, #d97706); 
            border: none; 
            color: black;
        }
        .stat-item.exchange-btn:hover { transform: scale(1.05); }

        /* MAIN LAYOUT */
        .main-container {
            display: grid; 
            grid-template-columns: 260px 1fr; 
            gap: 25px;
            max-width: 1500px; 
            margin: 20px auto; 
            padding: 0 4%;
        }

        .sidebar {
            background: var(--card-bg); 
            border: 1px solid var(--glass-border);
            border-radius: 20px; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 10px;
            height: fit-content; 
            position: sticky; 
            top: 100px;
        }

        .menu-btn {
            padding: 14px 16px; 
            border-radius: 12px; 
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.03); 
            color: white; 
            text-align: left;
            font-weight: 700; 
            cursor: pointer; 
            transition: 0.3s; 
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .menu-btn:hover, .menu-btn.active {
            background: rgba(34, 197, 94, 0.15); 
            border-color: var(--primary); 
            color: var(--primary); 
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.2);
        }
        .menu-btn.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        /* STATUS BAR */
        .status-bar {
            position: fixed; 
            bottom: 0; 
            left: 0; 
            width: 100%;
            height: 50px; 
            background: rgba(10, 15, 25, 0.95);
            backdrop-filter: blur(15px); 
            border-top: 1px solid var(--glass-border);
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            padding: 0 20px; 
            z-index: 2000; 
            font-size: 10px; 
            font-weight: 800;
            color: var(--text-gray); 
            letter-spacing: 1px;
        }

        .status-indicator {
            display: flex; 
            align-items: center; 
            gap: 8px;
        }
        .status-dot {
            width: 8px; 
            height: 8px; 
            border-radius: 50%; 
            background: var(--primary); 
            box-shadow: 0 0 10px var(--primary);
            animation: pulse 2s infinite;
        }
        .status-dot.spinning { background: var(--accent); box-shadow: 0 0 10px var(--accent); }

        .content-section { display: none; animation: fadeIn 0.4s ease; }
        .content-section.active { display: block; }

        /* PROMO BANNER */
        #promoBanner {
            display: none;
            background: linear-gradient(135deg, #f97316, #ea580c);
            padding: 20px; 
            border-radius: 20px; 
            margin-bottom: 25px;
            text-align: center; 
            border: 2px solid var(--accent);
            box-shadow: 0 0 40px var(--accent-glow);
            animation: pulse 2s infinite;
            position: relative;
            overflow: hidden;
        }
        #promoBanner::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shine 3s infinite;
        }
        @keyframes shine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .promo-badge {
            display: inline-block;
            background: rgba(0,0,0,0.3);
            padding: 6px 16px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 900;
            margin-bottom: 10px;
            animation: shake 0.5s infinite;
        }

        .promo-title {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .promo-prices {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .promo-old-price {
            font-size: 18px;
            color: rgba(255,255,255,0.5);
            text-decoration: line-through;
        }

        .promo-new-price {
            font-size: 32px;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .promo-percent {
            margin-top: 12px;
            background: rgba(0,0,0,0.4);
            display: inline-block;
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 900;
        }

        /* ROULETTE */
        .roulette-container {
            background: linear-gradient(180deg, #0a0f18 0%, #05080f 100%);
            border: 1px solid var(--glass-border);
            border-radius: 30px; 
            padding: 40px 20px; 
            text-align: center; 
            position: relative;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 100px rgba(34, 197, 94, 0.03);
            overflow: hidden;
            margin-bottom: 25px;
        }

        .roulette-title {
            font-size: clamp(18px, 5vw, 28px);
            margin-bottom: 30px;
        }

        .carousel-outer {
            position: relative; 
            height: 220px; 
            margin: 30px 0; 
            overflow: hidden;
            background: rgba(0, 0, 0, 0.3); 
            border-radius: 20px;
            mask-image: linear-gradient(to right, transparent 0%, black 15%, black 85%, transparent 100%);
            border: 1px solid rgba(255,255,255, 0.05);
        }
        
        .pointer {
            position: absolute; 
            top: 0; 
            left: 50%; 
            transform: translateX(-50%);
            width: 4px; 
            height: 100%; 
            background: linear-gradient(180deg, var(--accent), transparent);
            z-index: 100;
            box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent);
        }
        .pointer::before {
            content: '‚ñº';
            position: absolute;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
        }

        .track {
            display: flex; 
            position: absolute; 
            left: 0; 
            top: 50%;
            transform: translateY(-50%);
            will-change: transform;
        }
        
        .prize-card {
            width: 180px; 
            height: 180px; 
            margin: 0 8px;
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border: 1px solid rgba(255,255,255, 0.08);
            border-radius: 16px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            justify-content: center; 
            padding: 15px; 
            flex-shrink: 0;
            transition: 0.3s;
        }
        .prize-card img { 
            width: 90px; 
            height: 90px; 
            object-fit: contain;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.1));
        }
        .prize-card span { 
            font-size: 11px; 
            font-weight: 800; 
            margin-top: 10px; 
            color: var(--text-gray);
            text-align: center;
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* WIN OVERLAY */
        #winOverlay {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0,0,0,0.85); 
            z-index: 50;
            display: none; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center;
            backdrop-filter: blur(5px); 
            animation: fadeIn 0.5s;
        }

        .win-title {
            font-size: 36px;
            font-weight: 900;
            color: var(--accent);
            text-shadow: 0 0 30px var(--accent);
            margin-bottom: 15px;
            animation: pulse 1s infinite;
        }

        .win-prize-name {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 25px;
        }

        /* EXCHANGE CHOICE (–Ω–æ–≤–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª) */
        .exchange-choice {
            display: none;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
            width: 100%;
            max-width: 350px;
        }

        .exchange-choice-btn {
            padding: 16px 20px;
            border-radius: 14px;
            border: 2px solid transparent;
            font-weight: 800;
            font-size: 14px;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .exchange-choice-btn.points-btn {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1));
            border-color: var(--primary);
            color: var(--primary);
        }
        .exchange-choice-btn.points-btn:hover {
            background: var(--primary);
            color: black;
        }

        .exchange-choice-btn.currency-btn {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.1));
            border-color: var(--currency);
            color: var(--currency);
        }
        .exchange-choice-btn.currency-btn:hover {
            background: var(--currency);
            color: black;
        }

        .exchange-choice-btn.keep-btn {
            background: rgba(255,255,255,0.05);
            border-color: var(--text-gray);
            color: var(--text-gray);
        }
        .exchange-choice-btn.keep-btn:hover {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        /* SPIN ACTIONS */
        .spin-actions {
            display: flex; 
            justify-content: center; 
            align-items: stretch;
            gap: 15px; 
            max-width: 600px; 
            margin: 25px auto 0;
            padding: 0 10px;
        }

        .btn-main {
            flex: 1; 
            padding: 16px 20px; 
            border-radius: 14px; 
            border: none; 
            font-weight: 900;
            cursor: pointer; 
            text-transform: uppercase; 
            font-size: 13px; 
            transition: 0.3s;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            gap: 4px;
            max-width: 280px; 
            width: 100%; 
            position: relative; 
            overflow: hidden;
        }
        .btn-main:hover:not(:disabled) { transform: translateY(-2px); }
        .btn-main:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(0.5); }
        
        .btn-buy { 
            background: linear-gradient(135deg, #f97316, #ea580c); 
            color: white; 
            box-shadow: 0 0 25px rgba(249, 115, 22, 0.4);
        }
        .btn-spin { 
            background: linear-gradient(135deg, #1e293b, #0f172a); 
            color: #94a3b8; 
            border: 1px solid #334155;
        }
        .btn-spin:not(:disabled) {
            background: linear-gradient(135deg, var(--primary), #16a34a);
            color: white;
            box-shadow: 0 0 25px var(--primary-glow);
        }

        .btn-label { font-size: 14px; }
        .btn-sub { font-size: 10px; opacity: 0.8; }

        /* ADMIN STYLES */
        .admin-box { 
            background: var(--card-bg); 
            border: 1px solid var(--glass-border); 
            border-radius: 24px; 
            padding: 25px;
        }

        .admin-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 25px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .admin-tab-btn {
            padding: 12px 18px;
            border-radius: 10px;
            border: 1px solid transparent;
            background: rgba(255,255,255,0.03);
            color: var(--text-gray);
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            transition: 0.3s;
            white-space: nowrap;
        }
        .admin-tab-btn:hover, .admin-tab-btn.active {
            background: rgba(34, 197, 94, 0.15);
            border-color: var(--primary);
            color: var(--primary);
        }

        .input, .select, .textarea { 
            width: 100%; 
            background: rgba(0,0,0,0.5); 
            border: 1px solid rgba(255,255,255,0.1); 
            color: white; 
            padding: 14px 16px; 
            border-radius: 10px; 
            outline: none; 
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: 0.3s;
        }
        .input:focus, .select:focus, .textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.2);
        }

        .form-group {
            margin-bottom: 18px;
        }
        .form-label {
            display: block;
            font-size: 11px;
            color: var(--text-gray);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .info-box {
            background: rgba(34, 197, 94, 0.05);
            border: 1px solid var(--glass-border);
            padding: 15px;
            border-radius: 12px;
            font-size: 12px;
            color: var(--text-gray);
            margin-top: 15px;
        }

        /* TOGGLE SWITCH */
        .toggle-container { 
            display: flex; 
            align-items: center; 
            justify-content: space-between;
            gap: 15px; 
            background: rgba(255, 255, 255, 0.03); 
            padding: 15px 18px; 
            border-radius: 12px;
            margin-bottom: 18px;
        }
        
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { 
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; 
            background-color: #333; transition: .4s; border-radius: 26px; 
        }
        .slider:before { 
            position: absolute; content: ""; height: 20px; width: 20px; left: 3px; 
            bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; 
        }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(24px); }

        /* BALANCE CARDS */
        .balance-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .balance-card {
            padding: 20px;
            border-radius: 16px;
            text-align: center;
        }
        .balance-card.points {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15), rgba(34, 197, 94, 0.05));
            border: 1px solid var(--primary);
        }
        .balance-card.currency {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(251, 191, 36, 0.05));
            border: 1px solid var(--currency);
        }
        .balance-card-label {
            font-size: 10px;
            color: var(--text-gray);
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .balance-card-value {
            font-size: 26px;
            font-weight: 900;
        }
        .balance-card.points .balance-card-value { color: var(--primary); }
        .balance-card.currency .balance-card-value { color: var(--currency); }

        /* SHOP */
        .shop-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 18px; 
        }

        .shop-card { 
            background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255, 255, 0.06);
            border-radius: 18px; 
            padding: 22px; 
            text-align: center; 
            transition: 0.3s;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            position: relative;
            overflow: hidden;
        }
        .shop-card:hover { 
            transform: translateY(-5px); 
            border-color: var(--primary);
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .shop-card img { 
            width: 100px; 
            height: 100px; 
            object-fit: contain; 
            margin-bottom: 12px;
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.3));
        }
        .shop-card-name {
            font-size: 13px;
            font-weight: 800;
            margin-bottom: 10px;
            color: white;
        }
        .shop-card-price { 
            font-size: 20px; 
            font-weight: 900; 
            color: var(--primary); 
            margin-bottom: 12px; 
        }
        .shop-card-price.on-sale {
            color: var(--accent);
        }
        .shop-card-original {
            font-size: 13px;
            color: var(--text-gray);
            text-decoration: line-through;
            margin-bottom: 5px;
        }
        .shop-card .sale-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--accent);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 900;
        }

        /* PRIZE MANAGEMENT */
        .manage-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 10px;
            margin-bottom: 25px;
        }

        .manage-card {
            background: rgba(255,255,255,0.03);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
            transition: 0.3s;
        }
        .manage-card:hover {
            border-color: var(--primary);
        }
        .manage-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        .manage-card-name {
            font-size: 10px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .manage-card-info {
            font-size: 9px;
            color: var(--primary);
            margin-bottom: 8px;
        }
        .manage-card-actions {
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        .manage-btn {
            padding: 5px 10px;
            border-radius: 6px;
            border: none;
            font-size: 10px;
            cursor: pointer;
            transition: 0.3s;
        }
        .manage-btn.edit { background: #334155; color: white; }
        .manage-btn.delete { background: #7f1d1d; color: white; }

        /* MODALS */
        .modal { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.95); 
            z-index: 5000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-inner { 
            background: linear-gradient(180deg, #0a0e14, #050810);
            border: 1px solid var(--glass-border); 
            border-radius: 24px; 
            padding: 30px; 
            width: 100%; 
            max-width: 450px; 
            text-align: center; 
            max-height: 90vh; 
            overflow-y: auto; 
            animation: fadeIn 0.3s;
            margin: auto;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .modal-btns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .processing-overlay {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: rgba(0, 0, 0, 0.95); 
            z-index: 10000;
            display: none; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
        }

        .spinner {
            width: 50px; 
            height: 50px; 
            border: 4px solid rgba(34, 197, 94, 0.1);
            border-top-color: var(--primary); 
            border-radius: 50%;
            animation: spin 1s linear infinite; 
            margin-bottom: 20px;
        }

        /* TOAST NOTIFICATIONS */
        #toastContainer { 
            position: fixed; 
            bottom: 70px; 
            right: 20px; 
            z-index: 9999; 
            display: flex; 
            flex-direction: column; 
            gap: 10px;
            max-width: calc(100% - 40px);
        }
        
        .toast { 
            background: rgba(10, 15, 25, 0.95);
            border-left: 4px solid var(--primary); 
            color: white; 
            padding: 14px 20px; 
            border-radius: 10px; 
            font-weight: 700;
            font-size: 13px;
            box-shadow: 0 10px 40px rgba(0,0,0, 0.5); 
            animation: slideDown 0.3s ease-out;
            backdrop-filter: blur(10px);
        }
        .toast.error { border-left-color: var(--danger); }
        .toast.warning { border-left-color: var(--currency); }

        /* SPIN LOCK */
        #spinLockOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 4000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(3px);
        }

        .spin-lock-message {
            background: var(--card-bg);
            border: 2px solid var(--accent);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 350px;
            animation: pulse 2s infinite;
        }

        /* PRIZE PREVIEW */
        .prize-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .prize-preview-card {
            background: rgba(255,255,255,0.02);
            padding: 15px;
            border-radius: 14px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.05);
        }
        .prize-preview-card img {
            width: 50px;
            height: 50px;
            object-fit: contain;
            margin-bottom: 8px;
        }
        .prize-preview-card span {
            font-size: 10px;
            font-weight: 800;
            color: var(--text-gray);
        }

        /* LOGS */
        .logs-container {
            background: #000;
            border: 2px solid #222;
            border-radius: 12px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #00ff41;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px dashed #222;
        }
        .log-time { color: #666; }
        .log-user { color: #00bfff; }
        .log-action { color: #fff; }
        .log-desc { color: #aaa; }

        /* RESPONSIVE */
        @media (max-width: 1024px) {
            .main-container { 
                grid-template-columns: 1fr; 
                padding: 0 3%;
            }
            .sidebar { 
                position: relative; 
                top: 0; 
                flex-direction: row; 
                overflow-x: auto; 
                padding: 10px;
                gap: 8px;
            }
            .menu-btn { 
                white-space: nowrap; 
                padding: 10px 16px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            header { 
                padding: 10px 3%;
                gap: 8px;
            }
            .header-stats {
                width: 100%;
                justify-content: center;
            }
            .stat-item {
                padding: 6px 10px;
                font-size: 11px;
            }

            .roulette-container {
                padding: 25px 15px;
                border-radius: 20px;
            }
            .roulette-title {
                font-size: 16px;
                letter-spacing: 2px;
            }

            .carousel-outer { 
                height: 160px;
                margin: 20px 0;
            }
            .prize-card { 
                width: 130px; 
                height: 130px;
                margin: 0 6px;
                padding: 10px;
            }
            .prize-card img { 
                width: 60px; 
                height: 60px; 
            }
            .prize-card span {
                font-size: 9px;
            }

            .spin-actions { 
                flex-direction: column; 
                gap: 10px;
                padding: 0;
            }
            .btn-main { 
                max-width: 100%;
                padding: 14px;
            }

            .admin-box {
                padding: 18px;
            }
            .admin-tabs {
                gap: 6px;
            }
            .admin-tab-btn {
                padding: 10px 14px;
                font-size: 11px;
            }

            .balance-cards {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .shop-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            .shop-card {
                padding: 15px;
            }
            .shop-card img {
                width: 70px;
                height: 70px;
            }

            .modal-inner {
                padding: 20px;
                border-radius: 18px;
            }

            .win-title { font-size: 28px; }
            .win-prize-name { font-size: 18px; }

            .exchange-choice-btn {
                padding: 14px;
                font-size: 12px;
            }

            .promo-new-price { font-size: 26px; }
            .promo-old-price { font-size: 14px; }
        }

        @media (max-width: 400px) {
            .carousel-outer { height: 140px; }
            .prize-card { 
                width: 110px; 
                height: 110px;
                margin: 0 5px;
            }
            .prize-card img { 
                width: 50px; 
                height: 50px; 
            }

            .shop-grid {
                grid-template-columns: 1fr;
            }

            .header-back {
                font-size: 10px;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>

<div id="toastContainer"></div>

<!-- PROCESSING OVERLAY -->
<div id="processingModal" class="processing-overlay">
    <div style="text-align: center; padding: 30px; background: var(--card-bg); border: 1px solid var(--glass-border); border-radius: 20px; max-width: 350px; margin: 20px;">
        <div class="spinner"></div>
        <h3 id="procTitle" style="color: var(--primary); margin-bottom: 10px;">–û–ë–†–û–ë–ö–ê</h3>
        <p id="procText" style="color: var(--text-gray); font-size: 13px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
    </div>
</div>

<!-- SPIN LOCK OVERLAY -->
<div id="spinLockOverlay">
    <div class="spin-lock-message">
        <div style="font-size: 40px; margin-bottom: 15px;">üé∞</div>
        <h3 style="color: var(--accent); margin-bottom: 10px;">–†–£–õ–ï–¢–ö–ê –ö–†–£–¢–ò–¢–¨–°–Ø</h3>
        <p style="color: var(--text-gray); font-size: 12px;">–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è...</p>
        <div class="spinner" style="margin: 20px auto 0;"></div>
    </div>
</div>

<!-- HEADER -->
<header>
    <a href="cabinet.html" class="header-back" id="backLink">‚Üê –ù–ê–ó–ê–î</a>
    <div class="header-stats">
        <div class="stat-item">‚ö™ <span id="pointsVal">0</span></div>
        <div class="stat-item currency-stat">üí∏ <span id="currencyVal">0</span> ‚Ç¥</div>
        <button class="stat-item exchange-btn" onclick="openExchangeModal()">üí± –û–ë–ú–Ü–ù</button>
    </div>
</header>

<!-- MAIN CONTAINER -->
<div class="main-container">
    <aside class="sidebar" id="sidebar">
        <button id="nav-roulette" class="menu-btn active" onclick="showPage('roulette', this)">
            üé∞ <span>–†–£–õ–ï–¢–ö–ê</span>
        </button>
        <button id="nav-shop" class="menu-btn" onclick="showPage('shop', this)">
            üõí <span>–ú–ê–ì–ê–ó–ò–ù</span>
        </button>
        <button id="adminBtn" class="menu-btn" style="display: none;" onclick="showPage('admin', this)">
            ‚öôÔ∏è <span>–ö–û–ù–°–û–õ–¨</span>
        </button>
    </aside>

    <main class="content-wrapper">
        <!-- ==================== ROULETTE PAGE ==================== -->
        <section id="roulettePage" class="content-section active">
            <!-- PROMO BANNER -->
            <div id="promoBanner">
                <div class="promo-badge">üî• –ê–ö–¶–Ü–Ø üî•</div>
                <div class="promo-title" id="promoBannerText">–°–í–Ø–¢–ö–û–í–ê –ó–ù–ò–ñ–ö–ê!</div>
                <div class="promo-prices">
                    <span class="promo-old-price"><span id="promoOldPrice">100</span> ‚ö™</span>
                    <span class="promo-new-price"><span id="promoNewPrice">80</span> ‚ö™</span>
                </div>
                <div class="promo-percent" id="promoPercentLabel">-20% –ó–ù–ò–ñ–ö–ê</div>
            </div>

            <!-- ROULETTE CONTAINER -->
            <div class="roulette-container">
                <h1 class="roulette-title neon-text">–ö–û–õ–ï–°–û –§–û–†–¢–£–ù–ò</h1>
                
                <div class="carousel-outer">
                    <div class="pointer"></div>
                    
                    <!-- WIN OVERLAY -->
                    <div id="winOverlay">
                        <div class="win-title">üéâ –í–ò–ì–†–ê–® üéâ</div>
                        <div class="win-prize-name" id="winPrizeName">–ü–†–ò–ó</div>
                        
                        <!-- EXCHANGE CHOICE (–¥–ª—è action: exchange) -->
                        <div class="exchange-choice" id="exchangeChoice">
                            <button class="exchange-choice-btn points-btn" id="sellPointsBtn" onclick="selectExchangeOption('points')">
                                ‚ö™ –ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ <span id="sellPointsValue">0</span> –±–∞–ª—ñ–≤
                            </button>
                            <button class="exchange-choice-btn currency-btn" id="sellCurrencyBtn" onclick="selectExchangeOption('currency')">
                                üí∏ –ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ <span id="sellCurrencyValue">0</span> ‚Ç¥
                            </button>
                            <button class="exchange-choice-btn keep-btn" onclick="selectExchangeOption('keep')">
                                üì¶ –ó–∞–ª–∏—à–∏—Ç–∏ —Å–æ–±—ñ
                            </button>
                        </div>
                    </div>
                    
                    <div id="track" class="track">–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø...</div>
                </div>

                <div class="spin-actions">
                    <button class="btn-main btn-buy" onclick="openPurchaseModal()">
                        <span class="btn-label">–ö–£–ü–ò–¢–ò –ö–í–ò–¢–û–ö</span>
                        <span class="btn-sub" id="ticketPriceLabel">–í–ê–†–¢–Ü–°–¢–¨: 100 ‚ö™</span>
                    </button>
                    <button class="btn-main btn-spin" id="spinBtn" onclick="startSpin()">
                        <span class="btn-label">–ö–†–£–¢–ò–¢–ò –ö–û–õ–ï–°–û</span>
                        <span class="btn-sub">–ö–í–ò–¢–ö–Ü–í: <b id="ticketsVal">0</b></span>
                    </button>
                </div>
            </div>

            <h3 style="text-transform: uppercase; letter-spacing: 2px; color: var(--primary); font-size: 11px; margin-bottom: 15px;">
                –ü–†–ò–ó–ò –í –¶–Ü–ô –†–£–õ–ï–¢–¶–Ü
            </h3>
            <div id="prizePreview" class="prize-preview-grid"></div>
        </section>

        <!-- ==================== SHOP PAGE ==================== -->
        <section id="shopPage" class="content-section">
            <!-- SHOP PROMO BANNER -->
            <div id="shopPromoBanner" style="display: none; background: linear-gradient(135deg, #22c55e, #16a34a); padding: 20px; border-radius: 20px; margin-bottom: 25px; text-align: center; border: 2px solid var(--primary); animation: glow 2s infinite;">
                <div class="promo-badge" style="animation: none;">üíé –†–û–ó–ü–†–û–î–ê–ñ üíé</div>
                <div class="promo-title" id="shopPromoBannerText">–ó–ù–ò–ñ–ö–ò –í –ú–ê–ì–ê–ó–ò–ù–Ü!</div>
                <div class="promo-percent" id="shopPromoPercentLabel" style="background: rgba(0,0,0,0.3);">-20% –ù–ê –í–°–ï</div>
            </div>

            <h1 class="neon-text" style="font-size: 24px; margin-bottom: 25px;">üõí –ú–ê–ì–ê–ó–ò–ù</h1>
            <div id="shopGrid" class="shop-grid"></div>
        </section>

        <!-- ==================== ADMIN PAGE ==================== -->
        <section id="adminPage" class="content-section">
            <div class="admin-box">
                <div class="admin-tabs">
                    <button class="admin-tab-btn active" onclick="switchAdminTab('price', this)">üí∞ –¶–Ü–ù–ê</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('promo', this)">üî• –ê–ö–¶–Ü–á</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('shopPromo', this)">üõí –ê–ö–¶–Ü–á –ú–ê–ì–ê–ó–ò–ù–£</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('balance', this)">üíé –ë–ê–õ–ê–ù–°</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('prizes', this)">üé∞ –°–õ–û–¢–ò</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('discord', this)">üì¢ DISCORD</button>
                    <button class="admin-tab-btn" onclick="switchAdminTab('logs', this)">üìä –õ–û–ì–ò</button>
                </div>

                <!-- TAB: TICKET PRICE -->
                <div id="tabPrice" class="admin-tab">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üí∞ –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –¶–Ü–ù–ò –ö–í–ò–¢–ö–ê</h3>
                    
                    <div class="form-group">
                        <label class="form-label">–ë–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞ –∫–≤–∏—Ç–∫–∞ (–≤ –±–∞–ª–∞—Ö)</label>
                        <input type="number" id="ticketPriceInput" class="input" placeholder="100" min="1" value="100">
                    </div>
                    
                    <button onclick="saveTicketPrice()" class="btn-main btn-buy" style="width: 100%;">
                        üíæ –ó–ë–ï–†–ï–ì–¢–ò –¶–Ü–ù–£
                    </button>
                    
                    <div class="info-box">
                        ‚ÑπÔ∏è –ü–æ—Ç–æ—á–Ω–∞ –±–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞: <span id="currentTicketPrice" style="color: var(--primary); font-weight: 900;">100</span> ‚ö™
                    </div>
                </div>

                <!-- TAB: ROULETTE PROMOTIONS -->
                <div id="tabPromo" class="admin-tab" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üî• –ê–ö–¶–Ü–Ø –†–£–õ–ï–¢–ö–ò</h3>
                    
                    <div class="toggle-container">
                        <span style="font-weight: 700;">–ê–∫—Ü—ñ—è –∞–∫—Ç–∏–≤–Ω–∞</span>
                        <label class="switch">
                            <input type="checkbox" id="promoActiveToggle" onchange="togglePromo()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–Ω–∏–∂–∫–∞ / –ù–∞—Ü—ñ–Ω–∫–∞ (%)</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="promoSlider" min="-50" max="50" value="0" step="5"
                                   style="flex: 1; height: 8px; accent-color: var(--primary);" oninput="updatePromoPreview()">
                            <div id="promoValueDisplay" style="min-width: 70px; font-weight: 900; font-size: 18px; color: var(--primary); text-align: right;">
                                0%
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 10px; color: var(--text-gray); margin-bottom: 10px; text-transform: uppercase;">
                            –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥
                        </div>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                            <span id="originalPrice" style="font-size: 16px; color: #666; text-decoration: line-through;">100 ‚ö™</span>
                            <span style="font-size: 24px; color: var(--accent);">‚Üí</span>
                            <span id="newPrice" style="font-size: 24px; color: var(--primary); font-weight: 900;">100 ‚ö™</span>
                        </div>
                        <div id="discountLabel" style="margin-top: 10px; font-size: 13px; font-weight: 800; color: var(--text-gray);">
                            –ë–ï–ó –ó–ú–Ü–ù
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–µ–∫—Å—Ç –∞–∫—Ü—ñ—ó</label>
                        <input type="text" id="promoTextInput" class="input" placeholder="–°–í–Ø–¢–ö–û–í–ê –ê–ö–¶–Ü–Ø! üéâ" maxlength="50">
                    </div>
                    
                    <button onclick="savePromoSettings()" class="btn-main btn-buy" style="width: 100%;">
                        üíæ –ó–ë–ï–†–ï–ì–¢–ò –ê–ö–¶–Ü–Æ
                    </button>
                    
                    <div class="toggle-container" style="margin-top: 25px;">
                        <div>
                            <span style="font-weight: 700; display: block;">üé≤ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —à–∞–Ω—Å–∏</span>
                            <span style="font-size: 11px; color: var(--text-gray);">–†—ñ–≤–Ω–æ–º—ñ—Ä–Ω–∏–π —Ä–æ–∑–ø–æ–¥—ñ–ª –¥–ª—è –≤—Å—ñ—Ö –ø—Ä–∏–∑—ñ–≤</span>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="autoOddsToggle" onchange="toggleAutoOdds()">
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <!-- TAB: SHOP PROMOTIONS -->
                <div id="tabShopPromo" class="admin-tab" style="display: none;">
                    <h3 style="color: var(--currency); margin-bottom: 20px;">üõí –ê–ö–¶–Ü–Ø –ú–ê–ì–ê–ó–ò–ù–£</h3>
                    
                    <div class="toggle-container">
                        <span style="font-weight: 700;">–ê–∫—Ü—ñ—è –º–∞–≥–∞–∑–∏–Ω—É –∞–∫—Ç–∏–≤–Ω–∞</span>
                        <label class="switch">
                            <input type="checkbox" id="shopPromoActiveToggle" onchange="toggleShopPromo()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ó–Ω–∏–∂–∫–∞ / –ù–∞—Ü—ñ–Ω–∫–∞ (%)</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="shopPromoSlider" min="-50" max="50" value="0" step="5"
                                   style="flex: 1; height: 8px; accent-color: var(--currency);" oninput="updateShopPromoPreview()">
                            <div id="shopPromoValueDisplay" style="min-width: 70px; font-weight: 900; font-size: 18px; color: var(--currency); text-align: right;">
                                0%
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,0,0,0.3); padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
                        <div style="font-size: 10px; color: var(--text-gray); margin-bottom: 10px; text-transform: uppercase;">
                            –ü—Ä–∏–∫–ª–∞–¥ —Ü—ñ–Ω–∏ —Ç–æ–≤–∞—Ä—É (100 –±–∞–ª—ñ–≤)
                        </div>
                        <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                            <span id="shopOriginalPrice" style="font-size: 16px; color: #666; text-decoration: line-through;">100 ‚ö™</span>
                            <span style="font-size: 24px; color: var(--accent);">‚Üí</span>
                            <span id="shopNewPrice" style="font-size: 24px; color: var(--currency); font-weight: 900;">100 ‚ö™</span>
                        </div>
                        <div id="shopDiscountLabel" style="margin-top: 10px; font-size: 13px; font-weight: 800; color: var(--text-gray);">
                            –ë–ï–ó –ó–ú–Ü–ù
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–µ–∫—Å—Ç –∞–∫—Ü—ñ—ó –º–∞–≥–∞–∑–∏–Ω—É</label>
                        <input type="text" id="shopPromoTextInput" class="input" placeholder="–†–û–ó–ü–†–û–î–ê–ñ! üíé" maxlength="50">
                    </div>
                    
                    <button onclick="saveShopPromoSettings()" class="btn-main" style="width: 100%; background: linear-gradient(135deg, var(--currency), #d97706); color: black;">
                        üíæ –ó–ë–ï–†–ï–ì–¢–ò –ê–ö–¶–Ü–Æ –ú–ê–ì–ê–ó–ò–ù–£
                    </button>
                </div>

                <!-- TAB: BALANCE -->
                <div id="tabBalance" class="admin-tab" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üíé –ü–û–ü–û–í–ù–ï–ù–ù–Ø –ë–ê–õ–ê–ù–°–£</h3>
                    
                    <div class="form-group">
                        <label class="form-label">–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
                        <select id="topUpUserSelect" class="select" onchange="updateTopUpBalances()">
                            <option value="">-- –û–±–µ—Ä—ñ—Ç—å –±—ñ–π—Ü—è --</option>
                        </select>
                    </div>
                    
                    <!-- BALANCE CARDS -->
                    <div id="currentBalances" class="balance-cards" style="display: none;">
                        <div class="balance-card points">
                            <div class="balance-card-label">–ë–ê–õ–ò</div>
                            <div class="balance-card-value"><span id="currentPoints">0</span> ‚ö™</div>
                        </div>
                        <div class="balance-card currency">
                            <div class="balance-card-label">–ì–†–û–®–Ü</div>
                            <div class="balance-card-value"><span id="currentCurrency">0</span> ‚Ç¥</div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø –±–∞–ª–∞–Ω—Å—É</label>
                        <select id="topUpType" class="select">
                            <option value="points">‚ö™ –ë–∞–ª–∏</option>
                            <option value="currency">üí∏ –ì—Ä–æ—à—ñ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°—É–º–∞</label>
                        <input type="number" id="topUpAmount" class="input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É" min="1">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ö–æ–º–µ–Ω—Ç–∞—Ä (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" id="topUpComment" class="input" placeholder="–ü—Ä–∏—á–∏–Ω–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è...">
                    </div>
                    
                    <button onclick="processTopUp()" class="btn-main btn-buy" style="width: 100%;">
                        üí∞ –ü–û–ü–û–í–ù–ò–¢–ò
                    </button>
                </div>

                <!-- TAB: PRIZES (SLOTS) -->
                <div id="tabPrizes" class="admin-tab" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üéÅ –£–ü–†–ê–í–õ–Ü–ù–ù–Ø –°–õ–û–¢–ê–ú–ò</h3>
                    
                    <div style="margin-bottom: 25px;">
                        <h4 style="color: var(--accent); margin-bottom: 12px; font-size: 12px;">üé∞ –°–õ–û–¢–ò –†–£–õ–ï–¢–ö–ò</h4>
                        <div id="manageRouletteGrid" class="manage-grid"></div>
                        
                        <h4 style="color: var(--currency); margin-bottom: 12px; margin-top: 20px; font-size: 12px;">üõí –°–õ–û–¢–ò –ú–ê–ì–ê–ó–ò–ù–£</h4>
                        <div id="manageShopGrid" class="manage-grid"></div>
                    </div>
                    
                    <div id="instructorNotice" style="display: none; background: rgba(251, 191, 36, 0.1); border: 1px solid var(--currency); padding: 18px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 14px; font-weight: 800; color: var(--currency); margin-bottom: 6px;">‚ö†Ô∏è –û–ë–ú–ï–ñ–ï–ù–ò–ô –î–û–°–¢–£–ü</div>
                        <p style="font-size: 11px; color: var(--text-gray); margin: 0;">
                            –Ü–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏ –º–æ–∂—É—Ç—å —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å–ª–æ—Ç–∏.
                        </p>
                    </div>
                    
                    <!-- PRIZE FORM -->
                    <div style="background: rgba(255,255,255,0.02); padding: 22px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.05);">
                        <h4 id="formTitle" style="color: var(--primary); margin-bottom: 18px; font-size: 14px;">‚ûï –°–¢–í–û–†–ò–¢–ò –ù–û–í–ò–ô –°–õ–û–¢</h4>
                        
                        <div class="form-group">
                            <label class="form-label">–ù–∞–∑–≤–∞ –ø—Ä–∏–∑—É</label>
                            <input type="text" id="newPrizeName" class="input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: iPhone 15">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                            <select id="newPrizeCategory" class="select" onchange="togglePrizeSettings()">
                                <option value="roulette">üé∞ –†—É–ª–µ—Ç–∫–∞</option>
                                <option value="shop">üõí –ú–∞–≥–∞–∑–∏–Ω</option>
                            </select>
                        </div>
                        
                        <div id="rouletteSettings">
                            <div class="form-group">
                                <label class="form-label">–®–∞–Ω—Å –≤–∏–ø–∞–¥–∞–Ω–Ω—è (%)</label>
                                <input type="number" id="newPrizeChance" class="input" value="10" min="0" max="100" step="0.1">
                            </div>
                        </div>
                        
                        <div id="shopSettings" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">–¶—ñ–Ω–∞ (–±–∞–ª–∏)</label>
                                <input type="number" id="newPrizePrice" class="input" value="100" min="1">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–¢–∏–ø –¥—ñ—ó –ø—Ä–∏ –≤–∏–≥—Ä–∞—à—ñ</label>
                            <select id="newPrizeActionType" class="select" onchange="toggleActionVal()">
                                <option value="item">üì¶ –ü—Ä–µ–¥–º–µ—Ç (–±–µ–∑ –¥—ñ–π)</option>
                                <option value="points">‚ö™ –ù–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –±–∞–ª–∏</option>
                                <option value="currency">üí∏ –ù–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –≥—Ä–æ—à—ñ</option>
                                <option value="ticket">üé´ –ù–∞—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫–≤–∏—Ç–∫–∏</option>
                                <option value="exchange">üí± –í–∏–±—ñ—Ä –æ–±–º—ñ–Ω—É (–±–∞–ª–∏/–≥—Ä–æ—à—ñ/–∑–∞–ª–∏—à–∏—Ç–∏)</option>
                            </select>
                        </div>
                        
                        <!-- ACTION VALUES -->
                        <div id="actionValContainer" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–ª—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è</label>
                                <input type="number" id="newPrizeActionVal" class="input" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫—ñ–ª—å–∫—ñ—Å—Ç—å" min="1">
                            </div>
                        </div>
                        
                        <!-- EXCHANGE VALUES -->
                        <div id="exchangeValContainer" style="display: none;">
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ –±–∞–ª–∏</label>
                                <input type="number" id="newPrizeExchangePoints" class="input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 500" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ü—Ä–æ–¥–∞—Ç–∏ –∑–∞ –≥—Ä–æ—à—ñ (‚Ç¥)</label>
                                <input type="number" id="newPrizeExchangeCurrency" class="input" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 50000" min="0">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø—Ä–∏–∑—É</label>
                            <input type="file" id="newPrizeImgFile" accept="image/*" onchange="previewSlotImage()" class="input" style="padding: 10px;">
                        </div>
                        
                        <div style="text-align: center; margin-bottom: 15px;">
                            <img id="slotImgPreview" style="max-width: 120px; max-height: 120px; border-radius: 12px; display: none; border: 2px solid var(--primary);">
                        </div>
                        
                        <div id="prizeFormActions" style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <button id="cancelEditBtn" onclick="resetPrizeForm()" class="btn-main" style="background: #333; color: white; display: none;">
                                ‚úï –°–ö–ê–°–£–í–ê–¢–ò
                            </button>
                            <button id="savePrizeBtn" onclick="savePrize()" class="btn-main btn-buy" style="grid-column: span 2;">
                                üíæ –ó–ë–ï–†–ï–ì–¢–ò
                            </button>
                        </div>
                    </div>
                </div>

                <!-- TAB: DISCORD -->
                <div id="tabDiscord" class="admin-tab" style="display: none;">
                    <h3 style="color: #5865F2; margin-bottom: 20px;">üì¢ DISCORD WEBHOOK</h3>
                    
                    <div class="toggle-container">
                        <span style="font-weight: 700;">–ù–∞–¥—Å–∏–ª–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ Discord</span>
                        <label class="switch">
                            <input type="checkbox" id="discordEnabledToggle">
                            <span class="slider" style="background-color: #5865F2;"></span>
                        </label>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Webhook URL</label>
                        <input type="text" id="discordWebhookUrl" class="input" placeholder="https://discord.com/api/webhooks/...">
                    </div>
                    
                    <div class="info-box" style="margin-bottom: 20px;">
                        <p style="margin: 0;">üìå <b>–°–ø–æ–≤—ñ—â–µ–Ω–Ω—è –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –ø—Ä–∏:</b></p>
                        <ul style="margin: 10px 0 0 20px; padding: 0;">
                            <li>–ê–∫—Ç–∏–≤–∞—Ü—ñ—ó/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –∞–∫—Ü—ñ–π</li>
                            <li>–í–∏–≥—Ä–∞—à—ñ –∑ —Ä—É–ª–µ—Ç–∫–∏</li>
                            <li>–í–∏–±–æ—Ä—ñ –æ–±–º—ñ–Ω—É –ø—Ä–∏–∑—É</li>
                        </ul>
                    </div>
                    
                    <button onclick="saveDiscordSettings()" class="btn-main" style="width: 100%; background: #5865F2; color: white;">
                        üíæ –ó–ë–ï–†–ï–ì–¢–ò –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø
                    </button>
                    
                    <button onclick="testDiscordWebhook()" class="btn-main" style="width: 100%; background: #333; color: white; margin-top: 10px;">
                        üîî –¢–ï–°–¢–û–í–ï –ü–û–í–Ü–î–û–ú–õ–ï–ù–ù–Ø
                    </button>
                </div>

                <!-- TAB: LOGS -->
                <div id="tabLogs" class="admin-tab" style="display: none;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üìä –ñ–£–†–ù–ê–õ –î–Ü–ô</h3>
                    <div id="logsList" class="logs-container">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª–æ–≥—ñ–≤...</div>
                </div>
            </div>
        </section>
    </main>
</div>

<!-- ==================== MODALS ==================== -->

<!-- EXCHANGE MODAL -->
<div id="exchangeModal" class="modal">
    <div class="modal-inner">
        <h2 class="modal-title">üí± –û–ë–ú–Ü–ù–ù–ò–ö</h2>
        
        <div class="balance-cards">
            <div class="balance-card points">
                <div class="balance-card-label">–ë–ê–õ–ò</div>
                <div class="balance-card-value"><span id="exPointsVal">0</span> ‚ö™</div>
            </div>
            <div class="balance-card currency">
                <div class="balance-card-label">–ì–†–û–®–Ü</div>
                <div class="balance-card-value"><span id="exCurrencyVal">0</span> ‚Ç¥</div>
            </div>
        </div>
        
        <div style="background: rgba(0,0,0,0.3); padding: 12px; border-radius: 10px; margin-bottom: 18px; text-align: center;">
            <div style="font-size: 10px; color: var(--text-gray); margin-bottom: 4px;">–ö–£–†–° –û–ë–ú–Ü–ù–£</div>
            <div style="font-size: 18px; font-weight: 900; color: var(--primary);">
                1 ‚ö™ = <span id="exchangeRate">500</span> ‚Ç¥
            </div>
        </div>
        
        <div class="form-group">
            <label class="form-label">–û–ø–µ—Ä–∞—Ü—ñ—è</label>
            <select id="exchangeOperation" class="select" onchange="updateExchangeUI()">
                <option value="exchange">üí± –û–±–º—ñ–Ω—è—Ç–∏ –±–∞–ª–∏ –Ω–∞ –≥—Ä–æ—à—ñ</option>
                <option value="withdrawMoney">üí∏ –í–∏–≤–µ—Å—Ç–∏ –≥—Ä–æ—à—ñ –∑ –±–∞–ª–∞–Ω—Å—É</option>
                <option value="withdrawPoints">‚ö™ –í–∏–≤–µ—Å—Ç–∏ –±–∞–ª–∏ –∑ –±–∞–ª–∞–Ω—Å—É</option>
            </select>
        </div>
        
        <div class="form-group">
            <label class="form-label">–°—É–º–∞</label>
            <input type="number" id="exchangeAmount" class="input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É" min="1" oninput="calculateExchange()">
        </div>
        
        <div id="exchangePreview" style="display: none; background: rgba(34, 197, 94, 0.05); padding: 15px; border-radius: 12px; margin-bottom: 18px; border: 1px solid var(--glass-border);">
            <div style="font-size: 11px; color: var(--text-gray); margin-bottom: 10px; text-align: center;">–†–ï–ó–£–õ–¨–¢–ê–¢:</div>
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <div style="text-align: center;">
                    <div style="font-size: 10px; color: var(--text-gray);">–°–ü–ò–°–ê–ù–û</div>
                    <div style="font-size: 18px; font-weight: 900; color: var(--danger);">
                        -<span id="previewFromAmount">0</span> <span id="previewFromCurrency">‚ö™</span>
                    </div>
                </div>
                <div id="previewArrow" style="font-size: 20px; color: var(--primary);">‚Üí</div>
                <div id="previewTo" style="text-align: center;">
                    <div style="font-size: 10px; color: var(--text-gray);">–û–¢–†–ò–ú–ê–ù–û</div>
                    <div style="font-size: 18px; font-weight: 900; color: var(--primary);">
                        +<span id="previewToAmount">0</span> <span id="previewToCurrency">‚Ç¥</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-btns">
            <button onclick="closeExchangeModal()" class="btn-main" style="background: #333; color: white;">
                ‚úï –°–ö–ê–°–£–í–ê–¢–ò
            </button>
            <button onclick="processExchange()" id="exchangeBtn" class="btn-main btn-buy">
                ‚úì –í–ò–ö–û–ù–ê–¢–ò
            </button>
        </div>
    </div>
</div>

<!-- PURCHASE MODAL -->
<div id="purchaseModal" class="modal">
    <div class="modal-inner">
        <h2 class="modal-title">üé´ –ö–£–ü–Ü–í–õ–Ø –ö–í–ò–¢–ö–Ü–í</h2>
        
        <div class="form-group">
            <label class="form-label">–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–≤–∏—Ç–∫—ñ–≤</label>
            <input type="number" id="ticketCount" class="input" value="1" min="1" oninput="updateTotalCost()">
        </div>
        
        <div style="font-size: 28px; font-weight: 900; color: var(--primary); margin: 20px 0;">
            –í–°–¨–û–ì–û: <span id="totalCostDisplay">100 ‚ö™</span>
        </div>
        
        <div class="modal-btns">
            <button onclick="document.getElementById('purchaseModal').style.display='none'" class="btn-main" style="background: #333; color: white;">
                ‚úï –°–ö–ê–°–£–í–ê–¢–ò
            </button>
            <button onclick="confirmPurchase()" class="btn-main btn-buy">
                ‚úì –ö–£–ü–ò–¢–ò
            </button>
        </div>
    </div>
</div>

<!-- STATUS BAR -->
<div class="status-bar">
    <div class="status-indicator">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">–°–ò–°–¢–ï–ú–ê –ê–ö–¢–ò–í–ù–ê</span>
    </div>
    <div id="footerPageLabel" style="color: white; background: rgba(34, 197, 94, 0.15); padding: 4px 12px; border-radius: 6px;">
        ROULETTE
    </div>
    <div id="footerRoleLabel" style="color: var(--primary);">USER</div>
</div>

<!-- ==================== JAVASCRIPT ==================== -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, addDoc, collection, onSnapshot, getDocs, deleteDoc, serverTimestamp, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
        authDomain: "dsv-gta.firebaseapp.com",
        projectId: "dsv-gta",
        storageBucket: "dsv-gta.firebasestorage.app",
        messagingSenderId: "661591588818",
        appId: "1:661591588818:web:a8e8dca3d061447e24d20b"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // === STATE ===
    let user = null;
    let userData = {};
    let currentUID = null;
    let prizePool = [];
    let isSpinning = false;
    let isSpinRequested = false;
    let currentWinPrize = null;
    let awaitingExchangeChoice = false;
    
    const CARD_WIDTH = 196; // 180 + 16 margin
    const TOTAL_CARDS = 100;
    const SPIN_TIME_SECONDS = 8;
    
    let currentPromotion = { isActive: false, percentage: 0, promoText: "" };
    let currentShopPromotion = { isActive: false, percentage: 0, promoText: "" };
    let discordSettings = { enabled: false, webhookUrl: "" };
    let allUsers = [];
    let isAutoOdds = false;
    let editingId = null;
    let currentSlotBase64 = null;
    let baseTicketPrice = 100;

    // === HELPER FUNCTIONS ===
    function notify(msg, type = 'success') {
        const toast = document.createElement('div');
        toast.className = 'toast ' + type;
        toast.innerText = msg;
        document.getElementById('toastContainer').appendChild(toast);
        setTimeout(() => toast.remove(), 3500);
    }

    function showProcessing(title, text) {
        document.getElementById('procTitle').innerText = title;
        document.getElementById('procText').innerText = text;
        document.getElementById('processingModal').style.display = 'flex';
    }

    function hideProcessing() {
        document.getElementById('processingModal').style.display = 'none';
    }

    // === DISCORD WEBHOOK ===
    async function sendDiscordNotification(title, description, color = 0x22c55e) {
        if (!discordSettings.enabled || !discordSettings.webhookUrl) return;
        
        try {
            await fetch(discordSettings.webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    embeds: [{
                        title: title,
                        description: description,
                        color: color,
                        timestamp: new Date().toISOString(),
                        footer: { text: '–î–®–í –†—É–ª–µ—Ç–∫–∞' }
                    }]
                })
            });
        } catch (e) {
            console.error('Discord webhook error:', e);
        }
    }

    async function loadDiscordSettings() {
        try {
            const snap = await getDoc(doc(db, "settings", "discord"));
            if (snap.exists()) {
                discordSettings = snap.data();
                document.getElementById('discordEnabledToggle').checked = discordSettings.enabled;
                document.getElementById('discordWebhookUrl').value = discordSettings.webhookUrl || '';
            }
        } catch (e) { console.error("Discord settings load error:", e); }
    }

    window.saveDiscordSettings = async function() {
        discordSettings = {
            enabled: document.getElementById('discordEnabledToggle').checked,
            webhookUrl: document.getElementById('discordWebhookUrl').value.trim()
        };
        
        try {
            await setDoc(doc(db, "settings", "discord"), discordSettings);
            notify('–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è Discord –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    window.testDiscordWebhook = async function() {
        await sendDiscordNotification(
            'üîî –¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è',
            'Webhook –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ!',
            0x5865F2
        );
        notify('–¢–µ—Å—Ç–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!');
    };

    // === TICKET PRICE SYSTEM ===
    async function loadTicketPrice() {
        try {
            const snap = await getDoc(doc(db, "settings", "ticketPrice"));
            if (snap.exists()) {
                baseTicketPrice = snap.data().basePrice || 100;
                document.getElementById('ticketPriceInput').value = baseTicketPrice;
                document.getElementById('currentTicketPrice').innerText = baseTicketPrice;
                updateBuyButtonPrice();
            }
        } catch (e) { console.error("Ticket price load error:", e); }
    }

    window.saveTicketPrice = async function() {
        const newPrice = parseInt(document.getElementById('ticketPriceInput').value);
        if (!newPrice || newPrice < 1) return notify('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Ü—ñ–Ω—É!', 'error');
        
        try {
            await setDoc(doc(db, "settings", "ticketPrice"), {
                basePrice: newPrice,
                updatedAt: serverTimestamp(),
                updatedBy: userData.name
            });
            
            baseTicketPrice = newPrice;
            document.getElementById('currentTicketPrice').innerText = newPrice;
            updateBuyButtonPrice();
            notify('–¶—ñ–Ω–∞ –∫–≤–∏—Ç–∫–∞ –æ–Ω–æ–≤–ª–µ–Ω–∞!');
            await addLog('UPDATE_TICKET_PRICE', `–¶—ñ–Ω–∞: ${newPrice} –±–∞–ª—ñ–≤`);
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    function updateBuyButtonPrice() {
        const finalPrice = calculatePromoPrice();
        document.getElementById('ticketPriceLabel').innerText = `–í–ê–†–¢–Ü–°–¢–¨: ${finalPrice} ‚ö™`;
    }

    // === ROULETTE PROMOTION SYSTEM ===
    async function loadPromoSettings() {
        try {
            const snap = await getDoc(doc(db, "settings", "promotion"));
            if (snap.exists()) {
                currentPromotion = snap.data();
                document.getElementById('promoActiveToggle').checked = currentPromotion.isActive;
                document.getElementById('promoSlider').value = currentPromotion.percentage || 0;
                document.getElementById('promoTextInput').value = currentPromotion.promoText || "";
                updatePromoPreview();
                updatePromoBanner();
            }
        } catch (e) { console.error("Promo load error:", e); }
    }

    window.updatePromoPreview = function() {
        const percentage = parseInt(document.getElementById('promoSlider').value);
        const newPrice = Math.round(baseTicketPrice * (1 + percentage / 100));
        
        document.getElementById('promoValueDisplay').innerText = (percentage > 0 ? '+' : '') + percentage + '%';
        document.getElementById('promoValueDisplay').style.color = percentage < 0 ? 'var(--primary)' : percentage > 0 ? 'var(--danger)' : 'var(--text-gray)';
        
        document.getElementById('originalPrice').innerText = baseTicketPrice + ' ‚ö™';
        document.getElementById('newPrice').innerText = newPrice + ' ‚ö™';
        
        const newPriceEl = document.getElementById('newPrice');
        const discountLabel = document.getElementById('discountLabel');
        
        if (percentage < 0) {
            newPriceEl.style.color = 'var(--primary)';
            discountLabel.innerHTML = `üí∞ –ó–ù–ò–ñ–ö–ê ${Math.abs(percentage)}%`;
            discountLabel.style.color = 'var(--primary)';
        } else if (percentage > 0) {
            newPriceEl.style.color = 'var(--danger)';
            discountLabel.innerHTML = `üìà –ù–ê–¶–Ü–ù–ö–ê +${percentage}%`;
            discountLabel.style.color = 'var(--danger)';
        } else {
            newPriceEl.style.color = 'var(--text-gray)';
            discountLabel.innerHTML = `–ë–ï–ó –ó–ú–Ü–ù`;
            discountLabel.style.color = 'var(--text-gray)';
        }
    };

    window.togglePromo = function() {
        const isActive = document.getElementById('promoActiveToggle').checked;
        notify(isActive ? '–ê–∫—Ü—ñ—è –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!' : '–ê–∫—Ü—ñ—è –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!');
    };

    window.savePromoSettings = async function() {
        const isActive = document.getElementById('promoActiveToggle').checked;
        const percentage = parseInt(document.getElementById('promoSlider').value);
        const promoText = document.getElementById('promoTextInput').value.trim();
        
        try {
            await setDoc(doc(db, "settings", "promotion"), {
                isActive, percentage, promoText,
                updatedAt: serverTimestamp(),
                updatedBy: userData.name
            });
            
            currentPromotion = { isActive, percentage, promoText };
            updatePromoBanner();
            notify('–ê–∫—Ü—ñ—è –∑–±–µ—Ä–µ–∂–µ–Ω–∞!');
            
            // Discord notification
            if (isActive) {
                await sendDiscordNotification(
                    'üî• –ê–ö–¶–Ü–Ø –ê–ö–¢–ò–í–û–í–ê–ù–ê',
                    `**${promoText || '–ê–∫—Ü—ñ—è'}**\n–ó–Ω–∏–∂–∫–∞/–Ω–∞—Ü—ñ–Ω–∫–∞: ${percentage}%`,
                    percentage < 0 ? 0x22c55e : 0xf97316
                );
            }
            
            await addLog('UPDATE_PROMOTION', `${isActive ? '–ê–ö–¢–ò–í–ù–ê' : '–ù–ï–ê–ö–¢–ò–í–ù–ê'}, ${percentage}%`);
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    function updatePromoBanner() {
        const banner = document.getElementById('promoBanner');
        
        if (currentPromotion.isActive && currentPromotion.percentage !== 0) {
            banner.style.display = 'block';
            const newPrice = calculatePromoPrice();
            const percentage = currentPromotion.percentage;
            
            document.getElementById('promoBannerText').innerText = currentPromotion.promoText || '–ê–ö–¶–Ü–Ø!';
            document.getElementById('promoOldPrice').innerText = baseTicketPrice;
            document.getElementById('promoNewPrice').innerText = newPrice;
            
            const label = document.getElementById('promoPercentLabel');
            if (percentage < 0) {
                label.innerText = `${Math.abs(percentage)}% –ó–ù–ò–ñ–ö–ê`;
                label.style.background = 'var(--primary)';
            } else {
                label.innerText = `+${percentage}% –ù–ê–¶–Ü–ù–ö–ê`;
                label.style.background = 'var(--danger)';
            }
        } else {
            banner.style.display = 'none';
        }
        
        updateBuyButtonPrice();
    }

    function calculatePromoPrice() {
        if (currentPromotion.isActive) {
            return Math.round(baseTicketPrice * (1 + currentPromotion.percentage / 100));
        }
        return baseTicketPrice;
    }

    // === SHOP PROMOTION SYSTEM ===
    async function loadShopPromoSettings() {
        try {
            const snap = await getDoc(doc(db, "settings", "shopPromotion"));
            if (snap.exists()) {
                currentShopPromotion = snap.data();
                document.getElementById('shopPromoActiveToggle').checked = currentShopPromotion.isActive;
                document.getElementById('shopPromoSlider').value = currentShopPromotion.percentage || 0;
                document.getElementById('shopPromoTextInput').value = currentShopPromotion.promoText || "";
                updateShopPromoPreview();
                updateShopPromoBanner();
            }
        } catch (e) { console.error("Shop promo load error:", e); }
    }

    window.updateShopPromoPreview = function() {
        const percentage = parseInt(document.getElementById('shopPromoSlider').value);
        const examplePrice = 100;
        const newPrice = Math.round(examplePrice * (1 + percentage / 100));
        
        document.getElementById('shopPromoValueDisplay').innerText = (percentage > 0 ? '+' : '') + percentage + '%';
        document.getElementById('shopPromoValueDisplay').style.color = percentage < 0 ? 'var(--currency)' : percentage > 0 ? 'var(--danger)' : 'var(--text-gray)';
        
        document.getElementById('shopOriginalPrice').innerText = examplePrice + ' ‚ö™';
        document.getElementById('shopNewPrice').innerText = newPrice + ' ‚ö™';
        
        const label = document.getElementById('shopDiscountLabel');
        if (percentage < 0) {
            label.innerHTML = `üí∞ –ó–ù–ò–ñ–ö–ê ${Math.abs(percentage)}%`;
            label.style.color = 'var(--currency)';
        } else if (percentage > 0) {
            label.innerHTML = `üìà –ù–ê–¶–Ü–ù–ö–ê +${percentage}%`;
            label.style.color = 'var(--danger)';
        } else {
            label.innerHTML = `–ë–ï–ó –ó–ú–Ü–ù`;
            label.style.color = 'var(--text-gray)';
        }
    };

    window.toggleShopPromo = function() {
        const isActive = document.getElementById('shopPromoActiveToggle').checked;
        notify(isActive ? '–ê–∫—Ü—ñ—è –º–∞–≥–∞–∑–∏–Ω—É –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!' : '–ê–∫—Ü—ñ—è –º–∞–≥–∞–∑–∏–Ω—É –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!');
    };

    window.saveShopPromoSettings = async function() {
        const isActive = document.getElementById('shopPromoActiveToggle').checked;
        const percentage = parseInt(document.getElementById('shopPromoSlider').value);
        const promoText = document.getElementById('shopPromoTextInput').value.trim();
        
        try {
            await setDoc(doc(db, "settings", "shopPromotion"), {
                isActive, percentage, promoText,
                updatedAt: serverTimestamp(),
                updatedBy: userData.name
            });
            
            currentShopPromotion = { isActive, percentage, promoText };
            updateShopPromoBanner();
            renderShop(prizePool.filter(p => p.category === 'shop'));
            notify('–ê–∫—Ü—ñ—è –º–∞–≥–∞–∑–∏–Ω—É –∑–±–µ—Ä–µ–∂–µ–Ω–∞!');
            
            if (isActive) {
                await sendDiscordNotification(
                    'üõí –ê–ö–¶–Ü–Ø –ú–ê–ì–ê–ó–ò–ù–£',
                    `**${promoText || '–†–æ–∑–ø—Ä–æ–¥–∞–∂'}**\n–ó–Ω–∏–∂–∫–∞/–Ω–∞—Ü—ñ–Ω–∫–∞: ${percentage}%`,
                    0xfbbf24
                );
            }
            
            await addLog('UPDATE_SHOP_PROMOTION', `${isActive ? '–ê–ö–¢–ò–í–ù–ê' : '–ù–ï–ê–ö–¢–ò–í–ù–ê'}, ${percentage}%`);
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    function updateShopPromoBanner() {
        const banner = document.getElementById('shopPromoBanner');
        
        if (currentShopPromotion.isActive && currentShopPromotion.percentage !== 0) {
            banner.style.display = 'block';
            document.getElementById('shopPromoBannerText').innerText = currentShopPromotion.promoText || '–†–û–ó–ü–†–û–î–ê–ñ!';
            
            const label = document.getElementById('shopPromoPercentLabel');
            const percentage = currentShopPromotion.percentage;
            if (percentage < 0) {
                label.innerText = `${Math.abs(percentage)}% –ó–ù–ò–ñ–ö–ê –ù–ê –í–°–ï`;
            } else {
                label.innerText = `+${percentage}% –ù–ê–¶–Ü–ù–ö–ê`;
            }
        } else {
            banner.style.display = 'none';
        }
    }

    function calculateShopPrice(originalPrice) {
        if (currentShopPromotion.isActive) {
            return Math.round(originalPrice * (1 + currentShopPromotion.percentage / 100));
        }
        return originalPrice;
    }

    // === BALANCE MANAGEMENT ===
    async function loadUsersForTopUp() {
        const snapshot = await getDocs(collection(db, "users"));
        allUsers = [];
        const select = document.getElementById('topUpUserSelect');
        select.innerHTML = '<option value="">-- –û–±–µ—Ä—ñ—Ç—å –±—ñ–π—Ü—è --</option>';
        
        snapshot.forEach(d => {
            const user = { id: d.id, ...d.data() };
            if (user.role === 'instructor' || user.role === 'admin') {
                allUsers.push(user);
                const option = document.createElement('option');
                option.value = d.id;
                option.innerText = `${user.name} (${user.rank || user.role})`;
                select.appendChild(option);
            }
        });
    }

    window.updateTopUpBalances = function() {
        const userId = document.getElementById('topUpUserSelect').value;
        const balancesDiv = document.getElementById('currentBalances');
        
        if (!userId) {
            balancesDiv.style.display = 'none';
            return;
        }
        
        const user = allUsers.find(u => u.id === userId);
        if (user) {
            balancesDiv.style.display = 'grid';
            document.getElementById('currentPoints').innerText = user.points || 0;
            document.getElementById('currentCurrency').innerText = user.currency || 0;
        }
    };

    window.processTopUp = async function() {
        const userId = document.getElementById('topUpUserSelect').value;
        const type = document.getElementById('topUpType').value;
        const amount = parseInt(document.getElementById('topUpAmount').value);
        const comment = document.getElementById('topUpComment').value.trim();
        
        if (!userId) return notify('–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞!', 'error');
        if (!amount || amount < 1) return notify('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É!', 'error');
        
        try {
            const userRef = doc(db, "users", userId);
            const userSnap = await getDoc(userRef);
            const currentValue = userSnap.data()[type] || 0;
            
            await updateDoc(userRef, { [type]: currentValue + amount });
            
            const userName = userSnap.data().name;
            const typeLabel = type === 'points' ? '–±–∞–ª—ñ–≤' : '–≥—Ä–∏–≤–µ–Ω—å';
            
            notify(`+${amount} ${typeLabel} –¥–ª—è ${userName}!`);
            await addLog('TOP_UP_BALANCE', `${userName}: +${amount} ${typeLabel}${comment ? ' (' + comment + ')' : ''}`);
            
            // Reset form
            document.getElementById('topUpUserSelect').value = '';
            document.getElementById('topUpAmount').value = '';
            document.getElementById('topUpComment').value = '';
            document.getElementById('currentBalances').style.display = 'none';
            
            await loadUsersForTopUp();
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    // === EXCHANGE SYSTEM ===
    window.openExchangeModal = function() {
        if (isSpinning || awaitingExchangeChoice) {
            notify('–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä—É–ª–µ—Ç–∫–∏!', 'warning');
            return;
        }
        document.getElementById('exchangeModal').style.display = 'flex';
        document.getElementById('exPointsVal').innerText = userData.points || 0;
        document.getElementById('exCurrencyVal').innerText = userData.currency || 0;
        document.getElementById('exchangeAmount').value = '';
        document.getElementById('exchangePreview').style.display = 'none';
        updateExchangeUI();
    };

    window.closeExchangeModal = function() {
        document.getElementById('exchangeModal').style.display = 'none';
    };

    window.updateExchangeUI = function() {
        const operation = document.getElementById('exchangeOperation').value;
        const btn = document.getElementById('exchangeBtn');
        const arrow = document.getElementById('previewArrow');
        const toDiv = document.getElementById('previewTo');
        
        switch(operation) {
            case 'exchange':
                btn.innerText = 'üí± –û–ë–ú–Ü–ù–Ø–¢–ò';
                break;
            case 'withdrawMoney':
                btn.innerText = 'üí∏ –í–ò–í–ï–°–¢–ò';
                break;
            case 'withdrawPoints':
                btn.innerText = '‚ö™ –í–ò–í–ï–°–¢–ò';
                break;
        }
        
        calculateExchange();
    };

    window.calculateExchange = function() {
        const operation = document.getElementById('exchangeOperation').value;
        const amount = parseInt(document.getElementById('exchangeAmount').value);
        const preview = document.getElementById('exchangePreview');
        
        if (!amount || amount < 1) {
            preview.style.display = 'none';
            return;
        }
        
        preview.style.display = 'block';
        const rate = 500;
        const toDiv = document.getElementById('previewTo');
        const arrow = document.getElementById('previewArrow');
        
        switch(operation) {
            case 'exchange':
                document.getElementById('previewFromAmount').innerText = amount;
                document.getElementById('previewFromCurrency').innerText = '‚ö™';
                document.getElementById('previewToAmount').innerText = amount * rate;
                document.getElementById('previewToCurrency').innerText = '‚Ç¥';
                toDiv.style.display = 'block';
                arrow.style.display = 'block';
                break;
            case 'withdrawMoney':
                document.getElementById('previewFromAmount').innerText = amount;
                document.getElementById('previewFromCurrency').innerText = '‚Ç¥';
                toDiv.style.display = 'none';
                arrow.style.display = 'none';
                break;
            case 'withdrawPoints':
                document.getElementById('previewFromAmount').innerText = amount;
                document.getElementById('previewFromCurrency').innerText = '‚ö™';
                toDiv.style.display = 'none';
                arrow.style.display = 'none';
                break;
        }
    };

    window.processExchange = async function() {
        const operation = document.getElementById('exchangeOperation').value;
        const amount = parseInt(document.getElementById('exchangeAmount').value);
        
        if (!amount || amount < 1) return notify('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É!', 'error');
        
        const userRef = doc(db, "users", currentUID);
        const rate = 500;
        
        try {
            switch(operation) {
                case 'exchange':
                    if (userData.points < amount) return notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤!', 'error');
                    await updateDoc(userRef, {
                        points: userData.points - amount,
                        currency: (userData.currency || 0) + (amount * rate)
                    });
                    notify(`–û–±–º—ñ–Ω—è–Ω–æ ${amount} ‚ö™ –Ω–∞ ${amount * rate} ‚Ç¥`);
                    await addLog('EXCHANGE', `${amount} –±–∞–ª—ñ–≤ ‚Üí ${amount * rate} –≥—Ä–∏–≤–µ–Ω—å`);
                    break;
                    
                case 'withdrawMoney':
                    if ((userData.currency || 0) < amount) return notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≥—Ä–æ—à–µ–π!', 'error');
                    await updateDoc(userRef, { currency: userData.currency - amount });
                    notify(`–í–∏–≤–µ–¥–µ–Ω–æ ${amount} ‚Ç¥`);
                    await addLog('WITHDRAW_MONEY', `${amount} –≥—Ä–∏–≤–µ–Ω—å`);
                    break;
                    
                case 'withdrawPoints':
                    if (userData.points < amount) return notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤!', 'error');
                    await updateDoc(userRef, { points: userData.points - amount });
                    notify(`–í–∏–≤–µ–¥–µ–Ω–æ ${amount} ‚ö™`);
                    await addLog('WITHDRAW_POINTS', `${amount} –±–∞–ª—ñ–≤`);
                    break;
            }
            
            closeExchangeModal();
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    // === SPIN LOCK SYSTEM ===
    function lockNavigation() {
        isSpinning = true;
        localStorage.setItem('rouletteSpinning', 'true');
        localStorage.setItem('rouletteSpinStart', Date.now().toString());
        
        document.getElementById('spinLockOverlay').style.display = 'flex';
        document.getElementById('statusDot').classList.add('spinning');
        document.getElementById('statusText').innerText = '–†–£–õ–ï–¢–ö–ê –ö–†–£–¢–ò–¢–¨–°–Ø...';
        
        document.querySelectorAll('.menu-btn, .header-back').forEach(el => {
            el.classList.add('locked');
        });
    }

    function unlockNavigation() {
        isSpinning = false;
        isSpinRequested = false;
        localStorage.removeItem('rouletteSpinning');
        localStorage.removeItem('rouletteSpinStart');
        localStorage.removeItem('roulettePrize');
        
        if (!awaitingExchangeChoice) {
            document.getElementById('spinLockOverlay').style.display = 'none';
        }
        
        document.getElementById('statusDot').classList.remove('spinning');
        document.getElementById('statusText').innerText = '–°–ò–°–¢–ï–ú–ê –ê–ö–¢–ò–í–ù–ê';
        
        document.querySelectorAll('.menu-btn, .header-back').forEach(el => {
            el.classList.remove('locked');
        });
    }

    function checkSpinState() {
        const spinning = localStorage.getItem('rouletteSpinning');
        const spinStart = parseInt(localStorage.getItem('rouletteSpinStart') || '0');
        const savedPrize = localStorage.getItem('roulettePrize');
        
        if (spinning === 'true') {
            const elapsed = (Date.now() - spinStart) / 1000;
            
            if (elapsed < SPIN_TIME_SECONDS) {
                // Continue spinning
                lockNavigation();
                
                const rouletteItems = prizePool.filter(p => !p.category || p.category === 'roulette');
                if (rouletteItems.length > 0) {
                    initTrack(rouletteItems);
                    
                    // Resume animation
                    const remainingTime = SPIN_TIME_SECONDS - elapsed;
                    const track = document.getElementById('track');
                    const containerWidth = document.querySelector('.carousel-outer')?.offsetWidth || 400;
                    const targetIndex = 55;
                    const targetCenter = (targetIndex * CARD_WIDTH) + (CARD_WIDTH / 2);
                    const scrollAmount = targetCenter - (containerWidth / 2);
                    
                    track.style.transition = `transform ${remainingTime}s cubic-bezier(0.15, 0, 0.2, 1)`;
                    track.style.transform = `translateX(-${scrollAmount}px)`;
                    
                    setTimeout(() => {
                        if (savedPrize) {
                            try {
                                currentWinPrize = JSON.parse(savedPrize);
                                showWinResult(currentWinPrize);
                            } catch (e) {
                                unlockNavigation();
                            }
                        } else {
                            unlockNavigation();
                        }
                    }, remainingTime * 1000);
                }
            } else if (savedPrize) {
                // Spin finished, show result
                try {
                    currentWinPrize = JSON.parse(savedPrize);
                    showWinResult(currentWinPrize);
                } catch (e) {
                    unlockNavigation();
                }
            } else {
                unlockNavigation();
            }
        }
    }

    // === TICKET PURCHASE ===
    window.openPurchaseModal = function() {
        if (isSpinning || awaitingExchangeChoice) {
            notify('–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä—É–ª–µ—Ç–∫–∏!', 'warning');
            return;
        }
        document.getElementById('purchaseModal').style.display = 'flex';
        document.getElementById('ticketCount').value = 1;
        updateTotalCost();
    };

    window.updateTotalCost = function() {
        let count = parseInt(document.getElementById('ticketCount').value) || 1;
        if (count < 1) count = 1;
        const price = calculatePromoPrice();
        document.getElementById('totalCostDisplay').innerText = (count * price) + " ‚ö™";
    };

    window.confirmPurchase = async function() {
        let count = parseInt(document.getElementById('ticketCount').value) || 1;
        if (count <= 0) return notify("–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å!", 'error');

        const price = calculatePromoPrice();
        const cost = count * price;
        const pts = userData.points || 0;

        if (pts < cost) return notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤!", 'error');
        
        document.getElementById('purchaseModal').style.display = 'none';
        showProcessing("–ö–í–ò–¢–ö–ò", `–ö—É–ø—ñ–≤–ª—è ${count} –∫–≤–∏—Ç–∫—ñ–≤...`);

        try {
            await updateDoc(doc(db, "users", currentUID), { 
                points: pts - cost, 
                roulette_passes: (userData.roulette_passes || 0) + count 
            });
            
            await addLog('TICKET_PURCHASE', `${count} –∫–≤–∏—Ç–∫—ñ–≤ –∑–∞ ${cost} –±–∞–ª—ñ–≤`);
            notify(`–ö—É–ø–ª–µ–Ω–æ ${count} –∫–≤–∏—Ç–∫—ñ–≤!`);
        } catch(e) {
            notify("–ü–æ–º–∏–ª–∫–∞: " + e.message, 'error');
        } finally {
            hideProcessing();
        }
    };

    // === SPIN LOGIC ===
    function createPrizeNode(p) {
        const el = document.createElement('div');
        el.className = 'prize-card';
        el.innerHTML = `<img src="${p.img || 'https://via.placeholder.com/90'}"><span>${p.name || 'Prize'}</span>`;
        return el;
    }

    function initTrack(prizes) {
        const track = document.getElementById('track');
        if (!track || prizes.length === 0) return;
        
        track.innerHTML = "";
        for (let i = 0; i < TOTAL_CARDS; i++) {
            const p = prizes[Math.floor(Math.random() * prizes.length)];
            track.appendChild(createPrizeNode(p));
        }
    }

    window.startSpin = async function() {
        if (isSpinRequested || isSpinning || awaitingExchangeChoice) return;
        
        if (!userData || userData.roulette_passes < 1) {
            notify("–ù–µ–º–∞—î –∫–≤–∏—Ç–∫—ñ–≤!", 'error');
            return;
        }
        
        isSpinRequested = true;
        const spinBtn = document.getElementById('spinBtn');
        spinBtn.disabled = true;
        
        lockNavigation();
        
        try {
            await updateDoc(doc(db, "users", currentUID), { 
                roulette_passes: Math.max(0, (userData.roulette_passes || 0) - 1) 
            });
            
            document.getElementById('winOverlay').style.display = 'none';
            document.getElementById('exchangeChoice').style.display = 'none';
            
            const track = document.getElementById('track');
            const rouletteItems = prizePool.filter(p => !p.category || p.category === 'roulette');
            
            if (rouletteItems.length === 0) {
                notify('–ù–µ–º–∞—î –ø—Ä–∏–∑—ñ–≤ –≤ —Ä—É–ª–µ—Ç—Ü—ñ!', 'error');
                unlockNavigation();
                spinBtn.disabled = false;
                return;
            }
            
            // Select winner based on chances
            let winPrize;
            if (isAutoOdds) {
                winPrize = rouletteItems[Math.floor(Math.random() * rouletteItems.length)];
            } else {
                const totalChance = rouletteItems.reduce((sum, p) => sum + (parseFloat(p.chance) || 0), 0);
                let rand = Math.random() * totalChance;
                for (const prize of rouletteItems) {
                    rand -= parseFloat(prize.chance) || 0;
                    if (rand <= 0) {
                        winPrize = prize;
                        break;
                    }
                }
                if (!winPrize) winPrize = rouletteItems[0];
            }
            
            currentWinPrize = winPrize;
            localStorage.setItem('roulettePrize', JSON.stringify(winPrize));
            
            // Place winning prize at target position
            const targetIndex = 55;
            const targetCard = track.children[targetIndex];
            if (targetCard) {
                const img = targetCard.querySelector('img');
                const txt = targetCard.querySelector('span');
                if (img) img.src = winPrize.img || 'https://via.placeholder.com/90';
                if (txt) txt.innerText = winPrize.name;
            }
            
            // Animate
            const containerWidth = document.querySelector('.carousel-outer').offsetWidth;
            const targetCenter = (targetIndex * CARD_WIDTH) + (CARD_WIDTH / 2);
            const scrollAmount = targetCenter - (containerWidth / 2);
            
            track.style.transition = `transform ${SPIN_TIME_SECONDS}s cubic-bezier(0.15, 0, 0.2, 1)`;
            track.style.transform = `translateX(-${scrollAmount}px)`;
            
            setTimeout(() => {
                showWinResult(winPrize);
            }, SPIN_TIME_SECONDS * 1000);
            
        } catch(e) {
            notify("–ü–æ–º–∏–ª–∫–∞: " + e.message, 'error');
            unlockNavigation();
            spinBtn.disabled = false;
        }
    };

    async function showWinResult(prize) {
        document.getElementById('winPrizeName').innerText = prize.name;
        document.getElementById('winOverlay').style.display = 'flex';
        
        notify(`üéâ –í–∏–≥—Ä–∞—à: ${prize.name}`);
        
        // Check if exchange action
        if (prize.action === 'exchange') {
            awaitingExchangeChoice = true;
            
            document.getElementById('sellPointsValue').innerText = prize.exchangePoints || 0;
            document.getElementById('sellCurrencyValue').innerText = prize.exchangeCurrency || 0;
            document.getElementById('exchangeChoice').style.display = 'flex';
            
            // Keep lock overlay but allow choice buttons
            document.getElementById('spinLockOverlay').style.display = 'none';
        } else {
            // Auto process regular wins
            await processWin(prize, null);
            
            setTimeout(() => {
                resetAfterWin();
            }, 3000);
        }
    }

    window.selectExchangeOption = async function(option) {
        if (!currentWinPrize) return;
        
        const prize = currentWinPrize;
        awaitingExchangeChoice = false;
        
        showProcessing("–û–ë–†–û–ë–ö–ê", "–ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∞—à –≤–∏–±—ñ—Ä...");
        
        await processWin(prize, option);
        
        hideProcessing();
        
        // Discord notification
        let choiceText = option === 'points' ? `–ü—Ä–æ–¥–∞–≤ –∑–∞ ${prize.exchangePoints} –±–∞–ª—ñ–≤` :
                        option === 'currency' ? `–ü—Ä–æ–¥–∞–≤ –∑–∞ ${prize.exchangeCurrency} ‚Ç¥` :
                        '–ó–∞–ª–∏—à–∏–≤ —Å–æ–±—ñ';
        
        await sendDiscordNotification(
            'üé∞ –í–ò–ë–Ü–† –ü–†–ò–ó–£',
            `**${userData.name}** –≤–∏–≥—Ä–∞–≤ **${prize.name}**\n${choiceText}`,
            option === 'keep' ? 0x94a3b8 : 0x22c55e
        );
        
        notify(`${choiceText}!`);
        
        resetAfterWin();
    };

    async function processWin(prize, exchangeOption) {
        try {
            const action = prize.action || 'item';
            const actionVal = parseInt(prize.actionVal) || 0;
            
            if (action === 'points') {
                await updateDoc(doc(db, "users", currentUID), {
                    points: (userData.points || 0) + actionVal
                });
            } else if (action === 'currency') {
                await updateDoc(doc(db, "users", currentUID), {
                    currency: (userData.currency || 0) + actionVal
                });
            } else if (action === 'ticket') {
                await updateDoc(doc(db, "users", currentUID), {
                    roulette_passes: (userData.roulette_passes || 0) + actionVal
                });
            } else if (action === 'exchange' && exchangeOption) {
                if (exchangeOption === 'points') {
                    await updateDoc(doc(db, "users", currentUID), {
                        points: (userData.points || 0) + (parseInt(prize.exchangePoints) || 0)
                    });
                } else if (exchangeOption === 'currency') {
                    await updateDoc(doc(db, "users", currentUID), {
                        currency: (userData.currency || 0) + (parseInt(prize.exchangeCurrency) || 0)
                    });
                }
            }
            
            await addLog('ROULETTE_WIN', `–í–∏–≥—Ä–∞–≤: ${prize.name}${exchangeOption ? ' (' + exchangeOption + ')' : ''}`);
            
            // Discord win notification (only for non-exchange or keep)
            if (action !== 'exchange' || exchangeOption === 'keep') {
                await sendDiscordNotification(
                    'üé∞ –í–ò–ì–†–ê–® –ó –†–£–õ–ï–¢–ö–ò',
                    `**${userData.name}** –≤–∏–≥—Ä–∞–≤ **${prize.name}**!`,
                    0xf97316
                );
            }
        } catch (e) {
            console.error("Process win error:", e);
        }
    }

    function resetAfterWin() {
        document.getElementById('winOverlay').style.display = 'none';
        document.getElementById('exchangeChoice').style.display = 'none';
        
        const track = document.getElementById('track');
        track.style.transition = 'none';
        track.style.transform = 'translateX(0)';
        
        const rouletteItems = prizePool.filter(p => !p.category || p.category === 'roulette');
        initTrack(rouletteItems);
        
        currentWinPrize = null;
        unlockNavigation();
        
        const spinBtn = document.getElementById('spinBtn');
        spinBtn.disabled = (userData.roulette_passes || 0) < 1;
    }

    // === LOGS ===
    async function addLog(action, desc) {
        try {
            await addDoc(collection(db, "logs"), {
                user: userData.name || 'Unknown',
                action: action,
                desc: desc,
                timestamp: serverTimestamp()
            });
        } catch (e) { console.error("Add log error:", e); }
    }

    function loadLogs() {
        const q = query(collection(db, "logs"), orderBy("timestamp", "desc"), limit(50));
        onSnapshot(q, (snap) => {
            const list = document.getElementById('logsList');
            if (!list) return;
            list.innerHTML = "";
            snap.forEach(d => {
                const data = d.data();
                const time = data.timestamp ? new Date(data.timestamp.seconds * 1000).toLocaleTimeString() : "???";
                list.innerHTML += `
                    <div class="log-entry">
                        <span class="log-time">[${time}]</span>
                        <span class="log-user">${data.user}</span>
                        <span class="log-action"> ${data.action}</span>
                        <span class="log-desc"> - ${data.desc}</span>
                    </div>`;
            });
        });
    }

    // === AUTO ODDS ===
    window.toggleAutoOdds = async function() {
        if (userData.role !== 'admin') {
            notify("–¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω!", 'error');
            document.getElementById('autoOddsToggle').checked = isAutoOdds;
            return;
        }
        
        isAutoOdds = document.getElementById('autoOddsToggle').checked;
        
        try {
            await setDoc(doc(db, "settings", "autoOdds"), {
                enabled: isAutoOdds,
                updatedAt: serverTimestamp()
            });
            notify(isAutoOdds ? '–ê–≤—Ç–æ—à–∞–Ω—Å–∏ —É–≤—ñ–º–∫–Ω–µ–Ω–æ!' : '–†—É—á–Ω—ñ —à–∞–Ω—Å–∏!');
            renderManage();
        } catch (e) {
            notify('–ü–æ–º–∏–ª–∫–∞: ' + e.message, 'error');
        }
    };

    async function loadAutoOdds() {
        try {
            const snap = await getDoc(doc(db, "settings", "autoOdds"));
            if (snap.exists()) {
                isAutoOdds = snap.data().enabled || false;
                document.getElementById('autoOddsToggle').checked = isAutoOdds;
            }
        } catch (e) { console.error("Auto odds load error:", e); }
    }

    // === PRIZE MANAGEMENT ===
    window.previewSlotImage = function() {
        const file = document.getElementById('newPrizeImgFile').files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (e) => {
            currentSlotBase64 = e.target.result;
            const img = document.getElementById('slotImgPreview');
            img.src = currentSlotBase64;
            img.style.display = 'block';
        };
        reader.readAsDataURL(file);
    };

    window.togglePrizeSettings = function() {
        const cat = document.getElementById('newPrizeCategory').value;
        document.getElementById('rouletteSettings').style.display = cat === 'roulette' ? 'block' : 'none';
        document.getElementById('shopSettings').style.display = cat === 'shop' ? 'block' : 'none';
    };

    window.toggleActionVal = function() {
        const action = document.getElementById('newPrizeActionType').value;
        document.getElementById('actionValContainer').style.display = 
            (action === 'points' || action === 'currency' || action === 'ticket') ? 'block' : 'none';
        document.getElementById('exchangeValContainer').style.display = 
            action === 'exchange' ? 'block' : 'none';
    };

    window.editPrize = function(id) {
        if (userData.role !== 'admin') return notify("–¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω!", 'error');
        
        editingId = id;
        const p = prizePool.find(prize => prize.id === id);
        if (!p) return;
        
        document.getElementById('newPrizeName').value = p.name;
        document.getElementById('newPrizeCategory').value = p.category || 'roulette';
        togglePrizeSettings();
        
        document.getElementById('newPrizeActionType').value = p.action || 'item';
        toggleActionVal();
        
        if (p.category !== 'shop') {
            document.getElementById('newPrizeChance').value = p.chance || 10;
        }
        if (p.category === 'shop') {
            document.getElementById('newPrizePrice').value = p.price || 0;
        }
        
        document.getElementById('newPrizeActionVal').value = p.actionVal || "";
        document.getElementById('newPrizeExchangePoints').value = p.exchangePoints || "";
        document.getElementById('newPrizeExchangeCurrency').value = p.exchangeCurrency || "";
        
        currentSlotBase64 = p.img;
        const img = document.getElementById('slotImgPreview');
        img.src = p.img;
        img.style.display = 'block';

        document.getElementById('formTitle').innerText = "‚úèÔ∏è –†–ï–î–ê–ì–£–í–ê–¢–ò –°–õ–û–¢";
        document.getElementById('savePrizeBtn').innerText = "üíæ –û–ù–û–í–ò–¢–ò";
        document.getElementById('savePrizeBtn').style.gridColumn = 'span 1';
        document.getElementById('cancelEditBtn').style.display = 'block';
        
        document.getElementById('tabPrizes').scrollIntoView({behavior: "smooth"});
    };

    window.savePrize = async function() {
        if (userData.role !== 'admin') return notify("–¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω!", 'error');
        
        const name = document.getElementById('newPrizeName').value.trim();
        const cat = document.getElementById('newPrizeCategory').value;
        const act = document.getElementById('newPrizeActionType').value;
        
        if (!name) return notify("–ù–∞–∑–≤–∞ –æ–±–æ–≤'—è–∑–∫–æ–≤–∞!", 'error');
        if (!editingId && !currentSlotBase64) return notify("–§–æ—Ç–æ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ!", 'error');

        const data = { name, category: cat, action: act };
        
        if (currentSlotBase64) data.img = currentSlotBase64;
        
        if (cat === 'roulette') {
            data.chance = parseFloat(document.getElementById('newPrizeChance').value) || 10;
        } else {
            data.price = parseInt(document.getElementById('newPrizePrice').value) || 100;
        }

        if (act === 'points' || act === 'currency' || act === 'ticket') {
            data.actionVal = document.getElementById('newPrizeActionVal').value;
        }
        
        if (act === 'exchange') {
            data.exchangePoints = document.getElementById('newPrizeExchangePoints').value;
            data.exchangeCurrency = document.getElementById('newPrizeExchangeCurrency').value;
        }

        try {
            if (editingId) {
                await updateDoc(doc(db, "roulette_prizes", editingId), data);
                notify("–°–ª–æ—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ!");
            } else {
                await addDoc(collection(db, "roulette_prizes"), data);
                notify("–°–ª–æ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ!");
            }
            resetPrizeForm();
        } catch (e) {
            notify("–ü–æ–º–∏–ª–∫–∞: " + e.message, 'error');
        }
    };

    window.deletePrize = async function(id) {
        if (userData.role !== 'admin') return notify("–¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω!", 'error');
        if (confirm("–í–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π —Å–ª–æ—Ç?")) {
            await deleteDoc(doc(db, "roulette_prizes", id));
            notify("–°–ª–æ—Ç –≤–∏–¥–∞–ª–µ–Ω–æ");
        }
    };

    window.resetPrizeForm = function() {
        editingId = null;
        document.getElementById('newPrizeName').value = "";
        document.getElementById('newPrizeImgFile').value = "";
        document.getElementById('slotImgPreview').style.display = 'none';
        document.getElementById('newPrizeActionVal').value = "";
        document.getElementById('newPrizeExchangePoints').value = "";
        document.getElementById('newPrizeExchangeCurrency').value = "";
        currentSlotBase64 = null;
        document.getElementById('formTitle').innerText = "‚ûï –°–¢–í–û–†–ò–¢–ò –ù–û–í–ò–ô –°–õ–û–¢";
        document.getElementById('savePrizeBtn').innerText = "üíæ –ó–ë–ï–†–ï–ì–¢–ò";
        document.getElementById('savePrizeBtn').style.gridColumn = 'span 2';
        document.getElementById('cancelEditBtn').style.display = 'none';
    };

    function renderManage() {
        const rouletteGrid = document.getElementById('manageRouletteGrid');
        const shopGrid = document.getElementById('manageShopGrid');
        if (!rouletteGrid || !shopGrid) return;

        rouletteGrid.innerHTML = "";
        shopGrid.innerHTML = "";
        
        const rouletteItems = prizePool.filter(p => !p.category || p.category === 'roulette');
        const totalChance = rouletteItems.reduce((sum, p) => sum + (parseFloat(p.chance) || 0), 0);

        prizePool.forEach(p => {
            let infoText = "";
            if (p.category === 'shop') {
                const finalPrice = calculateShopPrice(p.price || 0);
                infoText = `${finalPrice} ‚ö™`;
            } else {
                if (isAutoOdds) {
                    infoText = `${(100 / rouletteItems.length).toFixed(1)}%`;
                } else {
                    const realPercent = totalChance > 0 ? ((parseFloat(p.chance) || 0) / totalChance * 100).toFixed(1) : 0;
                    infoText = `${realPercent}%`;
                }
            }

            const html = `
                <div class="manage-card">
                    <img src="${p.img || 'https://via.placeholder.com/50'}">
                    <div class="manage-card-name">${p.name}</div>
                    <div class="manage-card-info">${infoText}</div>
                    <div class="manage-card-actions">
                        <button class="manage-btn edit" onclick="editPrize('${p.id}')">‚úèÔ∏è</button>
                        <button class="manage-btn delete" onclick="deletePrize('${p.id}')">üóëÔ∏è</button>
                    </div>
                </div>`;
            
            if (p.category === 'shop') {
                shopGrid.innerHTML += html;
            } else {
                rouletteGrid.innerHTML += html;
            }
        });
        
        if (rouletteGrid.innerHTML === '') {
            rouletteGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-gray); padding: 20px;">–ù–µ–º–∞—î —Å–ª–æ—Ç—ñ–≤</div>';
        }
        if (shopGrid.innerHTML === '') {
            shopGrid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-gray); padding: 20px;">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤</div>';
        }
    }

    function loadPrizes() {
        onSnapshot(collection(db, "roulette_prizes"), (snap) => {
            prizePool = [];
            snap.forEach(d => prizePool.push({ id: d.id, ...d.data() }));
            
            const rouletteItems = prizePool.filter(p => !p.category || p.category === 'roulette');
            const shopItems = prizePool.filter(p => p.category === 'shop');
            
            renderRoulettePreview(rouletteItems);
            renderShop(shopItems);
            renderManage();
            
            if (!isSpinning) {
                initTrack(rouletteItems);
            }
            
            // Check for resumed spin state
            setTimeout(() => checkSpinState(), 500);
        });
    }

    function renderRoulettePreview(items) {
        const preview = document.getElementById('prizePreview');
        if (!preview) return;
        preview.innerHTML = "";
        
        if (items.length === 0) {
            preview.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: var(--text-gray); padding: 30px;">–ù–µ–º–∞—î –ø—Ä–∏–∑—ñ–≤</div>';
            return;
        }
        
        items.forEach(p => {
            preview.innerHTML += `
                <div class="prize-preview-card">
                    <img src="${p.img || 'https://via.placeholder.com/50'}">
                    <span>${p.name}</span>
                </div>`;
        });
    }

    function renderShop(items) {
        const grid = document.getElementById('shopGrid');
        if (!grid) return;
        
        if (items.length === 0) {
            grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; color: var(--text-gray);">–ú–ê–ì–ê–ó–ò–ù –ü–û–†–û–ñ–ù–Ü–ô</div>';
            return;
        }
        
        grid.innerHTML = "";
        items.forEach(p => {
            const originalPrice = p.price || 0;
            const finalPrice = calculateShopPrice(originalPrice);
            const hasDiscount = currentShopPromotion.isActive && currentShopPromotion.percentage !== 0;
            
            grid.innerHTML += `
                <div class="shop-card">
                    ${hasDiscount ? `<div class="sale-badge">${currentShopPromotion.percentage > 0 ? '+' : ''}${currentShopPromotion.percentage}%</div>` : ''}
                    <img src="${p.img || 'https://via.placeholder.com/100'}">
                    <div class="shop-card-name">${p.name}</div>
                    ${hasDiscount ? `<div class="shop-card-original">${originalPrice} ‚ö™</div>` : ''}
                    <div class="shop-card-price ${hasDiscount ? 'on-sale' : ''}">${finalPrice} ‚ö™</div>
                    <button class="btn-main btn-buy" style="width: 100%; padding: 12px;" onclick="buyShopItem('${p.id}')">
                        –ö–£–ü–ò–¢–ò
                    </button>
                </div>`;
        });
    }

    window.buyShopItem = async function(id) {
        if (isSpinning || awaitingExchangeChoice) {
            notify('–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä—É–ª–µ—Ç–∫–∏!', 'warning');
            return;
        }
        
        const item = prizePool.find(p => p.id === id);
        if (!item) return;
        
        const finalPrice = calculateShopPrice(item.price || 0);
        const points = userData.points || 0;
        
        if (points < finalPrice) {
            notify('–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –±–∞–ª—ñ–≤!', 'error');
            return;
        }
        
        showProcessing("–ü–û–ö–£–ü–ö–ê", `–ö—É–ø—ñ–≤–ª—è: ${item.name}`);
        
        try {
            await updateDoc(doc(db, "users", currentUID), { 
                points: points - finalPrice 
            });
            
            await addLog('SHOP_PURCHASE', `${item.name} –∑–∞ ${finalPrice} –±–∞–ª—ñ–≤`);
            notify('–ü–æ–∫—É–ø–∫–∞ —É—Å–ø—ñ—à–Ω–∞!');
        } catch(e) {
            notify("–ü–æ–º–∏–ª–∫–∞: " + e.message, 'error');
        } finally {
            hideProcessing();
        }
    };

    // === NAVIGATION ===
    window.showPage = function(pageId, btn) {
        if (isSpinning || awaitingExchangeChoice) {
            notify('–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä—É–ª–µ—Ç–∫–∏!', 'warning');
            return;
        }
        
        document.querySelectorAll('.content-section').forEach(el => el.classList.remove('active'));
        document.getElementById(pageId + 'Page').classList.add('active');
        
        document.querySelectorAll('.sidebar .menu-btn').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');

        document.getElementById('footerPageLabel').innerText = pageId.toUpperCase();
    };

    window.switchAdminTab = function(tabId, btn) {
        document.querySelectorAll('.admin-tab').forEach(el => el.style.display = 'none');
        
        const tabName = tabId.charAt(0).toUpperCase() + tabId.slice(1);
        const tab = document.getElementById('tab' + tabName);
        if (tab) tab.style.display = 'block';
        
        document.querySelectorAll('.admin-tab-btn').forEach(b => b.classList.remove('active'));
        if (btn) btn.classList.add('active');
    };

    // === AUTH & INIT ===
    onAuthStateChanged(auth, async (u) => {
        if (!u) {
            window.location.href = "login.html";
            return;
        }
        
        user = u;
        currentUID = u.uid;
        
        // Listen to user data
        onSnapshot(doc(db, "users", u.uid), (s) => {
            userData = s.data() || {};
            
            document.getElementById('pointsVal').innerText = userData.points || 0;
            document.getElementById('currencyVal').innerText = userData.currency || 0;
            
            const tickets = userData.roulette_passes || 0;
            document.getElementById('ticketsVal').innerText = tickets;
            document.getElementById('footerRoleLabel').innerText = (userData.role || 'user').toUpperCase();
            
            const spinBtn = document.getElementById('spinBtn');
            spinBtn.disabled = tickets < 1 || isSpinning || awaitingExchangeChoice;
            
            if (['admin', 'instructor'].includes(userData.role)) {
                document.getElementById('adminBtn').style.display = 'flex';
                loadUsersForTopUp();
                loadLogs();
                
                if (userData.role !== 'admin') {
                    document.getElementById('instructorNotice').style.display = 'block';
                    document.getElementById('prizeFormActions').style.display = 'none';
                }
            }
        });

        // Load all settings
        await loadTicketPrice();
        await loadPromoSettings();
        await loadShopPromoSettings();
        await loadAutoOdds();
        await loadDiscordSettings();
        loadPrizes();
    });

    // Prevent back navigation during spin
    window.addEventListener('beforeunload', (e) => {
        if (isSpinning || awaitingExchangeChoice) {
            e.preventDefault();
            e.returnValue = '';
        }
    });

    // Block back link
    document.getElementById('backLink').addEventListener('click', (e) => {
        if (isSpinning || awaitingExchangeChoice) {
            e.preventDefault();
            notify('–ó–∞—á–µ–∫–∞–π—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ä—É–ª–µ—Ç–∫–∏!', 'warning');
        }
    });
</script>

</body>
</html>
