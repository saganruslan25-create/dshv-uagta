<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–®–í | –†–£–õ–ï–¢–ö–ê –£–î–ê–ß–Ü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* –ó–∞–ª—ñ–∑–Ω–∞ (Iron/Steel) –ø–∞–ª—ñ—Ç—Ä–∞ */
            --bg-dark: #111116;
            --card-bg: rgba(20, 25, 30, 0.8);
            --border-iron: #4a5568;
            --neon-blue: #00e1ff;
            --neon-orange: #ff9900;
            --text-main: #e2e8f0;
            --text-dim: #6b7280;
            --danger: #ff4444;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 10%, rgba(0, 225, 255, 0.1) 0%, transparent 60%),
                              linear-gradient(0deg, #0b0c10, #16181c);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            user-select: none;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 5%;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid var(--border-iron);
            backdrop-filter: blur(15px);
        }
        .logo {
            background: linear-gradient(135deg, #0f2b5e, #00e1ff);
            color: #000;
            padding: 5px 10px;
            border-radius: 6px;
            font-weight: 900;
            text-decoration: none;
            font-size: 14px;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(0, 225, 255, 0.3);
        }
        
        .header-right {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .info-box {
            background: rgba(20, 25, 30, 0.6);
            border: 1px solid var(--border-iron);
            padding: 8px 20px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }
        .balance-label { font-size: 12px; color: var(--text-dim); font-weight: 700; text-transform: uppercase; }
        .balance-amount { font-size: 20px; font-weight: 900; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }

        .btn-header {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-15);
            color: #ccc;
            padding: 8px 16px; border-radius: 8px;
            text-decoration: none;
            font-size: 12px; font-weight: 700;
            cursor: pointer;
        }
        .btn-header:hover { border-color: var(--text-dim); color: white; }

        /* –û–°–ù–û–í–ù–ò–ô –ú–ê–ö–ï–¢ */
        .marketplace {
            display: flex;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 30px;
            padding: 20px;
            flex-grow: 1;
        }

        /* –†–£–õ–ï–¢–ö–ê */
        .wheel-container {
            position: relative;
            width: 350px;
            height: 350px;
        }
        
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 8px solid var(--border-iron);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(0, 0,0, 0.8);
            background: #0b0c10; /* –¢–µ–º–Ω–∏–π —Ü–µ–Ω—Ç—Ä –∫–æ–ª–µ—Å–∞ */
            transition: transform 4s cubic-bezier(0.1, 0, 0.3, 1); /* –ü–ª–∞–≤–Ω–µ –≥–∞–ª—å–º—É–≤–∞–Ω–Ω—è */
            transform: rotate(0deg);
        }

        .sector {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                /* 0-30deg: Green (x500) */
                from 0deg, #00e1ff, 0deg, #0e1ff), 
                from 0deg, #00e1ff, 30deg, #000), 
                from 30deg, #000, 60deg, #111116), 
                /* 60-120deg: Orange (Loss) */
                from 30deg, #ff9900, 60deg, #ff9900),
                /* 120-360deg: Gradient Mix (Mostly Losses) */
                from 120deg, #4a5568, 180deg, #1a1c23),
                from 180deg, #1a1c23, 240deg, #111116),
                from 240deg, #111116, 300deg, #1a1c23),
                from 300deg, #1a1c23, 360deg, #4a5568),
                from 360deg, #4a5568, 0deg, #4a5568)
            );
            mask: radial-gradient(transparent 68%, transparent 69%), conic-gradient(#111116 0%, #111116 100%);
            -webkit-mask: radial-gradient(transparent 68%, transparent 69%), conic-gradient(#111116 0%, #111116 100%);
            -webkit-mask-composite: content-box; /* Firefox support */
            mask: conic-gradient(transparent 69%, #111116 70%, #111116 100%);
        }

        /* –ú–∞—Ä–∫–µ—Ä (—Å—Ç—Ä—ñ–ª–æ—á–∫–∞ –∑–≤–µ—Ä—Ö—É) */
        .marker {
            position: absolute;
            top: 0; 
            left: 50%;
            transform: translateX(-50%);
            width: 0; height: 0;
            border-left: 12px solid white;
            border-top: 4px solid white;
            transform-origin: top center;
            filter: drop-shadow(0 2px 5px black);
            z-index: 2;
        }

        .multipliers {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .btn-mult {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-iron);
            color: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            font-weight: 900;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-mult.active {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 20px var(--neon-blue);
            border-color: var(--neon-blue);
        }
        .btn-mult:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        .btn-spin {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #1a1c23, #4a5568);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 900;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(74, 85, 104, 0.3);
            transition: all 0.3s;
        }
        .btn-spin:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(74, 85, 104, 0.6);
        }
        .btn-spin:disabled {
            background: #333;
            cursor: not-allowed;
            color: #777;
            box-shadow: none;
        }

        /* –ù–ò–ñ–ù–Ø –ß–ê–°–¢–ò–ù–ê (–ú–ê–ì–ê–ó–ò–ù) */
        .marketplace-store {
            width: 100%;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 15px;
            padding: 20px;
            background: rgba(20, 25, 30, 0.3);
            border: 1px solid var(--border-15);
            border-radius: 15px;
            min-height: 150px;
        }

        .store-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--border-15);
            border-radius: 12px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.3s;
        }
        .store-item:hover {
            border-color: var(--neon-blue);
            background: rgba(0, 225, 255, 0.05);
        }
        .item-icon { font-size: 24px; margin-bottom: 5px; }
        .item-name { font-size: 12px; color: var(--text-dim); text-align: center; }
        .item-price { font-size: 14px; color: var(--neon-orange); font-weight: 700; margin-top: auto; text-align: center; }

        /* –ö–ù–û–ü–ö–ò –ö–£–ü–Ü–í–õ–Ü */
        .btn-buy {
            background: transparent;
            border: 1px solid var(--border-15);
            color: var(--neon-blue);
            font-size: 11px;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: 0.2s;
            font-weight: 700;
        }
        .btn-buy:hover {
            background: var(--neon-blue);
            color: #000;
            box-shadow: 0 0 10px var(--neon-blue);
        }

        /* –ü–ê–ù–ï–õ–¨ –ö–û–ù–°–û–õ–Ü */
        .console-section {
            width: 100%;
            height: 200px;
            background: rgba(20, 25, 30, 0.4);
            border: 1px solid var(--border-iron);
            border-radius: 20px;
            margin-top: auto;
            display: none; /* –°—Ö–æ–≤–∞–Ω–æ –ø–æ–∫–∏ –ø–æ–∫–∏ –Ω–µ –≤—ñ–¥–∫—Ä–∏—Ç–æ */
            overflow: hidden;
            position: relative;
        }

        .console-header {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid var(--border-iron);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .console-title {
            color: var(--neon-blue);
            font-size: 12px; font-weight: 800;
            letter-spacing: 1px;
        }

        /* –ö–ù–û–ü–ö–ê –ö–û–ù–°–û–õ–Ü */
        .btn-console {
            background: transparent;
            border: 1px solid var(--border-15);
            color: var(--neon-blue);
            font-size: 12px;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-console:hover {
            background: rgba(0, 225, 255, 0.1);
            box-shadow: 0 0 10px var(--neon-blue);
        }

        /* –°–ø–∏—Å–æ–∫ –ª–æ–≥—ñ–≤ */
        #console-list {
            height: 130px;
            overflow-y: auto;
            padding: 10px;
            font-size: 11px;
            font-family: monospace;
            color: var(--text-dim);
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; }
        .log-time { color: #4a5568; margin-right: 10px; }
        .log-text { color: #e2e8f0; }
        .log-system { color: #888; font-style: italic; }
        .log-win { color: var(--neon-blue); font-weight: bold; }
        .log-lose { color: var(--danger); }
        .log-admin { color: var(--neon-orange); font-weight: bold; }

        /* –ê–î–ú–Ü–ù –ü–ê–ù–ï–õ–¨ */
        .admin-modal {
            display: none;
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 350px;
            background: #0d1216;
            border: 2px solid var(--neon-blue);
            border-radius: 12px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.9);
            z-index: 2000;
            backdrop-filter: blur(15px);
        }
        .modal-content { padding: 20px; }
        .modal-h3 { color: var(--neon-blue); margin: 0 0 10px 0; font-size: 18px; }
        .modal-select, .modal-input {
            width: 100%;
            background: #000;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        .modal-btn {
            width: 100%; padding: 10px;
            border: none;
            border-radius: 8px;
            font-weight: 700; cursor: pointer;
        }
        .btn-green { background: var(--neon-blue); color: #000; }
        .btn-red { background: #333; color: #ccc; cursor: pointer; }
        .btn-red:hover { background: var(--danger); color: white; border: none; }

        /* TOAST */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background: rgba(20, 25, 30, 0.95);
            color: white;
            text-align: center;
            border-radius: 8px;
            padding: 12px;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5000;
            box-shadow: 0 0 20px rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            border: 1px solid var(--border-15);
        }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s forwards; }
        @keyframes fadein { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeout { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }

        /* MODAL WIN/LOSE */
        .modal {
            display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .modal-box {
            background: linear-gradient(145deg, #111116, #1a1c23);
            border: 2px solid var(--neon-blue);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 0 50px rgba(0, 225, 255, 0.3);
            animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .modal-win h1 { color: var(--neon-blue); font-size: 42px; margin: 0; text-shadow: 0 0 30px var(--neon-blue); }
        .modal-win .win-amount { font-size: 64px; font-weight: 900; color: var(--primary); margin: 20px 0; }
        
        .modal-lose h1 { color: var(--danger); font-size: 42px; margin: 0; text-shadow: 0 0 30px var(--danger); text-transform: uppercase; }
        
        .btn-close {
            margin-top: 30px;
            background: #000; color: #888; border: 1px solid #333;
            padding: 10px 30px; border-radius: 8px; cursor: pointer; font-weight: 700;
        }
        .btn-close:hover { background: #333; color: white; border-color: #fff; }

        @media (max-width: 768px) {
            .marketplace {
                flex-direction: column;
            }
            .console-section {
                height: 150px;
            }
            .marketplace-store {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }
    </style>
</head>
<body>

    <header>
        <a href="cabinet.html" class="logo">‚Üê</a>
        <div class="header-right">
            <div class="info-box">
                <span class="balance-label">–ë–ê–õ–ê–ù–°</span>
                <span id="userBalance" class="balance-amount">0</span>
            </div>
            
            <button id="consoleBtn" class="btn-header" style="display:none;">–ö–û–ù–°–û–õ–¨</button>
        </div>
    </header>

    <div class="marketplace">
        <!-- 1. –†–£–õ–ï–¢–ö–ê (CENTER) -->
        <div class="wheel-container">
            <div class="wheel" id="wheel"></div>
            <div class="marker"></div>
        </div>

        <!-- 2. –ú–£–õ–¨–¢–ò–ü–õ–Ü–Ñ–† (BELOW WHEEL) -->
        <div class="multipliers">
            <button class="btn-mult active" onclick="setMultiplier(1)">x1</button>
            <button class="btn-mult" onclick="setMultiplier(2)">x2</button>
            <button class="btn-mult" onclick="setMultiplier(3)">x3</button>
            <button class="btn-mult" onclick="setMultiplier(5)">x5</button>
        </div>
        <button id="spinBtn" class="btn-spin">–ö–†–£–¢–ò (-100 –ì–†–ù)</button>

        <!-- 3. –ú–ê–ó–ê–ó–ò–ù (BOTTOM LEFT) -->
        <div class="marketplace-store" id="storeGrid">
            <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>

        <!-- 4. –ö–û–ù–°–û–õ–¨ (BOTTOM RIGHT) -->
        <div class="console-section" id="consoleSection">
            <div class="console-header">
                <span class="console-title">ü§ñ –°–ò–°–¢–ï–ú–ê –õ–û–ì–Ü–í</span>
                <button onclick="document.getElementById('adminModal').style.display='flex'" style="background:none; border:1px solid var(--border-15); color: var(--text-dim); cursor: pointer; font-size:10px; padding: 2px 8px;">‚öô –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø</button>
            </div>
            <div id="console-list"></div>
        </div>
    </div>

    <!-- MODAL: RESULT -->
    <div class="modal" id="resultModal">
        <div class="modal-box">
            <h1 id="resTitle">–í–ò–ì–†–ê–®!</h1>
            <div id="resAmount" class="win-amount">5000</div>
            <p style="color: #888; margin-bottom: 20px;">–ë–∞–ª–∞–Ω—Å –æ–Ω–æ–≤–ª–µ–Ω–æ.</p>
            <button class="btn-close" onclick="document.getElementById('resultModal').style.display='none'">–û–ö</button>
        </div>
    </div>

    <!-- MODAL: LOSS -->
    <div class="modal" id="lossModal">
        <div class="modal-box" style="border-color: var(--danger);">
            <h1 id="resTitle">–ü–†–û–ì–†–ê–®</h1>
            <p style="color: #888; margin-bottom: 20px;">–ü–æ—Å—Ç–∞—Ä–∞–π—Å—è —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑!</p>
            <button class="btn-close" onclick="document.getElementById('lossModal').style.display='none'">–û–ö</button>
        </div>
    </div>

    <!-- ADMIN MODAL -->
    <div id="adminModal" class="admin-modal">
        <div class="modal-content">
            <h3 class="modal-h3">–ö–ï–†–£–í–ê–ù–ù–Ø –ì–†–ê–í–¶–Ü–í</h3>
            <select id="adminUserSelect" class="modal-select"></select>
            
            <label class="modal-label">–°—É–º–∞ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è (–±–∞–ª–∞–Ω—Å):</label>
            <input type="number" id="adminAmount" class="modal-input" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É...">
            
            <button class="modal-btn btn-green" onclick="adminAction('add')">–ü–û–ü–û–í–ù–ò–¢–ò –ë–ê–õ–ê–ù–°</button>
            <button class="modal-btn btn-red" onclick="adminAction('remove')">–ó–ù–Ø–¢–ò –ë–ê–õ–ê–ù–°</button>
            
            <div style="margin-top: 15px; border-top: 1px solid #333; padding-top: 15px;">
                <label class="modal-label">–ü—Ä–∏–º—ñ—Ç–∫–∞ (–¥–ª—è –ª–æ–≥—ñ–≤):</label>
                <input type="text" id="adminNote" class="modal-input" placeholder="–î–æ–¥–∞—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è...">
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-close" onclick="document.getElementById('adminModal').style.display='none'">–ó–ê–ö–†–ò–¢–ò</button>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div id="toast">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</div>

    <script type="module">
        import { initializeApp } from "https://www/sites.gstatic.com/jsmodul/firebasejs/10.9.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/jsmodul/firebasejs/10.9.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, onSnapshot, setDoc, addDoc, collection, query, orderBy, increment, serverTimestamp } from "https://www.gstatic.com/jsmodul/firebasejs/10.9.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyATUpLUHSp1VbyxkJXhMS-2R71zNOBGC00",
            authDomain: "dsv-gta.firebaseapp.com",
            "projectId": "dsv-gta",
            storageBucket: "dsv-gta.firebasestorage.app",
            "messagingSenderId": "661591588818",
            "appId": "1:661591588818:web:a8e8dca3d061447e24d20b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let myData = null;
        let userBalance = 0;
        let isSpinning = false;

        // --- –ü–†–ò–ó–´ (ITEMS) ---
        const items = [
            { 
                id: 1, 
                name: "–ö—Ä—É—Ç–∏—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ", 
                icon: "üé≤", 
                price: 0, 
                type: "free" 
            },
            { 
                id: 2, 
                name: "–ö—É–ø–∏—Ç–∏ –∑–∞ 100 –ì–†–ù", 
                icon: "üíé", 
                price: 100, 
                type: "buy" 
            }
        ];

        // --- –î–û–î–ê–í–ê–ù–ù–Ø –¢–û–í–ê–†–Ü–í ---
        function renderStore() {
            const grid = document.getElementById('storeGrid');
            grid.innerHTML = "";
            
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'store-item';
                
                let actionBtn = '';
                if (item.type === 'free') {
                    actionBtn = `<button class="btn-buy">–ë–ï–ó–ö–û–®–¢–û–í–ù–û</button>`;
                div.onclick = () => {
                    spinWheel(1); // –ö—Ä—É—Ç–∏—Ç–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ (x1)
                };
            } else {
                actionBtn = `<button class="btn-buy">–ö–£–ü–ò–¢–ò</button>`;
                div.onclick = () => buySpin(item.price);
            }
                
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div class="item-name">${item.name}</div>
                    <div class="item-price">${item.price} –ì–†–ù</div>
                    ${actionBtn}
                `;
                grid.appendChild(div);
            });
        }

        // --- –õ–û–ì–Ü–ö–ê ---
        function addLog(text, type = 'info', meta = '') {
            const list = document.getElementById('console-list');
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = 'log-entry';
            
            let colorClass = 'log-text';
            if (type === 'win') colorClass = 'log-win';
            if (type === 'lose') colorClass = 'log-lose';
            if (type === 'admin') colorClass = 'log-admin';

            div.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="${colorClass}">${text}</span>
                ${meta ? `<div style="font-size:10px; color: #666; margin-top:2px;">${meta}</div>` : ''}
            `;
            
            list.prepend(div);
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.className = "show";
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // --- –†–£–õ–ï–¢–ö–ê ---
        const spinBtn = document.getElementById('spinBtn');
        const wheel = document.getElementById('wheel');

        function setMultiplier(mult) {
            if (isSpinning) return;
            // Update active state
            document.querySelectorAll('.btn-mult').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentMultiplier = mult;
            
            const cost = 100 * mult; // –¶—ñ–Ω–∞ x5 = 500
            
            if (myData.role === 'admin') {
                spinBtn.innerText = `–ö–†–£–¢–ò (x${mult})`;
                spinBtn.style.opacity = '1';
                spinBtn.disabled = false;
            } else {
                if (userBalance >= cost) {
                    spinBtn.innerText = `–ö–†–£–¢–ò (-${cost})`;
                    spinBtn.disabled = false;
                } else {
                    spinBtn.innerText = `–ù–ï–î–û–°–¢–ê–¢–ù–û (-${cost})`;
                    spinBtn.disabled = true;
                }
            }
        }

        let currentMultiplier = 1;

        window.spinWheel = async () => {
            if (isSpinning) return;

            const cost = 100 * currentMultiplier;
            
            if (myData.role !== 'admin' && userBalance < cost) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!"); // –ü–æ–º–∏–ª–∫–∞ —è–∫ —Ç–∏ –ø—Ä–æ—Å–∏–≤
                return;
            }

            // –í–∏—Ç—Ä–∞—á–∞—î–º–æ –∫–æ—à—Ç–∏
            if (myData.role !== 'admin') {
                userBalance -= cost;
                updateBalanceUI();
                // –õ–æ–≥: "–ì—Ä–∞–≤–µ—Ü—å –∫—Ä—É—Ç–∏–≤..."
            }

            // –ü–æ–≥–Ω–∞–ª–∏–º–æ –∫–Ω–æ–ø–∫—É
            isSpinning = true;
            if(myData.role !== 'admin') {
                spinBtn.disabled = true;
                spinBtn.innerText = "–ö–†–£–¢–ò...";
                spinBtn.style.color = "#666";
            }

            // –ê–ù–Ü–ú–ê–¶–Ü–Ø
            const sectors = 12;
            const sliceDeg = 360 / sectors; // 30 –≥—Ä–∞–¥—É—Å—ñ–≤
            // –î–æ–¥–∞—î–º–æ 5-10 –ø–æ–≤–Ω–∏—Ö –æ–±–µ—Ä—Ç—ñ–≤, –ø–æ—Ç—ñ–º —Ä–∞–Ω–¥–æ–º–Ω–µ —â–æ–± –ø–æ—Ç—Ä–∞–ø–∏—Ç–∏ –≤ —Ü–µ–Ω—Ç—Ä —Å–µ–≥–º–µ–Ω—Ç–∞
            const baseRotations = 5;
            const randomRotation = Math.floor(Math.random() * (sliceDeg - 20)); // –†–∞–Ω–¥–æ–º–Ω–∏–π –∫—É—Ç–æ–∫ (20 –≥—Ä–∞–¥—É—Å –∑ 30)
            const totalRotations = baseRotations + Math.floor(Math.random() * 5);
            const finalDegree = totalRotations * sliceDeg + randomRotation; // –ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ–≤–æ—Ä–æ—Ç
            
            // –û–±–∏—Ä–∞—î–º–æ —á–∏—Å–ª–æ —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –∫—É—Ç –≤—ñ–¥ 0 –¥–æ 360 (–∞–±–æ –±—ñ–ª—å—à–µ)
            const normalizedDeg = finalDegree % 360;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å–µ–∫—Ç–æ—Ä: normalizedDeg / sliceDeg
            const sectorIndex = Math.floor(normalizedDeg / sliceDeg);
            
            wheel.style.transition = "transform 4s cubic-bezier(0.1, 0, 0.3, 1)"; // –ü–ª–∞–≤–Ω–µ –∑—É–ø–∏–Ω–Ω—è
            wheel.style.transform = `rotate(${finalDegree}deg)`;

            // –ß–µ–∫–∞—î–º–æ, —á–∏ –≤–∏–≥—Ä–∞–ª–∏
            setTimeout(() => {
                isSpinning = // false;
                
                const prize = prizes[sectorIndex] || prizes[prizes.length - 1];
                
                handleResult(prize, currentMultiplier, normalizedDeg);
                
                // –í—ñ–¥–Ω–æ–≤–ª—è—î–º–æ –∫–Ω–æ–ø–∫—É
                setMultiplier(currentMultiplier); // –¶–µ —Ç–∞–∫–æ–∂ –≤—ñ–¥–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –±–∞–ª–∞–Ω—Å—É

            }, 4000); // –ß–µ–∫–∞—î–º–æ 4 —Å–µ–∫—É–Ω–¥–∏ (–ø—Ä–∏–±–ª–∏–∑–Ω–æ —á–∞—Å—É –∞–Ω—ñ–º–∞—Ü—ñ—ó –∫–æ–ª–µ—Å–∞)
        };

        async function handleResult(prize, mult, deg) {
            let message = "";
            let amount = 0;
            let title = "–ü–†–û–ì–†–ê–®";
            let modalId = "lossModal";
            let winColor = "#ef4444";

            if (prize.multiplier === 1) {
                // –í–∏–≥—Ä–∞—à - –ó–µ–ª–µ–Ω–µ
                amount = prize.value * mult;
                userBalance += amount;
                title = "–í–ò–ì–†–ê–®!";
                modalId = "resultModal";
                winColor = "var(--primary-blue)";
                message = `–í–∏ –≤–∏–≥—Ä–∞–ª–∏: ${prize.name}!`;
            } else {
                // –ü—Ä–æ–≥—Ä–∞—à - –ñ–æ–≤—Ç–∏–π –∞–±–æ –ü–æ–º–∞—Ä–∞–Ω–∂–µ–≤–∏–π
                title = "–ü–†–û–ì–†–ê–®";
                if (prize.name === "–ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è") {
                     // –ü–æ–º–∞—Ä–∞–Ω–∂–µ–≤–∏–π
                } else {
                    // –ó–≤–∏—á–∞–π–Ω–∏–π –ø—Ä–æ–≥—Ä–∞—à
                    message = "–ù—ñ—á–æ–≥–æ.";
                }
            }

            // –û–Ω–æ–≤–ª—é—î–º–æ –±–∞–ª–∞–Ω—Å –≤ –±–∞–∑—ñ —Ç–∞ UI
            if (amount > 0) {
                await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: userBalance });
                addLog(`–í–ò–ì–†–ê–®! (+${amount} –ì–†–ù)`, 'win');
            } else {
                addLog(`–†–µ–∑—É–ª—å—Ç–∞—Ç: –°–µ–∫—Ç–æ—Ä ${Math.floor(deg/30)+1}.`);
            }

            // –ü–æ–∫–∞–∑—É—î–º–æ –º–æ–¥–∞–ª—å–∫—É
            const resTitle = document.getElementById('resTitle');
            const resAmount = document.getElementById('resAmount');
            resTitle.innerText = title;
            resAmount.innerText = amount > 0 ? `+${amount} –ì–†–ù` : "0";
            resAmount.style.color = winColor;

            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
        }

        // --- –ö–£–ü–û–í–õ–Ø ---
        async function buySpin(price) {
            // –¢—ñ–ª—å–∫–∏ –¥–ª—è –≥—Ä–∞–≤—Ü—ñ–≤
            if (userBalance < price) {
                alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤!");
                return;
            }

            if (confirm("–ö—É–ø–∏—Ç–∏ –∫—Ä—É—Ç–æ–∫ –∑–∞ " + price + " –ì–†–ù?")) {
                userBalance -= price;
                updateBalanceUI();
                addLog(`–ö—É–ø–∏–≤ –∫—Ä—É—Ç–æ–∫ –∑–∞ ${price} –ì–†–ù`, 'info');
                
                // –û–¥—Ä–∞–∑—É –∫—Ä—É—Ç–∏–º–æ
                spinWheel(1);
            }
        }

        // --- –§–£–ù–ö–¶–Ü–á ---
        function updateBalanceUI() {
            document.getElementById('userBalance').innerText = userBalance + " –ì–†–ù";
            
            // –û–Ω–æ–≤–ª—è—î–º–æ –∫–Ω–æ–ø–∫—É –∫—Ä—É—Ç–∏—Ç–∏
            setMultiplier(currentMultiplier);
        }

        // --- –ö–û–ù–°–û–õ–¨ –ö–ù–û–ü–ö–ê ---
        const consoleBtn = document.getElementById('consoleBtn');
        const consoleSection = document.getElementById('consoleSection');

        consoleBtn.onclick = () => {
            consoleSection.style.display = consoleSection.style.display === 'none' ? 'block' : 'none';
        };

        window.openAdminModal = () => {
            document.getElementById('adminModal').style.display = 'flex';
        };
        window.closeAdminModal = () => {
            document.getElementById('adminModal').style.display = 'none';
        };

        window.adminAction = async (type) => {
            const uid = document.getElementById('adminUserSelect').value;
            const amount = parseInt(document.getElementById('adminAmount').value);
            const note = document.getElementById('adminNote').value;

            if (!uid) {
                alert("–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞!");
                return;
            }
            if (!amount || isNaN(amount)) {
                alert("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω—É —Å—É–º—É!");
                return;
            }

            if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ?")) {
                try {
                    const userRef = doc(db, "users", uid);
                    
                    if (type === 'add') {
                        await updateDoc(userRef, { balance: increment(userBalance, amount) });
                        addLog(`–ê–¥–º—ñ–Ω –¥–æ–¥–∞–≤ ${amount} –ì–†–ù –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É ${uid}`, 'admin');
                        showToast(`–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—É –¥–æ–¥–∞–Ω–æ ${amount} –ì–†–ù`);
                    } else {
                        const snap = await getDoc(userRef);
                        const curBal = snap.data().balance || 0;
                        const newBal = Math.max(0, curBal - amount);
                        await updateDoc(userRef, { balance: newBal });
                        addLog(`–ê–¥–º—ñ–Ω –∑–∞–±—Ä–∞–≤ ${amount} –ì–†–ù —É ${uid}`, 'admin');
                        showToast(`–ë–∞–ª–∞–Ω—Å –∑–º–µ–Ω—à–µ–Ω–æ –¥–ª—è ${uid}`);
                    }
                } catch (e) {
                    alert("–ü–æ–º–∏–ª–∫–∞: " + e.message);
                }
                window.closeAdminModal();
            }
        };

        // --- –ù–ê–í–ê–ù–¢–ê–ù–ù–Ø ---
        onAuthStateChanged(auth, async (user) => {
            if (!user) { window.location.href = "index.html"; return; }

            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                myData = userDoc.data();
                userBalance = myData.balance || 0;
                updateBalanceUI();
                renderStore();

                // –ê–¥–º—ñ–Ω—Å—å–∫–∞ –∫–Ω–æ–ø–∫–∞ –≤ —à–∞–ø—Ü—ñ (—Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω)
                if (myData.role === 'admin') {
                    consoleBtn.style.display = 'block';
                }
            } else {
                window.location.href = "index.html";
            }
        });

        // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è UI —Ç–æ–≤–∞—Ä—ñ–≤ –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.onload = () => {
            renderStore();
        }

    </script>
</body>
</html>
